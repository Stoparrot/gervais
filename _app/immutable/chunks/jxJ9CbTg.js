import{aC as Ei,F as or,aB as Ma}from"./BSv_i5Hy.js";var Ia=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ta(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var nr={exports:{}},Ra=nr.exports,fi;function ja(){return fi||(fi=1,function(u,n){(function(s,i){u.exports=i()})(Ra,function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(r[o]=a[o])})(e,t)},i=function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function c(e,t,r){for(var a,o=0,l=t.length;o<l;o++)!a&&o in t||((a=a||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ia,S=Object.keys,O=Array.isArray;function D(e,t){return typeof t!="object"||S(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var q=Object.getPrototypeOf,H={}.hasOwnProperty;function F(e,t){return H.call(e,t)}function L(e,t){typeof t=="function"&&(t=t(q(e))),(typeof Reflect>"u"?S:Reflect.ownKeys)(t).forEach(function(r){ie(e,r,t[r])})}var J=Object.defineProperty;function ie(e,t,r,a){J(e,t,D(r&&F(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},a))}function pe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ie(e.prototype,"constructor",e),{extend:L.bind(null,e.prototype)}}}}var be=Object.getOwnPropertyDescriptor,ue=[].slice;function ee(e,t,r){return ue.call(e,t,r)}function ve(e,t){return t(e)}function he(e){if(!e)throw new Error("Assertion Failed")}function Ue(e){d.setImmediate?setImmediate(e):setTimeout(e,0)}function ae(e,t){if(typeof t=="string"&&F(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],a=0,o=t.length;a<o;++a){var l=ae(e,t[a]);r.push(l)}return r}var f=t.indexOf(".");if(f!==-1){var h=e[t.substr(0,f)];return h==null?void 0:ae(h,t.substr(f+1))}}function re(e,t,r){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){he(typeof r!="string"&&"length"in r);for(var a=0,o=t.length;a<o;++a)re(e,t[a],r[a])}else{var l,f,h=t.indexOf(".");h!==-1?(l=t.substr(0,h),(f=t.substr(h+1))===""?r===void 0?O(e)&&!isNaN(parseInt(l))?e.splice(l,1):delete e[l]:e[l]=r:re(h=!(h=e[l])||!F(e,l)?e[l]={}:h,f,r)):r===void 0?O(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Ae(e){var t,r={};for(t in e)F(e,t)&&(r[t]=e[t]);return r}var Ce=[].concat;function Bt(e){return Ce.apply([],e)}var ot="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Bt([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return d[e]}),fn=new Set(ot.map(function(e){return d[e]})),Me=null;function Ee(e){return Me=new WeakMap,e=function t(r){if(!r||typeof r!="object")return r;var a=Me.get(r);if(a)return a;if(O(r)){a=[],Me.set(r,a);for(var o=0,l=r.length;o<l;++o)a.push(t(r[o]))}else if(fn.has(r.constructor))a=r;else{var f,h=q(r);for(f in a=h===Object.prototype?{}:Object.create(h),Me.set(r,a),r)F(r,f)&&(a[f]=t(r[f]))}return a}(e),Me=null,e}var Le={}.toString;function it(e){return Le.call(e).slice(8,-1)}var vt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Dt=typeof vt=="symbol"?function(e){var t;return e!=null&&(t=e[vt])&&t.apply(e)}:function(){return null};function me(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var de={};function ce(e){var t,r,a,o;if(arguments.length===1){if(O(e))return e.slice();if(this===de&&typeof e=="string")return[e];if(o=Dt(e)){for(r=[];!(a=o.next()).done;)r.push(a.value);return r}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(r=new Array(t);t--;)r[t]=e[t];return r}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var Kt=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Nt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],je=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Nt),Ms={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function bt(e,t){this.name=e,this.message=t}function Is(e,t){return e+". Errors: "+Object.keys(t).map(function(r){return t[r].toString()}).filter(function(r,a,o){return o.indexOf(r)===a}).join(`
`)}function hn(e,t,r,a){this.failures=t,this.failedKeys=a,this.successCount=r,this.message=Is(e,t)}function wt(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(r){return t[r]}),this.failuresByPos=t,this.message=Is(e,this.failures)}pe(bt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),pe(hn).from(bt),pe(wt).from(bt);var yr=je.reduce(function(e,t){return e[t]=t+"Error",e},{}),Qi=bt,$=je.reduce(function(e,t){var r=t+"Error";function a(o,l){this.name=r,o?typeof o=="string"?(this.message="".concat(o).concat(l?`
 `+l:""),this.inner=l||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=Ms[t]||r,this.inner=null)}return pe(a).from(Qi),e[t]=a,e},{});$.Syntax=SyntaxError,$.Type=TypeError,$.Range=RangeError;var Ts=Nt.reduce(function(e,t){return e[t+"Error"]=$[t],e},{}),dn=je.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=$[t]),e},{});function te(){}function Ct(e){return e}function Zi(e,t){return e==null||e===Ct?t:function(r){return t(e(r))}}function at(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ea(e,t){return e===te?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var a=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var l=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?at(a,this.onsuccess):a),o&&(this.onerror=this.onerror?at(o,this.onerror):o),l!==void 0?l:r}}function ta(e,t){return e===te?t:function(){e.apply(this,arguments);var r=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?at(r,this.onsuccess):r),a&&(this.onerror=this.onerror?at(a,this.onerror):a)}}function na(e,t){return e===te?t:function(r){var a=e.apply(this,arguments);D(r,a);var o=this.onsuccess,l=this.onerror;return this.onsuccess=null,this.onerror=null,r=t.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?at(o,this.onsuccess):o),l&&(this.onerror=this.onerror?at(l,this.onerror):l),a===void 0?r===void 0?void 0:r:D(a,r)}}function ra(e,t){return e===te?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function gr(e,t){return e===te?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var a=this,o=arguments.length,l=new Array(o);o--;)l[o]=arguments[o];return r.then(function(){return t.apply(a,l)})}return t.apply(this,arguments)}}dn.ModifyError=hn,dn.DexieError=bt,dn.BulkError=wt;var qe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Rs(e){qe=e}var qt={},js=100,ot=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,q(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,q(t),e]}(),Nt=ot[0],je=ot[1],ot=ot[2],je=je&&je.then,ut=Nt&&Nt.constructor,vr=!!ot,Ft=function(e,t){$t.push([e,t]),pn&&(queueMicrotask(ia),pn=!1)},br=!0,pn=!0,ct=[],mn=[],wr=Ct,ze={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:te,pgp:!1,env:{},finalize:te},N=ze,$t=[],lt=0,yn=[];function K(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=N;if(typeof e!="function"){if(e!==qt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&xr(this,this._value))}this._state=null,this._value=null,++t.ref,function r(a,o){try{o(function(l){if(a._state===null){if(l===a)throw new TypeError("A promise cannot be resolved with itself.");var f=a._lib&&_t();l&&typeof l.then=="function"?r(a,function(h,m){l instanceof K?l._then(h,m):l.then(h,m)}):(a._state=!0,a._value=l,Ds(a)),f&&xt()}},xr.bind(null,a))}catch(l){xr(a,l)}}(this,e)}var _r={get:function(){var e=N,t=wn;function r(a,o){var l=this,f=!e.global&&(e!==N||t!==wn),h=f&&!Ge(),m=new K(function(g,w){Sr(l,new Bs(Cs(a,e,f,h),Cs(o,e,f,h),g,w,e))});return this._consoleTask&&(m._consoleTask=this._consoleTask),m}return r.prototype=qt,r},set:function(e){ie(this,"then",e&&e.prototype===qt?_r:{get:function(){return e},set:_r.set})}};function Bs(e,t,r,a,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=a,this.psd=o}function xr(e,t){var r,a;mn.push(t),e._state===null&&(r=e._lib&&_t(),t=wr(t),e._state=!1,e._value=t,a=e,ct.some(function(o){return o._value===a._value})||ct.push(a),Ds(e),r&&xt())}function Ds(e){var t=e._listeners;e._listeners=[];for(var r=0,a=t.length;r<a;++r)Sr(e,t[r]);var o=e._PSD;--o.ref||o.finalize(),lt===0&&(++lt,Ft(function(){--lt==0&&kr()},[]))}function Sr(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++lt,Ft(sa,[r,e,t])}else e._listeners.push(t)}function sa(e,t,r){try{var a,o=t._value;!t._state&&mn.length&&(mn=[]),a=qe&&t._consoleTask?t._consoleTask.run(function(){return e(o)}):e(o),t._state||mn.indexOf(o)!==-1||function(l){for(var f=ct.length;f;)if(ct[--f]._value===l._value)return ct.splice(f,1)}(t),r.resolve(a)}catch(l){r.reject(l)}finally{--lt==0&&kr(),--r.psd.ref||r.psd.finalize()}}function ia(){ft(ze,function(){_t()&&xt()})}function _t(){var e=br;return pn=br=!1,e}function xt(){var e,t,r;do for(;0<$t.length;)for(e=$t,$t=[],r=e.length,t=0;t<r;++t){var a=e[t];a[0].apply(null,a[1])}while(0<$t.length);pn=br=!0}function kr(){var e=ct;ct=[],e.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)});for(var t=yn.slice(0),r=t.length;r;)t[--r]()}function gn(e){return new K(qt,!1,e)}function oe(e,t){var r=N;return function(){var a=_t(),o=N;try{return Ye(r,!0),e.apply(this,arguments)}catch(l){t&&t(l)}finally{Ye(o,!1),a&&xt()}}}L(K.prototype,{then:_r,_then:function(e,t){Sr(this,new Bs(null,null,e,t,N))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,r=arguments[1];return typeof t=="function"?this.then(null,function(a){return(a instanceof t?r:gn)(a)}):this.then(null,function(a){return(a&&a.name===t?r:gn)(a)})},finally:function(e){return this.then(function(t){return K.resolve(e()).then(function(){return t})},function(t){return K.resolve(e()).then(function(){return gn(t)})})},timeout:function(e,t){var r=this;return e<1/0?new K(function(a,o){var l=setTimeout(function(){return o(new $.Timeout(t))},e);r.then(a,o).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ie(K.prototype,Symbol.toStringTag,"Dexie.Promise"),ze.env=Ks(),L(K,{all:function(){var e=ce.apply(null,arguments).map(_n);return new K(function(t,r){e.length===0&&t([]);var a=e.length;e.forEach(function(o,l){return K.resolve(o).then(function(f){e[l]=f,--a||t(e)},r)})})},resolve:function(e){return e instanceof K?e:e&&typeof e.then=="function"?new K(function(t,r){e.then(t,r)}):new K(qt,!0,e)},reject:gn,race:function(){var e=ce.apply(null,arguments).map(_n);return new K(function(t,r){e.map(function(a){return K.resolve(a).then(t,r)})})},PSD:{get:function(){return N},set:function(e){return N=e}},totalEchoes:{get:function(){return wn}},newPSD:Xe,usePSD:ft,scheduler:{get:function(){return Ft},set:function(e){Ft=e}},rejectionMapper:{get:function(){return wr},set:function(e){wr=e}},follow:function(e,t){return new K(function(r,a){return Xe(function(o,l){var f=N;f.unhandleds=[],f.onunhandled=l,f.finalize=at(function(){var h,m=this;h=function(){m.unhandleds.length===0?o():l(m.unhandleds[0])},yn.push(function g(){h(),yn.splice(yn.indexOf(g),1)}),++lt,Ft(function(){--lt==0&&kr()},[])},f.finalize),e()},t,r,a)})}}),ut&&(ut.allSettled&&ie(K,"allSettled",function(){var e=ce.apply(null,arguments).map(_n);return new K(function(t){e.length===0&&t([]);var r=e.length,a=new Array(r);e.forEach(function(o,l){return K.resolve(o).then(function(f){return a[l]={status:"fulfilled",value:f}},function(f){return a[l]={status:"rejected",reason:f}}).then(function(){return--r||t(a)})})})}),ut.any&&typeof AggregateError<"u"&&ie(K,"any",function(){var e=ce.apply(null,arguments).map(_n);return new K(function(t,r){e.length===0&&r(new AggregateError([]));var a=e.length,o=new Array(a);e.forEach(function(l,f){return K.resolve(l).then(function(h){return t(h)},function(h){o[f]=h,--a||r(new AggregateError(o))})})})}),ut.withResolvers&&(K.withResolvers=ut.withResolvers));var ye={awaits:0,echoes:0,id:0},aa=0,vn=[],bn=0,wn=0,oa=0;function Xe(e,t,r,a){var o=N,l=Object.create(o);return l.parent=o,l.ref=0,l.global=!1,l.id=++oa,ze.env,l.env=vr?{Promise:K,PromiseProp:{value:K,configurable:!0,writable:!0},all:K.all,race:K.race,allSettled:K.allSettled,any:K.any,resolve:K.resolve,reject:K.reject}:{},t&&D(l,t),++o.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},a=ft(l,e,r,a),l.ref===0&&l.finalize(),a}function St(){return ye.id||(ye.id=++aa),++ye.awaits,ye.echoes+=js,ye.id}function Ge(){return!!ye.awaits&&(--ye.awaits==0&&(ye.id=0),ye.echoes=ye.awaits*js,!0)}function _n(e){return ye.echoes&&e&&e.constructor===ut?(St(),e.then(function(t){return Ge(),t},function(t){return Ge(),le(t)})):e}function ua(){var e=vn[vn.length-1];vn.pop(),Ye(e,!1)}function Ye(e,t){var r,a=N;(t?!ye.echoes||bn++&&e===N:!bn||--bn&&e===N)||queueMicrotask(t?(function(o){++wn,ye.echoes&&--ye.echoes!=0||(ye.echoes=ye.awaits=ye.id=0),vn.push(N),Ye(o,!0)}).bind(null,e):ua),e!==N&&(N=e,a===ze&&(ze.env=Ks()),vr&&(r=ze.env.Promise,t=e.env,(a.global||e.global)&&(Object.defineProperty(d,"Promise",t.PromiseProp),r.all=t.all,r.race=t.race,r.resolve=t.resolve,r.reject=t.reject,t.allSettled&&(r.allSettled=t.allSettled),t.any&&(r.any=t.any))))}function Ks(){var e=d.Promise;return vr?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ft(e,t,r,a,o){var l=N;try{return Ye(e,!0),t(r,a,o)}finally{Ye(l,!1)}}function Cs(e,t,r,a){return typeof e!="function"?e:function(){var o=N;r&&St(),Ye(t,!0);try{return e.apply(this,arguments)}finally{Ye(o,!1),a&&queueMicrotask(Ge)}}}function Pr(e){Promise===ut&&ye.echoes===0?bn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+je).indexOf("[native code]")===-1&&(St=Ge=te);var le=K.reject,ht="￿",We="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",qs="String expected.",kt=[],xn="__dbnames",Ar="readonly",Er="readwrite";function dt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Ns={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Sn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Ee(t))[e],t}}function Fs(){throw $.Type()}function Y(e,t){try{var r=$s(e),a=$s(t);if(r!==a)return r==="Array"?1:a==="Array"?-1:r==="binary"?1:a==="binary"?-1:r==="string"?1:a==="string"?-1:r==="Date"?1:a!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(o,l){for(var f=o.length,h=l.length,m=f<h?f:h,g=0;g<m;++g)if(o[g]!==l[g])return o[g]<l[g]?-1:1;return f===h?0:f<h?-1:1}(Us(e),Us(t));case"Array":return function(o,l){for(var f=o.length,h=l.length,m=f<h?f:h,g=0;g<m;++g){var w=Y(o[g],l[g]);if(w!==0)return w}return f===h?0:f<h?-1:1}(e,t)}}catch{}return NaN}function $s(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=it(e),e==="ArrayBuffer"?"binary":e)}function Us(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Ls=(se.prototype._trans=function(e,t,r){var a=this._tx||N.trans,o=this.name,l=qe&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function f(g,w,p){if(!p.schema[o])throw new $.NotFound("Table "+o+" not part of transaction");return t(p.idbtrans,p)}var h=_t();try{var m=a&&a.db._novip===this.db._novip?a===N.trans?a._promise(e,f,r):Xe(function(){return a._promise(e,f,r)},{trans:a,transless:N.transless||N}):function g(w,p,x,y){if(w.idbdb&&(w._state.openComplete||N.letThrough||w._vip)){var b=w._createTransaction(p,x,w._dbSchema);try{b.create(),w._state.PR1398_maxLoop=3}catch(_){return _.name===yr.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return g(w,p,x,y)})):le(_)}return b._promise(p,function(_,v){return Xe(function(){return N.trans=b,y(_,v,b)})}).then(function(_){if(p==="readwrite")try{b.idbtrans.commit()}catch{}return p==="readonly"?_:b._completion.then(function(){return _})})}if(w._state.openComplete)return le(new $.DatabaseClosed(w._state.dbOpenError));if(!w._state.isBeingOpened){if(!w._state.autoOpen)return le(new $.DatabaseClosed);w.open().catch(te)}return w._state.dbReadyPromise.then(function(){return g(w,p,x,y)})}(this.db,e,[this.name],f);return l&&(m._consoleTask=l,m=m.catch(function(g){return console.trace(g),le(g)})),m}finally{h&&xt()}},se.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?le(new $.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return r.core.get({trans:a,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(t)},se.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(O(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=S(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(h){if(h.compound&&t.every(function(g){return 0<=h.keyPath.indexOf(g)})){for(var m=0;m<t.length;++m)if(t.indexOf(h.keyPath[m])===-1)return!1;return!0}return!1}).sort(function(h,m){return h.keyPath.length-m.keyPath.length})[0];if(r&&this.db._maxKey!==ht){var l=r.keyPath.slice(0,t.length);return this.where(l).equals(l.map(function(m){return e[m]}))}!r&&qe&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var a=this.schema.idxByName;function o(h,m){return Y(h,m)===0}var f=t.reduce(function(p,m){var g=p[0],w=p[1],p=a[m],x=e[m];return[g||p,g||!p?dt(w,p&&p.multi?function(y){return y=ae(y,m),O(y)&&y.some(function(b){return o(x,b)})}:function(y){return o(x,ae(y,m))}):w]},[null,null]),l=f[0],f=f[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(f):r?this.filter(f):this.where(t).equals("")},se.prototype.filter=function(e){return this.toCollection().and(e)},se.prototype.count=function(e){return this.toCollection().count(e)},se.prototype.offset=function(e){return this.toCollection().offset(e)},se.prototype.limit=function(e){return this.toCollection().limit(e)},se.prototype.each=function(e){return this.toCollection().each(e)},se.prototype.toArray=function(e){return this.toCollection().toArray(e)},se.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},se.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,O(e)?"[".concat(e.join("+"),"]"):e))},se.prototype.reverse=function(){return this.toCollection().reverse()},se.prototype.mapToClass=function(e){var t,r=this.db,a=this.name;function o(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Fs&&(function(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function w(){this.constructor=m}s(m,g),m.prototype=g===null?Object.create(g):(w.prototype=g.prototype,new w)}(o,t=e),Object.defineProperty(o.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),o.prototype.table=function(){return a},e=o);for(var l=new Set,f=e.prototype;f;f=q(f))Object.getOwnPropertyNames(f).forEach(function(m){return l.add(m)});function h(m){if(!m)return m;var g,w=Object.create(e.prototype);for(g in m)if(!l.has(g))try{w[g]=m[g]}catch{}return w}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=h,this.hook("reading",h),e},se.prototype.defineClass=function(){return this.mapToClass(function(e){D(this,e)})},se.prototype.add=function(e,t){var r=this,a=this.schema.primKey,o=a.auto,l=a.keyPath,f=e;return l&&o&&(f=Sn(l)(e)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"add",keys:t!=null?[t]:null,values:[f]})}).then(function(h){return h.numFailures?K.reject(h.failures[0]):h.lastResult}).then(function(h){if(l)try{re(e,l,h)}catch{}return h})},se.prototype.update=function(e,t){return typeof e!="object"||O(e)?this.where(":id").equals(e).modify(t):(e=ae(e,this.schema.primKey.keyPath),e===void 0?le(new $.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},se.prototype.put=function(e,t){var r=this,a=this.schema.primKey,o=a.auto,l=a.keyPath,f=e;return l&&o&&(f=Sn(l)(e)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"put",values:[f],keys:t!=null?[t]:null})}).then(function(h){return h.numFailures?K.reject(h.failures[0]):h.lastResult}).then(function(h){if(l)try{re(e,l,h)}catch{}return h})},se.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?K.reject(r.failures[0]):void 0})},se.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Ns})}).then(function(t){return t.numFailures?K.reject(t.failures[0]):void 0})},se.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:e,trans:r}).then(function(a){return a.map(function(o){return t.hook.reading.fire(o)})})})},se.prototype.bulkAdd=function(e,t,r){var a=this,o=Array.isArray(t)?t:void 0,l=(r=r||(o?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(f){var g=a.schema.primKey,h=g.auto,g=g.keyPath;if(g&&o)throw new $.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");var m=e.length,g=g&&h?e.map(Sn(g)):e;return a.core.mutate({trans:f,type:"add",keys:o,values:g,wantResults:l}).then(function(b){var p=b.numFailures,x=b.results,y=b.lastResult,b=b.failures;if(p===0)return l?x:y;throw new wt("".concat(a.name,".bulkAdd(): ").concat(p," of ").concat(m," operations failed"),b)})})},se.prototype.bulkPut=function(e,t,r){var a=this,o=Array.isArray(t)?t:void 0,l=(r=r||(o?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(f){var g=a.schema.primKey,h=g.auto,g=g.keyPath;if(g&&o)throw new $.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");var m=e.length,g=g&&h?e.map(Sn(g)):e;return a.core.mutate({trans:f,type:"put",keys:o,values:g,wantResults:l}).then(function(b){var p=b.numFailures,x=b.results,y=b.lastResult,b=b.failures;if(p===0)return l?x:y;throw new wt("".concat(a.name,".bulkPut(): ").concat(p," of ").concat(m," operations failed"),b)})})},se.prototype.bulkUpdate=function(e){var t=this,r=this.core,a=e.map(function(f){return f.key}),o=e.map(function(f){return f.changes}),l=[];return this._trans("readwrite",function(f){return r.getMany({trans:f,keys:a,cache:"clone"}).then(function(h){var m=[],g=[];e.forEach(function(p,x){var y=p.key,b=p.changes,_=h[x];if(_){for(var v=0,k=Object.keys(b);v<k.length;v++){var P=k[v],A=b[P];if(P===t.schema.primKey.keyPath){if(Y(A,y)!==0)throw new $.Constraint("Cannot update primary key in bulkUpdate()")}else re(_,P,A)}l.push(x),m.push(y),g.push(_)}});var w=m.length;return r.mutate({trans:f,type:"put",keys:m,values:g,updates:{keys:a,changeSpecs:o}}).then(function(p){var x=p.numFailures,y=p.failures;if(x===0)return w;for(var b=0,_=Object.keys(y);b<_.length;b++){var v,k=_[b],P=l[Number(k)];P!=null&&(v=y[k],delete y[k],y[P]=v)}throw new wt("".concat(t.name,".bulkUpdate(): ").concat(x," of ").concat(w," operations failed"),y)})})})},se.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",function(a){return t.core.mutate({trans:a,type:"delete",keys:e})}).then(function(f){var o=f.numFailures,l=f.lastResult,f=f.failures;if(o===0)return l;throw new wt("".concat(t.name,".bulkDelete(): ").concat(o," of ").concat(r," operations failed"),f)})},se);function se(){}function Ut(e){function t(f,h){if(h){for(var m=arguments.length,g=new Array(m-1);--m;)g[m-1]=arguments[m];return r[f].subscribe.apply(null,g),e}if(typeof f=="string")return r[f]}var r={};t.addEventType=l;for(var a=1,o=arguments.length;a<o;++a)l(arguments[a]);return t;function l(f,h,m){if(typeof f!="object"){var g;h=h||ra;var w={subscribers:[],fire:m=m||te,subscribe:function(p){w.subscribers.indexOf(p)===-1&&(w.subscribers.push(p),w.fire=h(w.fire,p))},unsubscribe:function(p){w.subscribers=w.subscribers.filter(function(x){return x!==p}),w.fire=w.subscribers.reduce(h,m)}};return r[f]=t[f]=w}S(g=f).forEach(function(p){var x=g[p];if(O(x))l(p,g[p][0],g[p][1]);else{if(x!=="asap")throw new $.InvalidArgument("Invalid event config");var y=l(p,Ct,function(){for(var b=arguments.length,_=new Array(b);b--;)_[b]=arguments[b];y.subscribers.forEach(function(v){Ue(function(){v.apply(null,_)})})})}})}}function Lt(e,t){return pe(t).from({prototype:e}),t}function Pt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Or(e,t){e.filter=dt(e.filter,t)}function Mr(e,t,r){var a=e.replayFilter;e.replayFilter=a?function(){return dt(a(),t())}:t,e.justLimit=r&&!a}function kn(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new $.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Ws(e,t,r){var a=kn(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:a,range:e.range}})}function Pn(e,t,r,a){var o=e.replayFilter?dt(e.filter,e.replayFilter()):e.filter;if(e.or){var l={},f=function(h,m,g){var w,p;o&&!o(m,g,function(x){return m.stop(x)},function(x){return m.fail(x)})||((p=""+(w=m.primaryKey))=="[object ArrayBuffer]"&&(p=""+new Uint8Array(w)),F(l,p)||(l[p]=!0,t(h,m,g)))};return Promise.all([e.or._iterate(f,r),Hs(Ws(e,a,r),e.algorithm,f,!e.keysOnly&&e.valueMapper)])}return Hs(Ws(e,a,r),dt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function Hs(e,t,r,a){var o=oe(a?function(l,f,h){return r(a(l),f,h)}:r);return e.then(function(l){if(l)return l.start(function(){var f=function(){return l.continue()};t&&!t(l,function(h){return f=h},function(h){l.stop(h),f=te},function(h){l.fail(h),f=te})||o(l.value,l,function(h){return f=h}),f()})})}var Wt=(Js.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var r=t.add;if(O(r))return c(c([],O(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(t.remove!==void 0){var a=t.remove;if(O(a))return O(e)?e.filter(function(o){return!a.includes(o)}).sort():[];if(typeof a=="number")return Number(e)-a;if(typeof a=="bigint")try{return BigInt(e)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return r=(r=t.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Js);function Js(e){this["@@propmod"]=e}var ca=(Z.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,le.bind(null,r.error)):r.table._trans("readonly",e).then(t)},Z.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,le.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Z.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=dt(t.algorithm,e)},Z.prototype._iterate=function(e,t){return Pn(this._ctx,e,t,this._ctx.table.core)},Z.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&D(r,e),t._ctx=r,t},Z.prototype.raw=function(){return this._ctx.valueMapper=null,this},Z.prototype.each=function(e){var t=this._ctx;return this._read(function(r){return Pn(t,e,r,t.table.core)})},Z.prototype.count=function(e){var t=this;return this._read(function(r){var a=t._ctx,o=a.table.core;if(Pt(a,!0))return o.count({trans:r,query:{index:kn(a,o.schema),range:a.range}}).then(function(f){return Math.min(f,a.limit)});var l=0;return Pn(a,function(){return++l,!1},r,o).then(function(){return l})}).then(e)},Z.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),a=r[0],o=r.length-1;function l(m,g){return g?l(m[r[g]],g-1):m[a]}var f=this._ctx.dir==="next"?1:-1;function h(m,g){return Y(l(m,o),l(g,o))*f}return this.toArray(function(m){return m.sort(h)}).then(t)},Z.prototype.toArray=function(e){var t=this;return this._read(function(r){var a=t._ctx;if(a.dir==="next"&&Pt(a,!0)&&0<a.limit){var o=a.valueMapper,l=kn(a,a.table.core.schema);return a.table.core.query({trans:r,limit:a.limit,values:!0,query:{index:l,range:a.range}}).then(function(h){return h=h.result,o?h.map(o):h})}var f=[];return Pn(a,function(h){return f.push(h)},r,a.table.core).then(function(){return f})},e)},Z.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Pt(t)?Mr(t,function(){var r=e;return function(a,o){return r===0||(r===1?--r:o(function(){a.advance(r),r=0}),!1)}}):Mr(t,function(){var r=e;return function(){return--r<0}})),this},Z.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Mr(this._ctx,function(){var t=e;return function(r,a,o){return--t<=0&&a(o),0<=t}},!0),this},Z.prototype.until=function(e,t){return Or(this._ctx,function(r,a,o){return!e(r.value)||(a(o),t)}),this},Z.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},Z.prototype.last=function(e){return this.reverse().first(e)},Z.prototype.filter=function(e){var t;return Or(this._ctx,function(r){return e(r.value)}),(t=this._ctx).isMatch=dt(t.isMatch,e),this},Z.prototype.and=function(e){return this.filter(e)},Z.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Z.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Z.prototype.desc=function(){return this.reverse()},Z.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,a){e(a.key,a)})},Z.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Z.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,a){e(a.primaryKey,a)})},Z.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(a,o){r.push(o.key)}).then(function(){return r}).then(e)},Z.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Pt(t,!0)&&0<t.limit)return this._read(function(a){var o=kn(t,t.table.core.schema);return t.table.core.query({trans:a,values:!1,limit:t.limit,query:{index:o,range:t.range}})}).then(function(a){return a.result}).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(a,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},Z.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Z.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},Z.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Z.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Or(this._ctx,function(o){var a=o.primaryKey.toString(),o=F(t,a);return t[a]=!0,!o}),this},Z.prototype.modify=function(e){var t=this,r=this._ctx;return this._write(function(a){var o,l,f;f=typeof e=="function"?e:(o=S(e),l=o.length,function(v){for(var k=!1,P=0;P<l;++P){var A=o[P],E=e[A],M=ae(v,A);E instanceof Wt?(re(v,A,E.execute(M)),k=!0):M!==E&&(re(v,A,E),k=!0)}return k});var h=r.table.core,p=h.schema.primaryKey,m=p.outbound,g=p.extractKey,w=200,p=t.db._options.modifyChunkSize;p&&(w=typeof p=="object"?p[h.name]||p["*"]||200:p);function x(v,A){var P=A.failures,A=A.numFailures;b+=v-A;for(var E=0,M=S(P);E<M.length;E++){var j=M[E];y.push(P[j])}}var y=[],b=0,_=[];return t.clone().primaryKeys().then(function(v){function k(A){var E=Math.min(w,v.length-A);return h.getMany({trans:a,keys:v.slice(A,A+E),cache:"immutable"}).then(function(M){for(var j=[],I=[],T=m?[]:null,B=[],R=0;R<E;++R){var C=M[R],W={value:Ee(C),primKey:v[A+R]};f.call(W,W.value,W)!==!1&&(W.value==null?B.push(v[A+R]):m||Y(g(C),g(W.value))===0?(I.push(W.value),m&&T.push(v[A+R])):(B.push(v[A+R]),j.push(W.value)))}return Promise.resolve(0<j.length&&h.mutate({trans:a,type:"add",values:j}).then(function(X){for(var G in X.failures)B.splice(parseInt(G),1);x(j.length,X)})).then(function(){return(0<I.length||P&&typeof e=="object")&&h.mutate({trans:a,type:"put",keys:T,values:I,criteria:P,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<A}).then(function(X){return x(I.length,X)})}).then(function(){return(0<B.length||P&&e===Ir)&&h.mutate({trans:a,type:"delete",keys:B,criteria:P,isAdditionalChunk:0<A}).then(function(X){return x(B.length,X)})}).then(function(){return v.length>A+E&&k(A+w)})})}var P=Pt(r)&&r.limit===1/0&&(typeof e!="function"||e===Ir)&&{index:r.index,range:r.range};return k(0).then(function(){if(0<y.length)throw new hn("Error modifying one or more objects",y,b,_);return v.length})})})},Z.prototype.delete=function(){var e=this._ctx,t=e.range;return Pt(e)&&(e.isPrimKey||t.type===3)?this._write(function(r){var a=e.table.core.schema.primaryKey,o=t;return e.table.core.count({trans:r,query:{index:a,range:o}}).then(function(l){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(f){var h=f.failures;if(f.lastResult,f.results,f=f.numFailures,f)throw new hn("Could not delete some values",Object.keys(h).map(function(m){return h[m]}),l-f);return l-f})})}):this.modify(Ir)},Z);function Z(){}var Ir=function(e,t){return t.value=null};function la(e,t){return e<t?-1:e===t?0:1}function fa(e,t){return t<e?-1:e===t?0:1}function Ie(e,t,r){return e=e instanceof zs?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(t),e}function At(e){return new e.Collection(e,function(){return Vs("")}).limit(0)}function An(e,t,r,a){var o,l,f,h,m,g,w,p=r.length;if(!r.every(function(b){return typeof b=="string"}))return Ie(e,qs);function x(b){o=b==="next"?function(v){return v.toUpperCase()}:function(v){return v.toLowerCase()},l=b==="next"?function(v){return v.toLowerCase()}:function(v){return v.toUpperCase()},f=b==="next"?la:fa;var _=r.map(function(v){return{lower:l(v),upper:o(v)}}).sort(function(v,k){return f(v.lower,k.lower)});h=_.map(function(v){return v.upper}),m=_.map(function(v){return v.lower}),w=(g=b)==="next"?"":a}x("next"),e=new e.Collection(e,function(){return Qe(h[0],m[p-1]+a)}),e._ondirectionchange=function(b){x(b)};var y=0;return e._addAlgorithm(function(b,_,v){var k=b.key;if(typeof k!="string")return!1;var P=l(k);if(t(P,m,y))return!0;for(var A=null,E=y;E<p;++E){var M=function(j,I,T,B,R,C){for(var W=Math.min(j.length,B.length),X=-1,G=0;G<W;++G){var Te=I[G];if(Te!==B[G])return R(j[G],T[G])<0?j.substr(0,G)+T[G]+T.substr(G+1):R(j[G],B[G])<0?j.substr(0,G)+B[G]+T.substr(G+1):0<=X?j.substr(0,X)+I[X]+T.substr(X+1):null;R(j[G],Te)<0&&(X=G)}return W<B.length&&C==="next"?j+T.substr(j.length):W<j.length&&C==="prev"?j.substr(0,T.length):X<0?null:j.substr(0,X)+B[X]+T.substr(X+1)}(k,P,h[E],m[E],f,g);M===null&&A===null?y=E+1:(A===null||0<f(A,M))&&(A=M)}return _(A!==null?function(){b.continue(A+w)}:v),!1}),e}function Qe(e,t,r,a){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:a}}function Vs(e){return{type:1,lower:e,upper:e}}var zs=(Object.defineProperty(ge.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ge.prototype.between=function(e,t,r,a){r=r!==!1,a=a===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(r||a)&&(!r||!a)?At(this):new this.Collection(this,function(){return Qe(e,t,!r,!a)})}catch{return Ie(this,We)}},ge.prototype.equals=function(e){return e==null?Ie(this,We):new this.Collection(this,function(){return Vs(e)})},ge.prototype.above=function(e){return e==null?Ie(this,We):new this.Collection(this,function(){return Qe(e,void 0,!0)})},ge.prototype.aboveOrEqual=function(e){return e==null?Ie(this,We):new this.Collection(this,function(){return Qe(e,void 0,!1)})},ge.prototype.below=function(e){return e==null?Ie(this,We):new this.Collection(this,function(){return Qe(void 0,e,!1,!0)})},ge.prototype.belowOrEqual=function(e){return e==null?Ie(this,We):new this.Collection(this,function(){return Qe(void 0,e)})},ge.prototype.startsWith=function(e){return typeof e!="string"?Ie(this,qs):this.between(e,e+ht,!0,!0)},ge.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):An(this,function(t,r){return t.indexOf(r[0])===0},[e],ht)},ge.prototype.equalsIgnoreCase=function(e){return An(this,function(t,r){return t===r[0]},[e],"")},ge.prototype.anyOfIgnoreCase=function(){var e=ce.apply(de,arguments);return e.length===0?At(this):An(this,function(t,r){return r.indexOf(t)!==-1},e,"")},ge.prototype.startsWithAnyOfIgnoreCase=function(){var e=ce.apply(de,arguments);return e.length===0?At(this):An(this,function(t,r){return r.some(function(a){return t.indexOf(a)===0})},e,ht)},ge.prototype.anyOf=function(){var e=this,t=ce.apply(de,arguments),r=this._cmp;try{t.sort(r)}catch{return Ie(this,We)}if(t.length===0)return At(this);var a=new this.Collection(this,function(){return Qe(t[0],t[t.length-1])});a._ondirectionchange=function(l){r=l==="next"?e._ascending:e._descending,t.sort(r)};var o=0;return a._addAlgorithm(function(l,f,h){for(var m=l.key;0<r(m,t[o]);)if(++o===t.length)return f(h),!1;return r(m,t[o])===0||(f(function(){l.continue(t[o])}),!1)}),a},ge.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ge.prototype.noneOf=function(){var e=ce.apply(de,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ie(this,We)}var t=e.reduce(function(r,a){return r?r.concat([[r[r.length-1][1],a]]):[[-1/0,a]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},ge.prototype.inAnyRange=function(k,t){var r=this,a=this._cmp,o=this._ascending,l=this._descending,f=this._min,h=this._max;if(k.length===0)return At(this);if(!k.every(function(P){return P[0]!==void 0&&P[1]!==void 0&&o(P[0],P[1])<=0}))return Ie(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",$.InvalidArgument);var m=!t||t.includeLowers!==!1,g=t&&t.includeUppers===!0,w,p=o;function x(P,A){return p(P[0],A[0])}try{(w=k.reduce(function(P,A){for(var E=0,M=P.length;E<M;++E){var j=P[E];if(a(A[0],j[1])<0&&0<a(A[1],j[0])){j[0]=f(j[0],A[0]),j[1]=h(j[1],A[1]);break}}return E===M&&P.push(A),P},[])).sort(x)}catch{return Ie(this,We)}var y=0,b=g?function(P){return 0<o(P,w[y][1])}:function(P){return 0<=o(P,w[y][1])},_=m?function(P){return 0<l(P,w[y][0])}:function(P){return 0<=l(P,w[y][0])},v=b,k=new this.Collection(this,function(){return Qe(w[0][0],w[w.length-1][1],!m,!g)});return k._ondirectionchange=function(P){p=P==="next"?(v=b,o):(v=_,l),w.sort(x)},k._addAlgorithm(function(P,A,E){for(var M,j=P.key;v(j);)if(++y===w.length)return A(E),!1;return!b(M=j)&&!_(M)||(r._cmp(j,w[y][1])===0||r._cmp(j,w[y][0])===0||A(function(){p===o?P.continue(w[y][0]):P.continue(w[y][1])}),!1)}),k},ge.prototype.startsWithAnyOf=function(){var e=ce.apply(de,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?At(this):this.inAnyRange(e.map(function(t){return[t,t+ht]})):Ie(this,"startsWithAnyOf() only works with strings")},ge);function ge(){}function Ne(e){return oe(function(t){return Ht(t),e(t.target.error),!1})}function Ht(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Jt="storagemutated",Tr="x-storagemutated-1",Ze=Ut(null,Jt),ha=(Fe.prototype._lock=function(){return he(!N.global),++this._reculock,this._reculock!==1||N.global||(N.lockOwnerFor=this),this},Fe.prototype._unlock=function(){if(he(!N.global),--this._reculock==0)for(N.global||(N.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ft(e[1],e[0])}catch{}}return this},Fe.prototype._locked=function(){return this._reculock&&N.lockOwnerFor!==this},Fe.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,a=this.db._state.dbOpenError;if(he(!this.idbtrans),!e&&!r)switch(a&&a.name){case"DatabaseClosedError":throw new $.DatabaseClosed(a);case"MissingAPIError":throw new $.MissingAPI(a.message,a);default:throw new $.OpenFailed(a)}if(!this.active)throw new $.TransactionInactive;return he(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=oe(function(o){Ht(o),t._reject(e.error)}),e.onabort=oe(function(o){Ht(o),t.active&&t._reject(new $.Abort(e.error)),t.active=!1,t.on("abort").fire(o)}),e.oncomplete=oe(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Ze.storagemutated.fire(e.mutatedParts)}),this},Fe.prototype._promise=function(e,t,r){var a=this;if(e==="readwrite"&&this.mode!=="readwrite")return le(new $.ReadOnly("Transaction is readonly"));if(!this.active)return le(new $.TransactionInactive);if(this._locked())return new K(function(l,f){a._blockedFuncs.push([function(){a._promise(e,t,r).then(l,f)},N])});if(r)return Xe(function(){var l=new K(function(f,h){a._lock();var m=t(f,h,a);m&&m.then&&m.then(f,h)});return l.finally(function(){return a._unlock()}),l._lib=!0,l});var o=new K(function(l,f){var h=t(l,f,a);h&&h.then&&h.then(l,f)});return o._lib=!0,o},Fe.prototype._root=function(){return this.parent?this.parent._root():this},Fe.prototype.waitFor=function(e){var t,r=this._root(),a=K.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return a}):(r._waitingFor=a,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),function l(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=l)}());var o=r._waitingFor;return new K(function(l,f){a.then(function(h){return r._waitingQueue.push(oe(l.bind(null,h)))},function(h){return r._waitingQueue.push(oe(f.bind(null,h)))}).finally(function(){r._waitingFor===o&&(r._waitingFor=null)})})},Fe.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new $.Abort))},Fe.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(F(t,e))return t[e];var r=this.schema[e];if(!r)throw new $.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),t[e]=r},Fe);function Fe(){}function Rr(e,t,r,a,o,l,f){return{name:e,keyPath:t,unique:r,multi:a,auto:o,compound:l,src:(r&&!f?"&":"")+(a?"*":"")+(o?"++":"")+Xs(t)}}function Xs(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function jr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:(a=function(o){return[o.name,o]},r.reduce(function(o,l,f){return f=a(l,f),f&&(o[f[0]]=f[1]),o},{}))};var a}var Vt=function(e){try{return e.only([[]]),Vt=function(){return[[]]},[[]]}catch{return Vt=function(){return ht},ht}};function Br(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(r){return r[t]}:function(r){return ae(r,t)}:function(r){return ae(r,e)};var t}function Gs(e){return[].slice.call(e)}var da=0;function zt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function pa(e,t,m){function a(v){if(v.type===3)return null;if(v.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var y=v.lower,b=v.upper,_=v.lowerOpen,v=v.upperOpen;return y===void 0?b===void 0?null:t.upperBound(b,!!v):b===void 0?t.lowerBound(y,!!_):t.bound(y,b,!!_,!!v)}function o(x){var y,b=x.name;return{name:b,schema:x,mutate:function(_){var v=_.trans,k=_.type,P=_.keys,A=_.values,E=_.range;return new Promise(function(M,j){M=oe(M);var I=v.objectStore(b),T=I.keyPath==null,B=k==="put"||k==="add";if(!B&&k!=="delete"&&k!=="deleteRange")throw new Error("Invalid operation type: "+k);var R,C=(P||A||{length:1}).length;if(P&&A&&P.length!==A.length)throw new Error("Given keys array must have same length as given values array.");if(C===0)return M({numFailures:0,failures:{},results:[],lastResult:void 0});function W(Oe){++Te,Ht(Oe)}var X=[],G=[],Te=0;if(k==="deleteRange"){if(E.type===4)return M({numFailures:Te,failures:G,results:[],lastResult:void 0});E.type===3?X.push(R=I.clear()):X.push(R=I.delete(a(E)))}else{var T=B?T?[A,P]:[A,null]:[P,null],U=T[0],_e=T[1];if(B)for(var xe=0;xe<C;++xe)X.push(R=_e&&_e[xe]!==void 0?I[k](U[xe],_e[xe]):I[k](U[xe])),R.onerror=W;else for(xe=0;xe<C;++xe)X.push(R=I[k](U[xe])),R.onerror=W}function Nn(Oe){Oe=Oe.target.result,X.forEach(function(yt,Qr){return yt.error!=null&&(G[Qr]=yt.error)}),M({numFailures:Te,failures:G,results:k==="delete"?P:X.map(function(yt){return yt.result}),lastResult:Oe})}R.onerror=function(Oe){W(Oe),Nn(Oe)},R.onsuccess=Nn})},getMany:function(_){var v=_.trans,k=_.keys;return new Promise(function(P,A){P=oe(P);for(var E,M=v.objectStore(b),j=k.length,I=new Array(j),T=0,B=0,R=function(X){X=X.target,I[X._pos]=X.result,++B===T&&P(I)},C=Ne(A),W=0;W<j;++W)k[W]!=null&&((E=M.get(k[W]))._pos=W,E.onsuccess=R,E.onerror=C,++T);T===0&&P(I)})},get:function(_){var v=_.trans,k=_.key;return new Promise(function(P,A){P=oe(P);var E=v.objectStore(b).get(k);E.onsuccess=function(M){return P(M.target.result)},E.onerror=Ne(A)})},query:(y=g,function(_){return new Promise(function(v,k){v=oe(v);var P,A,E,T=_.trans,M=_.values,j=_.limit,R=_.query,I=j===1/0?void 0:j,B=R.index,R=R.range,T=T.objectStore(b),B=B.isPrimaryKey?T:T.index(B.name),R=a(R);if(j===0)return v({result:[]});y?((I=M?B.getAll(R,I):B.getAllKeys(R,I)).onsuccess=function(C){return v({result:C.target.result})},I.onerror=Ne(k)):(P=0,A=!M&&"openKeyCursor"in B?B.openKeyCursor(R):B.openCursor(R),E=[],A.onsuccess=function(C){var W=A.result;return W?(E.push(M?W.value:W.primaryKey),++P===j?v({result:E}):void W.continue()):v({result:E})},A.onerror=Ne(k))})}),openCursor:function(_){var v=_.trans,k=_.values,P=_.query,A=_.reverse,E=_.unique;return new Promise(function(M,j){M=oe(M);var B=P.index,I=P.range,T=v.objectStore(b),T=B.isPrimaryKey?T:T.index(B.name),B=A?E?"prevunique":"prev":E?"nextunique":"next",R=!k&&"openKeyCursor"in T?T.openKeyCursor(a(I),B):T.openCursor(a(I),B);R.onerror=Ne(j),R.onsuccess=oe(function(C){var W,X,G,Te,U=R.result;U?(U.___id=++da,U.done=!1,W=U.continue.bind(U),X=(X=U.continuePrimaryKey)&&X.bind(U),G=U.advance.bind(U),Te=function(){throw new Error("Cursor not stopped")},U.trans=v,U.stop=U.continue=U.continuePrimaryKey=U.advance=function(){throw new Error("Cursor not started")},U.fail=oe(j),U.next=function(){var _e=this,xe=1;return this.start(function(){return xe--?_e.continue():_e.stop()}).then(function(){return _e})},U.start=function(_e){function xe(){if(R.result)try{_e()}catch(Oe){U.fail(Oe)}else U.done=!0,U.start=function(){throw new Error("Cursor behind last entry")},U.stop()}var Nn=new Promise(function(Oe,yt){Oe=oe(Oe),R.onerror=Ne(yt),U.fail=yt,U.stop=function(Qr){U.stop=U.continue=U.continuePrimaryKey=U.advance=Te,Oe(Qr)}});return R.onsuccess=oe(function(Oe){R.onsuccess=xe,xe()}),U.continue=W,U.continuePrimaryKey=X,U.advance=G,xe(),Nn},M(U)):M(null)},j)})},count:function(_){var v=_.query,k=_.trans,P=v.index,A=v.range;return new Promise(function(E,M){var j=k.objectStore(b),I=P.isPrimaryKey?j:j.index(P.name),j=a(A),I=j?I.count(j):I.count();I.onsuccess=oe(function(T){return E(T.target.result)}),I.onerror=Ne(M)})}}}var l,f,h,w=(f=m,h=Gs((l=e).objectStoreNames),{schema:{name:l.name,tables:h.map(function(x){return f.objectStore(x)}).map(function(x){var y=x.keyPath,v=x.autoIncrement,b=O(y),_={},v={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y==null,compound:b,keyPath:y,autoIncrement:v,unique:!0,extractKey:Br(y)},indexes:Gs(x.indexNames).map(function(k){return x.index(k)}).map(function(E){var P=E.name,A=E.unique,M=E.multiEntry,E=E.keyPath,M={name:P,compound:O(E),keyPath:E,unique:A,multiEntry:M,extractKey:Br(E)};return _[zt(E)]=M}),getIndexByKeyPath:function(k){return _[zt(k)]}};return _[":id"]=v.primaryKey,y!=null&&(_[zt(y)]=v.primaryKey),v})},hasGetAll:0<h.length&&"getAll"in f.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),m=w.schema,g=w.hasGetAll,w=m.tables.map(o),p={};return w.forEach(function(x){return p[x.name]=x}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(x){if(!p[x])throw new Error("Table '".concat(x,"' not found"));return p[x]},MIN_KEY:-1/0,MAX_KEY:Vt(t),schema:m}}function ma(e,t,r,a){var o=r.IDBKeyRange;return r.indexedDB,{dbcore:(a=pa(t,o,a),e.dbcore.reduce(function(l,f){return f=f.create,i(i({},l),f(l))},a))}}function En(e,a){var r=a.db,a=ma(e._middlewares,r,e._deps,a);e.core=a.dbcore,e.tables.forEach(function(o){var l=o.name;e.core.schema.tables.some(function(f){return f.name===l})&&(o.core=e.core.table(l),e[l]instanceof e.Table&&(e[l].core=o.core))})}function On(e,t,r,a){r.forEach(function(o){var l=a[o];t.forEach(function(f){var h=function m(g,w){return be(g,w)||(g=q(g))&&m(g,w)}(f,o);(!h||"value"in h&&h.value===void 0)&&(f===e.Transaction.prototype||f instanceof e.Transaction?ie(f,o,{get:function(){return this.table(o)},set:function(m){J(this,o,{value:m,writable:!0,configurable:!0,enumerable:!0})}}):f[o]=new e.Table(o,l))})})}function Dr(e,t){t.forEach(function(r){for(var a in r)r[a]instanceof e.Table&&delete r[a]})}function ya(e,t){return e._cfg.version-t._cfg.version}function ga(e,t,r,a){var o=e._dbSchema;r.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=jr("$meta",Qs("")[0],[]),e._storeNames.push("$meta"));var l=e._createTransaction("readwrite",e._storeNames,o);l.create(r),l._completion.catch(a);var f=l._reject.bind(l),h=N.transless||N;Xe(function(){return N.trans=l,N.transless=h,t!==0?(En(e,r),g=t,((m=l).storeNames.includes("$meta")?m.table("$meta").get("version").then(function(w){return w??g}):K.resolve(g)).then(function(w){return x=w,y=l,b=r,_=[],w=(p=e)._versions,v=p._dbSchema=In(0,p.idbdb,b),(w=w.filter(function(k){return k._cfg.version>=x})).length!==0?(w.forEach(function(k){_.push(function(){var P=v,A=k._cfg.dbschema;Tn(p,P,b),Tn(p,A,b),v=p._dbSchema=A;var E=Kr(P,A);E.add.forEach(function(B){Cr(b,B[0],B[1].primKey,B[1].indexes)}),E.change.forEach(function(B){if(B.recreate)throw new $.Upgrade("Not yet support for changing primary key");var R=b.objectStore(B.name);B.add.forEach(function(C){return Mn(R,C)}),B.change.forEach(function(C){R.deleteIndex(C.name),Mn(R,C)}),B.del.forEach(function(C){return R.deleteIndex(C)})});var M=k._cfg.contentUpgrade;if(M&&k._cfg.version>x){En(p,b),y._memoizedTables={};var j=Ae(A);E.del.forEach(function(B){j[B]=P[B]}),Dr(p,[p.Transaction.prototype]),On(p,[p.Transaction.prototype],S(j),j),y.schema=j;var I,T=Kt(M);return T&&St(),E=K.follow(function(){var B;(I=M(y))&&T&&(B=Ge.bind(null,null),I.then(B,B))}),I&&typeof I.then=="function"?K.resolve(I):E.then(function(){return I})}}),_.push(function(P){var A,E,M=k._cfg.dbschema;A=M,E=P,[].slice.call(E.db.objectStoreNames).forEach(function(j){return A[j]==null&&E.db.deleteObjectStore(j)}),Dr(p,[p.Transaction.prototype]),On(p,[p.Transaction.prototype],p._storeNames,p._dbSchema),y.schema=p._dbSchema}),_.push(function(P){p.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(p.idbdb.version/10)===k._cfg.version?(p.idbdb.deleteObjectStore("$meta"),delete p._dbSchema.$meta,p._storeNames=p._storeNames.filter(function(A){return A!=="$meta"})):P.objectStore("$meta").put(k._cfg.version,"version"))})}),function k(){return _.length?K.resolve(_.shift()(y.idbtrans)).then(k):K.resolve()}().then(function(){Ys(v,b)})):K.resolve();var p,x,y,b,_,v}).catch(f)):(S(o).forEach(function(w){Cr(r,w,o[w].primKey,o[w].indexes)}),En(e,r),void K.follow(function(){return e.on.populate.fire(l)}).catch(f));var m,g})}function va(e,t){Ys(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var r=In(0,e.idbdb,t);Tn(e,e._dbSchema,t);for(var a=0,o=Kr(r,e._dbSchema).change;a<o.length;a++){var l=function(f){if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=t.objectStore(f.name);f.add.forEach(function(m){qe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(m.src)),Mn(h,m)})}(o[a]);if(typeof l=="object")return l.value}}function Kr(e,t){var r,a={del:[],add:[],change:[]};for(r in e)t[r]||a.del.push(r);for(r in t){var o=e[r],l=t[r];if(o){var f={name:r,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||o.primKey.auto!==l.primKey.auto)f.recreate=!0,a.change.push(f);else{var h=o.idxByName,m=l.idxByName,g=void 0;for(g in h)m[g]||f.del.push(g);for(g in m){var w=h[g],p=m[g];w?w.src!==p.src&&f.change.push(p):f.add.push(p)}(0<f.del.length||0<f.add.length||0<f.change.length)&&a.change.push(f)}}else a.add.push([r,l])}return a}function Cr(e,t,r,a){var o=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return a.forEach(function(l){return Mn(o,l)}),o}function Ys(e,t){S(e).forEach(function(r){t.db.objectStoreNames.contains(r)||(qe&&console.debug("Dexie: Creating missing table",r),Cr(t,r,e[r].primKey,e[r].indexes))})}function Mn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function In(e,t,r){var a={};return ee(t.objectStoreNames,0).forEach(function(o){for(var l=r.objectStore(o),f=Rr(Xs(g=l.keyPath),g||"",!0,!1,!!l.autoIncrement,g&&typeof g!="string",!0),h=[],m=0;m<l.indexNames.length;++m){var w=l.index(l.indexNames[m]),g=w.keyPath,w=Rr(w.name,g,!!w.unique,!!w.multiEntry,!1,g&&typeof g!="string",!1);h.push(w)}a[o]=jr(o,f,h)}),a}function Tn(e,t,r){for(var a=r.db.objectStoreNames,o=0;o<a.length;++o){var l=a[o],f=r.objectStore(l);e._hasGetAll="getAll"in f;for(var h=0;h<f.indexNames.length;++h){var m=f.indexNames[h],g=f.index(m).keyPath,w=typeof g=="string"?g:"["+ee(g).join("+")+"]";!t[l]||(g=t[l].idxByName[w])&&(g.name=m,delete t[l].idxByName[w],t[l].idxByName[m]=g)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Qs(e){return e.split(",").map(function(t,r){var a=(t=t.trim()).replace(/([&*]|\+\+)/g,""),o=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Rr(a,o||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),O(o),r===0)})}var ba=(Rn.prototype._parseStoresSpec=function(e,t){S(e).forEach(function(r){if(e[r]!==null){var a=Qs(e[r]),o=a.shift();if(o.unique=!0,o.multi)throw new $.Schema("Primary key cannot be multi-valued");a.forEach(function(l){if(l.auto)throw new $.Schema("Only primary key can be marked as autoIncrement (++)");if(!l.keyPath)throw new $.Schema("Index must have a name and cannot be an empty string")}),t[r]=jr(r,o,a)}})},Rn.prototype.stores=function(r){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?D(this._cfg.storesSource,r):r;var r=t._versions,a={},o={};return r.forEach(function(l){D(a,l._cfg.storesSource),o=l._cfg.dbschema={},l._parseStoresSpec(a,o)}),t._dbSchema=o,Dr(t,[t._allTables,t,t.Transaction.prototype]),On(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],S(o),o),t._storeNames=S(o),this},Rn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=gr(this._cfg.contentUpgrade||te,e),this},Rn);function Rn(){}function qr(e,t){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new He(xn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function Nr(e){return e&&typeof e.databases=="function"}function Fr(e){return Xe(function(){return N.letThrough=!0,e()})}function $r(e){return!("from"in e)}var we=function(e,t){if(!this){var r=new we;return e&&"d"in e&&D(r,e),r}D(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Xt(e,t,r){var a=Y(t,r);if(!isNaN(a)){if(0<a)throw RangeError();if($r(e))return D(e,{from:t,to:r,d:1});var o=e.l,a=e.r;if(Y(r,e.from)<0)return o?Xt(o,t,r):e.l={from:t,to:r,d:1,l:null,r:null},ei(e);if(0<Y(t,e.to))return a?Xt(a,t,r):e.r={from:t,to:r,d:1,l:null,r:null},ei(e);Y(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),0<Y(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,o&&!e.l&&Gt(e,o),a&&r&&Gt(e,a)}}function Gt(e,t){$r(t)||function r(a,m){var l=m.from,f=m.to,h=m.l,m=m.r;Xt(a,l,f),h&&r(a,h),m&&r(a,m)}(e,t)}function Zs(e,t){var r=jn(t),a=r.next();if(a.done)return!1;for(var o=a.value,l=jn(e),f=l.next(o.from),h=f.value;!a.done&&!f.done;){if(Y(h.from,o.to)<=0&&0<=Y(h.to,o.from))return!0;Y(o.from,h.from)<0?o=(a=r.next(h.from)).value:h=(f=l.next(o.from)).value}return!1}function jn(e){var t=$r(e)?null:{s:0,n:e};return{next:function(r){for(var a=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,a)for(;t.n.l&&Y(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!a||Y(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ei(e){var t,r,a=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),o=1<a?"r":a<-1?"l":"";o&&(t=o=="r"?"l":"r",r=i({},e),a=e[o],e.from=a.from,e.to=a.to,e[o]=a[o],r[o]=a[t],(e[t]=r).d=ti(r)),e.d=ti(e)}function ti(r){var t=r.r,r=r.l;return(t?r?Math.max(t.d,r.d):t.d:r?r.d:0)+1}function Bn(e,t){return S(t).forEach(function(r){e[r]?Gt(e[r],t[r]):e[r]=function a(o){var l,f,h={};for(l in o)F(o,l)&&(f=o[l],h[l]=!f||typeof f!="object"||fn.has(f.constructor)?f:a(f));return h}(t[r])}),e}function Ur(e,t){return e.all||t.all||Object.keys(e).some(function(r){return t[r]&&Zs(t[r],e[r])})}L(we.prototype,((je={add:function(e){return Gt(this,e),this},addKey:function(e){return Xt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(r){return Xt(t,r,r)}),this},hasKey:function(e){var t=jn(this).next(e).value;return t&&Y(t.from,e)<=0&&0<=Y(t.to,e)}})[vt]=function(){return jn(this)},je));var pt={},Lr={},Wr=!1;function Dn(e){Bn(Lr,e),Wr||(Wr=!0,setTimeout(function(){Wr=!1,Hr(Lr,!(Lr={}))},0))}function Hr(e,t){t===void 0&&(t=!1);var r=new Set;if(e.all)for(var a=0,o=Object.values(pt);a<o.length;a++)ni(f=o[a],e,r,t);else for(var l in e){var f,h=/^idb\:\/\/(.*)\/(.*)\//.exec(l);h&&(l=h[1],h=h[2],(f=pt["idb://".concat(l,"/").concat(h)])&&ni(f,e,r,t))}r.forEach(function(m){return m()})}function ni(e,t,r,a){for(var o=[],l=0,f=Object.entries(e.queries.query);l<f.length;l++){for(var h=f[l],m=h[0],g=[],w=0,p=h[1];w<p.length;w++){var x=p[w];Ur(t,x.obsSet)?x.subscribers.forEach(function(v){return r.add(v)}):a&&g.push(x)}a&&o.push([m,g])}if(a)for(var y=0,b=o;y<b.length;y++){var _=b[y],m=_[0],g=_[1];e.queries.query[m]=g}}function wa(e){var t=e._state,r=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?le(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var a=t.openCanceller,o=Math.round(10*e.verno),l=!1;function f(){if(t.openCanceller!==a)throw new $.DatabaseClosed("db.open() was cancelled")}function h(){return new K(function(x,y){if(f(),!r)throw new $.MissingAPI;var b=e.name,_=t.autoSchema||!o?r.open(b):r.open(b,o);if(!_)throw new $.MissingAPI;_.onerror=Ne(y),_.onblocked=oe(e._fireOnBlocked),_.onupgradeneeded=oe(function(v){var k;w=_.transaction,t.autoSchema&&!e._options.allowEmptyDB?(_.onerror=Ht,w.abort(),_.result.close(),(k=r.deleteDatabase(b)).onsuccess=k.onerror=oe(function(){y(new $.NoSuchDatabase("Database ".concat(b," doesnt exist")))})):(w.onerror=Ne(y),v=v.oldVersion>Math.pow(2,62)?0:v.oldVersion,p=v<1,e.idbdb=_.result,l&&va(e,w),ga(e,v/10,w,y))},y),_.onsuccess=oe(function(){w=null;var v,k,P,A,E,M=e.idbdb=_.result,j=ee(M.objectStoreNames);if(0<j.length)try{var I=M.transaction((A=j).length===1?A[0]:A,"readonly");if(t.autoSchema)k=M,P=I,(v=e).verno=k.version/10,P=v._dbSchema=In(0,k,P),v._storeNames=ee(k.objectStoreNames,0),On(v,[v._allTables],S(P),P);else if(Tn(e,e._dbSchema,I),((E=Kr(In(0,(E=e).idbdb,I),E._dbSchema)).add.length||E.change.some(function(T){return T.add.length||T.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),M.close(),o=M.version+1,l=!0,x(h());En(e,I)}catch{}kt.push(e),M.onversionchange=oe(function(T){t.vcFired=!0,e.on("versionchange").fire(T)}),M.onclose=oe(function(T){e.on("close").fire(T)}),p&&(E=e._deps,I=b,M=E.indexedDB,E=E.IDBKeyRange,Nr(M)||I===xn||qr(M,E).put({name:I}).catch(te)),x()},y)}).catch(function(x){switch(x==null?void 0:x.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(0<o)return o=0,h()}return K.reject(x)})}var m,g=t.dbReadyResolve,w=null,p=!1;return K.race([a,(typeof navigator>"u"?K.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function y(){return indexedDB.databases().finally(x)}m=setInterval(y,100),y()}).finally(function(){return clearInterval(m)}):Promise.resolve()).then(h)]).then(function(){return f(),t.onReadyBeingFired=[],K.resolve(Fr(function(){return e.on.ready.fire(e.vip)})).then(function x(){if(0<t.onReadyBeingFired.length){var y=t.onReadyBeingFired.reduce(gr,te);return t.onReadyBeingFired=[],K.resolve(Fr(function(){return y(e.vip)})).then(x)}})}).finally(function(){t.openCanceller===a&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(x){t.dbOpenError=x;try{w&&w.abort()}catch{}return a===t.openCanceller&&e._close(),le(x)}).finally(function(){t.openComplete=!0,g()}).then(function(){var x;return p&&(x={},e.tables.forEach(function(y){y.schema.indexes.forEach(function(b){b.name&&(x["idb://".concat(e.name,"/").concat(y.name,"/").concat(b.name)]=new we(-1/0,[[[]]]))}),x["idb://".concat(e.name,"/").concat(y.name,"/")]=x["idb://".concat(e.name,"/").concat(y.name,"/:dels")]=new we(-1/0,[[[]]])}),Ze(Jt).fire(x),Hr(x,!0)),e})}function Jr(e){function t(l){return e.next(l)}var r=o(t),a=o(function(l){return e.throw(l)});function o(l){return function(m){var h=l(m),m=h.value;return h.done?m:m&&typeof m.then=="function"?m.then(r,a):O(m)?Promise.all(m).then(r,a):r(m)}}return o(t)()}function Kn(e,t,r){for(var a=O(e)?e.slice():[e],o=0;o<r;++o)a.push(t);return a}var _a={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return i(i({},e),{table:function(t){var r=e.table(t),a=r.schema,o={},l=[];function f(p,x,y){var b=zt(p),_=o[b]=o[b]||[],v=p==null?0:typeof p=="string"?1:p.length,k=0<x,k=i(i({},y),{name:k?"".concat(b,"(virtual-from:").concat(y.name,")"):y.name,lowLevelIndex:y,isVirtual:k,keyTail:x,keyLength:v,extractKey:Br(p),unique:!k&&y.unique});return _.push(k),k.isPrimaryKey||l.push(k),1<v&&f(v===2?p[0]:p.slice(0,v-1),x+1,y),_.sort(function(P,A){return P.keyTail-A.keyTail}),k}t=f(a.primaryKey.keyPath,0,a.primaryKey),o[":id"]=[t];for(var h=0,m=a.indexes;h<m.length;h++){var g=m[h];f(g.keyPath,0,g)}function w(p){var x,y=p.query.index;return y.isVirtual?i(i({},p),{query:{index:y.lowLevelIndex,range:(x=p.query.range,y=y.keyTail,{type:x.type===1?2:x.type,lower:Kn(x.lower,x.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:Kn(x.upper,x.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0})}}):p}return i(i({},r),{schema:i(i({},a),{primaryKey:t,indexes:l,getIndexByKeyPath:function(p){return(p=o[zt(p)])&&p[0]}}),count:function(p){return r.count(w(p))},query:function(p){return r.query(w(p))},openCursor:function(p){var x=p.query.index,y=x.keyTail,b=x.isVirtual,_=x.keyLength;return b?r.openCursor(w(p)).then(function(k){return k&&v(k)}):r.openCursor(p);function v(k){return Object.create(k,{continue:{value:function(P){P!=null?k.continue(Kn(P,p.reverse?e.MAX_KEY:e.MIN_KEY,y)):p.unique?k.continue(k.key.slice(0,_).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,y)):k.continue()}},continuePrimaryKey:{value:function(P,A){k.continuePrimaryKey(Kn(P,e.MAX_KEY,y),A)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var P=k.key;return _===1?P[0]:P.slice(0,_)}},value:{get:function(){return k.value}}})}}})}})}};function Vr(e,t,r,a){return r=r||{},a=a||"",S(e).forEach(function(o){var l,f,h;F(t,o)?(l=e[o],f=t[o],typeof l=="object"&&typeof f=="object"&&l&&f?(h=it(l))!==it(f)?r[a+o]=t[o]:h==="Object"?Vr(l,f,r,a+o+"."):l!==f&&(r[a+o]=t[o]):l!==f&&(r[a+o]=t[o])):r[a+o]=void 0}),S(t).forEach(function(o){F(e,o)||(r[a+o]=t[o])}),r}function zr(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var xa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return i(i({},e),{table:function(t){var r=e.table(t),a=r.schema.primaryKey;return i(i({},r),{mutate:function(o){var l=N.trans,f=l.table(t).hook,h=f.deleting,m=f.creating,g=f.updating;switch(o.type){case"add":if(m.fire===te)break;return l._promise("readwrite",function(){return w(o)},!0);case"put":if(m.fire===te&&g.fire===te)break;return l._promise("readwrite",function(){return w(o)},!0);case"delete":if(h.fire===te)break;return l._promise("readwrite",function(){return w(o)},!0);case"deleteRange":if(h.fire===te)break;return l._promise("readwrite",function(){return function p(x,y,b){return r.query({trans:x,values:!1,query:{index:a,range:y},limit:b}).then(function(_){var v=_.result;return w({type:"delete",keys:v,trans:x}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):v.length<b?{failures:[],numFailures:0,lastResult:void 0}:p(x,i(i({},y),{lower:v[v.length-1],lowerOpen:!0}),b)})})}(o.trans,o.range,1e4)},!0)}return r.mutate(o);function w(p){var x,y,b,_=N.trans,v=p.keys||zr(a,p);if(!v)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?i(i({},p),{keys:v}):i({},p)).type!=="delete"&&(p.values=c([],p.values)),p.keys&&(p.keys=c([],p.keys)),x=r,b=v,((y=p).type==="add"?Promise.resolve([]):x.getMany({trans:y.trans,keys:b,cache:"immutable"})).then(function(k){var P=v.map(function(A,E){var M,j,I,T=k[E],B={onerror:null,onsuccess:null};return p.type==="delete"?h.fire.call(B,A,T,_):p.type==="add"||T===void 0?(M=m.fire.call(B,A,p.values[E],_),A==null&&M!=null&&(p.keys[E]=A=M,a.outbound||re(p.values[E],a.keyPath,A))):(M=Vr(T,p.values[E]),(j=g.fire.call(B,M,A,T,_))&&(I=p.values[E],Object.keys(j).forEach(function(R){F(I,R)?I[R]=j[R]:re(I,R,j[R])}))),B});return r.mutate(p).then(function(A){for(var E=A.failures,M=A.results,j=A.numFailures,A=A.lastResult,I=0;I<v.length;++I){var T=(M||v)[I],B=P[I];T==null?B.onerror&&B.onerror(E[I]):B.onsuccess&&B.onsuccess(p.type==="put"&&k[I]?p.values[I]:T)}return{failures:E,results:M,numFailures:j,lastResult:A}}).catch(function(A){return P.forEach(function(E){return E.onerror&&E.onerror(A)}),Promise.reject(A)})})}}})}})}};function ri(e,t,r){try{if(!t||t.keys.length<e.length)return null;for(var a=[],o=0,l=0;o<t.keys.length&&l<e.length;++o)Y(t.keys[o],e[l])===0&&(a.push(r?Ee(t.values[o]):t.values[o]),++l);return a.length===e.length?a:null}catch{return null}}var Sa={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return i(i({},r),{getMany:function(a){if(!a.cache)return r.getMany(a);var o=ri(a.keys,a.trans._cache,a.cache==="clone");return o?K.resolve(o):r.getMany(a).then(function(l){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?Ee(l):l},l})},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),r.mutate(a)}})}}}};function si(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function ii(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ka={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new we(e.MIN_KEY,e.MAX_KEY);return i(i({},e),{transaction:function(a,o,l){if(N.subscr&&o!=="readonly")throw new $.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(N.querier));return e.transaction(a,o,l)},table:function(a){var o=e.table(a),l=o.schema,f=l.primaryKey,p=l.indexes,h=f.extractKey,m=f.outbound,g=f.autoIncrement&&p.filter(function(y){return y.compound&&y.keyPath.includes(f.keyPath)}),w=i(i({},o),{mutate:function(y){function b(R){return R="idb://".concat(t,"/").concat(a,"/").concat(R),A[R]||(A[R]=new we)}var _,v,k,P=y.trans,A=y.mutatedParts||(y.mutatedParts={}),E=b(""),M=b(":dels"),j=y.type,B=y.type==="deleteRange"?[y.range]:y.type==="delete"?[y.keys]:y.values.length<50?[zr(f,y).filter(function(R){return R}),y.values]:[],I=B[0],T=B[1],B=y.trans._cache;return O(I)?(E.addKeys(I),(B=j==="delete"||I.length===T.length?ri(I,B):null)||M.addKeys(I),(B||T)&&(_=b,v=B,k=T,l.indexes.forEach(function(R){var C=_(R.name||"");function W(G){return G!=null?R.extractKey(G):null}function X(G){return R.multiEntry&&O(G)?G.forEach(function(Te){return C.addKey(Te)}):C.addKey(G)}(v||k).forEach(function(G,_e){var U=v&&W(v[_e]),_e=k&&W(k[_e]);Y(U,_e)!==0&&(U!=null&&X(U),_e!=null&&X(_e))})}))):I?(T={from:(T=I.lower)!==null&&T!==void 0?T:e.MIN_KEY,to:(T=I.upper)!==null&&T!==void 0?T:e.MAX_KEY},M.add(T),E.add(T)):(E.add(r),M.add(r),l.indexes.forEach(function(R){return b(R.name).add(r)})),o.mutate(y).then(function(R){return!I||y.type!=="add"&&y.type!=="put"||(E.addKeys(R.results),g&&g.forEach(function(C){for(var W=y.values.map(function(U){return C.extractKey(U)}),X=C.keyPath.findIndex(function(U){return U===f.keyPath}),G=0,Te=R.results.length;G<Te;++G)W[G][X]=R.results[G];b(C.name).addKeys(W)})),P.mutatedParts=Bn(P.mutatedParts||{},A),R})}}),p=function(b){var _=b.query,b=_.index,_=_.range;return[b,new we((b=_.lower)!==null&&b!==void 0?b:e.MIN_KEY,(_=_.upper)!==null&&_!==void 0?_:e.MAX_KEY)]},x={get:function(y){return[f,new we(y.key)]},getMany:function(y){return[f,new we().addKeys(y.keys)]},count:p,query:p,openCursor:p};return S(x).forEach(function(y){w[y]=function(b){var _=N.subscr,v=!!_,k=si(N,o)&&ii(y,b)?b.obsSet={}:_;if(v){var P=function(T){return T="idb://".concat(t,"/").concat(a,"/").concat(T),k[T]||(k[T]=new we)},A=P(""),E=P(":dels"),_=x[y](b),v=_[0],_=_[1];if((y==="query"&&v.isPrimaryKey&&!b.values?E:P(v.name||"")).add(_),!v.isPrimaryKey){if(y!=="count"){var M=y==="query"&&m&&b.values&&o.query(i(i({},b),{values:!1}));return o[y].apply(this,arguments).then(function(T){if(y==="query"){if(m&&b.values)return M.then(function(W){return W=W.result,A.addKeys(W),T});var B=b.values?T.result.map(h):T.result;(b.values?A:E).addKeys(B)}else if(y==="openCursor"){var R=T,C=b.values;return R&&Object.create(R,{key:{get:function(){return E.addKey(R.primaryKey),R.key}},primaryKey:{get:function(){var W=R.primaryKey;return E.addKey(W),W}},value:{get:function(){return C&&A.addKey(R.primaryKey),R.value}}})}return T})}E.add(r)}}return o[y].apply(this,arguments)}}),w}})}};function ai(e,t,r){if(r.numFailures===0)return t;if(t.type==="deleteRange")return null;var a=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return r.numFailures===a?null:(t=i({},t),O(t.keys)&&(t.keys=t.keys.filter(function(o,l){return!(l in r.failures)})),"values"in t&&O(t.values)&&(t.values=t.values.filter(function(o,l){return!(l in r.failures)})),t)}function Xr(e,t){return r=e,((a=t).lower===void 0||(a.lowerOpen?0<Y(r,a.lower):0<=Y(r,a.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?Y(e,t.upper)<0:Y(e,t.upper)<=0));var r,a}function oi(e,t,x,a,o,l){if(!x||x.length===0)return e;var f=t.query.index,h=f.multiEntry,m=t.query.range,g=a.schema.primaryKey.extractKey,w=f.extractKey,p=(f.lowLevelIndex||f).extractKey,x=x.reduce(function(y,b){var _=y,v=[];if(b.type==="add"||b.type==="put")for(var k=new we,P=b.values.length-1;0<=P;--P){var A,E=b.values[P],M=g(E);k.hasKey(M)||(A=w(E),(h&&O(A)?A.some(function(R){return Xr(R,m)}):Xr(A,m))&&(k.addKey(M),v.push(E)))}switch(b.type){case"add":var j=new we().addKeys(t.values?y.map(function(C){return g(C)}):y),_=y.concat(t.values?v.filter(function(C){return C=g(C),!j.hasKey(C)&&(j.addKey(C),!0)}):v.map(function(C){return g(C)}).filter(function(C){return!j.hasKey(C)&&(j.addKey(C),!0)}));break;case"put":var I=new we().addKeys(b.values.map(function(C){return g(C)}));_=y.filter(function(C){return!I.hasKey(t.values?g(C):C)}).concat(t.values?v:v.map(function(C){return g(C)}));break;case"delete":var T=new we().addKeys(b.keys);_=y.filter(function(C){return!T.hasKey(t.values?g(C):C)});break;case"deleteRange":var B=b.range;_=y.filter(function(C){return!Xr(g(C),B)})}return _},e);return x===e?e:(x.sort(function(y,b){return Y(p(y),p(b))||Y(g(y),g(b))}),t.limit&&t.limit<1/0&&(x.length>t.limit?x.length=t.limit:e.length===t.limit&&x.length<t.limit&&(o.dirty=!0)),l?Object.freeze(x):x)}function ui(e,t){return Y(e.lower,t.lower)===0&&Y(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Pa(e,t){return function(r,a,o,l){if(r===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((a=Y(r,a))===0){if(o&&l)return 0;if(o)return 1;if(l)return-1}return a}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(r,a,o,l){if(r===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((a=Y(r,a))===0){if(o&&l)return 0;if(o)return-1;if(l)return 1}return a}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Aa(e,t,r,a){e.subscribers.add(r),a.addEventListener("abort",function(){var o,l;e.subscribers.delete(r),e.subscribers.size===0&&(o=e,l=t,setTimeout(function(){o.subscribers.size===0&&me(l,o)},3e3))})}var Ea={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return i(i({},e),{transaction:function(r,a,o){var l,f,h=e.transaction(r,a,o);return a==="readwrite"&&(f=(l=new AbortController).signal,o=function(m){return function(){if(l.abort(),a==="readwrite"){for(var g=new Set,w=0,p=r;w<p.length;w++){var x=p[w],y=pt["idb://".concat(t,"/").concat(x)];if(y){var b=e.table(x),_=y.optimisticOps.filter(function(C){return C.trans===h});if(h._explicit&&m&&h.mutatedParts)for(var v=0,k=Object.values(y.queries.query);v<k.length;v++)for(var P=0,A=(j=k[v]).slice();P<A.length;P++)Ur((I=A[P]).obsSet,h.mutatedParts)&&(me(j,I),I.subscribers.forEach(function(C){return g.add(C)}));else if(0<_.length){y.optimisticOps=y.optimisticOps.filter(function(C){return C.trans!==h});for(var E=0,M=Object.values(y.queries.query);E<M.length;E++)for(var j,I,T,B=0,R=(j=M[E]).slice();B<R.length;B++)(I=R[B]).res!=null&&h.mutatedParts&&(m&&!I.dirty?(T=Object.isFrozen(I.res),T=oi(I.res,I.req,_,b,I,T),I.dirty?(me(j,I),I.subscribers.forEach(function(C){return g.add(C)})):T!==I.res&&(I.res=T,I.promise=K.resolve({result:T}))):(I.dirty&&me(j,I),I.subscribers.forEach(function(C){return g.add(C)})))}}}g.forEach(function(C){return C()})}}},h.addEventListener("abort",o(!1),{signal:f}),h.addEventListener("error",o(!1),{signal:f}),h.addEventListener("complete",o(!0),{signal:f})),h},table:function(r){var a=e.table(r),o=a.schema.primaryKey;return i(i({},a),{mutate:function(l){var f=N.trans;if(o.outbound||f.db._options.cache==="disabled"||f.explicit||f.idbtrans.mode!=="readwrite")return a.mutate(l);var h=pt["idb://".concat(t,"/").concat(r)];return h?(f=a.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||zr(o,l).some(function(m){return m==null}))?(h.optimisticOps.push(l),l.mutatedParts&&Dn(l.mutatedParts),f.then(function(m){0<m.numFailures&&(me(h.optimisticOps,l),(m=ai(0,l,m))&&h.optimisticOps.push(m),l.mutatedParts&&Dn(l.mutatedParts))}),f.catch(function(){me(h.optimisticOps,l),l.mutatedParts&&Dn(l.mutatedParts)})):f.then(function(m){var g=ai(0,i(i({},l),{values:l.values.map(function(w,p){var x;return m.failures[p]?w:(w=(x=o.keyPath)!==null&&x!==void 0&&x.includes(".")?Ee(w):i({},w),re(w,o.keyPath,m.results[p]),w)})}),m);h.optimisticOps.push(g),queueMicrotask(function(){return l.mutatedParts&&Dn(l.mutatedParts)})}),f):a.mutate(l)},query:function(l){if(!si(N,a)||!ii("query",l))return a.query(l);var f=((g=N.trans)===null||g===void 0?void 0:g.db._options.cache)==="immutable",p=N,h=p.requery,m=p.signal,g=function(b,_,v,k){var P=pt["idb://".concat(b,"/").concat(_)];if(!P)return[];if(!(_=P.queries[v]))return[null,!1,P,null];var A=_[(k.query?k.query.index.name:null)||""];if(!A)return[null,!1,P,null];switch(v){case"query":var E=A.find(function(M){return M.req.limit===k.limit&&M.req.values===k.values&&ui(M.req.query.range,k.query.range)});return E?[E,!0,P,A]:[A.find(function(M){return("limit"in M.req?M.req.limit:1/0)>=k.limit&&(!k.values||M.req.values)&&Pa(M.req.query.range,k.query.range)}),!1,P,A];case"count":return E=A.find(function(M){return ui(M.req.query.range,k.query.range)}),[E,!!E,P,A]}}(t,r,"query",l),w=g[0],p=g[1],x=g[2],y=g[3];return w&&p?w.obsSet=l.obsSet:(p=a.query(l).then(function(b){var _=b.result;if(w&&(w.res=_),f){for(var v=0,k=_.length;v<k;++v)Object.freeze(_[v]);Object.freeze(_)}else b.result=Ee(_);return b}).catch(function(b){return y&&w&&me(y,w),Promise.reject(b)}),w={obsSet:l.obsSet,promise:p,subscribers:new Set,type:"query",req:l,dirty:!1},y?y.push(w):(y=[w],(x=x||(pt["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=y)),Aa(w,y,h,m),w.promise.then(function(b){return{result:oi(b.result,l,x==null?void 0:x.optimisticOps,a,w,f)}})}})}})}};function Cn(e,t){return new Proxy(e,{get:function(r,a,o){return a==="db"?t:Reflect.get(r,a,o)}})}var He=(fe.prototype.version=function(e){if(isNaN(e)||e<.1)throw new $.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new $.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter(function(a){return a._cfg.version===e})[0];return r||(r=new this.Version(e),t.push(r),t.sort(ya),r.stores({}),this._state.autoSchema=!1,r)},fe.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||N.letThrough||this._vip)?e():new K(function(r,a){if(t._state.openComplete)return a(new $.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void a(new $.DatabaseClosed);t.open().catch(te)}t._state.dbReadyPromise.then(r,a)}).then(e)},fe.prototype.use=function(e){var t=e.stack,r=e.create,a=e.level,o=e.name;return o&&this.unuse({stack:t,name:o}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:r,level:a??10,name:o}),e.sort(function(l,f){return l.level-f.level}),this},fe.prototype.unuse=function(e){var t=e.stack,r=e.name,a=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(o){return a?o.create!==a:!!r&&o.name!==r})),this},fe.prototype.open=function(){var e=this;return ft(ze,function(){return wa(e)})},fe.prototype._close=function(){var e=this._state,t=kt.indexOf(this);if(0<=t&&kt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new K(function(r){e.dbReadyResolve=r}),e.openCanceller=new K(function(r,a){e.cancelOpen=a}))},fe.prototype.close=function(r){var t=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;t?(r.isBeingOpened&&r.cancelOpen(new $.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new $.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},fe.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",a=this._state;return new K(function(o,l){function f(){t.close(e);var h=t._deps.indexedDB.deleteDatabase(t.name);h.onsuccess=oe(function(){var m,g,w;m=t._deps,g=t.name,w=m.indexedDB,m=m.IDBKeyRange,Nr(w)||g===xn||qr(w,m).delete(g).catch(te),o()}),h.onerror=Ne(l),h.onblocked=t._fireOnBlocked}if(r)throw new $.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(f):f()})},fe.prototype.backendDB=function(){return this.idbdb},fe.prototype.isOpen=function(){return this.idbdb!==null},fe.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},fe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},fe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(fe.prototype,"tables",{get:function(){var e=this;return S(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),fe.prototype.transaction=function(){var e=(function(t,r,a){var o=arguments.length;if(o<2)throw new $.InvalidArgument("Too few arguments");for(var l=new Array(o-1);--o;)l[o-1]=arguments[o];return a=l.pop(),[t,Bt(l),a]}).apply(this,arguments);return this._transaction.apply(this,e)},fe.prototype._transaction=function(e,t,r){var a=this,o=N.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var l,f,h=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(f=t.map(function(g){if(g=g instanceof a.Table?g.name:g,typeof g!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return g}),e=="r"||e===Ar)l=Ar;else{if(e!="rw"&&e!=Er)throw new $.InvalidArgument("Invalid transaction mode: "+e);l=Er}if(o){if(o.mode===Ar&&l===Er){if(!h)throw new $.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&f.forEach(function(g){if(o&&o.storeNames.indexOf(g)===-1){if(!h)throw new $.SubTransaction("Table "+g+" not included in parent transaction.");o=null}}),h&&o&&!o.active&&(o=null)}}catch(g){return o?o._promise(null,function(w,p){p(g)}):le(g)}var m=(function g(w,p,x,y,b){return K.resolve().then(function(){var _=N.transless||N,v=w._createTransaction(p,x,w._dbSchema,y);if(v.explicit=!0,_={trans:v,transless:_},y)v.idbtrans=y.idbtrans;else try{v.create(),v.idbtrans._explicit=!0,w._state.PR1398_maxLoop=3}catch(A){return A.name===yr.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return g(w,p,x,null,b)})):le(A)}var k,P=Kt(b);return P&&St(),_=K.follow(function(){var A;(k=b.call(v,v))&&(P?(A=Ge.bind(null,null),k.then(A,A)):typeof k.next=="function"&&typeof k.throw=="function"&&(k=Jr(k)))},_),(k&&typeof k.then=="function"?K.resolve(k).then(function(A){return v.active?A:le(new $.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_.then(function(){return k})).then(function(A){return y&&v._resolve(),v._completion.then(function(){return A})}).catch(function(A){return v._reject(A),le(A)})})}).bind(null,this,l,f,o,r);return o?o._promise(l,m,"lock"):N.trans?ft(N.transless,function(){return a._whenReady(m)}):this._whenReady(m)},fe.prototype.table=function(e){if(!F(this._allTables,e))throw new $.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},fe);function fe(e,t){var r=this;this._middlewares={},this.verno=0;var a=fe.dependencies;this._options=t=i({addons:fe.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},a=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,l,f,h,m,g={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:te,dbReadyPromise:null,cancelOpen:te,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};g.dbReadyPromise=new K(function(p){g.dbReadyResolve=p}),g.openCanceller=new K(function(p,x){g.cancelOpen=x}),this._state=g,this.name=e,this.on=Ut(this,"populate","blocked","versionchange","close",{ready:[gr,te]}),this.on.ready.subscribe=ve(this.on.ready.subscribe,function(p){return function(x,y){fe.vip(function(){var b,_=r._state;_.openComplete?(_.dbOpenError||K.resolve().then(x),y&&p(x)):_.onReadyBeingFired?(_.onReadyBeingFired.push(x),y&&p(x)):(p(x),b=r,y||p(function v(){b.on.ready.unsubscribe(x),b.on.ready.unsubscribe(v)}))})}}),this.Collection=(o=this,Lt(ca.prototype,function(k,v){this.db=o;var y=Ns,b=null;if(v)try{y=v()}catch(P){b=P}var _=k._ctx,v=_.table,k=v.hook.reading.fire;this._ctx={table:v,index:_.index,isPrimKey:!_.index||v.schema.primKey.keyPath&&_.index===v.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:b,or:_.or,valueMapper:k!==Ct?k:null}})),this.Table=(l=this,Lt(Ls.prototype,function(p,x,y){this.db=l,this._tx=y,this.name=p,this.schema=x,this.hook=l._allTables[p]?l._allTables[p].hook:Ut(null,{creating:[ea,te],reading:[Zi,Ct],updating:[na,te],deleting:[ta,te]})})),this.Transaction=(f=this,Lt(ha.prototype,function(p,x,y,b,_){var v=this;this.db=f,this.mode=p,this.storeNames=x,this.schema=y,this.chromeTransactionDurability=b,this.idbtrans=null,this.on=Ut(this,"complete","error","abort"),this.parent=_||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new K(function(k,P){v._resolve=k,v._reject=P}),this._completion.then(function(){v.active=!1,v.on.complete.fire()},function(k){var P=v.active;return v.active=!1,v.on.error.fire(k),v.parent?v.parent._reject(k):P&&v.idbtrans&&v.idbtrans.abort(),le(k)})})),this.Version=(h=this,Lt(ba.prototype,function(p){this.db=h,this._cfg={version:p,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(m=this,Lt(zs.prototype,function(p,x,y){if(this.db=m,this._ctx={table:p,index:x===":id"?null:x,or:y},this._cmp=this._ascending=Y,this._descending=function(b,_){return Y(_,b)},this._max=function(b,_){return 0<Y(b,_)?b:_},this._min=function(b,_){return Y(b,_)<0?b:_},this._IDBKeyRange=m._deps.IDBKeyRange,!this._IDBKeyRange)throw new $.MissingAPI})),this.on("versionchange",function(p){0<p.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(p){!p.newVersion||p.newVersion<p.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(p.oldVersion/10))}),this._maxKey=Vt(t.IDBKeyRange),this._createTransaction=function(p,x,y,b){return new r.Transaction(p,x,y,r._options.chromeTransactionDurability,b)},this._fireOnBlocked=function(p){r.on("blocked").fire(p),kt.filter(function(x){return x.name===r.name&&x!==r&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(p)})},this.use(Sa),this.use(Ea),this.use(ka),this.use(_a),this.use(xa);var w=new Proxy(this,{get:function(p,x,y){if(x==="_vip")return!0;if(x==="table")return function(_){return Cn(r.table(_),w)};var b=Reflect.get(p,x,y);return b instanceof Ls?Cn(b,w):x==="tables"?b.map(function(_){return Cn(_,w)}):x==="_createTransaction"?function(){return Cn(b.apply(this,arguments),w)}:b}});this.vip=w,a.forEach(function(p){return p(r)})}var qn,je=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Oa=(Gr.prototype.subscribe=function(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})},Gr.prototype[je]=function(){return this},Gr);function Gr(e){this._subscribe=e}try{qn={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{qn={indexedDB:null,IDBKeyRange:null}}function ci(e){var t,r=!1,a=new Oa(function(o){var l=Kt(e),f,h=!1,m={},g={},w={get closed(){return h},unsubscribe:function(){h||(h=!0,f&&f.abort(),p&&Ze.storagemutated.unsubscribe(y))}};o.start&&o.start(w);var p=!1,x=function(){return Pr(b)},y=function(_){Bn(m,_),Ur(g,m)&&x()},b=function(){var _,v,k;!h&&qn.indexedDB&&(m={},_={},f&&f.abort(),f=new AbortController,k=function(P){var A=_t();try{l&&St();var E=Xe(e,P);return E=l?E.finally(Ge):E}finally{A&&xt()}}(v={subscr:_,signal:f.signal,requery:x,querier:e,trans:null}),Promise.resolve(k).then(function(P){r=!0,t=P,h||v.signal.aborted||(m={},function(A){for(var E in A)if(F(A,E))return;return 1}(g=_)||p||(Ze(Jt,y),p=!0),Pr(function(){return!h&&o.next&&o.next(P)}))},function(P){r=!1,["DatabaseClosedError","AbortError"].includes(P==null?void 0:P.name)||h||Pr(function(){h||o.error&&o.error(P)})}))};return setTimeout(x,0),w});return a.hasValue=function(){return r},a.getValue=function(){return t},a}var mt=He;function Yr(e){var t=et;try{et=!0,Ze.storagemutated.fire(e),Hr(e,!0)}finally{et=t}}L(mt,i(i({},dn),{delete:function(e){return new mt(e,{addons:[]}).delete()},exists:function(e){return new mt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=mt.dependencies,r=t.indexedDB,t=t.IDBKeyRange,(Nr(r)?Promise.resolve(r.databases()).then(function(a){return a.map(function(o){return o.name}).filter(function(o){return o!==xn})}):qr(r,t).toCollection().primaryKeys()).then(e)}catch{return le(new $.MissingAPI)}var t,r},defineClass:function(){return function(e){D(this,e)}},ignoreTransaction:function(e){return N.trans?ft(N.transless,e):e()},vip:Fr,async:function(e){return function(){try{var t=Jr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:K.resolve(t)}catch(r){return le(r)}}},spawn:function(e,t,r){try{var a=Jr(e.apply(r,t||[]));return a&&typeof a.then=="function"?a:K.resolve(a)}catch(o){return le(o)}},currentTransaction:{get:function(){return N.trans||null}},waitFor:function(e,t){return t=K.resolve(typeof e=="function"?mt.ignoreTransaction(e):e).timeout(t||6e4),N.trans?N.trans.waitFor(t):t},Promise:K,debug:{get:function(){return qe},set:function(e){Rs(e)}},derive:pe,extend:D,props:L,override:ve,Events:Ut,on:Ze,liveQuery:ci,extendObservabilitySet:Bn,getByKeyPath:ae,setByKeyPath:re,delByKeyPath:function(e,t){typeof t=="string"?re(e,t,void 0):"length"in t&&[].map.call(t,function(r){re(e,r,void 0)})},shallowClone:Ae,deepClone:Ee,getObjectDiff:Vr,cmp:Y,asap:Ue,minKey:-1/0,addons:[],connections:kt,errnames:yr,dependencies:qn,cache:pt,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)})})),mt.maxKey=Vt(mt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ze(Jt,function(e){et||(e=new CustomEvent(Tr,{detail:e}),et=!0,dispatchEvent(e),et=!1)}),addEventListener(Tr,function(e){e=e.detail,et||Yr(e)}));var Et,et=!1,li=function(){};return typeof BroadcastChannel<"u"&&((li=function(){(Et=new BroadcastChannel(Tr)).onmessage=function(e){return e.data&&Yr(e.data)}})(),typeof Et.unref=="function"&&Et.unref(),Ze(Jt,function(e){et||Et.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!He.disableBfCache&&e.persisted){qe&&console.debug("Dexie: handling persisted pagehide"),Et!=null&&Et.close();for(var t=0,r=kt;t<r.length;t++)r[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!He.disableBfCache&&e.persisted&&(qe&&console.debug("Dexie: handling persisted pageshow"),li(),Yr({all:new we(-1/0,[[]])}))})),K.rejectionMapper=function(e,t){return!e||e instanceof bt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ts[e.name]?e:(t=new Ts[e.name](t||e.message,e),"stack"in e&&ie(t,"stack",{get:function(){return this.inner.stack}}),t)},Rs(qe),i(He,Object.freeze({__proto__:null,Dexie:He,liveQuery:ci,Entity:Fs,cmp:Y,PropModification:Wt,replacePrefix:function(e,t){return new Wt({replacePrefix:[e,t]})},add:function(e){return new Wt({add:e})},remove:function(e){return new Wt({remove:e})},default:He,RangeSet:we,mergeRanges:Gt,rangesOverlap:Zs}),{default:He}),He})}(nr)),nr.exports}var Ba=ja();const ps=Ta(Ba),hi=Symbol.for("Dexie"),rr=globalThis[hi]||(globalThis[hi]=ps);if(ps.semVer!==rr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ps.semVer} and ${rr.semVer}`);const{liveQuery:Fo,mergeRanges:$o,rangesOverlap:Uo,RangeSet:Lo,cmp:Wo,Entity:Ho,PropModification:Jo,replacePrefix:Vo,add:zo,remove:Xo}=rr,ms={theme:"system",apiKeys:{anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"},videoCaptureDuration:5,videoCaptureFps:1,saveChatsToLocalStorage:!1,preserveKeyFormat:!1},{subscribe:Da,set:Zr,update:es}=Ei(ms),ur={subscribe:Da,async loadSettings(){try{const u=await tr.settings.get("user-settings");u?(console.log("Loaded settings from IndexedDB:",u),u.apiKeys?Object.entries(u.apiKeys).forEach(([n,s])=>{s&&typeof s=="string"&&s.length>0?console.log(`Found ${n} API key (length: ${s.length}, starts with: ${s.substring(0,4)}...)`):console.log(`No ${n} API key found in settings`)}):(console.warn("No API keys object found in loaded settings"),u.apiKeys={anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),Zr(u)):(console.log("Creating default settings in IndexedDB"),await tr.settings.add({...ms,id:"user-settings"}),Zr(ms))}catch(u){console.error("Failed to load settings from IndexedDB:",u);try{const n=localStorage.getItem("gervais-settings");if(n){console.log("Found settings in localStorage, migrating to IndexedDB");const s=JSON.parse(n);Zr(s),await tr.settings.add({...s,id:"user-settings"}),localStorage.removeItem("gervais-settings")}}catch(n){console.error("Failed to load settings from localStorage:",n)}}},async saveSettings(u){try{console.log("Saving settings to IndexedDB:",u),await tr.settings.put({...u,id:"user-settings"})}catch(n){console.error("Failed to save settings to IndexedDB:",n);try{localStorage.setItem("gervais-settings",JSON.stringify(u)),console.log("Saved settings to localStorage as fallback")}catch(s){console.error("Failed to save settings to localStorage:",s)}}},async updateApiKeys(u){es(n=>{const s={...n,apiKeys:{...n.apiKeys,...u}};return this.saveSettings(s).catch(console.error),s})},async updateSettings(u){es(n=>{const s={...n,...u,apiKeys:{...n.apiKeys,...u.apiKeys||{}}};return this.saveSettings(s).catch(console.error),s})},updateTheme(u){es(n=>{const s={...n,theme:u};return this.saveSettings(s).catch(console.error),s})},async init(){await this.loadSettings()}},It="0.39.0";let di=!1,un,Oi,ys,Mi,Ii,Ti;function Ka(u,n={auto:!1}){if(di)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${u.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(un)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${u.kind}'\` after \`import '@anthropic-ai/sdk/shims/${un}'\``);di=n.auto,un=u.kind,Oi=u.fetch,ys=u.File,Mi=u.ReadableStream,Ii=u.getDefaultAgent,Ti=u.fileFromPath}class Ca{constructor(n){this.body=n}get[Symbol.toStringTag](){return"MultipartBody"}}function qa({manuallyImported:u}={}){const n=u?"You may need to use polyfills":"Add one of these imports before your first `import … from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let s,i,c,d;try{s=fetch,i=Request,c=Response,d=Headers}catch(S){throw new Error(`this environment is missing the following Web Fetch API type: ${S.message}. ${n}`)}return{kind:"web",fetch:s,Request:i,Response:c,Headers:d,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${n}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${n}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${n}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${n}`)}},getMultipartRequestOptions:async(S,O)=>({...O,body:new Ca(S)}),getDefaultAgent:S=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:S=>!1}}un||Ka(qa(),{auto:!0});class Q extends Error{}class Pe extends Q{constructor(n,s,i,c){super(`${Pe.makeMessage(n,s,i)}`),this.status=n,this.headers=c,this.request_id=c==null?void 0:c["request-id"],this.error=s}static makeMessage(n,s,i){const c=s!=null&&s.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):i;return n&&c?`${n} ${c}`:n?`${n} status code (no body)`:c||"(no status code or body)"}static generate(n,s,i,c){if(!n||!c)return new cr({message:i,cause:gs(s)});const d=s;return n===400?new ji(n,d,i,c):n===401?new Bi(n,d,i,c):n===403?new Di(n,d,i,c):n===404?new Ki(n,d,i,c):n===409?new Ci(n,d,i,c):n===422?new qi(n,d,i,c):n===429?new Ni(n,d,i,c):n>=500?new Fi(n,d,i,c):new Pe(n,d,i,c)}}class Ke extends Pe{constructor({message:n}={}){super(void 0,void 0,n||"Request was aborted.",void 0)}}class cr extends Pe{constructor({message:n,cause:s}){super(void 0,void 0,n||"Connection error.",void 0),s&&(this.cause=s)}}class Ri extends cr{constructor({message:n}={}){super({message:n??"Request timed out."})}}class ji extends Pe{}class Bi extends Pe{}class Di extends Pe{}class Ki extends Pe{}class Ci extends Pe{}class qi extends Pe{}class Ni extends Pe{}class Fi extends Pe{}var Fn=function(u,n,s,i,c){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?u!==n||!c:!n.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?c.call(u,s):c?c.value=s:n.set(u,s),s},gt=function(u,n,s,i){if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?u!==n||!i:!n.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(u):i?i.value:n.get(u)},Re;class cn{constructor(){Re.set(this,void 0),this.buffer=new Uint8Array,Fn(this,Re,null,"f")}decode(n){if(n==null)return[];const s=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let i=new Uint8Array(this.buffer.length+s.length);i.set(this.buffer),i.set(s,this.buffer.length),this.buffer=i;const c=[];let d;for(;(d=Na(this.buffer,gt(this,Re,"f")))!=null;){if(d.carriage&&gt(this,Re,"f")==null){Fn(this,Re,d.index,"f");continue}if(gt(this,Re,"f")!=null&&(d.index!==gt(this,Re,"f")+1||d.carriage)){c.push(this.decodeText(this.buffer.slice(0,gt(this,Re,"f")-1))),this.buffer=this.buffer.slice(gt(this,Re,"f")),Fn(this,Re,null,"f");continue}const S=gt(this,Re,"f")!==null?d.preceding-1:d.preceding,O=this.decodeText(this.buffer.slice(0,S));c.push(O),this.buffer=this.buffer.slice(d.index),Fn(this,Re,null,"f")}return c}decodeText(n){if(n==null)return"";if(typeof n=="string")return n;if(typeof Buffer<"u"){if(n instanceof Buffer)return n.toString();if(n instanceof Uint8Array)return Buffer.from(n).toString();throw new Q(`Unexpected: received non-Uint8Array (${n.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(n instanceof Uint8Array||n instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(n);throw new Q(`Unexpected: received non-Uint8Array/ArrayBuffer (${n.constructor.name}) in a web platform. Please report this error.`)}throw new Q("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}Re=new WeakMap;cn.NEWLINE_CHARS=new Set([`
`,"\r"]);cn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Na(u,n){for(let c=n??0;c<u.length;c++){if(u[c]===10)return{preceding:c,index:c+1,carriage:!1};if(u[c]===13)return{preceding:c,index:c+1,carriage:!0}}return null}function Fa(u){for(let i=0;i<u.length-1;i++){if(u[i]===10&&u[i+1]===10||u[i]===13&&u[i+1]===13)return i+2;if(u[i]===13&&u[i+1]===10&&i+3<u.length&&u[i+2]===13&&u[i+3]===10)return i+4}return-1}function vs(u){if(u[Symbol.asyncIterator])return u;const n=u.getReader();return{async next(){try{const s=await n.read();return s!=null&&s.done&&n.releaseLock(),s}catch(s){throw n.releaseLock(),s}},async return(){const s=n.cancel();return n.releaseLock(),await s,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class $e{constructor(n,s){this.iterator=n,this.controller=s}static fromSSEResponse(n,s){let i=!1;async function*c(){if(i)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let d=!1;try{for await(const S of $a(n,s)){if(S.event==="completion")try{yield JSON.parse(S.data)}catch(O){throw console.error("Could not parse message into JSON:",S.data),console.error("From chunk:",S.raw),O}if(S.event==="message_start"||S.event==="message_delta"||S.event==="message_stop"||S.event==="content_block_start"||S.event==="content_block_delta"||S.event==="content_block_stop")try{yield JSON.parse(S.data)}catch(O){throw console.error("Could not parse message into JSON:",S.data),console.error("From chunk:",S.raw),O}if(S.event!=="ping"&&S.event==="error")throw Pe.generate(void 0,`SSE Error: ${S.data}`,S.data,Li(n.headers))}d=!0}catch(S){if(S instanceof Error&&S.name==="AbortError")return;throw S}finally{d||s.abort()}}return new $e(c,s)}static fromReadableStream(n,s){let i=!1;async function*c(){const S=new cn,O=vs(n);for await(const D of O)for(const q of S.decode(D))yield q;for(const D of S.flush())yield D}async function*d(){if(i)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let S=!1;try{for await(const O of c())S||O&&(yield JSON.parse(O));S=!0}catch(O){if(O instanceof Error&&O.name==="AbortError")return;throw O}finally{S||s.abort()}}return new $e(d,s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const n=[],s=[],i=this.iterator(),c=d=>({next:()=>{if(d.length===0){const S=i.next();n.push(S),s.push(S)}return d.shift()}});return[new $e(()=>c(n),this.controller),new $e(()=>c(s),this.controller)]}toReadableStream(){const n=this;let s;const i=new TextEncoder;return new Mi({async start(){s=n[Symbol.asyncIterator]()},async pull(c){try{const{value:d,done:S}=await s.next();if(S)return c.close();const O=i.encode(JSON.stringify(d)+`
`);c.enqueue(O)}catch(d){c.error(d)}},async cancel(){var c;await((c=s.return)==null?void 0:c.call(s))}})}}async function*$a(u,n){if(!u.body)throw n.abort(),new Q("Attempted to iterate over a response with no body");const s=new La,i=new cn,c=vs(u.body);for await(const d of Ua(c))for(const S of i.decode(d)){const O=s.decode(S);O&&(yield O)}for(const d of i.flush()){const S=s.decode(d);S&&(yield S)}}async function*Ua(u){let n=new Uint8Array;for await(const s of u){if(s==null)continue;const i=s instanceof ArrayBuffer?new Uint8Array(s):typeof s=="string"?new TextEncoder().encode(s):s;let c=new Uint8Array(n.length+i.length);c.set(n),c.set(i,n.length),n=c;let d;for(;(d=Fa(n))!==-1;)yield n.slice(0,d),n=n.slice(d)}n.length>0&&(yield n)}class La{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(n){if(n.endsWith("\r")&&(n=n.substring(0,n.length-1)),!n){if(!this.event&&!this.data.length)return null;const d={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],d}if(this.chunks.push(n),n.startsWith(":"))return null;let[s,i,c]=Wa(n,":");return c.startsWith(" ")&&(c=c.substring(1)),s==="event"?this.event=c:s==="data"&&this.data.push(c),null}}function Wa(u,n){const s=u.indexOf(n);return s!==-1?[u.substring(0,s),n,u.substring(s+n.length)]:[u,"",""]}const Ha=u=>u!=null&&typeof u=="object"&&typeof u.url=="string"&&typeof u.blob=="function",Ja=u=>u!=null&&typeof u=="object"&&typeof u.name=="string"&&typeof u.lastModified=="number"&&lr(u),lr=u=>u!=null&&typeof u=="object"&&typeof u.size=="number"&&typeof u.type=="string"&&typeof u.text=="function"&&typeof u.slice=="function"&&typeof u.arrayBuffer=="function";async function Va(u,n,s){var c;if(u=await u,Ja(u))return u;if(Ha(u)){const d=await u.blob();n||(n=new URL(u.url).pathname.split(/[\\/]/).pop()??"unknown_file");const S=lr(d)?[await d.arrayBuffer()]:[d];return new ys(S,n,s)}const i=await za(u);if(n||(n=Ga(u)??"unknown_file"),!(s!=null&&s.type)){const d=(c=i[0])==null?void 0:c.type;typeof d=="string"&&(s={...s,type:d})}return new ys(i,n,s)}async function za(u){var s;let n=[];if(typeof u=="string"||ArrayBuffer.isView(u)||u instanceof ArrayBuffer)n.push(u);else if(lr(u))n.push(await u.arrayBuffer());else if(Ya(u))for await(const i of u)n.push(i);else throw new Error(`Unexpected data type: ${typeof u}; constructor: ${(s=u==null?void 0:u.constructor)==null?void 0:s.name}; props: ${Xa(u)}`);return n}function Xa(u){return`[${Object.getOwnPropertyNames(u).map(s=>`"${s}"`).join(", ")}]`}function Ga(u){var n;return ts(u.name)||ts(u.filename)||((n=ts(u.path))==null?void 0:n.split(/[\\/]/).pop())}const ts=u=>{if(typeof u=="string")return u;if(typeof Buffer<"u"&&u instanceof Buffer)return String(u)},Ya=u=>u!=null&&typeof u=="object"&&typeof u[Symbol.asyncIterator]=="function",pi=u=>u&&typeof u=="object"&&u.body&&u[Symbol.toStringTag]==="MultipartBody";var Rt={},Qa=function(u,n,s,i,c){if(typeof n=="function"?u!==n||!0:!n.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n.set(u,s),s},Za=function(u,n,s,i){if(typeof n=="function"?u!==n||!0:!n.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(u):i?i.value:n.get(u)},$n;async function $i(u){const{response:n}=u;if(u.options.stream)return jt("response",n.status,n.url,n.headers,n.body),u.options.__streamClass?u.options.__streamClass.fromSSEResponse(n,u.controller):$e.fromSSEResponse(n,u.controller);if(n.status===204)return null;if(u.options.__binaryResponse)return n;const s=n.headers.get("content-type");if((s==null?void 0:s.includes("application/json"))||(s==null?void 0:s.includes("application/vnd.api+json"))){const d=await n.json();return jt("response",n.status,n.url,n.headers,d),Ui(d,n)}const c=await n.text();return jt("response",n.status,n.url,n.headers,c),c}function Ui(u,n){return!u||typeof u!="object"||Array.isArray(u)?u:Object.defineProperty(u,"_request_id",{value:n.headers.get("request-id"),enumerable:!1})}class fr extends Promise{constructor(n,s=$i){super(i=>{i(null)}),this.responsePromise=n,this.parseResponse=s}_thenUnwrap(n){return new fr(this.responsePromise,async s=>Ui(n(await this.parseResponse(s),s),s.response))}asResponse(){return this.responsePromise.then(n=>n.response)}async withResponse(){const[n,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:n,response:s,request_id:s.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(n,s){return this.parse().then(n,s)}catch(n){return this.parse().catch(n)}finally(n){return this.parse().finally(n)}}class eo{constructor({baseURL:n,maxRetries:s=2,timeout:i=6e5,httpAgent:c,fetch:d}){this.baseURL=n,this.maxRetries=ns("maxRetries",s),this.timeout=ns("timeout",i),this.httpAgent=c,this.fetch=d??Oi}authHeaders(n){return{}}defaultHeaders(n){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ao(),...this.authHeaders(n)}}validateHeaders(n,s){}defaultIdempotencyKey(){return`stainless-node-retry-${fo()}`}get(n,s){return this.methodRequest("get",n,s)}post(n,s){return this.methodRequest("post",n,s)}patch(n,s){return this.methodRequest("patch",n,s)}put(n,s){return this.methodRequest("put",n,s)}delete(n,s){return this.methodRequest("delete",n,s)}methodRequest(n,s,i){return this.request(Promise.resolve(i).then(async c=>{const d=c&&lr(c==null?void 0:c.body)?new DataView(await c.body.arrayBuffer()):(c==null?void 0:c.body)instanceof DataView?c.body:(c==null?void 0:c.body)instanceof ArrayBuffer?new DataView(c.body):c&&ArrayBuffer.isView(c==null?void 0:c.body)?new DataView(c.body.buffer):c==null?void 0:c.body;return{method:n,path:s,...c,body:d}}))}getAPIList(n,s,i){return this.requestAPIList(s,{method:"get",path:n,...i})}calculateContentLength(n){if(typeof n=="string"){if(typeof Buffer<"u")return Buffer.byteLength(n,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(n).length.toString()}else if(ArrayBuffer.isView(n))return n.byteLength.toString();return null}buildRequest(n,{retryCount:s=0}={}){var ie;n={...n};const{method:i,path:c,query:d,headers:S={}}=n,O=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:pi(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,D=this.calculateContentLength(O),q=this.buildURL(c,d);"timeout"in n&&ns("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const H=n.httpAgent??this.httpAgent??Ii(q),F=n.timeout+1e3;typeof((ie=H==null?void 0:H.options)==null?void 0:ie.timeout)=="number"&&F>(H.options.timeout??0)&&(H.options.timeout=F),this.idempotencyHeader&&i!=="get"&&(n.idempotencyKey||(n.idempotencyKey=this.defaultIdempotencyKey()),S[this.idempotencyHeader]=n.idempotencyKey);const L=this.buildHeaders({options:n,headers:S,contentLength:D,retryCount:s});return{req:{method:i,...O&&{body:O},headers:L,...H&&{agent:H},signal:n.signal??null},url:q,timeout:n.timeout}}buildHeaders({options:n,headers:s,contentLength:i,retryCount:c}){const d={};i&&(d["content-length"]=i);const S=this.defaultHeaders(n);return vi(d,S),vi(d,s),pi(n.body)&&un!=="node"&&delete d["content-type"],Un(S,"x-stainless-retry-count")===void 0&&Un(s,"x-stainless-retry-count")===void 0&&(d["x-stainless-retry-count"]=String(c)),Un(S,"x-stainless-timeout")===void 0&&Un(s,"x-stainless-timeout")===void 0&&n.timeout&&(d["x-stainless-timeout"]=String(n.timeout)),this.validateHeaders(d,s),d}_calculateNonstreamingTimeout(n){if(3600*n/128e3>600)throw new Q("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(n){}async prepareRequest(n,{url:s,options:i}){}parseHeaders(n){return n?Symbol.iterator in n?Object.fromEntries(Array.from(n).map(s=>[...s])):{...n}:{}}makeStatusError(n,s,i,c){return Pe.generate(n,s,i,c)}request(n,s=null){return new fr(this.makeRequest(n,s))}async makeRequest(n,s){var F,L;const i=await n,c=i.maxRetries??this.maxRetries;s==null&&(s=c),await this.prepareOptions(i);const{req:d,url:S,timeout:O}=this.buildRequest(i,{retryCount:c-s});if(await this.prepareRequest(d,{url:S,options:i}),jt("request",S,i,d.headers),(F=i.signal)!=null&&F.aborted)throw new Ke;const D=new AbortController,q=await this.fetchWithTimeout(S,d,O,D).catch(gs);if(q instanceof Error){if((L=i.signal)!=null&&L.aborted)throw new Ke;if(s)return this.retryRequest(i,s);throw q.name==="AbortError"?new Ri:new cr({cause:q})}const H=Li(q.headers);if(!q.ok){if(s&&this.shouldRetry(q)){const ee=`retrying, ${s} attempts remaining`;return jt(`response (error; ${ee})`,q.status,S,H),this.retryRequest(i,s,H)}const J=await q.text().catch(ee=>gs(ee).message),ie=oo(J),pe=ie?void 0:J;throw jt(`response (error; ${s?"(error; no more retries left)":"(error; not retryable)"})`,q.status,S,H,pe),this.makeStatusError(q.status,ie,pe,H)}return{response:q,options:i,controller:D}}requestAPIList(n,s){const i=this.makeRequest(s,null);return new no(this,i,n)}buildURL(n,s){const i=co(n)?new URL(n):new URL(this.baseURL+(this.baseURL.endsWith("/")&&n.startsWith("/")?n.slice(1):n)),c=this.defaultQuery();return sr(c)||(s={...c,...s}),typeof s=="object"&&s&&!Array.isArray(s)&&(i.search=this.stringifyQuery(s)),i.toString()}stringifyQuery(n){return Object.entries(n).filter(([s,i])=>typeof i<"u").map(([s,i])=>{if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")return`${encodeURIComponent(s)}=${encodeURIComponent(i)}`;if(i===null)return`${encodeURIComponent(s)}=`;throw new Q(`Cannot stringify type ${typeof i}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(n,s,i,c){const{signal:d,...S}=s||{};d&&d.addEventListener("abort",()=>c.abort());const O=setTimeout(()=>c.abort(),i),D={signal:c.signal,...S};D.method&&(D.method=D.method.toUpperCase());const q=60*1e3,H=setTimeout(()=>{var F,L;if(D&&((F=D==null?void 0:D.agent)!=null&&F.sockets))for(const J of Object.values((L=D==null?void 0:D.agent)==null?void 0:L.sockets).flat())J!=null&&J.setKeepAlive&&J.setKeepAlive(!0,q)},q);return this.fetch.call(void 0,n,D).finally(()=>{clearTimeout(O),clearTimeout(H)})}shouldRetry(n){const s=n.headers.get("x-should-retry");return s==="true"?!0:s==="false"?!1:n.status===408||n.status===409||n.status===429||n.status>=500}async retryRequest(n,s,i){let c;const d=i==null?void 0:i["retry-after-ms"];if(d){const O=parseFloat(d);Number.isNaN(O)||(c=O)}const S=i==null?void 0:i["retry-after"];if(S&&!c){const O=parseFloat(S);Number.isNaN(O)?c=Date.parse(S)-Date.now():c=O*1e3}if(!(c&&0<=c&&c<60*1e3)){const O=n.maxRetries??this.maxRetries;c=this.calculateDefaultRetryTimeoutMillis(s,O)}return await lo(c),this.makeRequest(n,s-1)}calculateDefaultRetryTimeoutMillis(n,s){const d=s-n,S=Math.min(.5*Math.pow(2,d),8),O=1-Math.random()*.25;return S*O*1e3}getUserAgent(){return`${this.constructor.name}/JS ${It}`}}class to{constructor(n,s,i,c){$n.set(this,void 0),Qa(this,$n,n),this.options=c,this.response=s,this.body=i}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const n=this.nextPageInfo();if(!n)throw new Q("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const s={...this.options};if("params"in n&&typeof s.query=="object")s.query={...s.query,...n.params};else if("url"in n){const i=[...Object.entries(s.query||{}),...n.url.searchParams.entries()];for(const[c,d]of i)n.url.searchParams.set(c,d);s.query=void 0,s.path=n.url.toString()}return await Za(this,$n,"f").requestAPIList(this.constructor,s)}async*iterPages(){let n=this;for(yield n;n.hasNextPage();)n=await n.getNextPage(),yield n}async*[($n=new WeakMap,Symbol.asyncIterator)](){for await(const n of this.iterPages())for(const s of n.getPaginatedItems())yield s}}class no extends fr{constructor(n,s,i){super(s,async c=>new i(n,c.response,await $i(c),c.options))}async*[Symbol.asyncIterator](){const n=await this;for await(const s of n)yield s}}const Li=u=>new Proxy(Object.fromEntries(u.entries()),{get(n,s){const i=s.toString();return n[i.toLowerCase()]||n[i]}}),ro={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},rt=u=>typeof u=="object"&&u!==null&&!sr(u)&&Object.keys(u).every(n=>Wi(ro,n)),so=()=>{var n;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":yi(Deno.build.os),"X-Stainless-Arch":mi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((n=Deno.version)==null?void 0:n.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":yi(process.platform),"X-Stainless-Arch":mi(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const u=io();return u?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${u.browser}`,"X-Stainless-Runtime-Version":u.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function io(){if(typeof navigator>"u"||!navigator)return null;const u=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:n,pattern:s}of u){const i=s.exec(navigator.userAgent);if(i){const c=i[1]||0,d=i[2]||0,S=i[3]||0;return{browser:n,version:`${c}.${d}.${S}`}}}return null}const mi=u=>u==="x32"?"x32":u==="x86_64"||u==="x64"?"x64":u==="arm"?"arm":u==="aarch64"||u==="arm64"?"arm64":u?`other:${u}`:"unknown",yi=u=>(u=u.toLowerCase(),u.includes("ios")?"iOS":u==="android"?"Android":u==="darwin"?"MacOS":u==="win32"?"Windows":u==="freebsd"?"FreeBSD":u==="openbsd"?"OpenBSD":u==="linux"?"Linux":u?`Other:${u}`:"Unknown");let gi;const ao=()=>gi??(gi=so()),oo=u=>{try{return JSON.parse(u)}catch{return}},uo=/^[a-z][a-z0-9+.-]*:/i,co=u=>uo.test(u),lo=u=>new Promise(n=>setTimeout(n,u)),ns=(u,n)=>{if(typeof n!="number"||!Number.isInteger(n))throw new Q(`${u} must be an integer`);if(n<0)throw new Q(`${u} must be a positive integer`);return n},gs=u=>{if(u instanceof Error)return u;if(typeof u=="object"&&u!==null)try{return new Error(JSON.stringify(u))}catch{}return new Error(String(u))},rs=u=>{var n,s,i,c;if(typeof process<"u")return((n=Rt==null?void 0:Rt[u])==null?void 0:n.trim())??void 0;if(typeof Deno<"u")return(c=(i=(s=Deno.env)==null?void 0:s.get)==null?void 0:i.call(s,u))==null?void 0:c.trim()};function sr(u){if(!u)return!0;for(const n in u)return!1;return!0}function Wi(u,n){return Object.prototype.hasOwnProperty.call(u,n)}function vi(u,n){for(const s in n){if(!Wi(n,s))continue;const i=s.toLowerCase();if(!i)continue;const c=n[s];c===null?delete u[i]:c!==void 0&&(u[i]=c)}}function jt(u,...n){typeof process<"u"&&(Rt==null?void 0:Rt.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${u}`,...n)}const fo=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,u=>{const n=Math.random()*16|0;return(u==="x"?n:n&3|8).toString(16)}),ho=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",po=u=>typeof(u==null?void 0:u.get)=="function",Un=(u,n)=>{var i;const s=n.toLowerCase();if(po(u)){const c=((i=n[0])==null?void 0:i.toUpperCase())+n.substring(1).replace(/([^\w])(\w)/g,(d,S,O)=>S+O.toUpperCase());for(const d of[n,s,n.toUpperCase(),c]){const S=u.get(d);if(S)return S}}for(const[c,d]of Object.entries(u))if(c.toLowerCase()===s)return Array.isArray(d)?(d.length<=1||console.warn(`Received ${d.length} entries for the ${n} header, using the first entry.`),d[0]):d};class hr extends to{constructor(n,s,i,c){super(n,s,i,c),this.data=i.data||[],this.has_more=i.has_more||!1,this.first_id=i.first_id||null,this.last_id=i.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const n=this.nextPageInfo();if(!n)return null;if("params"in n)return n.params;const s=Object.fromEntries(n.url.searchParams);return Object.keys(s).length?s:null}nextPageInfo(){var s;if((s=this.options.query)!=null&&s.before_id){const i=this.first_id;return i?{params:{before_id:i}}:null}const n=this.last_id;return n?{params:{after_id:n}}:null}}class st{constructor(n){this._client=n}}let bs=class extends st{retrieve(n,s){return this._client.get(`/v1/models/${n}?beta=true`,s)}list(n={},s){return rt(n)?this.list({},n):this._client.getAPIList("/v1/models?beta=true",ws,{query:n,...s})}};class ws extends hr{}bs.BetaModelInfosPage=ws;class dr{constructor(n,s){this.iterator=n,this.controller=s}async*decoder(){const n=new cn;for await(const s of this.iterator)for(const i of n.decode(s))yield JSON.parse(i);for(const s of n.flush())yield JSON.parse(s)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(n,s){if(!n.body)throw s.abort(),new Q("Attempted to iterate over a response with no body");return new dr(vs(n.body),s)}}let _s=class extends st{create(n,s){const{betas:i,...c}=n;return this._client.post("/v1/messages/batches?beta=true",{body:c,...s,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...s==null?void 0:s.headers}})}retrieve(n,s={},i){if(rt(s))return this.retrieve(n,{},s);const{betas:c}=s;return this._client.get(`/v1/messages/batches/${n}?beta=true`,{...i,headers:{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString(),...i==null?void 0:i.headers}})}list(n={},s){if(rt(n))return this.list({},n);const{betas:i,...c}=n;return this._client.getAPIList("/v1/messages/batches?beta=true",xs,{query:c,...s,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...s==null?void 0:s.headers}})}delete(n,s={},i){if(rt(s))return this.delete(n,{},s);const{betas:c}=s;return this._client.delete(`/v1/messages/batches/${n}?beta=true`,{...i,headers:{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString(),...i==null?void 0:i.headers}})}cancel(n,s={},i){if(rt(s))return this.cancel(n,{},s);const{betas:c}=s;return this._client.post(`/v1/messages/batches/${n}/cancel?beta=true`,{...i,headers:{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString(),...i==null?void 0:i.headers}})}async results(n,s={},i){if(rt(s))return this.results(n,{},s);const c=await this.retrieve(n);if(!c.results_url)throw new Q(`No batch \`results_url\`; Has it finished processing? ${c.processing_status} - ${c.id}`);const{betas:d}=s;return this._client.get(c.results_url,{...i,headers:{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary",...i==null?void 0:i.headers},__binaryResponse:!0})._thenUnwrap((S,O)=>dr.fromResponse(O.response,O.controller))}};class xs extends hr{}_s.BetaMessageBatchesPage=xs;const mo=u=>{let n=0,s=[];for(;n<u.length;){let i=u[n];if(i==="\\"){n++;continue}if(i==="{"){s.push({type:"brace",value:"{"}),n++;continue}if(i==="}"){s.push({type:"brace",value:"}"}),n++;continue}if(i==="["){s.push({type:"paren",value:"["}),n++;continue}if(i==="]"){s.push({type:"paren",value:"]"}),n++;continue}if(i===":"){s.push({type:"separator",value:":"}),n++;continue}if(i===","){s.push({type:"delimiter",value:","}),n++;continue}if(i==='"'){let O="",D=!1;for(i=u[++n];i!=='"';){if(n===u.length){D=!0;break}if(i==="\\"){if(n++,n===u.length){D=!0;break}O+=i+u[n],i=u[++n]}else O+=i,i=u[++n]}i=u[++n],D||s.push({type:"string",value:O});continue}if(i&&/\s/.test(i)){n++;continue}let d=/[0-9]/;if(i&&d.test(i)||i==="-"||i==="."){let O="";for(i==="-"&&(O+=i,i=u[++n]);i&&d.test(i)||i===".";)O+=i,i=u[++n];s.push({type:"number",value:O});continue}let S=/[a-z]/i;if(i&&S.test(i)){let O="";for(;i&&S.test(i)&&n!==u.length;)O+=i,i=u[++n];if(O=="true"||O=="false"||O==="null")s.push({type:"name",value:O});else{n++;continue}continue}n++}return s},Tt=u=>{if(u.length===0)return u;let n=u[u.length-1];switch(n.type){case"separator":return u=u.slice(0,u.length-1),Tt(u);case"number":let s=n.value[n.value.length-1];if(s==="."||s==="-")return u=u.slice(0,u.length-1),Tt(u);case"string":let i=u[u.length-2];if((i==null?void 0:i.type)==="delimiter")return u=u.slice(0,u.length-1),Tt(u);if((i==null?void 0:i.type)==="brace"&&i.value==="{")return u=u.slice(0,u.length-1),Tt(u);break;case"delimiter":return u=u.slice(0,u.length-1),Tt(u)}return u},yo=u=>{let n=[];return u.map(s=>{s.type==="brace"&&(s.value==="{"?n.push("}"):n.splice(n.lastIndexOf("}"),1)),s.type==="paren"&&(s.value==="["?n.push("]"):n.splice(n.lastIndexOf("]"),1))}),n.length>0&&n.reverse().map(s=>{s==="}"?u.push({type:"brace",value:"}"}):s==="]"&&u.push({type:"paren",value:"]"})}),u},go=u=>{let n="";return u.map(s=>{switch(s.type){case"string":n+='"'+s.value+'"';break;default:n+=s.value;break}}),n},Hi=u=>JSON.parse(go(yo(Tt(mo(u)))));var Se=function(u,n,s,i,c){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?u!==n||!c:!n.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?c.call(u,s):c?c.value=s:n.set(u,s),s},V=function(u,n,s,i){if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?u!==n||!i:!n.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(u):i?i.value:n.get(u)},Be,tt,Yt,Ln,Qt,Zt,Wn,en,Je,tn,Hn,Jn,Ot,Vn,zn,ss,bi,is,as,os,us,wi;const _i="__json_buf";class ir{constructor(){Be.add(this),this.messages=[],this.receivedMessages=[],tt.set(this,void 0),this.controller=new AbortController,Yt.set(this,void 0),Ln.set(this,()=>{}),Qt.set(this,()=>{}),Zt.set(this,void 0),Wn.set(this,()=>{}),en.set(this,()=>{}),Je.set(this,{}),tn.set(this,!1),Hn.set(this,!1),Jn.set(this,!1),Ot.set(this,!1),Vn.set(this,void 0),zn.set(this,void 0),is.set(this,n=>{if(Se(this,Hn,!0,"f"),n instanceof Error&&n.name==="AbortError"&&(n=new Ke),n instanceof Ke)return Se(this,Jn,!0,"f"),this._emit("abort",n);if(n instanceof Q)return this._emit("error",n);if(n instanceof Error){const s=new Q(n.message);return s.cause=n,this._emit("error",s)}return this._emit("error",new Q(String(n)))}),Se(this,Yt,new Promise((n,s)=>{Se(this,Ln,n,"f"),Se(this,Qt,s,"f")}),"f"),Se(this,Zt,new Promise((n,s)=>{Se(this,Wn,n,"f"),Se(this,en,s,"f")}),"f"),V(this,Yt,"f").catch(()=>{}),V(this,Zt,"f").catch(()=>{})}get response(){return V(this,Vn,"f")}get request_id(){return V(this,zn,"f")}async withResponse(){const n=await V(this,Yt,"f");if(!n)throw new Error("Could not resolve a `Response` object");return{data:this,response:n,request_id:n.headers.get("request-id")}}static fromReadableStream(n){const s=new ir;return s._run(()=>s._fromReadableStream(n)),s}static createMessage(n,s,i){const c=new ir;for(const d of s.messages)c._addMessageParam(d);return c._run(()=>c._createMessage(n,{...s,stream:!0},{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),c}_run(n){n().then(()=>{this._emitFinal(),this._emit("end")},V(this,is,"f"))}_addMessageParam(n){this.messages.push(n)}_addMessage(n,s=!0){this.receivedMessages.push(n),s&&this._emit("message",n)}async _createMessage(n,s,i){var O;const c=i==null?void 0:i.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),V(this,Be,"m",as).call(this);const{response:d,data:S}=await n.create({...s,stream:!0},{...i,signal:this.controller.signal}).withResponse();this._connected(d);for await(const D of S)V(this,Be,"m",os).call(this,D);if((O=S.controller.signal)!=null&&O.aborted)throw new Ke;V(this,Be,"m",us).call(this)}_connected(n){this.ended||(Se(this,Vn,n,"f"),Se(this,zn,n==null?void 0:n.headers.get("request-id"),"f"),V(this,Ln,"f").call(this,n),this._emit("connect"))}get ended(){return V(this,tn,"f")}get errored(){return V(this,Hn,"f")}get aborted(){return V(this,Jn,"f")}abort(){this.controller.abort()}on(n,s){return(V(this,Je,"f")[n]||(V(this,Je,"f")[n]=[])).push({listener:s}),this}off(n,s){const i=V(this,Je,"f")[n];if(!i)return this;const c=i.findIndex(d=>d.listener===s);return c>=0&&i.splice(c,1),this}once(n,s){return(V(this,Je,"f")[n]||(V(this,Je,"f")[n]=[])).push({listener:s,once:!0}),this}emitted(n){return new Promise((s,i)=>{Se(this,Ot,!0,"f"),n!=="error"&&this.once("error",i),this.once(n,s)})}async done(){Se(this,Ot,!0,"f"),await V(this,Zt,"f")}get currentMessage(){return V(this,tt,"f")}async finalMessage(){return await this.done(),V(this,Be,"m",ss).call(this)}async finalText(){return await this.done(),V(this,Be,"m",bi).call(this)}_emit(n,...s){if(V(this,tn,"f"))return;n==="end"&&(Se(this,tn,!0,"f"),V(this,Wn,"f").call(this));const i=V(this,Je,"f")[n];if(i&&(V(this,Je,"f")[n]=i.filter(c=>!c.once),i.forEach(({listener:c})=>c(...s))),n==="abort"){const c=s[0];!V(this,Ot,"f")&&!(i!=null&&i.length)&&Promise.reject(c),V(this,Qt,"f").call(this,c),V(this,en,"f").call(this,c),this._emit("end");return}if(n==="error"){const c=s[0];!V(this,Ot,"f")&&!(i!=null&&i.length)&&Promise.reject(c),V(this,Qt,"f").call(this,c),V(this,en,"f").call(this,c),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",V(this,Be,"m",ss).call(this))}async _fromReadableStream(n,s){var d;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),V(this,Be,"m",as).call(this),this._connected(null);const c=$e.fromReadableStream(n,this.controller);for await(const S of c)V(this,Be,"m",os).call(this,S);if((d=c.controller.signal)!=null&&d.aborted)throw new Ke;V(this,Be,"m",us).call(this)}[(tt=new WeakMap,Yt=new WeakMap,Ln=new WeakMap,Qt=new WeakMap,Zt=new WeakMap,Wn=new WeakMap,en=new WeakMap,Je=new WeakMap,tn=new WeakMap,Hn=new WeakMap,Jn=new WeakMap,Ot=new WeakMap,Vn=new WeakMap,zn=new WeakMap,is=new WeakMap,Be=new WeakSet,ss=function(){if(this.receivedMessages.length===0)throw new Q("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},bi=function(){if(this.receivedMessages.length===0)throw new Q("stream ended without producing a Message with role=assistant");const s=this.receivedMessages.at(-1).content.filter(i=>i.type==="text").map(i=>i.text);if(s.length===0)throw new Q("stream ended without producing a content block with type=text");return s.join(" ")},as=function(){this.ended||Se(this,tt,void 0,"f")},os=function(s){if(this.ended)return;const i=V(this,Be,"m",wi).call(this,s);switch(this._emit("streamEvent",s,i),s.type){case"content_block_delta":{const c=i.content.at(-1);switch(s.delta.type){case"text_delta":{c.type==="text"&&this._emit("text",s.delta.text,c.text||"");break}case"citations_delta":{c.type==="text"&&this._emit("citation",s.delta.citation,c.citations??[]);break}case"input_json_delta":{c.type==="tool_use"&&c.input&&this._emit("inputJson",s.delta.partial_json,c.input);break}case"thinking_delta":{c.type==="thinking"&&this._emit("thinking",s.delta.thinking,c.thinking);break}case"signature_delta":{c.type==="thinking"&&this._emit("signature",c.signature);break}default:s.delta}break}case"message_stop":{this._addMessageParam(i),this._addMessage(i,!0);break}case"content_block_stop":{this._emit("contentBlock",i.content.at(-1));break}case"message_start":{Se(this,tt,i,"f");break}}},us=function(){if(this.ended)throw new Q("stream has ended, this shouldn't happen");const s=V(this,tt,"f");if(!s)throw new Q("request ended without sending any chunks");return Se(this,tt,void 0,"f"),s},wi=function(s){let i=V(this,tt,"f");if(s.type==="message_start"){if(i)throw new Q(`Unexpected event order, got ${s.type} before receiving "message_stop"`);return s.message}if(!i)throw new Q(`Unexpected event order, got ${s.type} before "message_start"`);switch(s.type){case"message_stop":return i;case"message_delta":return i.stop_reason=s.delta.stop_reason,i.stop_sequence=s.delta.stop_sequence,i.usage.output_tokens=s.usage.output_tokens,i;case"content_block_start":return i.content.push(s.content_block),i;case"content_block_delta":{const c=i.content.at(s.index);switch(s.delta.type){case"text_delta":{(c==null?void 0:c.type)==="text"&&(c.text+=s.delta.text);break}case"citations_delta":{(c==null?void 0:c.type)==="text"&&(c.citations??(c.citations=[]),c.citations.push(s.delta.citation));break}case"input_json_delta":{if((c==null?void 0:c.type)==="tool_use"){let d=c[_i]||"";d+=s.delta.partial_json,Object.defineProperty(c,_i,{value:d,enumerable:!1,writable:!0}),d&&(c.input=Hi(d))}break}case"thinking_delta":{(c==null?void 0:c.type)==="thinking"&&(c.thinking+=s.delta.thinking);break}case"signature_delta":{(c==null?void 0:c.type)==="thinking"&&(c.signature=s.delta.signature);break}default:s.delta}return i}case"content_block_stop":return i}},Symbol.asyncIterator)](){const n=[],s=[];let i=!1;return this.on("streamEvent",c=>{const d=s.shift();d?d.resolve(c):n.push(c)}),this.on("end",()=>{i=!0;for(const c of s)c.resolve(void 0);s.length=0}),this.on("abort",c=>{i=!0;for(const d of s)d.reject(c);s.length=0}),this.on("error",c=>{i=!0;for(const d of s)d.reject(c);s.length=0}),{next:async()=>n.length?{value:n.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((d,S)=>s.push({resolve:d,reject:S})).then(d=>d?{value:d,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new $e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const xi={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let pr=class extends st{constructor(){super(...arguments),this.batches=new _s(this._client)}create(n,s){const{betas:i,...c}=n;return c.model in xi&&console.warn(`The model '${c.model}' is deprecated and will reach end-of-life on ${xi[c.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages?beta=true",{body:c,timeout:this._client._options.timeout??(c.stream?6e5:this._client._calculateNonstreamingTimeout(c.max_tokens)),...s,headers:{...(i==null?void 0:i.toString())!=null?{"anthropic-beta":i==null?void 0:i.toString()}:void 0,...s==null?void 0:s.headers},stream:n.stream??!1})}stream(n,s){return ir.createMessage(this,n,s)}countTokens(n,s){const{betas:i,...c}=n;return this._client.post("/v1/messages/count_tokens?beta=true",{body:c,...s,headers:{"anthropic-beta":[...i??[],"token-counting-2024-11-01"].toString(),...s==null?void 0:s.headers}})}};pr.Batches=_s;pr.BetaMessageBatchesPage=xs;class ln extends st{constructor(){super(...arguments),this.models=new bs(this._client),this.messages=new pr(this._client)}}ln.Models=bs;ln.BetaModelInfosPage=ws;ln.Messages=pr;class Ji extends st{create(n,s){return this._client.post("/v1/complete",{body:n,timeout:this._client._options.timeout??6e5,...s,stream:n.stream??!1})}}class Ss extends st{create(n,s){return this._client.post("/v1/messages/batches",{body:n,...s})}retrieve(n,s){return this._client.get(`/v1/messages/batches/${n}`,s)}list(n={},s){return rt(n)?this.list({},n):this._client.getAPIList("/v1/messages/batches",ks,{query:n,...s})}delete(n,s){return this._client.delete(`/v1/messages/batches/${n}`,s)}cancel(n,s){return this._client.post(`/v1/messages/batches/${n}/cancel`,s)}async results(n,s){const i=await this.retrieve(n);if(!i.results_url)throw new Q(`No batch \`results_url\`; Has it finished processing? ${i.processing_status} - ${i.id}`);return this._client.get(i.results_url,{...s,headers:{Accept:"application/binary",...s==null?void 0:s.headers},__binaryResponse:!0})._thenUnwrap((c,d)=>dr.fromResponse(d.response,d.controller))}}class ks extends hr{}Ss.MessageBatchesPage=ks;var ke=function(u,n,s,i,c){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?u!==n||!c:!n.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?c.call(u,s):c?c.value=s:n.set(u,s),s},z=function(u,n,s,i){if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?u!==n||!i:!n.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(u):i?i.value:n.get(u)},De,nt,nn,Xn,rn,sn,Gn,an,Ve,on,Yn,Qn,Mt,Zn,er,cs,Si,ls,fs,hs,ds,ki;const Pi="__json_buf";class ar{constructor(){De.add(this),this.messages=[],this.receivedMessages=[],nt.set(this,void 0),this.controller=new AbortController,nn.set(this,void 0),Xn.set(this,()=>{}),rn.set(this,()=>{}),sn.set(this,void 0),Gn.set(this,()=>{}),an.set(this,()=>{}),Ve.set(this,{}),on.set(this,!1),Yn.set(this,!1),Qn.set(this,!1),Mt.set(this,!1),Zn.set(this,void 0),er.set(this,void 0),ls.set(this,n=>{if(ke(this,Yn,!0,"f"),n instanceof Error&&n.name==="AbortError"&&(n=new Ke),n instanceof Ke)return ke(this,Qn,!0,"f"),this._emit("abort",n);if(n instanceof Q)return this._emit("error",n);if(n instanceof Error){const s=new Q(n.message);return s.cause=n,this._emit("error",s)}return this._emit("error",new Q(String(n)))}),ke(this,nn,new Promise((n,s)=>{ke(this,Xn,n,"f"),ke(this,rn,s,"f")}),"f"),ke(this,sn,new Promise((n,s)=>{ke(this,Gn,n,"f"),ke(this,an,s,"f")}),"f"),z(this,nn,"f").catch(()=>{}),z(this,sn,"f").catch(()=>{})}get response(){return z(this,Zn,"f")}get request_id(){return z(this,er,"f")}async withResponse(){const n=await z(this,nn,"f");if(!n)throw new Error("Could not resolve a `Response` object");return{data:this,response:n,request_id:n.headers.get("request-id")}}static fromReadableStream(n){const s=new ar;return s._run(()=>s._fromReadableStream(n)),s}static createMessage(n,s,i){const c=new ar;for(const d of s.messages)c._addMessageParam(d);return c._run(()=>c._createMessage(n,{...s,stream:!0},{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),c}_run(n){n().then(()=>{this._emitFinal(),this._emit("end")},z(this,ls,"f"))}_addMessageParam(n){this.messages.push(n)}_addMessage(n,s=!0){this.receivedMessages.push(n),s&&this._emit("message",n)}async _createMessage(n,s,i){var O;const c=i==null?void 0:i.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),z(this,De,"m",fs).call(this);const{response:d,data:S}=await n.create({...s,stream:!0},{...i,signal:this.controller.signal}).withResponse();this._connected(d);for await(const D of S)z(this,De,"m",hs).call(this,D);if((O=S.controller.signal)!=null&&O.aborted)throw new Ke;z(this,De,"m",ds).call(this)}_connected(n){this.ended||(ke(this,Zn,n,"f"),ke(this,er,n==null?void 0:n.headers.get("request-id"),"f"),z(this,Xn,"f").call(this,n),this._emit("connect"))}get ended(){return z(this,on,"f")}get errored(){return z(this,Yn,"f")}get aborted(){return z(this,Qn,"f")}abort(){this.controller.abort()}on(n,s){return(z(this,Ve,"f")[n]||(z(this,Ve,"f")[n]=[])).push({listener:s}),this}off(n,s){const i=z(this,Ve,"f")[n];if(!i)return this;const c=i.findIndex(d=>d.listener===s);return c>=0&&i.splice(c,1),this}once(n,s){return(z(this,Ve,"f")[n]||(z(this,Ve,"f")[n]=[])).push({listener:s,once:!0}),this}emitted(n){return new Promise((s,i)=>{ke(this,Mt,!0,"f"),n!=="error"&&this.once("error",i),this.once(n,s)})}async done(){ke(this,Mt,!0,"f"),await z(this,sn,"f")}get currentMessage(){return z(this,nt,"f")}async finalMessage(){return await this.done(),z(this,De,"m",cs).call(this)}async finalText(){return await this.done(),z(this,De,"m",Si).call(this)}_emit(n,...s){if(z(this,on,"f"))return;n==="end"&&(ke(this,on,!0,"f"),z(this,Gn,"f").call(this));const i=z(this,Ve,"f")[n];if(i&&(z(this,Ve,"f")[n]=i.filter(c=>!c.once),i.forEach(({listener:c})=>c(...s))),n==="abort"){const c=s[0];!z(this,Mt,"f")&&!(i!=null&&i.length)&&Promise.reject(c),z(this,rn,"f").call(this,c),z(this,an,"f").call(this,c),this._emit("end");return}if(n==="error"){const c=s[0];!z(this,Mt,"f")&&!(i!=null&&i.length)&&Promise.reject(c),z(this,rn,"f").call(this,c),z(this,an,"f").call(this,c),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",z(this,De,"m",cs).call(this))}async _fromReadableStream(n,s){var d;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),z(this,De,"m",fs).call(this),this._connected(null);const c=$e.fromReadableStream(n,this.controller);for await(const S of c)z(this,De,"m",hs).call(this,S);if((d=c.controller.signal)!=null&&d.aborted)throw new Ke;z(this,De,"m",ds).call(this)}[(nt=new WeakMap,nn=new WeakMap,Xn=new WeakMap,rn=new WeakMap,sn=new WeakMap,Gn=new WeakMap,an=new WeakMap,Ve=new WeakMap,on=new WeakMap,Yn=new WeakMap,Qn=new WeakMap,Mt=new WeakMap,Zn=new WeakMap,er=new WeakMap,ls=new WeakMap,De=new WeakSet,cs=function(){if(this.receivedMessages.length===0)throw new Q("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Si=function(){if(this.receivedMessages.length===0)throw new Q("stream ended without producing a Message with role=assistant");const s=this.receivedMessages.at(-1).content.filter(i=>i.type==="text").map(i=>i.text);if(s.length===0)throw new Q("stream ended without producing a content block with type=text");return s.join(" ")},fs=function(){this.ended||ke(this,nt,void 0,"f")},hs=function(s){if(this.ended)return;const i=z(this,De,"m",ki).call(this,s);switch(this._emit("streamEvent",s,i),s.type){case"content_block_delta":{const c=i.content.at(-1);switch(s.delta.type){case"text_delta":{c.type==="text"&&this._emit("text",s.delta.text,c.text||"");break}case"citations_delta":{c.type==="text"&&this._emit("citation",s.delta.citation,c.citations??[]);break}case"input_json_delta":{c.type==="tool_use"&&c.input&&this._emit("inputJson",s.delta.partial_json,c.input);break}case"thinking_delta":{c.type==="thinking"&&this._emit("thinking",s.delta.thinking,c.thinking);break}case"signature_delta":{c.type==="thinking"&&this._emit("signature",c.signature);break}default:s.delta}break}case"message_stop":{this._addMessageParam(i),this._addMessage(i,!0);break}case"content_block_stop":{this._emit("contentBlock",i.content.at(-1));break}case"message_start":{ke(this,nt,i,"f");break}}},ds=function(){if(this.ended)throw new Q("stream has ended, this shouldn't happen");const s=z(this,nt,"f");if(!s)throw new Q("request ended without sending any chunks");return ke(this,nt,void 0,"f"),s},ki=function(s){let i=z(this,nt,"f");if(s.type==="message_start"){if(i)throw new Q(`Unexpected event order, got ${s.type} before receiving "message_stop"`);return s.message}if(!i)throw new Q(`Unexpected event order, got ${s.type} before "message_start"`);switch(s.type){case"message_stop":return i;case"message_delta":return i.stop_reason=s.delta.stop_reason,i.stop_sequence=s.delta.stop_sequence,i.usage.output_tokens=s.usage.output_tokens,i;case"content_block_start":return i.content.push(s.content_block),i;case"content_block_delta":{const c=i.content.at(s.index);switch(s.delta.type){case"text_delta":{(c==null?void 0:c.type)==="text"&&(c.text+=s.delta.text);break}case"citations_delta":{(c==null?void 0:c.type)==="text"&&(c.citations??(c.citations=[]),c.citations.push(s.delta.citation));break}case"input_json_delta":{if((c==null?void 0:c.type)==="tool_use"){let d=c[Pi]||"";d+=s.delta.partial_json,Object.defineProperty(c,Pi,{value:d,enumerable:!1,writable:!0}),d&&(c.input=Hi(d))}break}case"thinking_delta":{(c==null?void 0:c.type)==="thinking"&&(c.thinking+=s.delta.thinking);break}case"signature_delta":{(c==null?void 0:c.type)==="thinking"&&(c.signature=s.delta.signature);break}default:s.delta}return i}case"content_block_stop":return i}},Symbol.asyncIterator)](){const n=[],s=[];let i=!1;return this.on("streamEvent",c=>{const d=s.shift();d?d.resolve(c):n.push(c)}),this.on("end",()=>{i=!0;for(const c of s)c.resolve(void 0);s.length=0}),this.on("abort",c=>{i=!0;for(const d of s)d.reject(c);s.length=0}),this.on("error",c=>{i=!0;for(const d of s)d.reject(c);s.length=0}),{next:async()=>n.length?{value:n.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((d,S)=>s.push({resolve:d,reject:S})).then(d=>d?{value:d,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new $e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class mr extends st{constructor(){super(...arguments),this.batches=new Ss(this._client)}create(n,s){return n.model in Ai&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${Ai[n.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:n,timeout:this._client._options.timeout??(n.stream?6e5:this._client._calculateNonstreamingTimeout(n.max_tokens)),...s,stream:n.stream??!1})}stream(n,s){return ar.createMessage(this,n,s)}countTokens(n,s){return this._client.post("/v1/messages/count_tokens",{body:n,...s})}}const Ai={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};mr.Batches=Ss;mr.MessageBatchesPage=ks;class Ps extends st{retrieve(n,s){return this._client.get(`/v1/models/${n}`,s)}list(n={},s){return rt(n)?this.list({},n):this._client.getAPIList("/v1/models",As,{query:n,...s})}}class As extends hr{}Ps.ModelInfosPage=As;var Vi;class ne extends eo{constructor({baseURL:n=rs("ANTHROPIC_BASE_URL"),apiKey:s=rs("ANTHROPIC_API_KEY")??null,authToken:i=rs("ANTHROPIC_AUTH_TOKEN")??null,...c}={}){const d={apiKey:s,authToken:i,...c,baseURL:n||"https://api.anthropic.com"};if(!d.dangerouslyAllowBrowser&&ho())throw new Q(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:d.baseURL,timeout:d.timeout??6e5,httpAgent:d.httpAgent,maxRetries:d.maxRetries,fetch:d.fetch}),this.completions=new Ji(this),this.messages=new mr(this),this.models=new Ps(this),this.beta=new ln(this),this._options=d,this.apiKey=s,this.authToken=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(n){return{...super.defaultHeaders(n),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(n,s){if(!(this.apiKey&&n["x-api-key"])&&s["x-api-key"]!==null&&!(this.authToken&&n.authorization)&&s.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(n){const s=this.apiKeyAuth(n),i=this.bearerAuth(n);return s!=null&&!sr(s)?s:i!=null&&!sr(i)?i:{}}apiKeyAuth(n){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(n){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}Vi=ne;ne.Anthropic=Vi;ne.HUMAN_PROMPT=`

Human:`;ne.AI_PROMPT=`

Assistant:`;ne.DEFAULT_TIMEOUT=6e5;ne.AnthropicError=Q;ne.APIError=Pe;ne.APIConnectionError=cr;ne.APIConnectionTimeoutError=Ri;ne.APIUserAbortError=Ke;ne.NotFoundError=Ki;ne.ConflictError=Ci;ne.RateLimitError=Ni;ne.BadRequestError=ji;ne.AuthenticationError=Bi;ne.InternalServerError=Fi;ne.PermissionDeniedError=Di;ne.UnprocessableEntityError=qi;ne.toFile=Va;ne.fileFromPath=Ti;ne.Completions=Ji;ne.Messages=mr;ne.Models=Ps;ne.ModelInfosPage=As;ne.Beta=ln;const{HUMAN_PROMPT:ru,AI_PROMPT:su}=ne,vo=[{id:"claude-3-7-sonnet-20250219",name:"Claude 3.7 Sonnet",provider:"anthropic",description:"Latest and most capable model",isLocal:!1,maxTokens:2e5,supportsStreaming:!0,supportsFiles:!0,supportsThinking:!0},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",provider:"anthropic",description:"Fastest model for quick responses",isLocal:!1,maxTokens:1e5,supportsStreaming:!0,supportsFiles:!0,supportsThinking:!1}];function bo(u){return u.split(",")[1]}function wo(u){const n=u.match(/^data:([^;]+);base64,/);return n?n[1]:"application/octet-stream"}function _o(u){const n=u.filter(d=>d.role==="system"),s=n.length>0?n.map(d=>d.content).join(`

`):void 0;return{messages:u.filter(d=>d.role==="user"||d.role==="assistant").map(d=>{if(!d.media||d.media.length===0)return{role:d.role,content:d.content};const S=[];return d.content.trim()&&S.push({type:"text",text:d.content}),d.media.forEach(O=>{O.type==="image"&&O.preview&&S.push({type:"image",source:{type:"base64",media_type:wo(O.preview),data:bo(O.preview)}})}),{role:d.role,content:S}}),systemPrompt:s}}function xo(){const n=or(ur).apiKeys.anthropic;if(!n)throw new Error("Anthropic API key not found. Please add your API key in Settings.");return n}async function iu(u,n,s,i,c,d){var S,O,D,q;try{const H=xo(),{messages:F,systemPrompt:L}=_o(n);console.log("Sending request to Anthropic API with model:",u);try{console.log("Attempting to use Anthropic SDK..."),await So(H,u,F,L,s,i,c,d);return}catch(ee){console.error("Error using Anthropic SDK, falling back to fetch:",ee)}const J=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"content-type":"application/json","x-api-key":H,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:u,messages:F,system:L,dangerouslyAllowBrowser:"true",stream:!0,temperature:.7,max_tokens:4e3})});if(!J.ok){let ee=`Status code: ${J.status}`;try{ee=((S=(await J.json()).error)==null?void 0:S.message)||ee}catch{ee=J.statusText||ee}throw new Error(`Anthropic API error: ${ee}`)}const ie=(O=J.body)==null?void 0:O.getReader();if(!ie)throw new Error("Failed to get response reader");const pe=new TextDecoder("utf-8");let be="",ue="";for(;;){const{done:ee,value:ve}=await ie.read();if(ee)break;be+=pe.decode(ve,{stream:!0});const he=be.split(`
`);be=he.pop()||"";for(const Ue of he){const ae=Ue.trim();if(!(!ae||ae==="data: [DONE]"))try{const re=ae.replace(/^data: /,"");if(re==="")continue;const Ae=JSON.parse(re);if(Ae.type==="thinking"&&d&&((D=Ae.delta)!=null&&D.text)){d(Ae.delta.text);continue}if(Ae.type==="content_block_delta"&&((q=Ae.delta)!=null&&q.text)&&(ue+=Ae.delta.text,s(ue)),Ae.type==="message_stop")return i(),ue}catch(re){console.warn("Error parsing chunk:",re)}}}return i(),ue}catch(H){throw c(H instanceof Error?H:new Error(String(H))),H}}async function So(u,n,s,i,c,d,S,O){try{const D=new ne({apiKey:u,dangerouslyAllowBrowser:!0}),q=s.map(L=>({role:L.role,content:typeof L.content=="string"?L.content:L.content.filter(J=>J.type==="text").map(J=>J.text||"").join(`
`)}));console.log("Using Anthropic SDK with model:",n);const H=await D.messages.create({model:n,max_tokens:1024,messages:[{role:"user",content:"Hello, Claude"}],system:i,stream:!0});let F="";for await(const L of H)if(L.type==="content_block_delta"&&"text"in L.delta&&(F+=L.delta.text,c(F)),L.type==="message_stop")return d(),F;return d(),F}catch(D){throw console.error("Error using Anthropic SDK:",D),D}}const zi=[{id:"gpt-4o",name:"GPT-4o",provider:"openai",description:"Most capable model for a wide range of tasks",isLocal:!1,maxTokens:8192,supportsStreaming:!0,supportsFiles:!0},{id:"gpt-4-turbo",name:"GPT-4 Turbo",provider:"openai",description:"Improved version of GPT-4",isLocal:!1,maxTokens:4096,supportsStreaming:!0,supportsFiles:!0},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",provider:"openai",description:"Fast and efficient for most tasks",isLocal:!1,maxTokens:4096,supportsStreaming:!0,supportsFiles:!0}];function Xi(u){return u.map(n=>{if(!n.media||n.media.length===0)return{role:n.role,content:n.content};const s=[];return n.content.trim()&&s.push({type:"text",text:n.content}),n.media.forEach(i=>{if(console.log(`Processing media item for OpenAI: ${i.type} ${i.name}`),i.type==="image"&&i.preview)s.push({type:"image_url",image_url:{url:i.preview,detail:"auto"}}),console.log(`Added image to OpenAI message: ${i.name}`);else if(i.type==="document")if(i.fileId)s.push({type:"text",text:`I've analyzed the document: ${i.name}. The file has been processed.`}),console.log(`Referenced uploaded document in message: ${i.name} (file ID: ${i.fileId})`);else if(i.preview)try{const c=i.preview.match(/^data:([^;]+);base64,/),d=c?c[1]:"application/octet-stream";console.log(`Processing document: ${i.name}, MIME type: ${d}`),d.startsWith("image/")?(s.push({type:"image_url",image_url:{url:i.preview,detail:"high"}}),console.log(`Added document with image MIME type to OpenAI message: ${i.name}`)):(console.warn(`Document type ${d} not supported via chat API: ${i.name}`),s.push({type:"text",text:`[Note: I attempted to analyze your document "${i.name}" but couldn't process it directly in the chat. For better document support, please try uploading it again.]`}))}catch(c){console.error(`Error processing document ${i.name}:`,c),s.push({type:"text",text:`[Error: Could not process document "${i.name}" due to technical error]`})}else console.log(`Document ${i.name} has no preview or fileId, cannot send to OpenAI`);else console.log(`Unsupported media type: ${i.type} for ${i.name}`)}),s.length===0?{role:n.role,content:n.content||"I've attached some files, but they couldn't be processed."}:{role:n.role,content:s}})}function ko(){try{const u=or(ur);if(console.log("Retrieving OpenAI API key from settings store"),!u||!u.apiKeys)throw console.error("Settings or apiKeys object is undefined:",u),new Error("OpenAI API key not found. Settings store may not be initialized properly.");const n=u.apiKeys.openai;if(!n)throw console.error("OpenAI API key is empty or undefined"),new Error("OpenAI API key not found. Please add your API key in Settings.");if(console.log("FULL API KEY FROM SETTINGS: ",n),!n.startsWith("sk-")||n.length<20)throw console.error("Invalid OpenAI API key format"),new Error('Invalid OpenAI API key format. Keys should start with "sk-" and be at least 20 characters long.');return console.log(`Retrieved OpenAI API key (length: ${n.length}, starts with: ${n.substring(0,4)}...)`),n}catch(u){throw console.error("Error retrieving OpenAI API key:",u),u}}async function Es(u=3,n=500){let s=0;for(;s<u;)try{return ko()}catch(i){if(console.warn(`Failed to get API key (attempt ${s+1}/${u}):`,i),s===u-1)throw i;await new Promise(c=>setTimeout(c,n)),s++}throw new Error("Failed to retrieve API key after multiple attempts")}async function au(u,n,s,i,c){var d,S,O,D;try{const q=await Es();console.log("SECURITY WARNING: Printing full API key for debugging: ",q),console.log("EXACT KEY SENT TO OPENAI: ",q),console.log(`Key format check: length=${q.length}, starts with=${q.substring(0,4)}, contains "sk-"=${q.includes("sk-")}`);const H=[...q.substring(0,10)].map(ee=>ee.charCodeAt(0));console.log(`First 10 character codes: ${H.join(", ")}`);const F=`Bearer ${q.trim()}`;console.log(`Authorization header format: Bearer ${q.trim()}`);const L=Xi(n),J=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:F},body:JSON.stringify({model:u,messages:L,stream:!0,temperature:.7})});if(!J.ok){const ee=await J.text();let ve=`OpenAI API error (${J.status}): ${J.statusText}`;try{const he=JSON.parse(ee);he.error&&(J.status===401?ve="Authentication error with OpenAI. Please check your API key in Settings.":he.error.message&&(ve=`OpenAI API error: ${he.error.message}`))}catch{J.status===401?ve="Authentication error with OpenAI. Please check your API key in Settings.":ee&&(ve=`OpenAI API error: ${ee}`)}throw new Error(ve)}const ie=(d=J.body)==null?void 0:d.getReader();if(!ie)throw new Error("Failed to get response reader");const pe=new TextDecoder("utf-8");let be="",ue="";for(;;){const{done:ee,value:ve}=await ie.read();if(ee)break;be+=pe.decode(ve,{stream:!0});const he=be.split(`
`);be=he.pop()||"";for(const Ue of he){const ae=Ue.trim();if(!(!ae||ae==="data: [DONE]"))try{const re=ae.replace(/^data: /,""),Ae=JSON.parse(re),Ce=(O=(S=Ae.choices[0])==null?void 0:S.delta)==null?void 0:O.content;if(Ce&&(ue+=Ce,s(ue)),(D=Ae.choices[0])!=null&&D.finish_reason)return i(),ue}catch(re){console.warn("Error parsing chunk:",re)}}}return i(),ue}catch(q){throw console.error("OpenAI stream completion error:",q),c(q instanceof Error?q:new Error(String(q))),q}}async function ou(u,n){var s,i;try{const c=await Es();console.log(`Processing ${n.length} messages for OpenAI non-streaming completion`),n.some(F=>F.media&&F.media.length>0)&&console.log("Messages contain media - ensuring proper conversion");const S=`Bearer ${c.trim()}`,O=Xi(n),D=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:S},body:JSON.stringify({model:u,messages:O,stream:!1,temperature:.7})});if(!D.ok){const F=await D.text();let L=`OpenAI API error (${D.status}): ${D.statusText}`;try{const J=JSON.parse(F);J.error&&(D.status===401?L="Authentication error with OpenAI. Please check your API key in Settings.":J.error.message&&(L=`OpenAI API error: ${J.error.message}`))}catch{D.status===401?L="Authentication error with OpenAI. Please check your API key in Settings.":F&&(L=`OpenAI API error: ${F}`)}throw new Error(L)}const H=(i=(s=(await D.json()).choices[0])==null?void 0:s.message)==null?void 0:i.content;return typeof H=="string"?H:Array.isArray(H)?H.filter(F=>F.type==="text"&&F.text).map(F=>F.text).join(`

`):""}catch(c){throw console.error("OpenAI completion error:",c),c}}async function uu(u){try{const n=await Es(),s=new FormData;s.append("file",u),s.append("purpose","assistants"),console.log(`Uploading file to OpenAI: ${u.name}, type: ${u.type}, size: ${u.size} bytes`);const i=await fetch("https://api.openai.com/v1/files",{method:"POST",headers:{Authorization:`Bearer ${n.trim()}`},body:s});if(!i.ok){const d=await i.text();let S=`OpenAI API error (${i.status}): ${i.statusText}`;try{const O=JSON.parse(d);O.error&&O.error.message&&(S=`OpenAI API error: ${O.error.message}`)}catch{d&&(S=`OpenAI API error: ${d}`)}throw new Error(S)}const c=await i.json();return console.log(`File uploaded successfully to OpenAI: ${c.id}`),c.id}catch(n){throw console.error("Error uploading file to OpenAI:",n),n}}const Po=[{id:"gemini-2.0-flash-exp",name:"Gemini 2.0 Flash",provider:"google",description:"Fast and efficient model with enhanced thinking capabilities",isLocal:!1,maxTokens:32768,supportsStreaming:!0,supportsFiles:!0,supportsThinking:!0}];function Ao(u){return u.split(",")[1]}function Eo(u){const n=u.match(/^data:([^;]+);base64,/);return n?n[1]:"application/octet-stream"}function Oo(u){return u.map(n=>{const s=[];return n.content.trim()&&s.push({text:n.content}),n.media&&n.media.length>0&&n.media.forEach(i=>{i.type==="image"&&i.preview&&s.push({inlineData:{mimeType:Eo(i.preview),data:Ao(i.preview)}})}),s.length>0?{role:n.role==="assistant"?"model":"user",parts:s}:null}).filter(n=>n!==null)}function Mo(){const n=or(ur).apiKeys.google;if(!n)throw new Error("Google API key not found. Please add your API key in Settings.");return n}async function cu(u,n,s,i,c,d){var S,O,D,q,H,F,L,J,ie,pe,be,ue,ee,ve,he,Ue;try{const ae=Mo(),re=Oo(n);console.log("Sending request to Google Gemini API with model:",u),console.log("Messages after conversion:",JSON.stringify(re,null,2));const Ae={contents:re,generationConfig:{temperature:.7,maxOutputTokens:2048},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]},Ce=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${u}:streamGenerateContent?key=${ae}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ae)});if(!Ce.ok){let Le=`Status code: ${Ce.status}`;try{Le=((S=(await Ce.json()).error)==null?void 0:S.message)||Le}catch{Le=Ce.statusText||Le}throw new Error(`Google API error: ${Le}`)}const Bt=(O=Ce.body)==null?void 0:O.getReader();if(!Bt)throw new Error("Failed to get response reader");const fn=new TextDecoder("utf-8");let Me="",Ee="";for(console.log("Starting to read the stream...");;){const{done:Le,value:it}=await Bt.read();if(Le){console.log("Stream reading complete");break}const vt=fn.decode(it,{stream:!0});console.log("Received chunk length:",vt.length),Me+=vt;let Dt=!1,me=null;try{me=JSON.parse(Me),Dt=!0,console.log("Successfully parsed complete JSON"),Me=""}catch{if(console.log("Failed to parse complete buffer, looking for array content"),Me.trim().startsWith("[")){console.log("Buffer starts with array indicator [");try{const ce=Me.lastIndexOf("]");if(ce>0){const Kt=Me.substring(0,ce+1);try{me=JSON.parse(Kt),Dt=!0,console.log("Successfully parsed array portion"),Me=Me.substring(ce+1)}catch{console.log("Failed to parse array portion")}}}catch(ce){console.log("Error handling array:",ce)}}}if(Dt&&me)if(console.log("Processing valid JSON data"),Array.isArray(me))for(const de of me){if(de.error){const ce=`Google API error: ${de.error.message||"Unknown error"}`;return console.error(ce),c(new Error(ce)),""}if((L=(F=(H=(q=(D=de.candidates)==null?void 0:D[0])==null?void 0:q.content)==null?void 0:H.parts)==null?void 0:F[0])!=null&&L.text){const ce=de.candidates[0].content.parts[0].text;console.log("Extracted text from array item:",ce),Ee+=ce,s(Ee)}if(((ie=(J=de.candidates)==null?void 0:J[0])==null?void 0:ie.finishReason)==="STOP")return console.log("Received completion signal (STOP) in array"),i(),Ee}else{if(me.error){const de=`Google API error: ${me.error.message||"Unknown error"}`;return console.error(de),c(new Error(de)),""}if((ve=(ee=(ue=(be=(pe=me.candidates)==null?void 0:pe[0])==null?void 0:be.content)==null?void 0:ue.parts)==null?void 0:ee[0])!=null&&ve.text){const de=me.candidates[0].content.parts[0].text;console.log("Extracted text from single object:",de),Ee+=de,s(Ee)}if(((Ue=(he=me.candidates)==null?void 0:he[0])==null?void 0:Ue.finishReason)==="STOP")return console.log("Received completion signal (STOP) in single object"),i(),Ee}}return i(),Ee}catch(ae){throw c(ae instanceof Error?ae:new Error(String(ae))),ae}}function Gi(){const n=or(ur).apiKeys.ollamaHost||"http://localhost:11434";return n.endsWith("/")?n.slice(0,-1):n}async function Io(){try{const u=Gi(),n=await fetch(`${u}/api/tags`);if(!n.ok)throw new Error(`Failed to fetch Ollama models: ${n.statusText}`);return(await n.json()).models.map(i=>({id:i.name,name:To(i.name),provider:"ollama",description:Ro(i),isLocal:!0,maxTokens:4096,supportsStreaming:!0,supportsFiles:!1}))}catch(u){return console.error("Error fetching Ollama models:",u),[]}}function To(u){let n=u.split(":")[0];return n=n.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),n}function Ro(u){const n=u.details;return n&&n.parameter_size?`${n.family||"Open source"} model (${n.parameter_size})`:"Local LLM model"}function jo(u){let n="";for(const s of u)s.role==="system"?n+=`SYSTEM: ${s.content}

`:s.role==="user"?n+=`USER: ${s.content}

`:s.role==="assistant"&&(n+=`ASSISTANT: ${s.content}

`);return n+="ASSISTANT: ",n}async function lu(u,n,s,i,c){var d;try{const S=Gi(),O=jo(n),D=await fetch(`${S}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:u,prompt:O,stream:!0,options:{temperature:.7}})});if(!D.ok){const L=await D.text();throw new Error(`Ollama API error: ${L||D.statusText}`)}const q=(d=D.body)==null?void 0:d.getReader();if(!q)throw new Error("Failed to get response reader");const H=new TextDecoder("utf-8");let F="";for(;;){const{done:L,value:J}=await q.read();if(L)break;const pe=H.decode(J,{stream:!0}).split(`
`);for(const be of pe)if(be.trim())try{const ue=JSON.parse(be);if(ue.response&&(F+=ue.response,s(F)),ue.done)return i(),F}catch(ue){console.warn("Error parsing Ollama chunk:",ue)}}return i(),F}catch(S){throw c(S instanceof Error?S:new Error(String(S))),S}}const Os=[...vo,...zi,...Po],Yi=Ei([]),fu=Ma(Yi,u=>[...Os,...u]);let Bo=[],Do=[...Os];const Ko=zi[0];async function hu(){try{const u=await Io();return Bo=u,Yi.set(u),Do=[...Os,...u],u}catch(u){return console.error("Failed to initialize models:",u),[]}}class Co extends rr{constructor(){super("gervaisDB"),this.version(1).stores({chats:"id, title, updatedAt, createdAt",messages:"id, chatId, role, timestamp",mediaItems:"id, messageId, type, timestamp",settings:"id"}),this.chats.mapToClass(qo)}async initialize(){{try{const s=await this.settings.get("user-settings");if(s){console.log("Found existing settings in IndexedDB:",s);return}const i=localStorage.getItem("settings");if(i)try{const c=JSON.parse(i);await this.settings.put({...c,id:"user-settings"}),console.log("Settings migrated from localStorage to IndexedDB:",c)}catch(c){console.error("Failed to migrate settings:",c)}else{const c={id:"user-settings",apiKeys:{anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"},theme:"system",videoCaptureDuration:5,videoCaptureFps:1,saveChatsToLocalStorage:!1};await this.settings.put(c),console.log("Created default settings in IndexedDB:",c)}}catch(s){console.error("Error initializing settings:",s)}const n=localStorage.getItem("chats");if(n)try{const s=JSON.parse(n);await this.transaction("rw",this.chats,this.messages,this.mediaItems,async()=>{for(const i of s){const c=[...i.messages],d={...i};delete d.messages,await this.chats.put(d);for(const S of c){const O=S.media||[],D={...S,chatId:i.id};delete D.media,await this.messages.put(D);for(const q of O)await this.mediaItems.put({...q,messageId:S.id})}}console.log("Chats migrated from localStorage to IndexedDB")})}catch(s){console.error("Failed to migrate chats:",s)}}}async getAllChats(){return(await this.chats.orderBy("updatedAt").reverse().toArray()).map(s=>({...s,messages:[]}))}async getChat(n){const s=await this.chats.get(n);if(!s)return null;const i=await this.messages.where("chatId").equals(n).sortBy("timestamp");for(const c of i){const d=await this.mediaItems.where("messageId").equals(c.id).toArray();d.length>0&&(c.media=d)}return{...s,messages:i}}async createChat(n=Ko){const s={id:crypto.randomUUID(),title:"New Chat",messages:[],createdAt:Date.now(),updatedAt:Date.now(),model:n},i={...s};return delete i.messages,await this.chats.put(i),s}async updateChat(n,s){const i={...s};"messages"in i&&delete i.messages,i.updatedAt=Date.now(),await this.chats.update(n,i)}async deleteChat(n){await this.transaction("rw",this.chats,this.messages,this.mediaItems,async()=>{const s=await this.messages.where("chatId").equals(n).toArray();for(const i of s)await this.mediaItems.where("messageId").equals(i.id).delete();await this.messages.where("chatId").equals(n).delete(),await this.chats.delete(n)})}async addMessage(n,s){const i=crypto.randomUUID(),c=Date.now(),d={...s,id:i,chatId:n,timestamp:c};return await this.transaction("rw",this.messages,this.mediaItems,this.chats,async()=>{const S=d.media||[],O={...d};delete O.media,await this.messages.put(O);for(const q of S){const H={...q,id:q.id||crypto.randomUUID(),messageId:i,timestamp:q.timestamp||Date.now()};await this.mediaItems.put(H)}const D=await this.chats.get(n);if(D&&D.title==="New Chat"&&s.role==="user"){const q=s.content.slice(0,30)+(s.content.length>30?"...":"");await this.chats.update(n,{title:q,updatedAt:Date.now()})}else await this.chats.update(n,{updatedAt:Date.now()})}),i}async updateMessage(n,s){try{const i=await this.messages.get(n);if(!i){console.error(`Cannot update message ${n} - not found in database`);return}await this.transaction("rw",this.messages,this.mediaItems,this.chats,async()=>{const c={...s};if("media"in c&&c.media!==void 0){const d=c.media||[];delete c.media,await this.mediaItems.where("messageId").equals(n).delete();for(const S of d){const O={...S,id:S.id||crypto.randomUUID(),messageId:n,timestamp:S.timestamp||Date.now()};await this.mediaItems.put(O)}}"chatId"in c&&delete c.chatId,Object.keys(c).forEach(d=>{c[d]===void 0&&delete c[d]}),Object.keys(c).length>0&&await this.messages.update(n,c),i.chatId&&await this.chats.update(i.chatId,{updatedAt:Date.now()})})}catch(i){throw console.error("Error updating message:",i),i}}async getSettings(){let n=await this.settings.get("user-settings");if(!n){const s={id:"user-settings",apiKeys:{},theme:"system",videoCaptureDuration:5,videoCaptureFps:1,saveChatsToLocalStorage:!1};await this.settings.put(s),n=s}return n}async updateSettings(n){const s=await this.getSettings();await this.settings.update("user-settings",{...s,...n})}async updateApiKeys(n){const i={...(await this.getSettings()).apiKeys,...n};await this.settings.update("user-settings",{apiKeys:i})}}class qo{constructor(n){n&&Object.assign(this,n),this.messages=this.messages||[]}}const tr=new Co;export{Ko as a,vo as b,fu as c,tr as d,iu as e,au as f,Po as g,ou as h,hu as i,cu as j,lu as k,Yi as l,Ta as m,zi as o,ur as s,uu as u};
