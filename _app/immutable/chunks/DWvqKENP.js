import{h as M,a as q,ax as G,a3 as K,ay as J,d as j,az as Q,aA as W,aB as X,aC as Z,F as k}from"./BSv_i5Hy.js";import{d as I,e as m,f as x,g as tt,n as at,j as rt,k as st}from"./Bl1F-iLh.js";import{a as et,d as S}from"./fllmau90.js";function pt(t,s,a,r,f){var i;M&&q();var o=(i=s.$$slots)==null?void 0:i[a],e=!1;o===!0&&(o=s.children,e=!0),o===void 0||o(t,e?()=>r:r)}function B(t){var s,a,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var f=t.length;for(s=0;s<f;s++)t[s]&&(a=B(t[s]))&&(r&&(r+=" "),r+=a)}else for(a in t)t[a]&&(r&&(r+=" "),r+=a);return r}function it(){for(var t,s,a=0,r="",f=arguments.length;a<f;a++)(t=arguments[a])&&(s=B(t))&&(r&&(r+=" "),r+=s);return r}function ft(t){return typeof t=="object"?it(t):t??""}const D=[...` 	
\r\fÂ \v\uFEFF`];function ot(t,s,a){var r=t==null?"":""+t;if(s&&(r=r?r+" "+s:s),a){for(var f in a)if(a[f])r=r?r+" "+f:f;else if(r.length)for(var o=f.length,e=0;(e=r.indexOf(f,e))>=0;){var i=e+o;(e===0||D.includes(r[e-1]))&&(i===r.length||D.includes(r[i]))?r=(e===0?"":r.substring(0,e))+r.substring(i+1):e=i}}return r===""?null:r}function P(t,s=!1){var a=s?" !important;":";",r="";for(var f in t){var o=t[f];o!=null&&o!==""&&(r+=" "+f+": "+o+a)}return r}function O(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function ct(t,s){if(s){var a="",r,f;if(Array.isArray(s)?(r=s[0],f=s[1]):r=s,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,e=0,i=!1,u=[];r&&u.push(...Object.keys(r).map(O)),f&&u.push(...Object.keys(f).map(O));var c=0,n=-1;const w=t.length;for(var v=0;v<w;v++){var l=t[v];if(i?l==="/"&&t[v-1]==="*"&&(i=!1):o?o===l&&(o=!1):l==="/"&&t[v+1]==="*"?i=!0:l==='"'||l==="'"?o=l:l==="("?e++:l===")"&&e--,!i&&o===!1&&e===0){if(l===":"&&n===-1)n=v;else if(l===";"||v===w-1){if(n!==-1){var C=O(t.substring(c,n).trim());if(!u.includes(C)){l!==";"&&v++;var b=t.substring(c,v).trim();a+=" "+b+";"}}c=v+1,n=-1}}}}return r&&(a+=P(r)),f&&(a+=P(f,!0)),a=a.trim(),a===""?null:a}return t==null?null:String(t)}function ut(t,s,a,r,f,o){var e=t.__className;if(M||e!==a){var i=ot(a,r,o);(!M||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):s?t.className=i:t.setAttribute("class",i)),t.__className=a}else if(o&&f!==o)for(var u in o){var c=!!o[u];(f==null||c!==!!f[u])&&t.classList.toggle(u,c)}return o}function y(t,s={},a,r){for(var f in a){var o=a[f];s[f]!==o&&(a[f]==null?t.style.removeProperty(f):t.style.setProperty(f,o,r))}}function nt(t,s,a,r){var f=t.__style;if(M||f!==s){var o=ct(s,r);(!M||o!==t.getAttribute("style"))&&(o==null?t.removeAttribute("style"):t.style.cssText=o),t.__style=s}else r&&(Array.isArray(r)?(y(t,a==null?void 0:a[0],r[0]),y(t,a==null?void 0:a[1],r[1],"important")):y(t,a,r));return r}const E=Symbol("class"),T=Symbol("style"),F=Symbol("is custom element"),R=Symbol("is html");function bt(t){if(M){var s=!1,a=()=>{if(!s){if(s=!0,t.hasAttribute("value")){var r=t.value;$(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var f=t.checked;$(t,"checked",null),t.checked=f}}};t.__on_r=a,W(a),st()}}function lt(t,s){s?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function $(t,s,a,r){var f=V(t);M&&(f[s]=t.getAttribute(s),s==="src"||s==="srcset"||s==="href"&&t.nodeName==="LINK")||f[s]!==(f[s]=a)&&(s==="loading"&&(t[J]=a),a==null?t.removeAttribute(s):typeof a!="string"&&z(t).includes(s)?t[s]=a:t.setAttribute(s,a))}function wt(t,s,a,r,f=!1){var o=V(t),e=o[F],i=!o[R];let u=M&&e;u&&j(!1);var c=s||{},n=t.tagName==="OPTION";for(var v in s)v in a||(a[v]=null);a.class?a.class=ft(a.class):(r||a[E])&&(a.class=null),a[T]&&(a.style??(a.style=null));var l=z(t);for(const h in a){let g=a[h];if(n&&h==="value"&&g==null){t.value=t.__value="",c[h]=g;continue}if(h==="class"){var C=t.namespaceURI==="http://www.w3.org/1999/xhtml";ut(t,C,g,r,s==null?void 0:s[E],a[E]),c[h]=g,c[E]=a[E];continue}if(h==="style"){nt(t,g,s==null?void 0:s[T],a[T]),c[h]=g,c[T]=a[T];continue}var b=c[h];if(g!==b){c[h]=g;var w=h[0]+h[1];if(w!=="$$")if(w==="on"){const p={},L="$$"+h;let A=h.slice(2);var N=rt(A);if(I(A)&&(A=A.slice(0,-7),p.capture=!0),!N&&b){if(g!=null)continue;t.removeEventListener(A,c[L],p),c[L]=null}if(g!=null)if(N)t[`__${A}`]=g,x([A]);else{let H=function(Y){c[h].call(this,Y)};c[L]=m(A,t,H,p)}else N&&(t[`__${A}`]=void 0)}else if(h==="style")$(t,h,g);else if(h==="autofocus")tt(t,!!g);else if(!e&&(h==="__value"||h==="value"&&g!=null))t.value=t.__value=g;else if(h==="selected"&&n)lt(t,g);else{var d=h;i||(d=at(d));var _=d==="defaultValue"||d==="defaultChecked";if(g==null&&!e&&!_)if(o[h]=null,d==="value"||d==="checked"){let p=t;const L=s===void 0;if(d==="value"){let A=p.defaultValue;p.removeAttribute(d),p.defaultValue=A,p.value=p.__value=L?A:null}else{let A=p.defaultChecked;p.removeAttribute(d),p.defaultChecked=A,p.checked=L?A:!1}}else t.removeAttribute(h);else _||l.includes(d)&&(e||typeof g!="string")?t[d]=g:typeof g!="function"&&$(t,d,g)}}}return u&&j(!0),c}function V(t){return t.__attributes??(t.__attributes={[F]:t.nodeName.includes("-"),[R]:t.namespaceURI===G})}var U=new Map;function z(t){var s=U.get(t.nodeName);if(s)return s;U.set(t.nodeName,s=[]);for(var a,r=t,f=Element.prototype;f!==r;){a=Q(r);for(var o in a)a[o].set&&s.push(o);r=K(r)}return s}const dt={chats:[],activeChat:null},ht=()=>{const{subscribe:t,set:s,update:a}=Z(dt),r=async e=>{const i=await S.getChat(e);i&&a(u=>{const c=u.chats.map(n=>n.id===e?i:n);return{...u,chats:c}})},f=async(e=et)=>{const i=await S.createChat(e);return a(u=>({chats:[i,...u.chats],activeChat:i.id})),i.id},o=async()=>{try{const e=await S.getAllChats();if(a(i=>({...i,chats:e})),e.length>0){const i=e[0].id;a(u=>({...u,activeChat:i})),await r(i)}else await f()}catch(e){console.error("Failed to load chats from database",e),await f()}};return{subscribe:t,createNewChat:f,selectChat:async e=>{a(i=>({...i,activeChat:e})),await r(e)},deleteChat:async e=>{await S.deleteChat(e),a(i=>{const u=i.chats.filter(n=>n.id!==e);let c=i.activeChat;if(i.activeChat===e)if(c=u.length>0?u[0].id:null,c)r(c);else return f().then(n=>{a(v=>({...v,activeChat:n})),r(n)}),{chats:u,activeChat:null};return{chats:u,activeChat:c}})},addMessage:async(e,i)=>{try{if(!k({subscribe:t}).chats.find(l=>l.id===e))return console.error(`Cannot add message - chat ${e} not found in local state`),null;const n=await S.addMessage(e,i),v=await S.getChat(e);return v?(a(l=>{const C=l.chats.find(_=>_.id===e);if(!C)return l;const b=Date.now(),w={...i,id:n,timestamp:b,chatId:e},N={...C,messages:[...C.messages||[],w],title:v.title,updatedAt:b},d=l.chats.map(_=>_.id===e?N:_);return{...l,chats:d}}),n):(console.error("Failed to get updated chat after adding message"),null)}catch(u){return console.error("Error adding message:",u),null}},updateMessage:async(e,i,u)=>{try{const n=k({subscribe:t}).chats.find(C=>C.id===e);if(!n){console.error(`Cannot update message - chat ${e} not found in local state`);return}if(!n.messages.find(C=>C.id===i)){console.error(`Cannot update message - message ${i} not found in local state`);return}const l={...u};"chatId"in l&&delete l.chatId,await S.updateMessage(i,l),a(C=>{const b=C.chats.find(d=>d.id===e);if(!b)return C;const w={...b,messages:b.messages.map(d=>d.id===i?{...d,...l}:d),updatedAt:Date.now()},N=C.chats.map(d=>d.id===e?w:d);return{...C,chats:N}})}catch(c){console.error("Error updating message:",c)}},updateChatModel:async(e,i)=>{await S.updateChat(e,{model:i}),a(u=>{const c=u.chats.map(n=>n.id===e?{...n,model:i,updatedAt:Date.now()}:n);return{...u,chats:c}})},init:async()=>{await o()}}},gt=ht(),St=X(gt,t=>t.chats.find(s=>s.id===t.activeChat)||null);export{E as C,$ as a,wt as b,gt as c,ut as d,St as e,ft as f,bt as r,pt as s};
