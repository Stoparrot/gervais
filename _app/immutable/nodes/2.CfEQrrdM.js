import{a as Ut,n as Yt,b as u,c as me,t as I,d as Xt}from"../chunks/CD-cSNpP.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as It,b as St,s as Ue,h as he,j as Et,a as it,G as e,aa as ue,c as Jt,r as $t,d as Ye,g as Te,m as Qt,e as pt,f as ft,p as Ct,aD as st,t as Pt,a7 as Zt,y as ct,aE as mt,aF as wt,aG as gt,B as ea,$ as kt,aH as qt,a4 as zt,aI as ta,aJ as aa,q as sa,aK as oa,aL as Tt,aM as ra,k as la,E as na,aN as ia,aO as ca,N as Nt,a6 as va,a5 as da,w as Ve,V as d,X as k,T as G,z as Fe,W as i,S as de,aP as ht,aQ as ce,al as Qe,aR as Je,aS as _t,D as g,aT as Ne,P as xt,aU as ke}from"../chunks/BSv_i5Hy.js";import{s as _e}from"../chunks/XUjQEjo_.js";import{i as V}from"../chunks/Cec3cEQU.js";import{l as ua,m as pa,o as le,p as fa}from"../chunks/Bl1F-iLh.js";import{i as ma,l as $e,p as ee,s as Ce,b as yt}from"../chunks/DYD2hZ7I.js";import{a as je,s as bt}from"../chunks/HG7v26tk.js";import{s as Ae,b as vt,C as ga,d as Le,a as be,e as jt,c as ie,f as ha,r as We}from"../chunks/uxZwVYDM.js";import{i as _a,o as ya,g as ba,b as $a,l as wa,c as ka,s as dt,v as xa,u as Aa,e as Ma,f as Ia,h as Sa,j as Ea,k as Ca}from"../chunks/BFkVdgW4.js";import{M as ot}from"../chunks/CoxQhQk-.js";function Ie(s,t){return t}function Pa(s,t,r,y){for(var a=[],f=t.length,n=0;n<f;n++)aa(t[n].e,a,!0);var o=f>0&&a.length===0&&r!==null;if(o){var T=r.parentNode;sa(T),T.append(r),y.clear(),ze(s,t[0].prev,t[f-1].next)}oa(a,()=>{for(var p=0;p<f;p++){var v=t[p];o||(y.delete(v.k),ze(s,v.prev,v.next)),Tt(v.e,!o)}})}function Se(s,t,r,y,a,f=null){var n=s,o={flags:t,items:new Map,first:null},T=(t&qt)!==0;if(T){var p=s;n=he?Ue(Et(p)):p.appendChild(It())}he&&it();var v=null,E=!1,h=ue(()=>{var m=r();return zt(m)?m:m==null?[]:Pt(m)});St(()=>{var m=e(h),b=m.length;if(E&&b===0)return;E=b===0;let P=!1;if(he){var M=n.data===Jt;M!==(b===0)&&(n=$t(),Ue(n),Ye(!1),P=!0)}if(he){for(var j=null,K,R=0;R<b;R++){if(Te.nodeType===8&&Te.data===Qt){n=Te,P=!0,Ye(!1);break}var C=m[R],L=y(C,R);K=Lt(Te,o,j,null,C,L,R,a,t,r),o.items.set(L,K),j=K}b>0&&Ue($t())}he||qa(m,o,n,a,t,y,r),f!==null&&(b===0?v?pt(v):v=ft(()=>f(n)):v!==null&&Ct(v,()=>{v=null})),P&&Ye(!0),e(h)}),he&&(n=Te)}function qa(s,t,r,y,a,f,n){var X,te,ne,F;var o=(a&ta)!==0,T=(a&(mt|gt))!==0,p=s.length,v=t.items,E=t.first,h=E,m,b=null,P,M=[],j=[],K,R,C,L;if(o)for(L=0;L<p;L+=1)K=s[L],R=f(K,L),C=v.get(R),C!==void 0&&((X=C.a)==null||X.measure(),(P??(P=new Set)).add(C));for(L=0;L<p;L+=1){if(K=s[L],R=f(K,L),C=v.get(R),C===void 0){var pe=h?h.e.nodes_start:r;b=Lt(pe,t,b,b===null?t.first:b.next,K,R,L,y,a,n),v.set(R,b),M=[],j=[],h=b.next;continue}if(T&&za(C,K,L,a),(C.e.f&st)!==0&&(pt(C.e),o&&((te=C.a)==null||te.unfix(),(P??(P=new Set)).delete(C))),C!==h){if(m!==void 0&&m.has(C)){if(M.length<j.length){var S=j[0],q;b=S.prev;var H=M[0],Q=M[M.length-1];for(q=0;q<M.length;q+=1)At(M[q],S,r);for(q=0;q<j.length;q+=1)m.delete(j[q]);ze(t,H.prev,Q.next),ze(t,b,H),ze(t,Q,S),h=S,b=Q,L-=1,M=[],j=[]}else m.delete(C),At(C,h,r),ze(t,C.prev,C.next),ze(t,C,b===null?t.first:b.next),ze(t,b,C),b=C;continue}for(M=[],j=[];h!==null&&h.k!==R;)(h.e.f&st)===0&&(m??(m=new Set)).add(h),j.push(h),h=h.next;if(h===null)continue;C=h}M.push(C),b=C,h=C.next}if(h!==null||m!==void 0){for(var W=m===void 0?[]:Pt(m);h!==null;)(h.e.f&st)===0&&W.push(h),h=h.next;var Y=W.length;if(Y>0){var re=(a&qt)!==0&&p===0?r:null;if(o){for(L=0;L<Y;L+=1)(ne=W[L].a)==null||ne.measure();for(L=0;L<Y;L+=1)(F=W[L].a)==null||F.fix()}Pa(t,W,re,v)}}o&&Zt(()=>{var ve;if(P!==void 0)for(C of P)(ve=C.a)==null||ve.apply()}),ct.first=t.first&&t.first.e,ct.last=b&&b.e}function za(s,t,r,y){(y&mt)!==0&&wt(s.v,t),(y&gt)!==0?wt(s.i,r):s.i=r}function Lt(s,t,r,y,a,f,n,o,T,p){var v=(T&mt)!==0,E=(T&ra)===0,h=v?E?ea(a):kt(a):a,m=(T&gt)===0?n:kt(n),b={i:m,v:h,k:f,a:null,e:null,prev:r,next:y};try{return b.e=ft(()=>o(s,h,m,p),he),b.e.prev=r&&r.e,b.e.next=y&&y.e,r===null?t.first=b:(r.next=b,r.e.next=b.e),y!==null&&(y.prev=b,y.e.prev=b.e),b}finally{}}function At(s,t,r){for(var y=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,f=s.e.nodes_start;f!==y;){var n=la(f);a.before(f),f=n}}function ze(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Ta(s,t,r,y,a,f){let n=he;he&&it();var o,T,p=null;he&&Te.nodeType===1&&(p=Te,it());var v=he?Te:s,E;St(()=>{const h=t()||null;var m=ia;h!==o&&(E&&(h===null?Ct(E,()=>{E=null,T=null}):h===T?pt(E):Tt(E)),h&&h!==T&&(E=ft(()=>{if(p=he?p:document.createElementNS(m,h),Ut(p,p),y){he&&ua(h)&&p.append(document.createComment(""));var b=he?Et(p):p.appendChild(It());he&&(b===null?Ye(!1):Ue(b)),y(p,b)}ct.nodes_end=p,v.before(p)})),o=h,o&&(T=o))},na),n&&(Ye(!0),Ue(v))}function Ke(s,t,r=t){var y=ca();pa(s,"input",a=>{var f=a?s.defaultValue:s.value;if(f=rt(s)?lt(f):f,r(f),y&&f!==(f=t())){var n=s.selectionStart,o=s.selectionEnd;s.value=f??"",o!==null&&(s.selectionStart=n,s.selectionEnd=Math.min(o,s.value.length))}}),(he&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&r(rt(s)?lt(s.value):s.value),va(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,r){if(s.multiple)return ja(s,t);for(var y of s.options){var a=Ot(y);if(ma(a,t)){y.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let r=!0;da(()=>{t&&ut(s,Nt(t),r),r=!1;var y=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return y.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{y.disconnect()}})}function ja(s,t){for(var r of s.options)r.selected=~t.indexOf(Ot(r))}function Ot(s){return"__value"in s?s.__value:s.value}function La(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function Mt(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function nt(s,t){var f;var r=(f=s.$$events)==null?void 0:f[t.type],y=zt(r)?r.slice():r==null?[]:[r];for(var a of y)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ha=Yt("<svg><!><!></svg>");function Pe(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]),y=$e(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let a=ee(t,"name",8,void 0),f=ee(t,"color",8,"currentColor"),n=ee(t,"size",8,24),o=ee(t,"strokeWidth",8,2),T=ee(t,"absoluteStrokeWidth",8,!1),p=ee(t,"iconNode",24,()=>[]);const v=(...P)=>P.filter((M,j,K)=>!!M&&K.indexOf(M)===j).join(" ");Re();var E=Ha();let h;var m=d(E);Se(m,1,p,Ie,(P,M)=>{let j=()=>e(M)[0],K=()=>e(M)[1];var R=me(),C=de(R);Ta(C,j,!0,(L,pe)=>{let S;G(()=>S=vt(L,S,{...K()}))}),u(P,R)});var b=k(m);Ae(b,t,"default",{}),i(E),G((P,M)=>h=vt(E,h,{...Oa,...y,width:n(),height:n(),stroke:f(),"stroke-width":P,class:M}),[()=>T()?Number(o())*24/Number(n()):o(),()=>v("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],ue),u(s,E),Fe()}function Da(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ka(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ra(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Va(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ht(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"notebook-pen"},()=>r,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Dt(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Fa(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"send"},()=>r,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ba(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ga(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"video"},()=>r,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Kt(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ce({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,f)=>{var n=me(),o=de(n);Ae(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}var Wa=I('<div class="spinner svelte-1pi70xe"></div>'),Ua=I("<button><!> <!></button>");function xe(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]),y=$e(r,["type","variant","size","disabled","loading","fullWidth"]);let a=ee(t,"type",8,"button"),f=ee(t,"variant",8,"primary"),n=ee(t,"size",8,"md"),o=ee(t,"disabled",8,!1),T=ee(t,"loading",8,!1),p=ee(t,"fullWidth",8,!1);var v=Ua();let E;var h=d(v);{var m=P=>{var M=Wa();u(P,M)};V(h,P=>{T()&&P(m)})}var b=k(h,2);Ae(b,t,"default",{}),i(v),G(P=>E=vt(v,E,{type:a(),class:`button ${f()??""} ${n()??""} ${(p()?"full-width":"")??""}`,disabled:o(),...y,[ga]:P},"svelte-1pi70xe"),[()=>({loading:T()})],ue),le("click",v,function(P){nt.call(this,t,P)}),le("keydown",v,function(P){nt.call(this,t,P)}),le("keyup",v,function(P){nt.call(this,t,P)}),u(s,v)}var Ya=I('<option class="svelte-1m60q0l"> </option>'),Xa=I('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Ja=I('<option class="svelte-1m60q0l"> </option>'),Qa=I('<option class="svelte-1m60q0l"> </option>'),Za=I('<option disabled class="svelte-1m60q0l"> </option>'),es=I('<!> <span class="svelte-1m60q0l">New Chat</span>',1),ts=I('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),as=I('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function ss(s,t){var ve;Ve(t,!1);const[r,y]=bt(),a=()=>je(jt,"$activeChat",r),f=()=>je(ka,"$allModelsStore",r),n=()=>je(wa,"$localModelsStore",r),o=()=>je(ie,"$chatStore",r);let T=ee(t,"isMobile",8,!1),p=ee(t,"isExpanded",8,!0);const v=ht();let E=ce(((ve=a())==null?void 0:ve.model.id)||"claude-3-5-sonnet");Qe(async()=>{await _a()});function h(){const z=f().find(l=>l.id===e(E));z&&ie.createNewChat(z)}function m(z){ie.selectChat(z),T()&&v("toggleSidebar",!1)}function b(z,l){l.stopPropagation(),ie.deleteChat(z)}function P(z){const l=z.target;if(g(E,l.value),a()){const c=f().find(_=>_.id===e(E));c&&ie.updateChatModel(a().id,c)}}Je(()=>a(),()=>{a()&&g(E,a().model.id)}),_t(),Re();var M=as();let j;var K=d(M),R=d(K),C=d(R);Ne(2),i(R);var L=k(R,2);{var pe=z=>{const l=ue(()=>p()?"Collapse sidebar":"Expand sidebar");xe(z,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(l)},$$events:{click:()=>v("toggleSidebar",!p())},children:(c,_)=>{Da(c,{size:20})},$$slots:{default:!0}})};V(L,z=>{T()&&z(pe)})}i(K);var S=k(K,2),q=d(S),H=d(q);Na(H,()=>e(E));var Q,W=d(H);{var Y=z=>{var l=Xa();Se(l,5,n,Ie,(c,_)=>{var x=Ya(),A={},B=d(x,!0);i(x),G(()=>{A!==(A=e(_).id)&&(x.value=(x.__value=e(_).id)==null?"":e(_).id),_e(B,e(_).name)}),u(c,x)}),i(l),u(z,l)};V(W,z=>{n().length>0&&z(Y)})}var re=k(W);Se(re,5,()=>ya,Ie,(z,l)=>{var c=Ja(),_={},x=d(c,!0);i(c),G(()=>{_!==(_=e(l).id)&&(c.value=(c.__value=e(l).id)==null?"":e(l).id),_e(x,e(l).name)}),u(z,c)}),i(re);var X=k(re);Se(X,5,()=>ba,Ie,(z,l)=>{var c=Qa(),_={},x=d(c,!0);i(c),G(()=>{_!==(_=e(l).id)&&(c.value=(c.__value=e(l).id)==null?"":e(l).id),_e(x,e(l).name)}),u(z,c)}),i(X);var te=k(X);Se(te,5,()=>$a,Ie,(z,l)=>{var c=Za(),_={},x=d(c,!0);i(c),G(()=>{_!==(_=e(l).id)&&(c.value=(c.__value=e(l).id)==null?"":e(l).id),_e(x,e(l).name)}),u(z,c)}),i(te),i(H),i(q);var ne=k(q,2);xe(ne,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:h},children:(z,l)=>{var c=es(),_=de(c);Ht(_,{size:16}),Ne(2),u(z,c)},$$slots:{default:!0}});var F=k(ne,2);Se(F,5,()=>o().chats,Ie,(z,l)=>{var c=ts();let _;var x=d(c),A=d(x,!0);i(x);var B=k(x,2);xe(B,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:Z=>b(e(l).id,Z)},children:(Z,ae)=>{Kt(Z,{size:16})},$$slots:{default:!0}}),i(c),G(Z=>{_=Le(c,1,"chat-item svelte-1m60q0l",null,_,Z),_e(A,e(l).title||"New Chat")},[()=>{var Z;return{active:e(l).id===((Z=a())==null?void 0:Z.id)}}],ue),le("click",c,()=>m(e(l).id)),u(z,c)}),i(F),i(S),i(M),G(z=>{j=Le(M,1,"sidebar svelte-1m60q0l",null,j,z),be(C,"src","/gervais/logo.svg"),Q!==(Q=e(E))&&(H.value=(H.__value=e(E))==null?"":e(E),ut(H,e(E)))},[()=>({expanded:p()})],ue),le("change",H,P),u(s,M),Fe(),y()}var os=I('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),rs=I('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),ls=I('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ns=I('<div class="file-size svelte-1mjurqb"> </div>'),is=I('<span class="document-status success svelte-1mjurqb"> </span>'),cs=I('<span class="document-status info svelte-1mjurqb">Document attached</span>'),vs=I('<span class="document-status success svelte-1mjurqb">Document processed</span>'),ds=I('<span class="document-status info svelte-1mjurqb">Document</span>'),us=I('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),ps=I('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">📄</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),fs=I('<div class="media-container svelte-1mjurqb"></div>'),ms=I('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),gs=I('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),hs=I('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),_s=I('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ys=I('<div class="media-container assistant-media svelte-1mjurqb"></div>'),bs=I('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),$s=I('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ws=I('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ks=I('<div class="content system-message svelte-1mjurqb"><!></div>'),xs=I('<div class="timestamp svelte-1mjurqb"> </div>'),As=I('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">×</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),Ms=I("<div><!> <!></div> <!>",1);function Is(s,t){Ve(t,!1);const r=ce(),y=ce();let a=ee(t,"message",8),f=ee(t,"isStreaming",8,!1),n=ee(t,"scrollToBottom",8,!1),o=ce(!1),T=ce(""),p=ce(""),v=ce();Qe(()=>{if(n()&&e(v)){const S=e(v).parentElement;S&&(S.scrollTop=S.scrollHeight)}});function E(S,q=2){if(S===0)return"0 Bytes";const H=1024,Q=q<0?0:q,W=["Bytes","KB","MB","GB","TB"],Y=Math.floor(Math.log(S)/Math.log(H));return parseFloat((S/Math.pow(H,Y)).toFixed(Q))+" "+W[Y]}function h(S,q="Preview image"){g(T,S),g(p,q),g(o,!0)}function m(){g(o,!1)}Je(()=>xt(a()),()=>{g(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Je(()=>xt(a()),()=>{g(y,`message ${a().role}`)}),_t(),Re();var b=Ms(),P=de(b),M=d(P);{var j=S=>{var q=ms(),H=d(q),Q=d(H),W=d(Q,!0);i(Q),i(H);var Y=k(H,2);{var re=X=>{var te=fs();Se(te,5,()=>a().media,Ie,(ne,F,ve)=>{var z=me(),l=de(z);{var c=x=>{var A=os(),B=d(A);be(B,"alt",`Image ${ve+1}`),i(A),G(()=>be(B,"src",e(F).preview)),le("click",A,()=>{e(F).preview&&h(e(F).preview,`Image ${ve+1}`)}),le("keydown",A,Z=>{if(Z.key==="Enter"||Z.key===" "){if(Z.preventDefault(),!e(F).preview)return;h(e(F).preview,`Image ${ve+1}`)}}),u(x,A)},_=(x,A)=>{{var B=ae=>{var oe=rs();G(()=>be(oe,"src",e(F).preview)),u(ae,oe)},Z=(ae,oe)=>{{var $=U=>{var D=ls();G(()=>be(D,"src",e(F).preview)),u(U,D)},w=(U,D)=>{{var se=O=>{var fe=ps(),ye=k(d(fe),2),Me=d(ye),we=d(Me,!0);i(Me);var J=k(Me,2);{var N=Ee=>{var qe=ns(),Be=d(qe,!0);i(qe),G(Ge=>_e(Be,Ge),[()=>E(e(F).size)],ue),u(Ee,qe)};V(J,Ee=>{e(F).size&&Ee(N)})}var ge=k(J,2),Ze=d(ge);{var et=Ee=>{var qe=is(),Be=d(qe);i(qe),G(Ge=>_e(Be,`✓ Uploaded to OpenAI (ID: ${Ge??""}...)`),[()=>e(F).fileId.substring(0,8)],ue),u(Ee,qe)},Rt=(Ee,qe)=>{{var Be=Oe=>{var Xe=me(),Vt=de(Xe);{var Ft=He=>{var tt=cs();u(He,tt)},Bt=(He,tt)=>{{var Gt=De=>{var at=vs();u(De,at)},Wt=De=>{var at=ds();u(De,at)};V(He,De=>{a().role==="assistant"?De(Gt):De(Wt,!1)},tt)}};V(Vt,He=>{a().role==="user"?He(Ft):He(Bt,!1)})}u(Oe,Xe)},Ge=Oe=>{var Xe=us();u(Oe,Xe)};V(Ee,Oe=>{e(F).preview?Oe(Be):Oe(Ge,!1)},qe)}};V(Ze,Ee=>{e(F).fileId?Ee(et):Ee(Rt,!1)})}i(ge),i(ye),i(fe),G(()=>_e(we,e(F).name||"Document")),u(O,fe)};V(U,O=>{e(F).type==="document"&&O(se)},D)}};V(ae,U=>{e(F).type==="video"?U($):U(w,!1)},oe)}};V(x,ae=>{e(F).type==="audio"?ae(B):ae(Z,!1)},A)}};V(l,x=>{e(F).type==="image"?x(c):x(_,!1)})}u(ne,z)}),i(te),u(X,te)};V(Y,X=>{a().media&&a().media.length>0&&X(re)})}i(q),G(()=>_e(W,a().content)),u(S,q)},K=(S,q)=>{{var H=W=>{var Y=ws(),re=d(Y);ot(re,{get content(){return a().content},get scrollToBottom(){return n()}});var X=k(re,2);{var te=l=>{var c=ys();Se(c,5,()=>a().media,Ie,(_,x,A)=>{var B=me(),Z=de(B);{var ae=$=>{var w=gs(),U=d(w);be(U,"alt",`Generated image ${A+1}`),Ne(2),i(w),G(()=>be(U,"src",e(x).preview)),le("click",w,()=>{e(x).preview&&h(e(x).preview,`Generated image ${A+1}`)}),le("keydown",w,D=>{if(D.key==="Enter"||D.key===" "){if(D.preventDefault(),!e(x).preview)return;h(e(x).preview,`Generated image ${A+1}`)}}),u($,w)},oe=($,w)=>{{var U=se=>{var O=hs();G(()=>be(O,"src",e(x).preview)),u(se,O)},D=(se,O)=>{{var fe=ye=>{var Me=_s();G(()=>be(Me,"src",e(x).preview)),u(ye,Me)};V(se,ye=>{e(x).type==="video"&&ye(fe)},O)}};V($,se=>{e(x).type==="audio"?se(U):se(D,!1)},w)}};V(Z,$=>{e(x).type==="image"?$(ae):$(oe,!1)})}u(_,B)}),i(c),u(l,c)};V(X,l=>{a().media&&a().media.length>0&&l(te)})}var ne=k(X,2);{var F=l=>{var c=bs(),_=k(d(c),2),x=d(_);ot(x,{get content(){return a().thinking},scrollToBottom:!1}),i(_),i(c),u(l,c)};V(ne,l=>{a().thinking&&l(F)})}var ve=k(ne,2);{var z=l=>{var c=$s();u(l,c)};V(ve,l=>{f()&&l(z)})}i(Y),u(W,Y)},Q=(W,Y)=>{{var re=X=>{var te=ks(),ne=d(te);ot(ne,{get content(){return a().content},get scrollToBottom(){return n()}}),i(te),u(X,te)};V(W,X=>{a().role==="system"&&X(re)},Y)}};V(S,W=>{a().role==="assistant"?W(H):W(Q,!1)},q)}};V(M,S=>{a().role==="user"?S(j):S(K,!1)})}var R=k(M,2);{var C=S=>{var q=xs(),H=d(q,!0);i(q),G(()=>_e(H,e(r))),u(S,q)};V(R,S=>{a().role==="user"&&S(C)})}i(P),yt(P,S=>g(v,S),()=>e(v));var L=k(P,2);{var pe=S=>{var q=As(),H=d(q),Q=d(H),W=k(Q,2),Y=k(W,2),re=d(Y,!0);i(Y),i(H),i(q),G(()=>{be(W,"src",e(T)),be(W,"alt",e(p)),_e(re,e(p))}),le("click",Q,m),le("click",H,Mt(()=>{})),le("keydown",H,Mt(()=>{})),le("click",q,m),le("keydown",q,X=>X.key==="Escape"&&m()),u(S,q)};V(L,S=>{e(o)&&S(pe)})}G(()=>Le(P,1,ha(e(y)),"svelte-1mjurqb")),u(s,b),Fe()}var Ss=I('<img class="svelte-1latar9">'),Es=I('<div class="file-preview svelte-1latar9"><span> </span></div>'),Cs=I('<div class="media-item svelte-1latar9"><!> <button type="button" class="remove-media svelte-1latar9" aria-label="Remove media">&times;</button></div>'),Ps=I("<div><!></div>"),qs=I("<div><!></div>"),zs=I("<div><!></div>"),Ts=I('<button type="button"> </button>'),Ns=I('<div class="message-input-container svelte-1latar9"><div class="media-preview svelte-1latar9"></div> <div class="input-wrapper svelte-1latar9"><div class="input-container svelte-1latar9"><textarea rows="1" class="svelte-1latar9"></textarea></div> <div class="actions-bar svelte-1latar9"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!> <!></div></div> <div class="tools-bar svelte-1latar9"></div></div>');function js(s,t){Ve(t,!1);let r=ee(t,"value",12,""),y=ee(t,"placeholder",8,"Send a message..."),a=ee(t,"disabled",8,!1),f=ee(t,"isRecording",8,!1),n=ee(t,"isCapturingVideo",8,!1),o=ee(t,"mediaItems",28,()=>[]),T=ee(t,"tools",24,()=>({}));const p=ht();let v=ce();function E(){e(v)&&(ke(v,e(v).style.height="auto"),ke(v,e(v).style.height=`${Math.min(e(v).scrollHeight,200)}px`))}function h(){a()||!r().trim()&&o().length===0||(p("submit",{content:r().trim(),media:o(),tools:T()}),r(""),e(v)&&ke(v,e(v).style.height="auto"))}function m(l){l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),h())}function b(){f()?p("stopAudioCapture"):p("startAudioCapture")}function P(){n()?p("stopVideoCapture"):p("startVideoCapture")}function M(l){const c=l.target;if(c.files&&c.files.length>0){const _=Array.from(c.files);p("uploadFile",_),c.value=""}}function j(l){const c=!T()[l];p("toggleTool",{tool:l,enabled:c})}Je(()=>e(v),()=>{e(v)&&E()}),_t(),Re();var K=Ns(),R=d(K);Se(R,5,o,Ie,(l,c)=>{var _=Cs(),x=d(_);{var A=ae=>{var oe=Ss();G(()=>{be(oe,"src",e(c).preview),be(oe,"alt",e(c).name)}),u(ae,oe)},B=ae=>{var oe=Es(),$=d(oe),w=d($,!0);i($),i(oe),G(()=>_e(w,e(c).name)),u(ae,oe)};V(x,ae=>{e(c).type==="image"&&e(c).preview?ae(A):ae(B,!1)})}var Z=k(x,2);i(_),le("click",Z,()=>{o(o().filter(ae=>ae.id!==e(c).id))}),u(l,_)}),i(R);var C=k(R,2),L=d(C),pe=d(L);fa(pe),yt(pe,l=>g(v,l),()=>e(v)),i(L);var S=k(L,2),q=d(S),H=k(q,2);xe(H,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var l;return(l=document.getElementById("file-upload"))==null?void 0:l.click()}},children:(l,c)=>{Dt(l,{size:18})},$$slots:{default:!0}});var Q=k(H,2);const W=ue(()=>a()||f()),Y=ue(()=>f()?"Stop recording":"Start recording");xe(Q,{variant:"icon",size:"sm",get disabled(){return e(W)},get"aria-label"(){return e(Y)},$$events:{click:b},children:(l,c)=>{var _=Ps();let x;var A=d(_);Va(A,{size:18}),i(_),G(B=>x=Le(_,1,"",null,x,B),[()=>({active:f()})],ue),u(l,_)},$$slots:{default:!0}});var re=k(Q,2);const X=ue(()=>a()||f()),te=ue(()=>n()?"Stop video capture":"Start video capture");xe(re,{variant:"icon",size:"sm",get disabled(){return e(X)},get"aria-label"(){return e(te)},$$events:{click:P},children:(l,c)=>{var _=qs();let x;var A=d(_);Ga(A,{size:18}),i(_),G(B=>x=Le(_,1,"",null,x,B),[()=>({active:n()})],ue),u(l,_)},$$slots:{default:!0}});var ne=k(re,2);xe(ne,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>j("search")},children:(l,c)=>{var _=zs();let x;var A=d(_);Ka(A,{size:18}),i(_),G(B=>x=Le(_,1,"",null,x,B),[()=>({active:T().search})],ue),u(l,_)},$$slots:{default:!0}});var F=k(ne,2);const ve=ue(()=>a()||!r().trim()&&o().length===0);xe(F,{variant:"icon",size:"sm",get disabled(){return e(ve)},"aria-label":"Send message",$$events:{click:h},children:(l,c)=>{Fa(l,{size:18})},$$slots:{default:!0}}),i(S),i(C);var z=k(C,2);Se(z,5,()=>Object.entries(T()),Ie,(l,c)=>{let _=()=>e(c)[0],x=()=>e(c)[1];var A=me(),B=de(A);{var Z=ae=>{var oe=Ts();let $;var w=d(oe,!0);i(oe),G(U=>{$=Le(oe,1,"tool-button svelte-1latar9",null,$,U),be(oe,"aria-label",`Toggle ${_()??""}`),_e(w,_())},[()=>({enabled:x()})],ue),le("click",oe,()=>j(_())),u(ae,oe)};V(B,ae=>{_()!=="search"&&ae(Z)})}u(l,A)}),i(z),i(K),G(()=>{be(pe,"placeholder",y()),pe.disabled=a()}),Ke(pe,r),le("keydown",pe,m),le("change",q,M),u(s,K),Fe()}var Ls=I('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Os=I('<span class="error-message svelte-8a76oy"> </span>'),Hs=I('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ds(s,t){Ve(t,!1);const[r,y]=bt(),a=()=>je(dt,"$settingsStore",r);let f=ee(t,"isOpen",8,!1);const n=ht();let o=ce({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),T=ce(!1),p=ce(!1),v=ce("");Qe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const M=a().apiKeys||{};console.log("Stored API keys from settings store:",M),g(o,{anthropic:M.anthropic||"",openai:M.openai||"",google:M.google||"",ollamaHost:M.ollamaHost||"http://localhost:11434",localHost:M.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(o))});function E(){n("close")}async function h(){var M;g(T,!0),g(p,!1),g(v,"");try{if(console.log("Saving API keys to settingsStore:",e(o)),e(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(o).openai),console.log(`OpenAI key before saving: length=${e(o).openai.length}, starts with=${e(o).openai.substring(0,4)}`);const j=[...e(o).openai.substring(0,10)].map(K=>K.charCodeAt(0));console.log(`First 10 character codes: ${j.join(", ")}`)}if(await dt.updateApiKeys({anthropic:e(o).anthropic,openai:e(o).openai,google:e(o).google,ollamaHost:e(o).ollamaHost||"http://localhost:11434",localHost:e(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(M=a().apiKeys)!=null&&M.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const j=[...a().apiKeys.openai.substring(0,10)].map(K=>K.charCodeAt(0));console.log(`First 10 character codes after saving: ${j.join(", ")}`)}g(p,!0),console.log("API keys saved successfully"),setTimeout(()=>{g(p,!1)},3e3)}catch(j){console.error("Failed to save API keys:",j),g(v,j instanceof Error?j.message:"Unknown error")}finally{g(T,!1)}}Re();var m=me(),b=de(m);{var P=M=>{var j=Hs(),K=d(j),R=d(K),C=k(d(R),2);xe(C,{variant:"icon","aria-label":"Close settings",$$events:{click:E},children:(A,B)=>{Kt(A,{size:20})},$$slots:{default:!0}}),i(R);var L=k(R,2),pe=d(L),S=k(d(pe),4),q=d(S),H=k(d(q),2);We(H),i(q);var Q=k(q,2),W=k(d(Q),2);We(W),i(Q);var Y=k(Q,2),re=k(d(Y),2);We(re),i(Y);var X=k(Y,2),te=k(d(X),2);We(te),Ne(2),i(X);var ne=k(X,2),F=k(d(ne),2);We(F),Ne(2),i(ne),i(S);var ve=k(S,2),z=d(ve);xe(z,{variant:"primary",get disabled(){return e(T)},$$events:{click:h},children:(A,B)=>{Ne();var Z=Xt();G(()=>_e(Z,e(T)?"Saving...":"Save API Keys")),u(A,Z)},$$slots:{default:!0}});var l=k(z,2);{var c=A=>{var B=Ls();u(A,B)};V(l,A=>{e(p)&&A(c)})}var _=k(l,2);{var x=A=>{var B=Os(),Z=d(B,!0);i(B),G(()=>_e(Z,e(v))),u(A,B)};V(_,A=>{e(v)&&A(x)})}i(ve),i(pe),i(L),i(K),i(j),Ke(H,()=>e(o).anthropic,A=>ke(o,e(o).anthropic=A)),Ke(W,()=>e(o).openai,A=>ke(o,e(o).openai=A)),Ke(re,()=>e(o).google,A=>ke(o,e(o).google=A)),Ke(te,()=>e(o).ollamaHost,A=>ke(o,e(o).ollamaHost=A)),Ke(F,()=>e(o).localHost,A=>ke(o,e(o).localHost=A)),le("click",j,La(E)),le("keydown",j,A=>A.key==="Escape"&&E()),u(M,j)};V(b,M=>{f()&&M(P)})}u(s,m),Fe(),y()}var Ks=I('<div class="sidebar-backdrop svelte-u7neki" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=I('<div class="empty-state svelte-u7neki"><h2 class="svelte-u7neki">Start a new conversation</h2> <p class="svelte-u7neki">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-u7neki"><div class="feature svelte-u7neki"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-u7neki"><!> <span>Vision support for images</span></div></div></div>'),Vs=I('<div class="settings-portal svelte-u7neki"><!></div>'),Fs=I('<div class="chat-container svelte-u7neki"><!> <!> <main class="chat-main svelte-u7neki"><header class="chat-header svelte-u7neki"><!> <h1 class="chat-title svelte-u7neki"> </h1> <!></header> <div class="chat-messages svelte-u7neki"><!></div> <div class="input-container svelte-u7neki"><!></div></main></div> <!>',1);function ao(s,t){Ve(t,!1);const[r,y]=bt(),a=()=>je(jt,"$activeChat",r),f=()=>je(dt,"$settingsStore",r);let n=ce(!1),o=ce(!0),T=ce(""),p=ce(!1),v=ce(!1),E=ce([]),h=ce({search:!1}),m=ce(),b=ce(!1);function P(){g(n,window.innerWidth<768),e(n)?g(o,!1):g(o,!0)}Qe(()=>(P(),window.addEventListener("resize",P),()=>{window.removeEventListener("resize",P)}));function M(){g(o,!e(o))}async function j({detail:$}){var fe,ye,Me;if(!a())return;const w=a().model.provider;if(console.log("Current settings store state:",f()),w==="openai"&&!((fe=f().apiKeys)!=null&&fe.openai)){console.warn("OpenAI API key not set, opening settings dialog"),g(b,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(w==="anthropic"&&!((ye=f().apiKeys)!=null&&ye.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),g(b,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(w==="google"&&!((Me=f().apiKeys)!=null&&Me.google)){console.warn("Google API key not set, opening settings dialog"),g(b,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:U,media:D,tools:se}=$;console.log("Media items in submission:",D),await ie.addMessage(a().id,{role:"user",content:U,media:D}),g(T,""),g(E,[]),setTimeout(()=>{e(m)&&ke(m,e(m).scrollTop=e(m).scrollHeight)},100);const O=await ie.addMessage(a().id,{role:"assistant",content:""});g(p,!0),g(v,!0);try{const we=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",we);const J=a().model.id;if(w==="anthropic")await Ma(J,we,N=>{ie.updateMessage(a().id,O,{content:N})},()=>{g(p,!1),g(v,!1),setTimeout(()=>{e(m)&&ke(m,e(m).scrollTop=e(m).scrollHeight)},100)},N=>{console.error("Error generating response:",N),ie.updateMessage(a().id,O,{content:`Error generating response: – ${N.message}`}),g(p,!1),g(v,!1)},N=>{ie.updateMessage(a().id,O,{thinking:N})});else if(w==="openai")if(e(v))await Ia(J,we,N=>{ie.updateMessage(a().id,O,{content:N})},()=>{g(p,!1),g(v,!1),setTimeout(()=>{e(m)&&ke(m,e(m).scrollTop=e(m).scrollHeight)},100)},N=>{console.error("Error generating response from OpenAI:",N);const ge=N.message||"An unknown error occurred";ie.updateMessage(a().id,O,{content:`Error: ${ge}`}),g(p,!1),g(v,!1)});else try{const N=await Sa(J,we);ie.updateMessage(a().id,O,{content:N}),g(p,!1)}catch(N){console.error("Error generating non-streaming response from OpenAI:",N);const ge=N.message||"An unknown error occurred";throw ie.updateMessage(a().id,O,{content:`Error: ${ge}`}),g(p,!1),N}else if(w==="google")await Ea(J,we,(N,ge)=>{ie.updateMessage(a().id,O,{content:N,media:ge})},()=>{g(p,!1),g(v,!1),setTimeout(()=>{e(m)&&ke(m,e(m).scrollTop=e(m).scrollHeight)},100)},N=>{console.error("Error generating response from Google:",N);const ge=N.message||"An unknown error occurred";ie.updateMessage(a().id,O,{content:`Error: ${ge}`}),g(p,!1),g(v,!1)},N=>{ie.updateMessage(a().id,O,{thinking:N})});else if(w==="ollama")try{await Ca(J,we,N=>{ie.updateMessage(a().id,O,{content:N})},()=>{g(p,!1),g(v,!1),setTimeout(()=>{e(m)&&ke(m,e(m).scrollTop=e(m).scrollHeight)},100)},N=>{console.error("Error generating response from Ollama:",N);const ge=N.message||"An unknown error occurred";ie.updateMessage(a().id,O,{content:`Error connecting to Ollama: ${ge}. Make sure Ollama is running locally.`}),g(p,!1),g(v,!1)})}catch(N){throw console.error("Error generating response from Ollama:",N),N}else{let N="";const ge="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of ge)await new Promise(et=>setTimeout(et,50)),N+=Ze+" ",ie.updateMessage(a().id,O,{content:N.trim()});g(p,!1),g(v,!1)}}catch(we){if(console.error("Error generating response:",we),e(p)){const J=we.message||"An unknown error occurred";ie.updateMessage(a().id,O,{content:`Error: ${J}`}),g(p,!1),g(v,!1)}}}function K($){$.forEach(async w=>{const U=xa(),D=w.name,se=w.size;let O="other",fe,ye;console.log(`Processing file: ${D}, type: ${w.type}, size: ${se} bytes`);const Me=J=>{var N;if(J.type.includes("pdf")||J.type.includes("word")||J.type.includes("excel")||J.type.includes("spreadsheet")||J.type.includes("presentation")||J.type.includes("officedocument")||J.type.includes("application/rtf")||J.type.includes("text/rtf"))return!0;if(!J.type||J.type==="application/octet-stream"){const ge=(N=D.split(".").pop())==null?void 0:N.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ge||"")}return!1};if(w.type.startsWith("image/")){O="image";try{fe=await R(w),console.log(`Created data URL for image ${D} (length: ${fe.length} chars)`)}catch(J){console.error(`Failed to create data URL for ${D}:`,J)}}else if(w.type.startsWith("audio/"))O="audio";else if(w.type.startsWith("video/"))O="video";else if(w.type.startsWith("text/"))O="text";else if(Me(w)){if(O="document",a()&&a().model.provider==="openai")try{ye=await Aa(w),console.log(`Document ${D} uploaded to OpenAI with ID: ${ye}`)}catch(J){console.error(`Failed to upload document to OpenAI: ${J.message}`),alert(`Failed to upload document to OpenAI: ${J.message}`)}try{fe=await R(w),console.log(`Created data URL for document ${D}, mime type: ${w.type}`),console.log(`Document data URL length: ${fe.length} chars`),se>5*1024*1024&&console.warn(`Warning: Large document (${(se/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(J){console.error(`Failed to create data URL for ${D}:`,J)}}const we={id:U,type:O,name:D,preview:fe,size:se,timestamp:Date.now(),fileId:ye};console.log(`Adding media item: ${O} ${D}`),g(E,[...e(E),we])})}async function R($){return new Promise((w,U)=>{const D=new FileReader;D.onload=()=>{const se=D.result;w(se)},D.onerror=se=>{console.error("Error reading file:",se),U(se)},D.readAsDataURL($)})}function C({detail:$}){const{tool:w,enabled:U}=$;g(h,{...e(h),[w]:U})}function L(){console.log("Start audio capture")}function pe(){console.log("Stop audio capture")}function S(){console.log("Start video capture")}function q(){console.log("Stop video capture")}Re();var H=Fs(),Q=de(H),W=d(Q);ss(W,{get isMobile(){return e(n)},get isExpanded(){return e(o)},$$events:{toggleSidebar:({detail:$})=>g(o,$)}});var Y=k(W,2);{var re=$=>{var w=Ks();le("click",w,()=>g(o,!1)),le("keydown",w,U=>U.key==="Escape"&&g(o,!1)),u($,w)};V(Y,$=>{e(n)&&e(o)&&$(re)})}var X=k(Y,2),te=d(X),ne=d(te);{var F=$=>{xe($,{variant:"icon","aria-label":"Open menu",$$events:{click:M},children:(w,U)=>{Ht(w,{size:20})},$$slots:{default:!0}})};V(ne,$=>{e(n)&&$(F)})}var ve=k(ne,2),z=d(ve,!0);i(ve);var l=k(ve,2);xe(l,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>g(b,!0)},children:($,w)=>{Ba($,{size:20})},$$slots:{default:!0}}),i(te);var c=k(te,2),_=d(c);{var x=$=>{var w=me(),U=de(w);Se(U,1,()=>a().messages,Ie,(D,se,O)=>{const fe=ue(()=>e(v)&&O===a().messages.length-1&&e(se).role==="assistant"),ye=ue(()=>O===a().messages.length-1);Is(D,{get message(){return e(se)},get isStreaming(){return e(fe)},get scrollToBottom(){return e(ye)}})}),u($,w)},A=$=>{var w=Rs(),U=k(d(w),4),D=d(U),se=d(D);Dt(se,{size:16}),Ne(2),i(D);var O=k(D,2),fe=d(O);Ra(fe,{size:16}),Ne(2),i(O),i(U),i(w),u($,w)};V(_,$=>{a()&&a().messages.length>0?$(x):$(A,!1)})}i(c),yt(c,$=>g(m,$),()=>e(m));var B=k(c,2),Z=d(B);js(Z,{get tools(){return e(h)},get disabled(){return e(p)},placeholder:"Send a message...",get value(){return e(T)},set value($){g(T,$)},get mediaItems(){return e(E)},set mediaItems($){g(E,$)},$$events:{submit:j,uploadFile:$=>K($.detail),toggleTool:C,startAudioCapture:L,stopAudioCapture:pe,startVideoCapture:S,stopVideoCapture:q},$$legacy:!0}),i(B),i(X),i(Q);var ae=k(Q,2);{var oe=$=>{var w=Vs(),U=d(w);Ds(U,{isOpen:!0,$$events:{close:()=>g(b,!1)}}),i(w),u($,w)};V(ae,$=>{e(b)&&$(oe)})}G(()=>{var $;return _e(z,(($=a())==null?void 0:$.model.name)||"AI Assistant")}),u(s,H),Fe(),y()}export{ao as component};
