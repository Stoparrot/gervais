import{a as Rt,n as Ut,b as _,c as ge,t as T,d as Vt}from"../chunks/D9u51XOd.js";import{i as Ue}from"../chunks/DSKYDh3O.js";import{v as wt,b as xt,s as Be,h as fe,j as kt,a as at,G as t,aa as le,c as Kt,r as gt,d as We,g as Pe,m as Ft,e as rt,f as it,p as At,aD as qe,t as Mt,a7 as Bt,y as st,aE as dt,aF as ht,aG as ct,B as Wt,$ as mt,aH as St,a4 as It,aI as jt,aJ as Gt,q as Yt,aK as Xt,aL as Et,aM as qt,k as Jt,E as Qt,aN as Zt,aO as ea,N as Ct,a6 as ta,a5 as aa,w as Ve,V as p,X as k,T as W,z as Ke,W as i,S as de,aP as vt,aQ as ne,al as Ye,aR as Ge,aS as ut,D as h,aT as Re,P as _t,aU as be}from"../chunks/BSv_i5Hy.js";import{s as me}from"../chunks/YMX71UVP.js";import{i as X}from"../chunks/Cec3cEQU.js";import{l as sa,m as oa,o as _e,p as na}from"../chunks/Bl1F-iLh.js";import{i as la,l as ye,p as q,s as ke,b as pt}from"../chunks/DYD2hZ7I.js";import{a as Ne,s as ft}from"../chunks/HG7v26tk.js";import{s as we,b as ot,C as ra,d as Le,e as Pt,c as Z,f as ia,a as ze,r as Fe}from"../chunks/DBQaLaxO.js";import{i as yt,o as da,g as ca,b as va,l as ua,c as pa,s as nt,u as fa,e as ga,f as ha,h as ma,j as _a,k as ya}from"../chunks/jxJ9CbTg.js";import{M as Je}from"../chunks/BKC3HbyP.js";function Se(a,e){return e}function $a(a,e,n,d){for(var s=[],f=e.length,l=0;l<f;l++)Gt(e[l].e,s,!0);var o=f>0&&s.length===0&&n!==null;if(o){var L=n.parentNode;Yt(L),L.append(n),d.clear(),Ce(a,e[0].prev,e[f-1].next)}Xt(s,()=>{for(var v=0;v<f;v++){var r=e[v];o||(d.delete(r.k),Ce(a,r.prev,r.next)),Et(r.e,!o)}})}function Ie(a,e,n,d,s,f=null){var l=a,o={flags:e,items:new Map,first:null},L=(e&St)!==0;if(L){var v=a;l=fe?Be(kt(v)):v.appendChild(wt())}fe&&at();var r=null,I=!1,g=le(()=>{var m=n();return It(m)?m:m==null?[]:Mt(m)});xt(()=>{var m=t(g),$=m.length;if(I&&$===0)return;I=$===0;let O=!1;if(fe){var c=l.data===Kt;c!==($===0)&&(l=gt(),Be(l),We(!1),O=!0)}if(fe){for(var A=null,C,H=0;H<$;H++){if(Pe.nodeType===8&&Pe.data===Ft){l=Pe,O=!0,We(!1);break}var w=m[H],S=d(w,H);C=zt(Pe,o,A,null,w,S,H,s,e,n),o.items.set(S,C),A=C}$>0&&Be(gt())}fe||ba(m,o,l,s,e,d,n),f!==null&&($===0?r?rt(r):r=it(()=>f(l)):r!==null&&At(r,()=>{r=null})),O&&We(!0),t(g)}),fe&&(l=Pe)}function ba(a,e,n,d,s,f,l){var ae,pe,se,ee;var o=(s&jt)!==0,L=(s&(dt|ct))!==0,v=a.length,r=e.items,I=e.first,g=I,m,$=null,O,c=[],A=[],C,H,w,S;if(o)for(S=0;S<v;S+=1)C=a[S],H=f(C,S),w=r.get(H),w!==void 0&&((ae=w.a)==null||ae.measure(),(O??(O=new Set)).add(w));for(S=0;S<v;S+=1){if(C=a[S],H=f(C,S),w=r.get(H),w===void 0){var J=g?g.e.nodes_start:n;$=zt(J,e,$,$===null?e.first:$.next,C,H,S,d,s,l),r.set(H,$),c=[],A=[],g=$.next;continue}if(L&&wa(w,C,S,s),(w.e.f&qe)!==0&&(rt(w.e),o&&((pe=w.a)==null||pe.unfix(),(O??(O=new Set)).delete(w))),w!==g){if(m!==void 0&&m.has(w)){if(c.length<A.length){var F=A[0],K;$=F.prev;var j=c[0],D=c[c.length-1];for(K=0;K<c.length;K+=1)$t(c[K],F,n);for(K=0;K<A.length;K+=1)m.delete(A[K]);Ce(e,j.prev,D.next),Ce(e,$,j),Ce(e,D,F),g=F,$=D,S-=1,c=[],A=[]}else m.delete(w),$t(w,g,n),Ce(e,w.prev,w.next),Ce(e,w,$===null?e.first:$.next),Ce(e,$,w),$=w;continue}for(c=[],A=[];g!==null&&g.k!==H;)(g.e.f&qe)===0&&(m??(m=new Set)).add(g),A.push(g),g=g.next;if(g===null)continue;w=g}c.push(w),$=w,g=w.next}if(g!==null||m!==void 0){for(var G=m===void 0?[]:Mt(m);g!==null;)(g.e.f&qe)===0&&G.push(g),g=g.next;var Q=G.length;if(Q>0){var re=(s&St)!==0&&v===0?n:null;if(o){for(S=0;S<Q;S+=1)(se=G[S].a)==null||se.measure();for(S=0;S<Q;S+=1)(ee=G[S].a)==null||ee.fix()}$a(e,G,re,r)}}o&&Bt(()=>{var P;if(O!==void 0)for(w of O)(P=w.a)==null||P.apply()}),st.first=e.first&&e.first.e,st.last=$&&$.e}function wa(a,e,n,d){(d&dt)!==0&&ht(a.v,e),(d&ct)!==0?ht(a.i,n):a.i=n}function zt(a,e,n,d,s,f,l,o,L,v){var r=(L&dt)!==0,I=(L&qt)===0,g=r?I?Wt(s):mt(s):s,m=(L&ct)===0?l:mt(l),$={i:m,v:g,k:f,a:null,e:null,prev:n,next:d};try{return $.e=it(()=>o(a,g,m,v),fe),$.e.prev=n&&n.e,$.e.next=d&&d.e,n===null?e.first=$:(n.next=$,n.e.next=$.e),d!==null&&(d.prev=$,d.e.prev=$.e),$}finally{}}function $t(a,e,n){for(var d=a.next?a.next.e.nodes_start:n,s=e?e.e.nodes_start:n,f=a.e.nodes_start;f!==d;){var l=Jt(f);s.before(f),f=l}}function Ce(a,e,n){e===null?a.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function xa(a,e,n,d,s,f){let l=fe;fe&&at();var o,L,v=null;fe&&Pe.nodeType===1&&(v=Pe,at());var r=fe?Pe:a,I;xt(()=>{const g=e()||null;var m=Zt;g!==o&&(I&&(g===null?At(I,()=>{I=null,L=null}):g===L?rt(I):Et(I)),g&&g!==L&&(I=it(()=>{if(v=fe?v:document.createElementNS(m,g),Rt(v,v),d){fe&&sa(g)&&v.append(document.createComment(""));var $=fe?kt(v):v.appendChild(wt());fe&&($===null?We(!1):Be($)),d(v,$)}st.nodes_end=v,r.before(v)})),o=g,o&&(L=o))},Qt),l&&(We(!0),Be(r))}function De(a,e,n=e){var d=ea();oa(a,"input",s=>{var f=s?a.defaultValue:a.value;if(f=Qe(a)?Ze(f):f,n(f),d&&f!==(f=e())){var l=a.selectionStart,o=a.selectionEnd;a.value=f??"",o!==null&&(a.selectionStart=l,a.selectionEnd=Math.min(o,a.value.length))}}),(fe&&a.defaultValue!==a.value||Ct(e)==null&&a.value)&&n(Qe(a)?Ze(a.value):a.value),ta(()=>{var s=e();Qe(a)&&s===Ze(a.value)||a.type==="date"&&!s&&!a.value||s!==a.value&&(a.value=s??"")})}function Qe(a){var e=a.type;return e==="number"||e==="range"}function Ze(a){return a===""?null:+a}function lt(a,e,n){if(a.multiple)return Aa(a,e);for(var d of a.options){var s=Tt(d);if(la(s,e)){d.selected=!0;return}}(!n||e!==void 0)&&(a.selectedIndex=-1)}function ka(a,e){let n=!0;aa(()=>{e&&lt(a,Ct(e),n),n=!1;var d=new MutationObserver(()=>{var s=a.__value;lt(a,s)});return d.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{d.disconnect()}})}function Aa(a,e){for(var n of a.options)n.selected=~e.indexOf(Tt(n))}function Tt(a){return"__value"in a?a.__value:a.value}function Ma(a){return function(...e){var n=e[0];n.target===this&&(a==null||a.apply(this,e))}}function et(a,e){var f;var n=(f=a.$$events)==null?void 0:f[e.type],d=It(n)?n.slice():n==null?[]:[n];for(var s of d)s.call(this,e)}const ue=[];for(let a=0;a<256;++a)ue.push((a+256).toString(16).slice(1));function Sa(a,e=0){return(ue[a[e+0]]+ue[a[e+1]]+ue[a[e+2]]+ue[a[e+3]]+"-"+ue[a[e+4]]+ue[a[e+5]]+"-"+ue[a[e+6]]+ue[a[e+7]]+"-"+ue[a[e+8]]+ue[a[e+9]]+"-"+ue[a[e+10]]+ue[a[e+11]]+ue[a[e+12]]+ue[a[e+13]]+ue[a[e+14]]+ue[a[e+15]]).toLowerCase()}let tt;const Ia=new Uint8Array(16);function Ea(){if(!tt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");tt=crypto.getRandomValues.bind(crypto)}return tt(Ia)}const Ca=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),bt={randomUUID:Ca};function Pa(a,e,n){var s;if(bt.randomUUID&&!a)return bt.randomUUID();a=a||{};const d=a.random??((s=a.rng)==null?void 0:s.call(a))??Ea();if(d.length<16)throw new Error("Random bytes length must be >= 16");return d[6]=d[6]&15|64,d[8]=d[8]&63|128,Sa(d)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const za={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ta=Ut("<svg><!><!></svg>");function Ae(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]),d=ye(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(e,!1);let s=q(e,"name",8,void 0),f=q(e,"color",8,"currentColor"),l=q(e,"size",8,24),o=q(e,"strokeWidth",8,2),L=q(e,"absoluteStrokeWidth",8,!1),v=q(e,"iconNode",24,()=>[]);const r=(...O)=>O.filter((c,A,C)=>!!c&&C.indexOf(c)===A).join(" ");Ue();var I=Ta();let g;var m=p(I);Ie(m,1,v,Se,(O,c)=>{let A=()=>t(c)[0],C=()=>t(c)[1];var H=ge(),w=de(H);xa(w,A,!0,(S,J)=>{let F;W(()=>F=ot(S,F,{...C()}))}),_(O,H)});var $=k(m);we($,e,"default",{}),i(I),W((O,c)=>g=ot(I,g,{...za,...d,width:l(),height:l(),stroke:f(),"stroke-width":O,class:c}),[()=>L()?Number(o())*24/Number(l()):o(),()=>r("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],le),_(a,I),Ke()}function Na(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"camera"},()=>n,{iconNode:[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function La(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"chevron-left"},()=>n,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Oa(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"image"},()=>n,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Ha(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"menu"},()=>n,{iconNode:[["line",{x1:"4",x2:"20",y1:"12",y2:"12"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Da(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"mic"},()=>n,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Nt(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"paperclip"},()=>n,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Ra(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"plus"},()=>n,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Ua(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"refresh-cw"},()=>n,{iconNode:[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Va(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"send"},()=>n,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Ka(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"settings"},()=>n,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}function Lt(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]);Ae(a,ke({name:"x"},()=>n,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(s,f)=>{var l=ge(),o=de(l);we(o,e,"default",{}),_(s,l)},$$slots:{default:!0}}))}var Fa=T('<div class="spinner svelte-1pi70xe"></div>'),Ba=T("<button><!> <!></button>");function xe(a,e){const n=ye(e,["children","$$slots","$$events","$$legacy"]),d=ye(n,["type","variant","size","disabled","loading","fullWidth"]);let s=q(e,"type",8,"button"),f=q(e,"variant",8,"primary"),l=q(e,"size",8,"md"),o=q(e,"disabled",8,!1),L=q(e,"loading",8,!1),v=q(e,"fullWidth",8,!1);var r=Ba();let I;var g=p(r);{var m=O=>{var c=Fa();_(O,c)};X(g,O=>{L()&&O(m)})}var $=k(g,2);we($,e,"default",{}),i(r),W(O=>I=ot(r,I,{type:s(),class:`button ${f()??""} ${l()??""} ${(v()?"full-width":"")??""}`,disabled:o(),...d,[ra]:O},"svelte-1pi70xe"),[()=>({loading:L()})],le),_e("click",r,function(O){et.call(this,e,O)}),_e("keydown",r,function(O){et.call(this,e,O)}),_e("keyup",r,function(O){et.call(this,e,O)}),_(a,r)}var Wa=T("<option> </option>"),ja=T('<optgroup label="Local Models" class="svelte-6bchvb"></optgroup>'),Ga=T("<option> </option>"),Ya=T("<option> </option>"),Xa=T("<option disabled> </option>"),qa=T("<span><!></span>"),Ja=T("<!> New Chat",1),Qa=T('<button type="button"><span class="chat-title svelte-6bchvb"> </span> <!></button>'),Za=T('<aside><div class="sidebar-header svelte-6bchvb"><div class="logo-container svelte-6bchvb"><img src="/logo.svg" alt="Gervais Logo" class="logo svelte-6bchvb"> <h2 class="svelte-6bchvb">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-6bchvb"><div class="model-selector svelte-6bchvb"><select class="select-styled svelte-6bchvb"><!><optgroup label="OpenAI Models" class="svelte-6bchvb"></optgroup><optgroup label="Google Models" class="svelte-6bchvb"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-6bchvb"></optgroup></select> <!></div> <!> <div class="chats-list svelte-6bchvb"></div></div></aside>');function es(a,e){var U;Ve(e,!1);const[n,d]=ft(),s=()=>Ne(Pt,"$activeChat",n),f=()=>Ne(pa,"$allModelsStore",n),l=()=>Ne(ua,"$localModelsStore",n),o=()=>Ne(Z,"$chatStore",n);let L=q(e,"isMobile",8,!1),v=q(e,"isExpanded",8,!0);const r=vt();let I=ne(((U=s())==null?void 0:U.model.id)||"claude-3-5-sonnet"),g=ne(!1);Ye(async()=>{h(g,!0),await yt(),h(g,!1)});async function m(){h(g,!0),await yt(),h(g,!1)}function $(){const u=f().find(b=>b.id===t(I));u&&Z.createNewChat(u)}function O(u){Z.selectChat(u),L()&&r("toggleSidebar",!1)}function c(u,b){b.stopPropagation(),Z.deleteChat(u)}function A(u){const b=u.target;if(h(I,b.value),s()){const y=f().find(N=>N.id===t(I));y&&Z.updateChatModel(s().id,y)}}Ge(()=>s(),()=>{s()&&h(I,s().model.id)}),ut(),Ue();var C=Za();let H;var w=p(C),S=k(p(w),2);{var J=u=>{const b=le(()=>v()?"Collapse sidebar":"Expand sidebar");xe(u,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return t(b)},$$events:{click:()=>r("toggleSidebar",!v())},children:(y,N)=>{La(y,{size:20})},$$slots:{default:!0}})};X(S,u=>{L()&&u(J)})}i(w);var F=k(w,2),K=p(F),j=p(K);ka(j,()=>t(I));var D,G=p(j);{var Q=u=>{var b=ja();Ie(b,5,l,Se,(y,N)=>{var x=Wa(),V={},te=p(x,!0);i(x),W(()=>{V!==(V=t(N).id)&&(x.value=(x.__value=t(N).id)==null?"":t(N).id),me(te,t(N).name)}),_(y,x)}),i(b),_(u,b)};X(G,u=>{l().length>0&&u(Q)})}var re=k(G);Ie(re,5,()=>da,Se,(u,b)=>{var y=Ga(),N={},x=p(y,!0);i(y),W(()=>{N!==(N=t(b).id)&&(y.value=(y.__value=t(b).id)==null?"":t(b).id),me(x,t(b).name)}),_(u,y)}),i(re);var ae=k(re);Ie(ae,5,()=>ca,Se,(u,b)=>{var y=Ya(),N={},x=p(y,!0);i(y),W(()=>{N!==(N=t(b).id)&&(y.value=(y.__value=t(b).id)==null?"":t(b).id),me(x,t(b).name)}),_(u,y)}),i(ae);var pe=k(ae);Ie(pe,5,()=>va,Se,(u,b)=>{var y=Xa(),N={},x=p(y,!0);i(y),W(()=>{N!==(N=t(b).id)&&(y.value=(y.__value=t(b).id)==null?"":t(b).id),me(x,t(b).name)}),_(u,y)}),i(pe),i(j);var se=k(j,2);xe(se,{variant:"icon",size:"sm",get disabled(){return t(g)},"aria-label":"Refresh models",$$events:{click:m},children:(u,b)=>{var y=qa();let N;var x=p(y);Ua(x,{size:16}),i(y),W(V=>N=Le(y,1,"svelte-6bchvb",null,N,V),[()=>({loading:t(g)})],le),_(u,y)},$$slots:{default:!0}}),i(K);var ee=k(K,2);xe(ee,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:$},children:(u,b)=>{var y=Ja(),N=de(y);Ra(N,{size:16}),Re(),_(u,y)},$$slots:{default:!0}});var P=k(ee,2);Ie(P,5,()=>o().chats,Se,(u,b)=>{var y=Qa();let N;var x=p(y),V=p(x,!0);i(x);var te=k(x,2);xe(te,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:ce=>c(t(b).id,ce)},children:(ce,E)=>{Lt(ce,{size:16})},$$slots:{default:!0}}),i(y),W(ce=>{N=Le(y,1,"chat-item svelte-6bchvb",null,N,ce),me(V,t(b).title||"New Chat")},[()=>{var ce;return{active:t(b).id===((ce=s())==null?void 0:ce.id)}}],le),_e("click",y,()=>O(t(b).id)),_(u,y)}),i(P),i(F),i(C),W(u=>{H=Le(C,1,"sidebar svelte-6bchvb",null,H,u),D!==(D=t(I))&&(j.value=(j.__value=t(I))==null?"":t(I),lt(j,t(I)))},[()=>({expanded:v()})],le),_e("change",j,A),_(a,C),Ke(),d()}var ts=T('<button type="button" class="media-preview-button svelte-6ysygh"><img class="media-preview svelte-6ysygh"></button>'),as=T('<audio controls class="media-preview svelte-6ysygh">Your browser does not support the audio element.</audio>'),ss=T('<video controls class="media-preview svelte-6ysygh"><track kind="captions" src="" label="English captions" class="svelte-6ysygh"> Your browser does not support the video element.</video>',2),os=T('<div class="file-size svelte-6ysygh"> </div>'),ns=T('<span class="document-status success svelte-6ysygh"> </span>'),ls=T('<span class="document-status info svelte-6ysygh">Document attached</span>'),rs=T('<span class="document-status success svelte-6ysygh">Document processed</span>'),is=T('<span class="document-status error svelte-6ysygh">Failed to process document</span>'),ds=T('<div class="document-file svelte-6ysygh" role="button" tabindex="0"><div class="file-icon svelte-6ysygh">ðŸ“„</div> <div class="file-info svelte-6ysygh"><div class="file-name svelte-6ysygh"> </div> <!> <div class="file-status svelte-6ysygh"><!></div></div></div>'),cs=T('<div class="media-container svelte-6ysygh"></div>'),vs=T('<div class="message-bubble svelte-6ysygh"><div class="content svelte-6ysygh"><p class="svelte-6ysygh"> </p></div> <!></div>'),us=T('<details class="thinking svelte-6ysygh"><summary class="svelte-6ysygh">Show thinking</summary> <div class="thinking-content svelte-6ysygh"><!></div></details>'),ps=T('<div class="typing-indicator svelte-6ysygh"><span class="svelte-6ysygh"></span> <span class="svelte-6ysygh"></span> <span class="svelte-6ysygh"></span></div>'),fs=T('<div class="content svelte-6ysygh"><!> <!> <!></div>'),gs=T('<div class="content system-message svelte-6ysygh"><!></div>'),hs=T('<div class="timestamp svelte-6ysygh"> </div>'),ms=T("<div><!> <!></div>");function _s(a,e){Ve(e,!1);const n=ne(),d=ne();let s=q(e,"message",8),f=q(e,"isStreaming",8,!1),l=q(e,"scrollToBottom",8,!1),o=ne();Ye(()=>{if(l()&&t(o)){const c=t(o).parentElement;c&&(c.scrollTop=c.scrollHeight)}});function L(c,A=2){if(c===0)return"0 Bytes";const C=1024,H=A<0?0:A,w=["Bytes","KB","MB","GB","TB"],S=Math.floor(Math.log(c)/Math.log(C));return parseFloat((c/Math.pow(C,S)).toFixed(H))+" "+w[S]}function v(c){window.open(c,"_blank")}Ge(()=>_t(s()),()=>{h(n,new Date(s().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Ge(()=>_t(s()),()=>{h(d,`message ${s().role}`)}),ut(),Ue();var r=ms(),I=p(r);{var g=c=>{var A=vs(),C=p(A),H=p(C),w=p(H,!0);i(H),i(C);var S=k(C,2);{var J=F=>{var K=cs();Ie(K,5,()=>s().media,Se,(j,D,G)=>{var Q=ge(),re=de(Q);{var ae=se=>{var ee=ts(),P=p(ee);ze(P,"alt",`Image ${G+1}`),i(ee),W(()=>ze(P,"src",t(D).preview)),_e("click",ee,()=>{t(D).preview&&v(t(D).preview)}),_e("keydown",ee,U=>{if(U.key==="Enter"||U.key===" "){if(U.preventDefault(),!t(D).preview)return;v(t(D).preview)}}),_(se,ee)},pe=(se,ee)=>{{var P=u=>{var b=as();W(()=>ze(b,"src",t(D).preview)),_(u,b)},U=(u,b)=>{{var y=x=>{var V=ss();W(()=>ze(V,"src",t(D).preview)),_(x,V)},N=(x,V)=>{{var te=ce=>{var E=ds(),z=k(p(E),2),oe=p(z),Y=p(oe,!0);i(oe);var ie=k(oe,2);{var B=R=>{var M=os(),ve=p(M,!0);i(M),W(Te=>me(ve,Te),[()=>L(t(D).size)],le),_(R,M)};X(ie,R=>{t(D).size&&R(B)})}var he=k(ie,2),Me=p(he);{var Oe=R=>{var M=ns(),ve=p(M);i(M),W(Te=>me(ve,`âœ“ Uploaded to OpenAI (ID: ${Te??""}...)`),[()=>t(D).fileId.substring(0,8)],le),_(R,M)},$e=(R,M)=>{{var ve=Ee=>{var je=ge(),Ot=de(je);{var Ht=He=>{var Xe=ls();_(He,Xe)},Dt=He=>{var Xe=rs();_(He,Xe)};X(Ot,He=>{s().role==="user"?He(Ht):He(Dt,!1)})}_(Ee,je)},Te=Ee=>{var je=is();_(Ee,je)};X(R,Ee=>{t(D).preview?Ee(ve):Ee(Te,!1)},M)}};X(Me,R=>{t(D).fileId?R(Oe):R($e,!1)})}i(he),i(z),i(E),W(()=>me(Y,t(D).name||"Document")),_(ce,E)};X(x,ce=>{t(D).type==="document"&&ce(te)},V)}};X(u,x=>{t(D).type==="video"?x(y):x(N,!1)},b)}};X(se,u=>{t(D).type==="audio"?u(P):u(U,!1)},ee)}};X(re,se=>{t(D).type==="image"?se(ae):se(pe,!1)})}_(j,Q)}),i(K),_(F,K)};X(S,F=>{s().media&&s().media.length>0&&F(J)})}i(A),W(()=>me(w,s().content)),_(c,A)},m=(c,A)=>{{var C=w=>{var S=fs(),J=p(S);Je(J,{get content(){return s().content},get scrollToBottom(){return l()}});var F=k(J,2);{var K=G=>{var Q=us(),re=k(p(Q),2),ae=p(re);Je(ae,{get content(){return s().thinking},scrollToBottom:!1}),i(re),i(Q),_(G,Q)};X(F,G=>{s().thinking&&G(K)})}var j=k(F,2);{var D=G=>{var Q=ps();_(G,Q)};X(j,G=>{f()&&G(D)})}i(S),_(w,S)},H=(w,S)=>{{var J=F=>{var K=gs(),j=p(K);Je(j,{get content(){return s().content},get scrollToBottom(){return l()}}),i(K),_(F,K)};X(w,F=>{s().role==="system"&&F(J)},S)}};X(c,w=>{s().role==="assistant"?w(C):w(H,!1)},A)}};X(I,c=>{s().role==="user"?c(g):c(m,!1)})}var $=k(I,2);{var O=c=>{var A=hs(),C=p(A,!0);i(A),W(()=>me(C,t(n))),_(c,A)};X($,c=>{s().role==="user"&&c(O)})}i(r),pt(r,c=>h(o,c),()=>t(o)),W(()=>Le(r,1,ia(t(d)),"svelte-6ysygh")),_(a,r),Ke()}var ys=T('<button type="button"> </button>'),$s=T('<img class="svelte-3d1bh">'),bs=T('<div class="file-preview svelte-3d1bh"><span> </span></div>'),ws=T('<div class="media-item svelte-3d1bh"><!> <button type="button" class="remove-media svelte-3d1bh" aria-label="Remove media">&times;</button></div>'),xs=T("<div><!></div>"),ks=T("<div><!></div>"),As=T('<div class="message-input-container svelte-3d1bh"><div class="tools-bar svelte-3d1bh"></div> <div class="media-preview svelte-3d1bh"></div> <div class="input-container svelte-3d1bh"><textarea rows="1" class="svelte-3d1bh"></textarea> <div class="actions svelte-3d1bh"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!></div></div></div>');function Ms(a,e){Ve(e,!1);let n=q(e,"value",12,""),d=q(e,"placeholder",8,"Send a message..."),s=q(e,"disabled",8,!1),f=q(e,"isRecording",8,!1),l=q(e,"isCapturingVideo",8,!1),o=q(e,"mediaItems",28,()=>[]),L=q(e,"tools",24,()=>({}));const v=vt();let r=ne();function I(){t(r)&&(be(r,t(r).style.height="auto"),be(r,t(r).style.height=`${Math.min(t(r).scrollHeight,200)}px`))}function g(){s()||!n().trim()&&o().length===0||(v("submit",{content:n().trim(),media:o(),tools:L()}),n(""),t(r)&&be(r,t(r).style.height="auto"))}function m(P){P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),g())}function $(){f()?v("stopAudioCapture"):v("startAudioCapture")}function O(){l()?v("stopVideoCapture"):v("startVideoCapture")}function c(P){const U=P.target;if(U.files&&U.files.length>0){const u=Array.from(U.files);v("uploadFile",u),U.value=""}}function A(P){const U=!L()[P];v("toggleTool",{tool:P,enabled:U})}Ge(()=>t(r),()=>{t(r)&&I()}),ut(),Ue();var C=As(),H=p(C);Ie(H,5,()=>Object.entries(L()),Se,(P,U)=>{let u=()=>t(U)[0],b=()=>t(U)[1];var y=ys();let N;var x=p(y,!0);i(y),W(V=>{N=Le(y,1,"tool-button svelte-3d1bh",null,N,V),ze(y,"aria-label",`Toggle ${u()??""}`),me(x,u())},[()=>({enabled:b()})],le),_e("click",y,()=>A(u())),_(P,y)}),i(H);var w=k(H,2);Ie(w,5,o,Se,(P,U)=>{var u=ws(),b=p(u);{var y=V=>{var te=$s();W(()=>{ze(te,"src",t(U).preview),ze(te,"alt",t(U).name)}),_(V,te)},N=V=>{var te=bs(),ce=p(te),E=p(ce,!0);i(ce),i(te),W(()=>me(E,t(U).name)),_(V,te)};X(b,V=>{t(U).type==="image"&&t(U).preview?V(y):V(N,!1)})}var x=k(b,2);i(u),_e("click",x,()=>{o(o().filter(V=>V.id!==t(U).id))}),_(P,u)}),i(w);var S=k(w,2),J=p(S);na(J),pt(J,P=>h(r,P),()=>t(r));var F=k(J,2),K=p(F),j=k(K,2);xe(j,{variant:"icon",size:"sm",get disabled(){return s()},"aria-label":"Upload file",$$events:{click:()=>{var P;return(P=document.getElementById("file-upload"))==null?void 0:P.click()}},children:(P,U)=>{Nt(P,{size:18})},$$slots:{default:!0}});var D=k(j,2);const G=le(()=>s()||l()),Q=le(()=>f()?"Stop recording":"Start recording");xe(D,{variant:"icon",size:"sm",get disabled(){return t(G)},get"aria-label"(){return t(Q)},$$events:{click:$},children:(P,U)=>{var u=xs();let b;var y=p(u);Da(y,{size:18}),i(u),W(N=>b=Le(u,1,"",null,b,N),[()=>({active:f()})],le),_(P,u)},$$slots:{default:!0}});var re=k(D,2);const ae=le(()=>s()||f()),pe=le(()=>l()?"Stop video capture":"Start video capture");xe(re,{variant:"icon",size:"sm",get disabled(){return t(ae)},get"aria-label"(){return t(pe)},$$events:{click:O},children:(P,U)=>{var u=ks();let b;var y=p(u);Na(y,{size:18}),i(u),W(N=>b=Le(u,1,"",null,b,N),[()=>({active:l()})],le),_(P,u)},$$slots:{default:!0}});var se=k(re,2);const ee=le(()=>s()||!n().trim()&&o().length===0);xe(se,{variant:"icon",size:"sm",get disabled(){return t(ee)},"aria-label":"Send message",$$events:{click:g},children:(P,U)=>{Va(P,{size:18})},$$slots:{default:!0}}),i(F),i(S),i(C),W(()=>{ze(J,"placeholder",d()),J.disabled=s()}),De(J,n),_e("keydown",J,m),_e("change",K,c),_(a,C),Ke()}var Ss=T('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Is=T('<span class="error-message svelte-8a76oy"> </span>'),Es=T('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Cs(a,e){Ve(e,!1);const[n,d]=ft(),s=()=>Ne(nt,"$settingsStore",n);let f=q(e,"isOpen",8,!1);const l=vt();let o=ne({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),L=ne(!1),v=ne(!1),r=ne("");Ye(()=>{console.log("Settings component mounted, current settingsStore value:",s());const c=s().apiKeys||{};console.log("Stored API keys from settings store:",c),h(o,{anthropic:c.anthropic||"",openai:c.openai||"",google:c.google||"",ollamaHost:c.ollamaHost||"http://localhost:11434",localHost:c.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",t(o))});function I(){l("close")}async function g(){var c;h(L,!0),h(v,!1),h(r,"");try{if(console.log("Saving API keys to settingsStore:",t(o)),t(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",t(o).openai),console.log(`OpenAI key before saving: length=${t(o).openai.length}, starts with=${t(o).openai.substring(0,4)}`);const A=[...t(o).openai.substring(0,10)].map(C=>C.charCodeAt(0));console.log(`First 10 character codes: ${A.join(", ")}`)}if(await nt.updateApiKeys({anthropic:t(o).anthropic,openai:t(o).openai,google:t(o).google,ollamaHost:t(o).ollamaHost||"http://localhost:11434",localHost:t(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",s()),(c=s().apiKeys)!=null&&c.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",s().apiKeys.openai),console.log(`OpenAI key after saving: length=${s().apiKeys.openai.length}, starts with=${s().apiKeys.openai.substring(0,4)}`);const A=[...s().apiKeys.openai.substring(0,10)].map(C=>C.charCodeAt(0));console.log(`First 10 character codes after saving: ${A.join(", ")}`)}h(v,!0),console.log("API keys saved successfully"),setTimeout(()=>{h(v,!1)},3e3)}catch(A){console.error("Failed to save API keys:",A),h(r,A instanceof Error?A.message:"Unknown error")}finally{h(L,!1)}}Ue();var m=ge(),$=de(m);{var O=c=>{var A=Es(),C=p(A),H=p(C),w=k(p(H),2);xe(w,{variant:"icon","aria-label":"Close settings",$$events:{click:I},children:(x,V)=>{Lt(x,{size:20})},$$slots:{default:!0}}),i(H);var S=k(H,2),J=p(S),F=k(p(J),4),K=p(F),j=k(p(K),2);Fe(j),i(K);var D=k(K,2),G=k(p(D),2);Fe(G),i(D);var Q=k(D,2),re=k(p(Q),2);Fe(re),i(Q);var ae=k(Q,2),pe=k(p(ae),2);Fe(pe),Re(2),i(ae);var se=k(ae,2),ee=k(p(se),2);Fe(ee),Re(2),i(se),i(F);var P=k(F,2),U=p(P);xe(U,{variant:"primary",get disabled(){return t(L)},$$events:{click:g},children:(x,V)=>{Re();var te=Vt();W(()=>me(te,t(L)?"Saving...":"Save API Keys")),_(x,te)},$$slots:{default:!0}});var u=k(U,2);{var b=x=>{var V=Ss();_(x,V)};X(u,x=>{t(v)&&x(b)})}var y=k(u,2);{var N=x=>{var V=Is(),te=p(V,!0);i(V),W(()=>me(te,t(r))),_(x,V)};X(y,x=>{t(r)&&x(N)})}i(P),i(J),i(S),i(C),i(A),De(j,()=>t(o).anthropic,x=>be(o,t(o).anthropic=x)),De(G,()=>t(o).openai,x=>be(o,t(o).openai=x)),De(re,()=>t(o).google,x=>be(o,t(o).google=x)),De(pe,()=>t(o).ollamaHost,x=>be(o,t(o).ollamaHost=x)),De(ee,()=>t(o).localHost,x=>be(o,t(o).localHost=x)),_e("click",A,Ma(I)),_e("keydown",A,x=>x.key==="Escape"&&I()),_(c,A)};X($,c=>{f()&&c(O)})}_(a,m),Ke(),d()}var Ps=T('<div class="sidebar-backdrop svelte-1jdnw89" role="button" tabindex="0" aria-label="Close sidebar"></div>'),zs=T('<div class="empty-state svelte-1jdnw89"><h2 class="svelte-1jdnw89">Start a new conversation</h2> <p class="svelte-1jdnw89">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1jdnw89"><div class="feature svelte-1jdnw89"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1jdnw89"><!> <span>Vision support for images</span></div></div></div>'),Ts=T('<div class="chat-container svelte-1jdnw89"><!> <!> <main class="chat-main svelte-1jdnw89"><header class="chat-header svelte-1jdnw89"><!> <h1 class="chat-title svelte-1jdnw89"> </h1> <!></header> <div class="chat-messages svelte-1jdnw89"><!></div> <div class="input-container svelte-1jdnw89"><!></div></main></div> <!>',1);function Ws(a,e){Ve(e,!1);const[n,d]=ft(),s=()=>Ne(Pt,"$activeChat",n),f=()=>Ne(nt,"$settingsStore",n);let l=ne(!1),o=ne(!0),L=ne(""),v=ne(!1),r=ne(!1),I=ne([]),g=ne({search:!1}),m=ne(),$=ne(!1);function O(){h(l,window.innerWidth<768),t(l)?h(o,!1):h(o,!0)}Ye(()=>(O(),window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O)}));function c(){h(o,!t(o))}async function A({detail:E}){var he,Me,Oe;if(!s())return;const z=s().model.provider;if(console.log("Current settings store state:",f()),z==="openai"&&!((he=f().apiKeys)!=null&&he.openai)){console.warn("OpenAI API key not set, opening settings dialog"),h($,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(z==="anthropic"&&!((Me=f().apiKeys)!=null&&Me.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),h($,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(z==="google"&&!((Oe=f().apiKeys)!=null&&Oe.google)){console.warn("Google API key not set, opening settings dialog"),h($,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:oe,media:Y,tools:ie}=E;console.log("Media items in submission:",Y),await Z.addMessage(s().id,{role:"user",content:oe,media:Y}),h(L,""),h(I,[]),setTimeout(()=>{t(m)&&be(m,t(m).scrollTop=t(m).scrollHeight)},100);const B=await Z.addMessage(s().id,{role:"assistant",content:""});h(v,!0),h(r,!0);try{const $e=s().messages.slice(0,-1);console.log("Sending messages to LLM with media:",$e);const R=s().model.id;if(z==="anthropic")await ga(R,$e,M=>{Z.updateMessage(s().id,B,{content:M})},()=>{h(v,!1),h(r,!1),setTimeout(()=>{t(m)&&be(m,t(m).scrollTop=t(m).scrollHeight)},100)},M=>{console.error("Error generating response:",M),Z.updateMessage(s().id,B,{content:`Error generating response: â€“ ${M.message}`}),h(v,!1),h(r,!1)},M=>{Z.updateMessage(s().id,B,{thinking:M})});else if(z==="openai")if(t(r))await ha(R,$e,M=>{Z.updateMessage(s().id,B,{content:M})},()=>{h(v,!1),h(r,!1),setTimeout(()=>{t(m)&&be(m,t(m).scrollTop=t(m).scrollHeight)},100)},M=>{console.error("Error generating response from OpenAI:",M);const ve=M.message||"An unknown error occurred";Z.updateMessage(s().id,B,{content:`Error: ${ve}`}),h(v,!1),h(r,!1)});else try{const M=await ma(R,$e);Z.updateMessage(s().id,B,{content:M}),h(v,!1)}catch(M){console.error("Error generating non-streaming response from OpenAI:",M);const ve=M.message||"An unknown error occurred";throw Z.updateMessage(s().id,B,{content:`Error: ${ve}`}),h(v,!1),M}else if(z==="google")await _a(R,$e,M=>{Z.updateMessage(s().id,B,{content:M})},()=>{h(v,!1),h(r,!1),setTimeout(()=>{t(m)&&be(m,t(m).scrollTop=t(m).scrollHeight)},100)},M=>{console.error("Error generating response from Google:",M);const ve=M.message||"An unknown error occurred";Z.updateMessage(s().id,B,{content:`Error: ${ve}`}),h(v,!1),h(r,!1)},M=>{Z.updateMessage(s().id,B,{thinking:M})});else if(z==="ollama")try{await ya(R,$e,M=>{Z.updateMessage(s().id,B,{content:M})},()=>{h(v,!1),h(r,!1),setTimeout(()=>{t(m)&&be(m,t(m).scrollTop=t(m).scrollHeight)},100)},M=>{console.error("Error generating response from Ollama:",M);const ve=M.message||"An unknown error occurred";Z.updateMessage(s().id,B,{content:`Error connecting to Ollama: ${ve}. Make sure Ollama is running locally.`}),h(v,!1),h(r,!1)})}catch(M){throw console.error("Error generating response from Ollama:",M),M}else{let M="";const ve="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Te of ve)await new Promise(Ee=>setTimeout(Ee,50)),M+=Te+" ",Z.updateMessage(s().id,B,{content:M.trim()});h(v,!1),h(r,!1)}}catch($e){if(console.error("Error generating response:",$e),t(v)){const R=$e.message||"An unknown error occurred";Z.updateMessage(s().id,B,{content:`Error: ${R}`}),h(v,!1),h(r,!1)}}}function C(E){E.forEach(async z=>{const oe=Pa(),Y=z.name,ie=z.size;let B="other",he,Me;console.log(`Processing file: ${Y}, type: ${z.type}, size: ${ie} bytes`);const Oe=R=>{var M;if(R.type.includes("pdf")||R.type.includes("word")||R.type.includes("excel")||R.type.includes("spreadsheet")||R.type.includes("presentation")||R.type.includes("officedocument")||R.type.includes("application/rtf")||R.type.includes("text/rtf"))return!0;if(!R.type||R.type==="application/octet-stream"){const ve=(M=Y.split(".").pop())==null?void 0:M.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ve||"")}return!1};if(z.type.startsWith("image/")){B="image";try{he=await H(z),console.log(`Created data URL for image ${Y} (length: ${he.length} chars)`)}catch(R){console.error(`Failed to create data URL for ${Y}:`,R)}}else if(z.type.startsWith("audio/"))B="audio";else if(z.type.startsWith("video/"))B="video";else if(z.type.startsWith("text/"))B="text";else if(Oe(z)){if(B="document",s()&&s().model.provider==="openai")try{Me=await fa(z),console.log(`Document ${Y} uploaded to OpenAI with ID: ${Me}`)}catch(R){console.error(`Failed to upload document to OpenAI: ${R.message}`),alert(`Failed to upload document to OpenAI: ${R.message}`)}try{he=await H(z),console.log(`Created data URL for document ${Y}, mime type: ${z.type}`),console.log(`Document data URL length: ${he.length} chars`),ie>5*1024*1024&&console.warn(`Warning: Large document (${(ie/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(R){console.error(`Failed to create data URL for ${Y}:`,R)}}const $e={id:oe,type:B,name:Y,preview:he,size:ie,timestamp:Date.now(),fileId:Me};console.log(`Adding media item: ${B} ${Y}`),h(I,[...t(I),$e])})}async function H(E){return new Promise((z,oe)=>{const Y=new FileReader;Y.onload=()=>{const ie=Y.result;z(ie)},Y.onerror=ie=>{console.error("Error reading file:",ie),oe(ie)},Y.readAsDataURL(E)})}function w({detail:E}){const{tool:z,enabled:oe}=E;h(g,{...t(g),[z]:oe})}function S(){console.log("Start audio capture")}function J(){console.log("Stop audio capture")}function F(){console.log("Start video capture")}function K(){console.log("Stop video capture")}Ue();var j=Ts(),D=de(j),G=p(D);es(G,{get isMobile(){return t(l)},get isExpanded(){return t(o)},$$events:{toggleSidebar:({detail:E})=>h(o,E)}});var Q=k(G,2);{var re=E=>{var z=Ps();_e("click",z,()=>h(o,!1)),_e("keydown",z,oe=>oe.key==="Escape"&&h(o,!1)),_(E,z)};X(Q,E=>{t(l)&&t(o)&&E(re)})}var ae=k(Q,2),pe=p(ae),se=p(pe);{var ee=E=>{xe(E,{variant:"icon","aria-label":"Open menu",$$events:{click:c},children:(z,oe)=>{Ha(z,{size:20})},$$slots:{default:!0}})};X(se,E=>{t(l)&&E(ee)})}var P=k(se,2),U=p(P,!0);i(P);var u=k(P,2);xe(u,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>h($,!0)},children:(E,z)=>{Ka(E,{size:20})},$$slots:{default:!0}}),i(pe);var b=k(pe,2),y=p(b);{var N=E=>{var z=ge(),oe=de(z);Ie(oe,1,()=>s().messages,Se,(Y,ie,B)=>{const he=le(()=>t(r)&&B===s().messages.length-1&&t(ie).role==="assistant"),Me=le(()=>B===s().messages.length-1);_s(Y,{get message(){return t(ie)},get isStreaming(){return t(he)},get scrollToBottom(){return t(Me)}})}),_(E,z)},x=E=>{var z=zs(),oe=k(p(z),4),Y=p(oe),ie=p(Y);Nt(ie,{size:16}),Re(2),i(Y);var B=k(Y,2),he=p(B);Oa(he,{size:16}),Re(2),i(B),i(oe),i(z),_(E,z)};X(y,E=>{s()&&s().messages.length>0?E(N):E(x,!1)})}i(b),pt(b,E=>h(m,E),()=>t(m));var V=k(b,2),te=p(V);Ms(te,{get tools(){return t(g)},get disabled(){return t(v)},placeholder:"Send a message...",get value(){return t(L)},set value(E){h(L,E)},get mediaItems(){return t(I)},set mediaItems(E){h(I,E)},$$events:{submit:A,uploadFile:E=>C(E.detail),toggleTool:w,startAudioCapture:S,stopAudioCapture:J,startVideoCapture:F,stopVideoCapture:K},$$legacy:!0}),i(V),i(ae),i(D);var ce=k(D,2);Cs(ce,{get isOpen(){return t($)},$$events:{close:()=>h($,!1)}}),W(()=>{var E;return me(U,((E=s())==null?void 0:E.title)||"New Chat")}),_(a,j),Ke(),d()}export{Ws as component};
