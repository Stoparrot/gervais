import{a as Ut,n as Yt,b as v,c as fe,t as S,d as Xt}from"../chunks/D4Wg7acP.js";import{i as Ke}from"../chunks/BCt6nKvl.js";import{v as St,b as It,s as We,h as ge,j as Et,a as nt,G as e,aa as pe,c as Jt,r as $t,d as Ue,g as je,m as Qt,e as pt,f as ft,p as zt,aD as st,t as Ct,a7 as Zt,y as ct,aE as mt,aF as wt,aG as gt,B as ea,$ as kt,aH as Pt,a4 as qt,aI as ta,aJ as aa,q as sa,aK as oa,aL as jt,aM as ra,k as la,E as ia,aN as na,aO as ca,N as Tt,a6 as va,a5 as da,w as Ge,V as c,X as k,T as U,z as Re,W as l,S as de,aP as ht,aQ as ne,al as Ye,aR as Qe,aS as _t,D as f,aT as Le,P as xt,aU as ke}from"../chunks/DGTWKBkE.js";import{s as he}from"../chunks/DyljIpSQ.js";import{i as V}from"../chunks/B6fIxP21.js";import{l as ua,m as pa,o as oe,p as fa}from"../chunks/Cjkrtwq3.js";import{i as ma,l as $e,p as ae,s as ze,b as bt}from"../chunks/xph6iKvr.js";import{a as Te,s as yt}from"../chunks/CDswycLH.js";import{s as Me,b as vt,C as ga,d as Ne,a as ye,e as Nt,c as ie,f as ha,r as Je}from"../chunks/iQgvPtfK.js";import{i as _a,o as ba,g as ya,b as $a,l as wa,c as ka,s as dt,v as xa,u as Ma,e as Aa,f as Sa,h as Ia,j as Ea,k as za}from"../chunks/BiknwHPp.js";import{M as ot}from"../chunks/9wSKcIDJ.js";function Se(s,t){return t}function Ca(s,t,o,_){for(var a=[],m=t.length,i=0;i<m;i++)aa(t[i].e,a,!0);var r=m>0&&a.length===0&&o!==null;if(r){var N=o.parentNode;sa(N),N.append(o),_.clear(),qe(s,t[0].prev,t[m-1].next)}oa(a,()=>{for(var d=0;d<m;d++){var n=t[d];r||(_.delete(n.k),qe(s,n.prev,n.next)),jt(n.e,!r)}})}function Ie(s,t,o,_,a,m=null){var i=s,r={flags:t,items:new Map,first:null},N=(t&Pt)!==0;if(N){var d=s;i=ge?We(Et(d)):d.appendChild(St())}ge&&nt();var n=null,C=!1,g=pe(()=>{var p=o();return qt(p)?p:p==null?[]:Ct(p)});It(()=>{var p=e(g),h=p.length;if(C&&h===0)return;C=h===0;let j=!1;if(ge){var I=i.data===Jt;I!==(h===0)&&(i=$t(),We(i),Ue(!1),j=!0)}if(ge){for(var K=null,Z,B=0;B<h;B++){if(je.nodeType===8&&je.data===Qt){i=je,j=!0,Ue(!1);break}var q=p[B],D=_(q,B);Z=Lt(je,r,K,null,q,D,B,a,t,o),r.items.set(D,Z),K=Z}h>0&&We($t())}ge||Pa(p,r,i,a,t,_,o),m!==null&&(h===0?n?pt(n):n=ft(()=>m(i)):n!==null&&zt(n,()=>{n=null})),j&&Ue(!0),e(g)}),ge&&(i=je)}function Pa(s,t,o,_,a,m,i){var ee,se,le,W;var r=(a&ta)!==0,N=(a&(mt|gt))!==0,d=s.length,n=t.items,C=t.first,g=C,p,h=null,j,I=[],K=[],Z,B,q,D;if(r)for(D=0;D<d;D+=1)Z=s[D],B=m(Z,D),q=n.get(B),q!==void 0&&((ee=q.a)==null||ee.measure(),(j??(j=new Set)).add(q));for(D=0;D<d;D+=1){if(Z=s[D],B=m(Z,D),q=n.get(B),q===void 0){var _e=g?g.e.nodes_start:o;h=Lt(_e,t,h,h===null?t.first:h.next,Z,B,D,_,a,i),n.set(B,h),I=[],K=[],g=h.next;continue}if(N&&qa(q,Z,D,a),(q.e.f&st)!==0&&(pt(q.e),r&&((se=q.a)==null||se.unfix(),(j??(j=new Set)).delete(q))),q!==g){if(p!==void 0&&p.has(q)){if(I.length<K.length){var E=K[0],z;h=E.prev;var R=I[0],J=I[I.length-1];for(z=0;z<I.length;z+=1)Mt(I[z],E,o);for(z=0;z<K.length;z+=1)p.delete(K[z]);qe(t,R.prev,J.next),qe(t,h,R),qe(t,J,E),g=E,h=J,D-=1,I=[],K=[]}else p.delete(q),Mt(q,g,o),qe(t,q.prev,q.next),qe(t,q,h===null?t.first:h.next),qe(t,h,q),h=q;continue}for(I=[],K=[];g!==null&&g.k!==B;)(g.e.f&st)===0&&(p??(p=new Set)).add(g),K.push(g),g=g.next;if(g===null)continue;q=g}I.push(q),h=q,g=q.next}if(g!==null||p!==void 0){for(var F=p===void 0?[]:Ct(p);g!==null;)(g.e.f&st)===0&&F.push(g),g=g.next;var X=F.length;if(X>0){var re=(a&Pt)!==0&&d===0?o:null;if(r){for(D=0;D<X;D+=1)(le=F[D].a)==null||le.measure();for(D=0;D<X;D+=1)(W=F[D].a)==null||W.fix()}Ca(t,F,re,n)}}r&&Zt(()=>{var ce;if(j!==void 0)for(q of j)(ce=q.a)==null||ce.apply()}),ct.first=t.first&&t.first.e,ct.last=h&&h.e}function qa(s,t,o,_){(_&mt)!==0&&wt(s.v,t),(_&gt)!==0?wt(s.i,o):s.i=o}function Lt(s,t,o,_,a,m,i,r,N,d){var n=(N&mt)!==0,C=(N&ra)===0,g=n?C?ea(a):kt(a):a,p=(N&gt)===0?i:kt(i),h={i:p,v:g,k:m,a:null,e:null,prev:o,next:_};try{return h.e=ft(()=>r(s,g,p,d),ge),h.e.prev=o&&o.e,h.e.next=_&&_.e,o===null?t.first=h:(o.next=h,o.e.next=h.e),_!==null&&(_.prev=h,_.e.prev=h.e),h}finally{}}function Mt(s,t,o){for(var _=s.next?s.next.e.nodes_start:o,a=t?t.e.nodes_start:o,m=s.e.nodes_start;m!==_;){var i=la(m);a.before(m),m=i}}function qe(s,t,o){t===null?s.first=o:(t.next=o,t.e.next=o&&o.e),o!==null&&(o.prev=t,o.e.prev=t&&t.e)}function ja(s,t,o,_,a,m){let i=ge;ge&&nt();var r,N,d=null;ge&&je.nodeType===1&&(d=je,nt());var n=ge?je:s,C;It(()=>{const g=t()||null;var p=na;g!==r&&(C&&(g===null?zt(C,()=>{C=null,N=null}):g===N?pt(C):jt(C)),g&&g!==N&&(C=ft(()=>{if(d=ge?d:document.createElementNS(p,g),Ut(d,d),_){ge&&ua(g)&&d.append(document.createComment(""));var h=ge?Et(d):d.appendChild(St());ge&&(h===null?Ue(!1):We(h)),_(d,h)}ct.nodes_end=d,n.before(d)})),r=g,r&&(N=r))},ia),i&&(Ue(!0),We(n))}function Fe(s,t,o=t){var _=ca();pa(s,"input",a=>{var m=a?s.defaultValue:s.value;if(m=rt(s)?lt(m):m,o(m),_&&m!==(m=t())){var i=s.selectionStart,r=s.selectionEnd;s.value=m??"",r!==null&&(s.selectionStart=i,s.selectionEnd=Math.min(r,s.value.length))}}),(ge&&s.defaultValue!==s.value||Tt(t)==null&&s.value)&&o(rt(s)?lt(s.value):s.value),va(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,o){if(s.multiple)return Na(s,t);for(var _ of s.options){var a=Ot(_);if(ma(a,t)){_.selected=!0;return}}(!o||t!==void 0)&&(s.selectedIndex=-1)}function Ta(s,t){let o=!0;da(()=>{t&&ut(s,Tt(t),o),o=!1;var _=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return _.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{_.disconnect()}})}function Na(s,t){for(var o of s.options)o.selected=~t.indexOf(Ot(o))}function Ot(s){return"__value"in s?s.__value:s.value}function La(s){return function(...t){var o=t[0];o.target===this&&(s==null||s.apply(this,t))}}function At(s){return function(...t){var o=t[0];return o.stopPropagation(),s==null?void 0:s.apply(this,t)}}function it(s,t){var m;var o=(m=s.$$events)==null?void 0:m[t.type],_=qt(o)?o.slice():o==null?[]:[o];for(var a of _)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Da=Yt("<svg><!><!></svg>");function Ce(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]),_=$e(o,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ge(t,!1);let a=ae(t,"name",8,void 0),m=ae(t,"color",8,"currentColor"),i=ae(t,"size",8,24),r=ae(t,"strokeWidth",8,2),N=ae(t,"absoluteStrokeWidth",8,!1),d=ae(t,"iconNode",24,()=>[]);const n=(...j)=>j.filter((I,K,Z)=>!!I&&Z.indexOf(I)===K).join(" ");Ke();var C=Da();let g;var p=c(C);Ie(p,1,d,Se,(j,I)=>{let K=()=>e(I)[0],Z=()=>e(I)[1];var B=fe(),q=de(B);ja(q,K,!0,(D,_e)=>{let E;U(()=>E=vt(D,E,{...Z()}))}),v(j,B)});var h=k(p);Me(h,t,"default",{}),l(C),U((j,I)=>g=vt(C,g,{...Oa,..._,width:i(),height:i(),stroke:m(),"stroke-width":j,class:I}),[()=>N()?Number(r())*24/Number(i()):r(),()=>n("lucide-icon","lucide",a()?`lucide-${a()}`:"",o.class)],pe),v(s,C),Re()}function Ha(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"chevron-left"},()=>o,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ka(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"circle-arrow-up"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m16 12-4-4-4 4"}],["path",{d:"M12 16V8"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ga(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"globe"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ra(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"image"},()=>o,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Va(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"mic"},()=>o,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Dt(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"notebook-pen"},()=>o,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ht(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"paperclip"},()=>o,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ba(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"settings"},()=>o,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Fa(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"video"},()=>o,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Kt(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"x"},()=>o,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,m)=>{var i=fe(),r=de(i);Me(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}var Wa=S('<div class="spinner svelte-1pi70xe"></div>'),Ua=S("<button><!> <!></button>");function xe(s,t){const o=$e(t,["children","$$slots","$$events","$$legacy"]),_=$e(o,["type","variant","size","disabled","loading","fullWidth"]);let a=ae(t,"type",8,"button"),m=ae(t,"variant",8,"primary"),i=ae(t,"size",8,"md"),r=ae(t,"disabled",8,!1),N=ae(t,"loading",8,!1),d=ae(t,"fullWidth",8,!1);var n=Ua();let C;var g=c(n);{var p=j=>{var I=Wa();v(j,I)};V(g,j=>{N()&&j(p)})}var h=k(g,2);Me(h,t,"default",{}),l(n),U(j=>C=vt(n,C,{type:a(),class:`button ${m()??""} ${i()??""} ${(d()?"full-width":"")??""}`,disabled:r(),..._,[ga]:j},"svelte-1pi70xe"),[()=>({loading:N()})],pe),oe("click",n,function(j){it.call(this,t,j)}),oe("keydown",n,function(j){it.call(this,t,j)}),oe("keyup",n,function(j){it.call(this,t,j)}),v(s,n)}var Ya=S('<option class="svelte-1m60q0l"> </option>'),Xa=S('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Ja=S('<option class="svelte-1m60q0l"> </option>'),Qa=S('<option class="svelte-1m60q0l"> </option>'),Za=S('<option disabled class="svelte-1m60q0l"> </option>'),es=S('<!> <span class="svelte-1m60q0l">New Chat</span>',1),ts=S('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),as=S('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function ss(s,t){var ce;Ge(t,!1);const[o,_]=yt(),a=()=>Te(Nt,"$activeChat",o),m=()=>Te(ka,"$allModelsStore",o),i=()=>Te(wa,"$localModelsStore",o),r=()=>Te(ie,"$chatStore",o);let N=ae(t,"isMobile",8,!1),d=ae(t,"isExpanded",8,!0);const n=ht();let C=ne(((ce=a())==null?void 0:ce.model.id)||"claude-3-5-sonnet");Ye(async()=>{await _a()});function g(){const H=m().find(w=>w.id===e(C));H&&ie.createNewChat(H)}function p(H){ie.selectChat(H),N()&&n("toggleSidebar",!1)}function h(H,w){w.stopPropagation(),ie.deleteChat(H)}function j(H){const w=H.target;if(f(C,w.value),a()){const y=m().find($=>$.id===e(C));y&&ie.updateChatModel(a().id,y)}}Qe(()=>a(),()=>{a()&&f(C,a().model.id)}),_t(),Ke();var I=as();let K;var Z=c(I),B=c(Z),q=c(B);Le(2),l(B);var D=k(B,2);{var _e=H=>{const w=pe(()=>d()?"Collapse sidebar":"Expand sidebar");xe(H,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(w)},$$events:{click:()=>n("toggleSidebar",!d())},children:(y,$)=>{Ha(y,{size:20})},$$slots:{default:!0}})};V(D,H=>{N()&&H(_e)})}l(Z);var E=k(Z,2),z=c(E),R=c(z);Ta(R,()=>e(C));var J,F=c(R);{var X=H=>{var w=Xa();Ie(w,5,i,Se,(y,$)=>{var A=Ya(),x={},G=c(A,!0);l(A),U(()=>{x!==(x=e($).id)&&(A.value=(A.__value=e($).id)==null?"":e($).id),he(G,e($).name)}),v(y,A)}),l(w),v(H,w)};V(F,H=>{i().length>0&&H(X)})}var re=k(F);Ie(re,5,()=>ba,Se,(H,w)=>{var y=Ja(),$={},A=c(y,!0);l(y),U(()=>{$!==($=e(w).id)&&(y.value=(y.__value=e(w).id)==null?"":e(w).id),he(A,e(w).name)}),v(H,y)}),l(re);var ee=k(re);Ie(ee,5,()=>ya,Se,(H,w)=>{var y=Qa(),$={},A=c(y,!0);l(y),U(()=>{$!==($=e(w).id)&&(y.value=(y.__value=e(w).id)==null?"":e(w).id),he(A,e(w).name)}),v(H,y)}),l(ee);var se=k(ee);Ie(se,5,()=>$a,Se,(H,w)=>{var y=Za(),$={},A=c(y,!0);l(y),U(()=>{$!==($=e(w).id)&&(y.value=(y.__value=e(w).id)==null?"":e(w).id),he(A,e(w).name)}),v(H,y)}),l(se),l(R),l(z);var le=k(z,2);xe(le,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:g},children:(H,w)=>{var y=es(),$=de(y);Dt($,{size:16}),Le(2),v(H,y)},$$slots:{default:!0}});var W=k(le,2);Ie(W,5,()=>r().chats,Se,(H,w)=>{var y=ts();let $;var A=c(y),x=c(A,!0);l(A);var G=k(A,2);xe(G,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:P=>h(e(w).id,P)},children:(P,te)=>{Kt(P,{size:16})},$$slots:{default:!0}}),l(y),U(P=>{$=Ne(y,1,"chat-item svelte-1m60q0l",null,$,P),he(x,e(w).title||"New Chat")},[()=>{var P;return{active:e(w).id===((P=a())==null?void 0:P.id)}}],pe),oe("click",y,()=>p(e(w).id)),v(H,y)}),l(W),l(E),l(I),U(H=>{K=Ne(I,1,"sidebar svelte-1m60q0l",null,K,H),ye(q,"src","/gervais/logo.svg"),J!==(J=e(C))&&(R.value=(R.__value=e(C))==null?"":e(C),ut(R,e(C)))},[()=>({expanded:d()})],pe),oe("change",R,j),v(s,I),Re(),_()}var os=S('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),rs=S('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),ls=S('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),is=S('<div class="file-size svelte-1mjurqb"> </div>'),ns=S('<span class="document-status success svelte-1mjurqb"> </span>'),cs=S('<span class="document-status info svelte-1mjurqb">Document attached</span>'),vs=S('<span class="document-status success svelte-1mjurqb">Document processed</span>'),ds=S('<span class="document-status info svelte-1mjurqb">Document</span>'),us=S('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),ps=S('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">ðŸ“„</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),fs=S('<div class="media-container svelte-1mjurqb"></div>'),ms=S('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),gs=S('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),hs=S('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),_s=S('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),bs=S('<div class="media-container assistant-media svelte-1mjurqb"></div>'),ys=S('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),$s=S('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ws=S('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ks=S('<div class="content system-message svelte-1mjurqb"><!></div>'),xs=S('<div class="timestamp svelte-1mjurqb"> </div>'),Ms=S('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">Ã—</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),As=S("<div><!> <!></div> <!>",1);function Ss(s,t){Ge(t,!1);const o=ne(),_=ne();let a=ae(t,"message",8),m=ae(t,"isStreaming",8,!1),i=ae(t,"scrollToBottom",8,!1),r=ne(!1),N=ne(""),d=ne(""),n=ne();Ye(()=>{if(i()&&e(n)){const E=e(n).parentElement;E&&(E.scrollTop=E.scrollHeight)}});function C(E,z=2){if(E===0)return"0 Bytes";const R=1024,J=z<0?0:z,F=["Bytes","KB","MB","GB","TB"],X=Math.floor(Math.log(E)/Math.log(R));return parseFloat((E/Math.pow(R,X)).toFixed(J))+" "+F[X]}function g(E,z="Preview image"){f(N,E),f(d,z),f(r,!0)}function p(){f(r,!1)}Qe(()=>xt(a()),()=>{f(o,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Qe(()=>xt(a()),()=>{f(_,`message ${a().role}`)}),_t(),Ke();var h=As(),j=de(h),I=c(j);{var K=E=>{var z=ms(),R=c(z),J=c(R),F=c(J,!0);l(J),l(R);var X=k(R,2);{var re=ee=>{var se=fs();Ie(se,5,()=>a().media,Se,(le,W,ce)=>{var H=fe(),w=de(H);{var y=A=>{var x=os(),G=c(x);ye(G,"alt",`Image ${ce+1}`),l(x),U(()=>ye(G,"src",e(W).preview)),oe("click",x,()=>{e(W).preview&&g(e(W).preview,`Image ${ce+1}`)}),oe("keydown",x,P=>{if(P.key==="Enter"||P.key===" "){if(P.preventDefault(),!e(W).preview)return;g(e(W).preview,`Image ${ce+1}`)}}),v(A,x)},$=(A,x)=>{{var G=te=>{var ue=rs();U(()=>ye(ue,"src",e(W).preview)),v(te,ue)},P=(te,ue)=>{{var u=T=>{var M=ls();U(()=>ye(M,"src",e(W).preview)),v(T,M)},b=(T,M)=>{{var Y=L=>{var ve=ps(),be=k(c(ve),2),Ae=c(be),we=c(Ae,!0);l(Ae);var Q=k(Ae,2);{var O=Ee=>{var Pe=is(),Ve=c(Pe,!0);l(Pe),U(Be=>he(Ve,Be),[()=>C(e(W).size)],pe),v(Ee,Pe)};V(Q,Ee=>{e(W).size&&Ee(O)})}var me=k(Q,2),Ze=c(me);{var et=Ee=>{var Pe=ns(),Ve=c(Pe);l(Pe),U(Be=>he(Ve,`âœ“ Uploaded to OpenAI (ID: ${Be??""}...)`),[()=>e(W).fileId.substring(0,8)],pe),v(Ee,Pe)},Gt=(Ee,Pe)=>{{var Ve=Oe=>{var Xe=fe(),Rt=de(Xe);{var Vt=De=>{var tt=cs();v(De,tt)},Bt=(De,tt)=>{{var Ft=He=>{var at=vs();v(He,at)},Wt=He=>{var at=ds();v(He,at)};V(De,He=>{a().role==="assistant"?He(Ft):He(Wt,!1)},tt)}};V(Rt,De=>{a().role==="user"?De(Vt):De(Bt,!1)})}v(Oe,Xe)},Be=Oe=>{var Xe=us();v(Oe,Xe)};V(Ee,Oe=>{e(W).preview?Oe(Ve):Oe(Be,!1)},Pe)}};V(Ze,Ee=>{e(W).fileId?Ee(et):Ee(Gt,!1)})}l(me),l(be),l(ve),U(()=>he(we,e(W).name||"Document")),v(L,ve)};V(T,L=>{e(W).type==="document"&&L(Y)},M)}};V(te,T=>{e(W).type==="video"?T(u):T(b,!1)},ue)}};V(A,te=>{e(W).type==="audio"?te(G):te(P,!1)},x)}};V(w,A=>{e(W).type==="image"?A(y):A($,!1)})}v(le,H)}),l(se),v(ee,se)};V(X,ee=>{a().media&&a().media.length>0&&ee(re)})}l(z),U(()=>he(F,a().content)),v(E,z)},Z=(E,z)=>{{var R=F=>{var X=ws(),re=c(X);ot(re,{get content(){return a().content},get scrollToBottom(){return i()}});var ee=k(re,2);{var se=w=>{var y=bs();Ie(y,5,()=>a().media,Se,($,A,x)=>{var G=fe(),P=de(G);{var te=u=>{var b=gs(),T=c(b);ye(T,"alt",`Generated image ${x+1}`),Le(2),l(b),U(()=>ye(T,"src",e(A).preview)),oe("click",b,()=>{e(A).preview&&g(e(A).preview,`Generated image ${x+1}`)}),oe("keydown",b,M=>{if(M.key==="Enter"||M.key===" "){if(M.preventDefault(),!e(A).preview)return;g(e(A).preview,`Generated image ${x+1}`)}}),v(u,b)},ue=(u,b)=>{{var T=Y=>{var L=hs();U(()=>ye(L,"src",e(A).preview)),v(Y,L)},M=(Y,L)=>{{var ve=be=>{var Ae=_s();U(()=>ye(Ae,"src",e(A).preview)),v(be,Ae)};V(Y,be=>{e(A).type==="video"&&be(ve)},L)}};V(u,Y=>{e(A).type==="audio"?Y(T):Y(M,!1)},b)}};V(P,u=>{e(A).type==="image"?u(te):u(ue,!1)})}v($,G)}),l(y),v(w,y)};V(ee,w=>{a().media&&a().media.length>0&&w(se)})}var le=k(ee,2);{var W=w=>{var y=ys(),$=k(c(y),2),A=c($);ot(A,{get content(){return a().thinking},scrollToBottom:!1}),l($),l(y),v(w,y)};V(le,w=>{a().thinking&&w(W)})}var ce=k(le,2);{var H=w=>{var y=$s();v(w,y)};V(ce,w=>{m()&&w(H)})}l(X),v(F,X)},J=(F,X)=>{{var re=ee=>{var se=ks(),le=c(se);ot(le,{get content(){return a().content},get scrollToBottom(){return i()}}),l(se),v(ee,se)};V(F,ee=>{a().role==="system"&&ee(re)},X)}};V(E,F=>{a().role==="assistant"?F(R):F(J,!1)},z)}};V(I,E=>{a().role==="user"?E(K):E(Z,!1)})}var B=k(I,2);{var q=E=>{var z=xs(),R=c(z,!0);l(z),U(()=>he(R,e(o))),v(E,z)};V(B,E=>{a().role==="user"&&E(q)})}l(j),bt(j,E=>f(n,E),()=>e(n));var D=k(j,2);{var _e=E=>{var z=Ms(),R=c(z),J=c(R),F=k(J,2),X=k(F,2),re=c(X,!0);l(X),l(R),l(z),U(()=>{ye(F,"src",e(N)),ye(F,"alt",e(d)),he(re,e(d))}),oe("click",J,p),oe("click",R,At(()=>{})),oe("keydown",R,At(()=>{})),oe("click",z,p),oe("keydown",z,ee=>ee.key==="Escape"&&p()),v(E,z)};V(D,E=>{e(r)&&E(_e)})}U(()=>Ne(j,1,ha(e(_)),"svelte-1mjurqb")),v(s,h),Re()}var Is=S('<img class="svelte-ij5ual">'),Es=S('<div class="file-preview svelte-ij5ual"><span class="svelte-ij5ual"> </span></div>'),zs=S('<div class="media-item svelte-ij5ual"><!> <button type="button" class="remove-media svelte-ij5ual" aria-label="Remove media">&times;</button></div>'),Cs=S("<div><!></div>"),Ps=S("<div><!></div>"),qs=S("<div><!></div>"),js=S('<button type="button"> </button>'),Ts=S('<div class="message-input-container svelte-ij5ual"><div class="media-preview svelte-ij5ual"></div> <div class="input-bubble svelte-ij5ual"><div class="input-container svelte-ij5ual"><textarea rows="2" class="svelte-ij5ual"></textarea></div> <div class="actions-bar svelte-ij5ual"><div class="left-actions svelte-ij5ual"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple class="svelte-ij5ual"> <!> <!> <!> <!></div> <div class="right-actions svelte-ij5ual"><!></div></div></div> <div class="tools-bar svelte-ij5ual"></div></div>');function Ns(s,t){Ge(t,!1);let o=ae(t,"value",12,""),_=ae(t,"placeholder",8,"Send a message..."),a=ae(t,"disabled",8,!1),m=ae(t,"isRecording",8,!1),i=ae(t,"isCapturingVideo",8,!1),r=ae(t,"mediaItems",28,()=>[]),N=ae(t,"tools",24,()=>({}));const d=ht();let n=ne(),C=!1;Ye(()=>(g(),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g)}));function g(){C=window.innerWidth<768}function p(){e(n)&&(ke(n,e(n).style.height="auto"),ke(n,e(n).style.height=`${Math.min(e(n).scrollHeight,200)}px`))}function h(){a()||!o().trim()&&r().length===0||(d("submit",{content:o().trim(),media:r(),tools:N()}),o(""),e(n)&&ke(n,e(n).style.height="auto"))}function j(x){x.key==="Enter"&&!x.shiftKey&&!C&&(x.preventDefault(),h())}function I(){m()?d("stopAudioCapture"):d("startAudioCapture")}function K(){i()?d("stopVideoCapture"):d("startVideoCapture")}function Z(x){const G=x.target;if(G.files&&G.files.length>0){const P=Array.from(G.files);d("uploadFile",P),G.value=""}}function B(x){const G=!N()[x];d("toggleTool",{tool:x,enabled:G})}Qe(()=>e(n),()=>{e(n)&&p()}),_t(),Ke();var q=Ts(),D=c(q);Ie(D,5,r,Se,(x,G)=>{var P=zs(),te=c(P);{var ue=T=>{var M=Is();U(()=>{ye(M,"src",e(G).preview),ye(M,"alt",e(G).name)}),v(T,M)},u=T=>{var M=Es(),Y=c(M),L=c(Y,!0);l(Y),l(M),U(()=>he(L,e(G).name)),v(T,M)};V(te,T=>{e(G).type==="image"&&e(G).preview?T(ue):T(u,!1)})}var b=k(te,2);l(P),oe("click",b,()=>{r(r().filter(T=>T.id!==e(G).id))}),v(x,P)}),l(D);var _e=k(D,2),E=c(_e),z=c(E);fa(z),bt(z,x=>f(n,x),()=>e(n)),l(E);var R=k(E,2),J=c(R),F=c(J),X=k(F,2);xe(X,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var x;return(x=document.getElementById("file-upload"))==null?void 0:x.click()}},children:(x,G)=>{Ht(x,{size:18})},$$slots:{default:!0}});var re=k(X,2);const ee=pe(()=>a()||m()),se=pe(()=>m()?"Stop recording":"Start recording");xe(re,{variant:"icon",size:"sm",get disabled(){return e(ee)},get"aria-label"(){return e(se)},$$events:{click:I},children:(x,G)=>{var P=Cs();let te;var ue=c(P);Va(ue,{size:18}),l(P),U(u=>te=Ne(P,1,"svelte-ij5ual",null,te,u),[()=>({active:m()})],pe),v(x,P)},$$slots:{default:!0}});var le=k(re,2);const W=pe(()=>a()||m()),ce=pe(()=>i()?"Stop video capture":"Start video capture");xe(le,{variant:"icon",size:"sm",get disabled(){return e(W)},get"aria-label"(){return e(ce)},$$events:{click:K},children:(x,G)=>{var P=Ps();let te;var ue=c(P);Fa(ue,{size:18}),l(P),U(u=>te=Ne(P,1,"svelte-ij5ual",null,te,u),[()=>({active:i()})],pe),v(x,P)},$$slots:{default:!0}});var H=k(le,2);xe(H,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>B("search")},children:(x,G)=>{var P=qs();let te;var ue=c(P);Ga(ue,{size:18}),l(P),U(u=>te=Ne(P,1,"svelte-ij5ual",null,te,u),[()=>({active:N().search})],pe),v(x,P)},$$slots:{default:!0}}),l(J);var w=k(J,2),y=c(w);const $=pe(()=>a()||!o().trim()&&r().length===0);xe(y,{variant:"icon",size:"sm",get disabled(){return e($)},class:"send-button","aria-label":"Send message",$$events:{click:h},children:(x,G)=>{Ka(x,{size:20,strokeWidth:2.5})},$$slots:{default:!0}}),l(w),l(R),l(_e);var A=k(_e,2);Ie(A,5,()=>Object.entries(N()),Se,(x,G)=>{let P=()=>e(G)[0],te=()=>e(G)[1];var ue=fe(),u=de(ue);{var b=T=>{var M=js();let Y;var L=c(M,!0);l(M),U(ve=>{Y=Ne(M,1,"tool-button svelte-ij5ual",null,Y,ve),ye(M,"aria-label",`Toggle ${P()??""}`),he(L,P())},[()=>({enabled:te()})],pe),oe("click",M,()=>B(P())),v(T,M)};V(u,T=>{P()!=="search"&&T(b)})}v(x,ue)}),l(A),l(q),U(()=>{ye(z,"placeholder",_()),z.disabled=a()}),Fe(z,o),oe("keydown",z,j),oe("input",z,p),oe("change",F,Z),v(s,q),Re()}var Ls=S('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Os=S('<span class="error-message svelte-8a76oy"> </span>'),Ds=S('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Hs(s,t){Ge(t,!1);const[o,_]=yt(),a=()=>Te(dt,"$settingsStore",o);let m=ae(t,"isOpen",8,!1);const i=ht();let r=ne({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434"}),N=ne(!1),d=ne(!1),n=ne("");Ye(()=>{console.log("Settings component mounted, current settingsStore value:",a());const I=a().apiKeys||{};console.log("Stored API keys from settings store:",I),f(r,{anthropic:I.anthropic||"",openai:I.openai||"",google:I.google||"",ollamaHost:I.ollamaHost||"http://localhost:11434"}),console.log("Initialized API key form with:",e(r))});function C(){i("close")}async function g(){var I;f(N,!0),f(d,!1),f(n,"");try{console.log("Saving API keys to settingsStore:",e(r)),e(r).google&&(console.log("EXACT GOOGLE KEY BEING SAVED: ",e(r).google),console.log(`Google key before saving: length=${e(r).google.length}, starts with=${e(r).google.substring(0,4)}`)),await dt.updateApiKeys({anthropic:e(r).anthropic,openai:e(r).openai,google:e(r).google,ollamaHost:e(r).ollamaHost||"http://localhost:11434"}),console.log("API keys saved. Current settingsStore value:",a());try{const K={...a(),apiKeys:{...a().apiKeys}};localStorage.setItem("gervais-api-backup",JSON.stringify(K)),console.log("API keys also backed up to localStorage")}catch(K){console.error("Failed to backup API keys to localStorage:",K)}(I=a().apiKeys)!=null&&I.google&&(console.log("EXACT GOOGLE KEY AFTER SAVING: ",a().apiKeys.google),console.log(`Google key after saving: length=${a().apiKeys.google.length}, starts with=${a().apiKeys.google.substring(0,4)}`)),f(d,!0),console.log("API keys saved successfully"),setTimeout(()=>{f(d,!1)},3e3)}catch(K){console.error("Failed to save API keys:",K),f(n,K instanceof Error?K.message:"Unknown error"),f(N,!1)}finally{f(N,!1)}}Ke();var p=fe(),h=de(p);{var j=I=>{var K=Ds(),Z=c(K),B=c(Z),q=k(c(B),2);xe(q,{variant:"icon","aria-label":"Close settings",$$events:{click:C},children:($,A)=>{Kt($,{size:20})},$$slots:{default:!0}}),l(B);var D=k(B,2),_e=c(D),E=k(c(_e),4),z=c(E),R=k(c(z),2);Je(R),l(z);var J=k(z,2),F=k(c(J),2);Je(F),l(J);var X=k(J,2),re=k(c(X),2);Je(re),l(X);var ee=k(X,2),se=k(c(ee),2);Je(se),Le(2),l(ee),l(E);var le=k(E,2),W=c(le);xe(W,{variant:"primary",get disabled(){return e(N)},$$events:{click:g},children:($,A)=>{Le();var x=Xt();U(()=>he(x,e(N)?"Saving...":"Save API Keys")),v($,x)},$$slots:{default:!0}});var ce=k(W,2);{var H=$=>{var A=Ls();v($,A)};V(ce,$=>{e(d)&&$(H)})}var w=k(ce,2);{var y=$=>{var A=Os(),x=c(A,!0);l(A),U(()=>he(x,e(n))),v($,A)};V(w,$=>{e(n)&&$(y)})}l(le),l(_e),l(D),l(Z),l(K),Fe(R,()=>e(r).anthropic,$=>ke(r,e(r).anthropic=$)),Fe(F,()=>e(r).openai,$=>ke(r,e(r).openai=$)),Fe(re,()=>e(r).google,$=>ke(r,e(r).google=$)),Fe(se,()=>e(r).ollamaHost,$=>ke(r,e(r).ollamaHost=$)),oe("click",K,La(C)),oe("keydown",K,$=>$.key==="Escape"&&C()),v(I,K)};V(h,I=>{m()&&I(j)})}v(s,p),Re(),_()}var Ks=S('<div class="sidebar-backdrop svelte-1b4tzcm" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Gs=S('<div class="empty-state svelte-1b4tzcm"><h2 class="svelte-1b4tzcm">Start a new conversation</h2> <p class="svelte-1b4tzcm">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1b4tzcm"><div class="feature svelte-1b4tzcm"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1b4tzcm"><!> <span>Vision support for images</span></div></div></div>'),Rs=S('<div class="settings-portal svelte-1b4tzcm"><!></div>'),Vs=S('<div class="chat-container svelte-1b4tzcm"><!> <!> <main class="chat-main svelte-1b4tzcm"><header class="chat-header svelte-1b4tzcm"><!> <h1 class="chat-title svelte-1b4tzcm"> </h1> <!></header> <div class="chat-messages svelte-1b4tzcm"><!></div> <div class="input-container svelte-1b4tzcm"><!></div></main></div> <!>',1);function ao(s,t){Ge(t,!1);const[o,_]=yt(),a=()=>Te(Nt,"$activeChat",o),m=()=>Te(dt,"$settingsStore",o);let i=ne(!1),r=ne(!0),N=ne(""),d=ne(!1),n=ne(!1),C=ne([]),g=ne({search:!1}),p=ne(),h=ne(!1);function j(){f(i,window.innerWidth<768),e(i)?f(r,!1):f(r,!0)}Ye(()=>{j(),window.addEventListener("resize",j);function u(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`)}return u(),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",j),window.removeEventListener("resize",u)}});function I(){f(r,!e(r))}async function K({detail:u}){var ve,be,Ae;if(!a())return;const b=a().model.provider;if(console.log("Current settings store state:",m()),b==="openai"&&!((ve=m().apiKeys)!=null&&ve.openai)){console.warn("OpenAI API key not set, opening settings dialog"),f(h,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(b==="anthropic"&&!((be=m().apiKeys)!=null&&be.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),f(h,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(b==="google"&&!((Ae=m().apiKeys)!=null&&Ae.google)){console.warn("Google API key not set, opening settings dialog"),f(h,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:T,media:M,tools:Y}=u;console.log("Media items in submission:",M),await ie.addMessage(a().id,{role:"user",content:T,media:M}),f(N,""),f(C,[]),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100);const L=await ie.addMessage(a().id,{role:"assistant",content:""});f(d,!0),f(n,!0);try{const we=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",we);const Q=a().model.id;if(b==="anthropic")await Aa(Q,we,O=>{ie.updateMessage(a().id,L,{content:O})},()=>{f(d,!1),f(n,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response:",O),ie.updateMessage(a().id,L,{content:`Error generating response: â€“ ${O.message}`}),f(d,!1),f(n,!1)},O=>{ie.updateMessage(a().id,L,{thinking:O})});else if(b==="openai")if(e(n))await Sa(Q,we,O=>{ie.updateMessage(a().id,L,{content:O})},()=>{f(d,!1),f(n,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response from OpenAI:",O);const me=O.message||"An unknown error occurred";ie.updateMessage(a().id,L,{content:`Error: ${me}`}),f(d,!1),f(n,!1)});else try{const O=await Ia(Q,we);ie.updateMessage(a().id,L,{content:O}),f(d,!1)}catch(O){console.error("Error generating non-streaming response from OpenAI:",O);const me=O.message||"An unknown error occurred";throw ie.updateMessage(a().id,L,{content:`Error: ${me}`}),f(d,!1),O}else if(b==="google")await Ea(Q,we,(O,me)=>{ie.updateMessage(a().id,L,{content:O,media:me})},()=>{f(d,!1),f(n,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response from Google:",O);const me=O.message||"An unknown error occurred";ie.updateMessage(a().id,L,{content:`Error: ${me}`}),f(d,!1),f(n,!1)},O=>{ie.updateMessage(a().id,L,{thinking:O})});else if(b==="ollama")try{await za(Q,we,O=>{ie.updateMessage(a().id,L,{content:O})},()=>{f(d,!1),f(n,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response from Ollama:",O);const me=O.message||"An unknown error occurred";ie.updateMessage(a().id,L,{content:`Error connecting to Ollama: ${me}. Make sure Ollama is running locally.`}),f(d,!1),f(n,!1)})}catch(O){throw console.error("Error generating response from Ollama:",O),O}else{let O="";const me="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of me)await new Promise(et=>setTimeout(et,50)),O+=Ze+" ",ie.updateMessage(a().id,L,{content:O.trim()});f(d,!1),f(n,!1)}}catch(we){if(console.error("Error generating response:",we),e(d)){const Q=we.message||"An unknown error occurred";ie.updateMessage(a().id,L,{content:`Error: ${Q}`}),f(d,!1),f(n,!1)}}}function Z(u){u.forEach(async b=>{const T=xa(),M=b.name,Y=b.size;let L="other",ve,be;console.log(`Processing file: ${M}, type: ${b.type}, size: ${Y} bytes`);const Ae=Q=>{var O;if(Q.type.includes("pdf")||Q.type.includes("word")||Q.type.includes("excel")||Q.type.includes("spreadsheet")||Q.type.includes("presentation")||Q.type.includes("officedocument")||Q.type.includes("application/rtf")||Q.type.includes("text/rtf"))return!0;if(!Q.type||Q.type==="application/octet-stream"){const me=(O=M.split(".").pop())==null?void 0:O.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(me||"")}return!1};if(b.type.startsWith("image/")){L="image";try{ve=await B(b),console.log(`Created data URL for image ${M} (length: ${ve.length} chars)`)}catch(Q){console.error(`Failed to create data URL for ${M}:`,Q)}}else if(b.type.startsWith("audio/"))L="audio";else if(b.type.startsWith("video/"))L="video";else if(b.type.startsWith("text/"))L="text";else if(Ae(b)){if(L="document",a()&&a().model.provider==="openai")try{be=await Ma(b),console.log(`Document ${M} uploaded to OpenAI with ID: ${be}`)}catch(Q){console.error(`Failed to upload document to OpenAI: ${Q.message}`),alert(`Failed to upload document to OpenAI: ${Q.message}`)}try{ve=await B(b),console.log(`Created data URL for document ${M}, mime type: ${b.type}`),console.log(`Document data URL length: ${ve.length} chars`),Y>5*1024*1024&&console.warn(`Warning: Large document (${(Y/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(Q){console.error(`Failed to create data URL for ${M}:`,Q)}}const we={id:T,type:L,name:M,preview:ve,size:Y,timestamp:Date.now(),fileId:be};console.log(`Adding media item: ${L} ${M}`),f(C,[...e(C),we])})}async function B(u){return new Promise((b,T)=>{const M=new FileReader;M.onload=()=>{const Y=M.result;b(Y)},M.onerror=Y=>{console.error("Error reading file:",Y),T(Y)},M.readAsDataURL(u)})}function q({detail:u}){const{tool:b,enabled:T}=u;f(g,{...e(g),[b]:T})}function D(){console.log("Start audio capture")}function _e(){console.log("Stop audio capture")}function E(){console.log("Start video capture")}function z(){console.log("Stop video capture")}Ke();var R=Vs(),J=de(R),F=c(J);ss(F,{get isMobile(){return e(i)},get isExpanded(){return e(r)},$$events:{toggleSidebar:({detail:u})=>f(r,u)}});var X=k(F,2);{var re=u=>{var b=Ks();oe("click",b,()=>f(r,!1)),oe("keydown",b,T=>T.key==="Escape"&&f(r,!1)),v(u,b)};V(X,u=>{e(i)&&e(r)&&u(re)})}var ee=k(X,2),se=c(ee),le=c(se);{var W=u=>{xe(u,{variant:"icon","aria-label":"Open menu",$$events:{click:I},children:(b,T)=>{Dt(b,{size:20})},$$slots:{default:!0}})};V(le,u=>{e(i)&&u(W)})}var ce=k(le,2),H=c(ce,!0);l(ce);var w=k(ce,2);xe(w,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>f(h,!0)},children:(u,b)=>{Ba(u,{size:20})},$$slots:{default:!0}}),l(se);var y=k(se,2),$=c(y);{var A=u=>{var b=fe(),T=de(b);Ie(T,1,()=>a().messages,Se,(M,Y,L)=>{const ve=pe(()=>e(n)&&L===a().messages.length-1&&e(Y).role==="assistant"),be=pe(()=>L===a().messages.length-1);Ss(M,{get message(){return e(Y)},get isStreaming(){return e(ve)},get scrollToBottom(){return e(be)}})}),v(u,b)},x=u=>{var b=Gs(),T=k(c(b),4),M=c(T),Y=c(M);Ht(Y,{size:16}),Le(2),l(M);var L=k(M,2),ve=c(L);Ra(ve,{size:16}),Le(2),l(L),l(T),l(b),v(u,b)};V($,u=>{a()&&a().messages.length>0?u(A):u(x,!1)})}l(y),bt(y,u=>f(p,u),()=>e(p));var G=k(y,2),P=c(G);Ns(P,{get tools(){return e(g)},get disabled(){return e(d)},placeholder:"Send a message...",get value(){return e(N)},set value(u){f(N,u)},get mediaItems(){return e(C)},set mediaItems(u){f(C,u)},$$events:{submit:K,uploadFile:u=>Z(u.detail),toggleTool:q,startAudioCapture:D,stopAudioCapture:_e,startVideoCapture:E,stopVideoCapture:z},$$legacy:!0}),l(G),l(ee),l(J);var te=k(J,2);{var ue=u=>{var b=Rs(),T=c(b);Hs(T,{isOpen:!0,$$events:{close:()=>f(h,!1)}}),l(b),v(u,b)};V(te,u=>{e(h)&&u(ue)})}U(()=>{var u;return he(H,((u=a())==null?void 0:u.model.name)||"AI Assistant")}),v(s,R),Re(),_()}export{ao as component};
