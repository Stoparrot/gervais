import{a as Ut,n as Yt,b as v,c as fe,t as I,d as Xt}from"../chunks/CD-cSNpP.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as It,b as St,s as Ue,h as ge,j as Et,a as nt,G as e,aa as pe,c as Jt,r as $t,d as Ye,g as Te,m as Qt,e as pt,f as ft,p as zt,aD as st,t as Ct,a7 as Zt,y as ct,aE as mt,aF as wt,aG as gt,B as ea,$ as kt,aH as Pt,a4 as qt,aI as ta,aJ as aa,q as sa,aK as oa,aL as Tt,aM as ra,k as la,E as ia,aN as na,aO as ca,N as Nt,a6 as da,a5 as va,w as Ve,V as c,X as $,T as U,z as Fe,W as l,S as ve,aP as ht,aQ as ne,al as Xe,aR as Qe,aS as _t,D as g,aT as Ne,P as xt,aU as ke}from"../chunks/BSv_i5Hy.js";import{s as he}from"../chunks/XUjQEjo_.js";import{i as F}from"../chunks/Cec3cEQU.js";import{l as ua,m as pa,o as oe,p as fa}from"../chunks/Bl1F-iLh.js";import{i as ma,l as $e,p as ae,s as ze,b as bt}from"../chunks/DYD2hZ7I.js";import{a as je,s as yt}from"../chunks/HG7v26tk.js";import{s as Me,b as dt,C as ga,d as Le,a as ye,e as jt,c as ie,f as ha,r as We}from"../chunks/uxZwVYDM.js";import{i as _a,o as ba,g as ya,b as $a,l as wa,c as ka,s as vt,v as xa,u as Ma,e as Aa,f as Ia,h as Sa,j as Ea,k as za}from"../chunks/BFkVdgW4.js";import{M as ot}from"../chunks/CoxQhQk-.js";function Ie(s,t){return t}function Ca(s,t,r,b){for(var a=[],m=t.length,i=0;i<m;i++)aa(t[i].e,a,!0);var o=m>0&&a.length===0&&r!==null;if(o){var L=r.parentNode;sa(L),L.append(r),b.clear(),qe(s,t[0].prev,t[m-1].next)}oa(a,()=>{for(var u=0;u<m;u++){var n=t[u];o||(b.delete(n.k),qe(s,n.prev,n.next)),Tt(n.e,!o)}})}function Se(s,t,r,b,a,m=null){var i=s,o={flags:t,items:new Map,first:null},L=(t&Pt)!==0;if(L){var u=s;i=ge?Ue(Et(u)):u.appendChild(It())}ge&&nt();var n=null,z=!1,h=pe(()=>{var f=r();return qt(f)?f:f==null?[]:Ct(f)});St(()=>{var f=e(h),_=f.length;if(z&&_===0)return;z=_===0;let q=!1;if(ge){var A=i.data===Jt;A!==(_===0)&&(i=$t(),Ue(i),Ye(!1),q=!0)}if(ge){for(var K=null,Y,B=0;B<_;B++){if(Te.nodeType===8&&Te.data===Qt){i=Te,q=!0,Ye(!1);break}var P=f[B],D=b(P,B);Y=Lt(Te,o,K,null,P,D,B,a,t,r),o.items.set(D,Y),K=Y}_>0&&Ue($t())}ge||Pa(f,o,i,a,t,b,r),m!==null&&(_===0?n?pt(n):n=ft(()=>m(i)):n!==null&&zt(n,()=>{n=null})),q&&Ye(!0),e(h)}),ge&&(i=Te)}function Pa(s,t,r,b,a,m,i){var Z,se,le,W;var o=(a&ta)!==0,L=(a&(mt|gt))!==0,u=s.length,n=t.items,z=t.first,h=z,f,_=null,q,A=[],K=[],Y,B,P,D;if(o)for(D=0;D<u;D+=1)Y=s[D],B=m(Y,D),P=n.get(B),P!==void 0&&((Z=P.a)==null||Z.measure(),(q??(q=new Set)).add(P));for(D=0;D<u;D+=1){if(Y=s[D],B=m(Y,D),P=n.get(B),P===void 0){var _e=h?h.e.nodes_start:r;_=Lt(_e,t,_,_===null?t.first:_.next,Y,B,D,b,a,i),n.set(B,_),A=[],K=[],h=_.next;continue}if(L&&qa(P,Y,D,a),(P.e.f&st)!==0&&(pt(P.e),o&&((se=P.a)==null||se.unfix(),(q??(q=new Set)).delete(P))),P!==h){if(f!==void 0&&f.has(P)){if(A.length<K.length){var S=K[0],E;_=S.prev;var R=A[0],Q=A[A.length-1];for(E=0;E<A.length;E+=1)Mt(A[E],S,r);for(E=0;E<K.length;E+=1)f.delete(K[E]);qe(t,R.prev,Q.next),qe(t,_,R),qe(t,Q,S),h=S,_=Q,D-=1,A=[],K=[]}else f.delete(P),Mt(P,h,r),qe(t,P.prev,P.next),qe(t,P,_===null?t.first:_.next),qe(t,_,P),_=P;continue}for(A=[],K=[];h!==null&&h.k!==B;)(h.e.f&st)===0&&(f??(f=new Set)).add(h),K.push(h),h=h.next;if(h===null)continue;P=h}A.push(P),_=P,h=P.next}if(h!==null||f!==void 0){for(var G=f===void 0?[]:Ct(f);h!==null;)(h.e.f&st)===0&&G.push(h),h=h.next;var J=G.length;if(J>0){var re=(a&Pt)!==0&&u===0?r:null;if(o){for(D=0;D<J;D+=1)(le=G[D].a)==null||le.measure();for(D=0;D<J;D+=1)(W=G[D].a)==null||W.fix()}Ca(t,G,re,n)}}o&&Zt(()=>{var ce;if(q!==void 0)for(P of q)(ce=P.a)==null||ce.apply()}),ct.first=t.first&&t.first.e,ct.last=_&&_.e}function qa(s,t,r,b){(b&mt)!==0&&wt(s.v,t),(b&gt)!==0?wt(s.i,r):s.i=r}function Lt(s,t,r,b,a,m,i,o,L,u){var n=(L&mt)!==0,z=(L&ra)===0,h=n?z?ea(a):kt(a):a,f=(L&gt)===0?i:kt(i),_={i:f,v:h,k:m,a:null,e:null,prev:r,next:b};try{return _.e=ft(()=>o(s,h,f,u),ge),_.e.prev=r&&r.e,_.e.next=b&&b.e,r===null?t.first=_:(r.next=_,r.e.next=_.e),b!==null&&(b.prev=_,b.e.prev=_.e),_}finally{}}function Mt(s,t,r){for(var b=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,m=s.e.nodes_start;m!==b;){var i=la(m);a.before(m),m=i}}function qe(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Ta(s,t,r,b,a,m){let i=ge;ge&&nt();var o,L,u=null;ge&&Te.nodeType===1&&(u=Te,nt());var n=ge?Te:s,z;St(()=>{const h=t()||null;var f=na;h!==o&&(z&&(h===null?zt(z,()=>{z=null,L=null}):h===L?pt(z):Tt(z)),h&&h!==L&&(z=ft(()=>{if(u=ge?u:document.createElementNS(f,h),Ut(u,u),b){ge&&ua(h)&&u.append(document.createComment(""));var _=ge?Et(u):u.appendChild(It());ge&&(_===null?Ye(!1):Ue(_)),b(u,_)}ct.nodes_end=u,n.before(u)})),o=h,o&&(L=o))},ia),i&&(Ye(!0),Ue(n))}function Ke(s,t,r=t){var b=ca();pa(s,"input",a=>{var m=a?s.defaultValue:s.value;if(m=rt(s)?lt(m):m,r(m),b&&m!==(m=t())){var i=s.selectionStart,o=s.selectionEnd;s.value=m??"",o!==null&&(s.selectionStart=i,s.selectionEnd=Math.min(o,s.value.length))}}),(ge&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&r(rt(s)?lt(s.value):s.value),da(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,r){if(s.multiple)return ja(s,t);for(var b of s.options){var a=Ot(b);if(ma(a,t)){b.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let r=!0;va(()=>{t&&ut(s,Nt(t),r),r=!1;var b=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return b.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{b.disconnect()}})}function ja(s,t){for(var r of s.options)r.selected=~t.indexOf(Ot(r))}function Ot(s){return"__value"in s?s.__value:s.value}function La(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function At(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function it(s,t){var m;var r=(m=s.$$events)==null?void 0:m[t.type],b=qt(r)?r.slice():r==null?[]:[r];for(var a of b)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ha=Yt("<svg><!><!></svg>");function Ce(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]),b=$e(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let a=ae(t,"name",8,void 0),m=ae(t,"color",8,"currentColor"),i=ae(t,"size",8,24),o=ae(t,"strokeWidth",8,2),L=ae(t,"absoluteStrokeWidth",8,!1),u=ae(t,"iconNode",24,()=>[]);const n=(...q)=>q.filter((A,K,Y)=>!!A&&Y.indexOf(A)===K).join(" ");Re();var z=Ha();let h;var f=c(z);Se(f,1,u,Ie,(q,A)=>{let K=()=>e(A)[0],Y=()=>e(A)[1];var B=fe(),P=ve(B);Ta(P,K,!0,(D,_e)=>{let S;U(()=>S=dt(D,S,{...Y()}))}),v(q,B)});var _=$(f);Me(_,t,"default",{}),l(z),U((q,A)=>h=dt(z,h,{...Oa,...b,width:i(),height:i(),stroke:m(),"stroke-width":q,class:A}),[()=>L()?Number(o())*24/Number(i()):o(),()=>n("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],pe),v(s,z),Fe()}function Da(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ka(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ra(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Va(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ht(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"notebook-pen"},()=>r,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Dt(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Fa(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"send"},()=>r,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ba(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ga(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"video"},()=>r,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Kt(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,m)=>{var i=fe(),o=ve(i);Me(o,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}var Wa=I('<div class="spinner svelte-1pi70xe"></div>'),Ua=I("<button><!> <!></button>");function xe(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]),b=$e(r,["type","variant","size","disabled","loading","fullWidth"]);let a=ae(t,"type",8,"button"),m=ae(t,"variant",8,"primary"),i=ae(t,"size",8,"md"),o=ae(t,"disabled",8,!1),L=ae(t,"loading",8,!1),u=ae(t,"fullWidth",8,!1);var n=Ua();let z;var h=c(n);{var f=q=>{var A=Wa();v(q,A)};F(h,q=>{L()&&q(f)})}var _=$(h,2);Me(_,t,"default",{}),l(n),U(q=>z=dt(n,z,{type:a(),class:`button ${m()??""} ${i()??""} ${(u()?"full-width":"")??""}`,disabled:o(),...b,[ga]:q},"svelte-1pi70xe"),[()=>({loading:L()})],pe),oe("click",n,function(q){it.call(this,t,q)}),oe("keydown",n,function(q){it.call(this,t,q)}),oe("keyup",n,function(q){it.call(this,t,q)}),v(s,n)}var Ya=I('<option class="svelte-1m60q0l"> </option>'),Xa=I('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Ja=I('<option class="svelte-1m60q0l"> </option>'),Qa=I('<option class="svelte-1m60q0l"> </option>'),Za=I('<option disabled class="svelte-1m60q0l"> </option>'),es=I('<!> <span class="svelte-1m60q0l">New Chat</span>',1),ts=I('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),as=I('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function ss(s,t){var ce;Ve(t,!1);const[r,b]=yt(),a=()=>je(jt,"$activeChat",r),m=()=>je(ka,"$allModelsStore",r),i=()=>je(wa,"$localModelsStore",r),o=()=>je(ie,"$chatStore",r);let L=ae(t,"isMobile",8,!1),u=ae(t,"isExpanded",8,!0);const n=ht();let z=ne(((ce=a())==null?void 0:ce.model.id)||"claude-3-5-sonnet");Xe(async()=>{await _a()});function h(){const O=m().find(w=>w.id===e(z));O&&ie.createNewChat(O)}function f(O){ie.selectChat(O),L()&&n("toggleSidebar",!1)}function _(O,w){w.stopPropagation(),ie.deleteChat(O)}function q(O){const w=O.target;if(g(z,w.value),a()){const k=m().find(V=>V.id===e(z));k&&ie.updateChatModel(a().id,k)}}Qe(()=>a(),()=>{a()&&g(z,a().model.id)}),_t(),Re();var A=as();let K;var Y=c(A),B=c(Y),P=c(B);Ne(2),l(B);var D=$(B,2);{var _e=O=>{const w=pe(()=>u()?"Collapse sidebar":"Expand sidebar");xe(O,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(w)},$$events:{click:()=>n("toggleSidebar",!u())},children:(k,V)=>{Da(k,{size:20})},$$slots:{default:!0}})};F(D,O=>{L()&&O(_e)})}l(Y);var S=$(Y,2),E=c(S),R=c(E);Na(R,()=>e(z));var Q,G=c(R);{var J=O=>{var w=Xa();Se(w,5,i,Ie,(k,V)=>{var T=Ya(),d={},C=c(T,!0);l(T),U(()=>{d!==(d=e(V).id)&&(T.value=(T.__value=e(V).id)==null?"":e(V).id),he(C,e(V).name)}),v(k,T)}),l(w),v(O,w)};F(G,O=>{i().length>0&&O(J)})}var re=$(G);Se(re,5,()=>ba,Ie,(O,w)=>{var k=Ja(),V={},T=c(k,!0);l(k),U(()=>{V!==(V=e(w).id)&&(k.value=(k.__value=e(w).id)==null?"":e(w).id),he(T,e(w).name)}),v(O,k)}),l(re);var Z=$(re);Se(Z,5,()=>ya,Ie,(O,w)=>{var k=Qa(),V={},T=c(k,!0);l(k),U(()=>{V!==(V=e(w).id)&&(k.value=(k.__value=e(w).id)==null?"":e(w).id),he(T,e(w).name)}),v(O,k)}),l(Z);var se=$(Z);Se(se,5,()=>$a,Ie,(O,w)=>{var k=Za(),V={},T=c(k,!0);l(k),U(()=>{V!==(V=e(w).id)&&(k.value=(k.__value=e(w).id)==null?"":e(w).id),he(T,e(w).name)}),v(O,k)}),l(se),l(R),l(E);var le=$(E,2);xe(le,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:h},children:(O,w)=>{var k=es(),V=ve(k);Ht(V,{size:16}),Ne(2),v(O,k)},$$slots:{default:!0}});var W=$(le,2);Se(W,5,()=>o().chats,Ie,(O,w)=>{var k=ts();let V;var T=c(k),d=c(T,!0);l(T);var C=$(T,2);xe(C,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:x=>_(e(w).id,x)},children:(x,te)=>{Kt(x,{size:16})},$$slots:{default:!0}}),l(k),U(x=>{V=Le(k,1,"chat-item svelte-1m60q0l",null,V,x),he(d,e(w).title||"New Chat")},[()=>{var x;return{active:e(w).id===((x=a())==null?void 0:x.id)}}],pe),oe("click",k,()=>f(e(w).id)),v(O,k)}),l(W),l(S),l(A),U(O=>{K=Le(A,1,"sidebar svelte-1m60q0l",null,K,O),ye(P,"src","/gervais/logo.svg"),Q!==(Q=e(z))&&(R.value=(R.__value=e(z))==null?"":e(z),ut(R,e(z)))},[()=>({expanded:u()})],pe),oe("change",R,q),v(s,A),Fe(),b()}var os=I('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),rs=I('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),ls=I('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),is=I('<div class="file-size svelte-1mjurqb"> </div>'),ns=I('<span class="document-status success svelte-1mjurqb"> </span>'),cs=I('<span class="document-status info svelte-1mjurqb">Document attached</span>'),ds=I('<span class="document-status success svelte-1mjurqb">Document processed</span>'),vs=I('<span class="document-status info svelte-1mjurqb">Document</span>'),us=I('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),ps=I('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">📄</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),fs=I('<div class="media-container svelte-1mjurqb"></div>'),ms=I('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),gs=I('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),hs=I('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),_s=I('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),bs=I('<div class="media-container assistant-media svelte-1mjurqb"></div>'),ys=I('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),$s=I('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ws=I('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ks=I('<div class="content system-message svelte-1mjurqb"><!></div>'),xs=I('<div class="timestamp svelte-1mjurqb"> </div>'),Ms=I('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">×</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),As=I("<div><!> <!></div> <!>",1);function Is(s,t){Ve(t,!1);const r=ne(),b=ne();let a=ae(t,"message",8),m=ae(t,"isStreaming",8,!1),i=ae(t,"scrollToBottom",8,!1),o=ne(!1),L=ne(""),u=ne(""),n=ne();Xe(()=>{if(i()&&e(n)){const S=e(n).parentElement;S&&(S.scrollTop=S.scrollHeight)}});function z(S,E=2){if(S===0)return"0 Bytes";const R=1024,Q=E<0?0:E,G=["Bytes","KB","MB","GB","TB"],J=Math.floor(Math.log(S)/Math.log(R));return parseFloat((S/Math.pow(R,J)).toFixed(Q))+" "+G[J]}function h(S,E="Preview image"){g(L,S),g(u,E),g(o,!0)}function f(){g(o,!1)}Qe(()=>xt(a()),()=>{g(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Qe(()=>xt(a()),()=>{g(b,`message ${a().role}`)}),_t(),Re();var _=As(),q=ve(_),A=c(q);{var K=S=>{var E=ms(),R=c(E),Q=c(R),G=c(Q,!0);l(Q),l(R);var J=$(R,2);{var re=Z=>{var se=fs();Se(se,5,()=>a().media,Ie,(le,W,ce)=>{var O=fe(),w=ve(O);{var k=T=>{var d=os(),C=c(d);ye(C,"alt",`Image ${ce+1}`),l(d),U(()=>ye(C,"src",e(W).preview)),oe("click",d,()=>{e(W).preview&&h(e(W).preview,`Image ${ce+1}`)}),oe("keydown",d,x=>{if(x.key==="Enter"||x.key===" "){if(x.preventDefault(),!e(W).preview)return;h(e(W).preview,`Image ${ce+1}`)}}),v(T,d)},V=(T,d)=>{{var C=te=>{var ue=rs();U(()=>ye(ue,"src",e(W).preview)),v(te,ue)},x=(te,ue)=>{{var p=N=>{var M=ls();U(()=>ye(M,"src",e(W).preview)),v(N,M)},y=(N,M)=>{{var X=j=>{var de=ps(),be=$(c(de),2),Ae=c(be),we=c(Ae,!0);l(Ae);var ee=$(Ae,2);{var H=Ee=>{var Pe=is(),Be=c(Pe,!0);l(Pe),U(Ge=>he(Be,Ge),[()=>z(e(W).size)],pe),v(Ee,Pe)};F(ee,Ee=>{e(W).size&&Ee(H)})}var me=$(ee,2),Ze=c(me);{var et=Ee=>{var Pe=ns(),Be=c(Pe);l(Pe),U(Ge=>he(Be,`✓ Uploaded to OpenAI (ID: ${Ge??""}...)`),[()=>e(W).fileId.substring(0,8)],pe),v(Ee,Pe)},Rt=(Ee,Pe)=>{{var Be=Oe=>{var Je=fe(),Vt=ve(Je);{var Ft=He=>{var tt=cs();v(He,tt)},Bt=(He,tt)=>{{var Gt=De=>{var at=ds();v(De,at)},Wt=De=>{var at=vs();v(De,at)};F(He,De=>{a().role==="assistant"?De(Gt):De(Wt,!1)},tt)}};F(Vt,He=>{a().role==="user"?He(Ft):He(Bt,!1)})}v(Oe,Je)},Ge=Oe=>{var Je=us();v(Oe,Je)};F(Ee,Oe=>{e(W).preview?Oe(Be):Oe(Ge,!1)},Pe)}};F(Ze,Ee=>{e(W).fileId?Ee(et):Ee(Rt,!1)})}l(me),l(be),l(de),U(()=>he(we,e(W).name||"Document")),v(j,de)};F(N,j=>{e(W).type==="document"&&j(X)},M)}};F(te,N=>{e(W).type==="video"?N(p):N(y,!1)},ue)}};F(T,te=>{e(W).type==="audio"?te(C):te(x,!1)},d)}};F(w,T=>{e(W).type==="image"?T(k):T(V,!1)})}v(le,O)}),l(se),v(Z,se)};F(J,Z=>{a().media&&a().media.length>0&&Z(re)})}l(E),U(()=>he(G,a().content)),v(S,E)},Y=(S,E)=>{{var R=G=>{var J=ws(),re=c(J);ot(re,{get content(){return a().content},get scrollToBottom(){return i()}});var Z=$(re,2);{var se=w=>{var k=bs();Se(k,5,()=>a().media,Ie,(V,T,d)=>{var C=fe(),x=ve(C);{var te=p=>{var y=gs(),N=c(y);ye(N,"alt",`Generated image ${d+1}`),Ne(2),l(y),U(()=>ye(N,"src",e(T).preview)),oe("click",y,()=>{e(T).preview&&h(e(T).preview,`Generated image ${d+1}`)}),oe("keydown",y,M=>{if(M.key==="Enter"||M.key===" "){if(M.preventDefault(),!e(T).preview)return;h(e(T).preview,`Generated image ${d+1}`)}}),v(p,y)},ue=(p,y)=>{{var N=X=>{var j=hs();U(()=>ye(j,"src",e(T).preview)),v(X,j)},M=(X,j)=>{{var de=be=>{var Ae=_s();U(()=>ye(Ae,"src",e(T).preview)),v(be,Ae)};F(X,be=>{e(T).type==="video"&&be(de)},j)}};F(p,X=>{e(T).type==="audio"?X(N):X(M,!1)},y)}};F(x,p=>{e(T).type==="image"?p(te):p(ue,!1)})}v(V,C)}),l(k),v(w,k)};F(Z,w=>{a().media&&a().media.length>0&&w(se)})}var le=$(Z,2);{var W=w=>{var k=ys(),V=$(c(k),2),T=c(V);ot(T,{get content(){return a().thinking},scrollToBottom:!1}),l(V),l(k),v(w,k)};F(le,w=>{a().thinking&&w(W)})}var ce=$(le,2);{var O=w=>{var k=$s();v(w,k)};F(ce,w=>{m()&&w(O)})}l(J),v(G,J)},Q=(G,J)=>{{var re=Z=>{var se=ks(),le=c(se);ot(le,{get content(){return a().content},get scrollToBottom(){return i()}}),l(se),v(Z,se)};F(G,Z=>{a().role==="system"&&Z(re)},J)}};F(S,G=>{a().role==="assistant"?G(R):G(Q,!1)},E)}};F(A,S=>{a().role==="user"?S(K):S(Y,!1)})}var B=$(A,2);{var P=S=>{var E=xs(),R=c(E,!0);l(E),U(()=>he(R,e(r))),v(S,E)};F(B,S=>{a().role==="user"&&S(P)})}l(q),bt(q,S=>g(n,S),()=>e(n));var D=$(q,2);{var _e=S=>{var E=Ms(),R=c(E),Q=c(R),G=$(Q,2),J=$(G,2),re=c(J,!0);l(J),l(R),l(E),U(()=>{ye(G,"src",e(L)),ye(G,"alt",e(u)),he(re,e(u))}),oe("click",Q,f),oe("click",R,At(()=>{})),oe("keydown",R,At(()=>{})),oe("click",E,f),oe("keydown",E,Z=>Z.key==="Escape"&&f()),v(S,E)};F(D,S=>{e(o)&&S(_e)})}U(()=>Le(q,1,ha(e(b)),"svelte-1mjurqb")),v(s,_),Fe()}var Ss=I('<img class="svelte-1c4p7dt">'),Es=I('<div class="file-preview svelte-1c4p7dt"><span class="svelte-1c4p7dt"> </span></div>'),zs=I('<div class="media-item svelte-1c4p7dt"><!> <button type="button" class="remove-media svelte-1c4p7dt" aria-label="Remove media">&times;</button></div>'),Cs=I("<div><!></div>"),Ps=I("<div><!></div>"),qs=I("<div><!></div>"),Ts=I('<button type="button"> </button>'),Ns=I('<div class="message-input-container svelte-1c4p7dt"><div class="media-preview svelte-1c4p7dt"></div> <div class="input-bubble svelte-1c4p7dt"><div class="input-container svelte-1c4p7dt"><textarea rows="2" class="svelte-1c4p7dt"></textarea></div> <div class="actions-bar svelte-1c4p7dt"><div class="left-actions svelte-1c4p7dt"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple class="svelte-1c4p7dt"> <!> <!> <!> <!></div> <div class="right-actions svelte-1c4p7dt"><!></div></div></div> <div class="tools-bar svelte-1c4p7dt"></div></div>');function js(s,t){Ve(t,!1);let r=ae(t,"value",12,""),b=ae(t,"placeholder",8,"Send a message..."),a=ae(t,"disabled",8,!1),m=ae(t,"isRecording",8,!1),i=ae(t,"isCapturingVideo",8,!1),o=ae(t,"mediaItems",28,()=>[]),L=ae(t,"tools",24,()=>({}));const u=ht();let n=ne(),z=!1;Xe(()=>(h(),window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}));function h(){z=window.innerWidth<768}function f(){e(n)&&(ke(n,e(n).style.height="auto"),ke(n,e(n).style.height=`${Math.min(e(n).scrollHeight,200)}px`))}function _(){a()||!r().trim()&&o().length===0||(u("submit",{content:r().trim(),media:o(),tools:L()}),r(""),e(n)&&ke(n,e(n).style.height="auto"))}function q(d){d.key==="Enter"&&!d.shiftKey&&!z&&(d.preventDefault(),_())}function A(){m()?u("stopAudioCapture"):u("startAudioCapture")}function K(){i()?u("stopVideoCapture"):u("startVideoCapture")}function Y(d){const C=d.target;if(C.files&&C.files.length>0){const x=Array.from(C.files);u("uploadFile",x),C.value=""}}function B(d){const C=!L()[d];u("toggleTool",{tool:d,enabled:C})}Qe(()=>e(n),()=>{e(n)&&f()}),_t(),Re();var P=Ns(),D=c(P);Se(D,5,o,Ie,(d,C)=>{var x=zs(),te=c(x);{var ue=N=>{var M=Ss();U(()=>{ye(M,"src",e(C).preview),ye(M,"alt",e(C).name)}),v(N,M)},p=N=>{var M=Es(),X=c(M),j=c(X,!0);l(X),l(M),U(()=>he(j,e(C).name)),v(N,M)};F(te,N=>{e(C).type==="image"&&e(C).preview?N(ue):N(p,!1)})}var y=$(te,2);l(x),oe("click",y,()=>{o(o().filter(N=>N.id!==e(C).id))}),v(d,x)}),l(D);var _e=$(D,2),S=c(_e),E=c(S);fa(E),bt(E,d=>g(n,d),()=>e(n)),l(S);var R=$(S,2),Q=c(R),G=c(Q),J=$(G,2);xe(J,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var d;return(d=document.getElementById("file-upload"))==null?void 0:d.click()}},children:(d,C)=>{Dt(d,{size:18})},$$slots:{default:!0}});var re=$(J,2);const Z=pe(()=>a()||m()),se=pe(()=>m()?"Stop recording":"Start recording");xe(re,{variant:"icon",size:"sm",get disabled(){return e(Z)},get"aria-label"(){return e(se)},$$events:{click:A},children:(d,C)=>{var x=Cs();let te;var ue=c(x);Va(ue,{size:18}),l(x),U(p=>te=Le(x,1,"svelte-1c4p7dt",null,te,p),[()=>({active:m()})],pe),v(d,x)},$$slots:{default:!0}});var le=$(re,2);const W=pe(()=>a()||m()),ce=pe(()=>i()?"Stop video capture":"Start video capture");xe(le,{variant:"icon",size:"sm",get disabled(){return e(W)},get"aria-label"(){return e(ce)},$$events:{click:K},children:(d,C)=>{var x=Ps();let te;var ue=c(x);Ga(ue,{size:18}),l(x),U(p=>te=Le(x,1,"svelte-1c4p7dt",null,te,p),[()=>({active:i()})],pe),v(d,x)},$$slots:{default:!0}});var O=$(le,2);xe(O,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>B("search")},children:(d,C)=>{var x=qs();let te;var ue=c(x);Ka(ue,{size:18}),l(x),U(p=>te=Le(x,1,"svelte-1c4p7dt",null,te,p),[()=>({active:L().search})],pe),v(d,x)},$$slots:{default:!0}}),l(Q);var w=$(Q,2),k=c(w);const V=pe(()=>a()||!r().trim()&&o().length===0);xe(k,{variant:"icon",size:"sm",get disabled(){return e(V)},class:"send-button","aria-label":"Send message",$$events:{click:_},children:(d,C)=>{Fa(d,{size:18})},$$slots:{default:!0}}),l(w),l(R),l(_e);var T=$(_e,2);Se(T,5,()=>Object.entries(L()),Ie,(d,C)=>{let x=()=>e(C)[0],te=()=>e(C)[1];var ue=fe(),p=ve(ue);{var y=N=>{var M=Ts();let X;var j=c(M,!0);l(M),U(de=>{X=Le(M,1,"tool-button svelte-1c4p7dt",null,X,de),ye(M,"aria-label",`Toggle ${x()??""}`),he(j,x())},[()=>({enabled:te()})],pe),oe("click",M,()=>B(x())),v(N,M)};F(p,N=>{x()!=="search"&&N(y)})}v(d,ue)}),l(T),l(P),U(()=>{ye(E,"placeholder",b()),E.disabled=a()}),Ke(E,r),oe("keydown",E,q),oe("input",E,f),oe("change",G,Y),v(s,P),Fe()}var Ls=I('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Os=I('<span class="error-message svelte-8a76oy"> </span>'),Hs=I('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ds(s,t){Ve(t,!1);const[r,b]=yt(),a=()=>je(vt,"$settingsStore",r);let m=ae(t,"isOpen",8,!1);const i=ht();let o=ne({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),L=ne(!1),u=ne(!1),n=ne("");Xe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const A=a().apiKeys||{};console.log("Stored API keys from settings store:",A),g(o,{anthropic:A.anthropic||"",openai:A.openai||"",google:A.google||"",ollamaHost:A.ollamaHost||"http://localhost:11434",localHost:A.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(o))});function z(){i("close")}async function h(){var A;g(L,!0),g(u,!1),g(n,"");try{if(console.log("Saving API keys to settingsStore:",e(o)),e(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(o).openai),console.log(`OpenAI key before saving: length=${e(o).openai.length}, starts with=${e(o).openai.substring(0,4)}`);const K=[...e(o).openai.substring(0,10)].map(Y=>Y.charCodeAt(0));console.log(`First 10 character codes: ${K.join(", ")}`)}if(await vt.updateApiKeys({anthropic:e(o).anthropic,openai:e(o).openai,google:e(o).google,ollamaHost:e(o).ollamaHost||"http://localhost:11434",localHost:e(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(A=a().apiKeys)!=null&&A.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const K=[...a().apiKeys.openai.substring(0,10)].map(Y=>Y.charCodeAt(0));console.log(`First 10 character codes after saving: ${K.join(", ")}`)}g(u,!0),console.log("API keys saved successfully"),setTimeout(()=>{g(u,!1)},3e3)}catch(K){console.error("Failed to save API keys:",K),g(n,K instanceof Error?K.message:"Unknown error")}finally{g(L,!1)}}Re();var f=fe(),_=ve(f);{var q=A=>{var K=Hs(),Y=c(K),B=c(Y),P=$(c(B),2);xe(P,{variant:"icon","aria-label":"Close settings",$$events:{click:z},children:(d,C)=>{Kt(d,{size:20})},$$slots:{default:!0}}),l(B);var D=$(B,2),_e=c(D),S=$(c(_e),4),E=c(S),R=$(c(E),2);We(R),l(E);var Q=$(E,2),G=$(c(Q),2);We(G),l(Q);var J=$(Q,2),re=$(c(J),2);We(re),l(J);var Z=$(J,2),se=$(c(Z),2);We(se),Ne(2),l(Z);var le=$(Z,2),W=$(c(le),2);We(W),Ne(2),l(le),l(S);var ce=$(S,2),O=c(ce);xe(O,{variant:"primary",get disabled(){return e(L)},$$events:{click:h},children:(d,C)=>{Ne();var x=Xt();U(()=>he(x,e(L)?"Saving...":"Save API Keys")),v(d,x)},$$slots:{default:!0}});var w=$(O,2);{var k=d=>{var C=Ls();v(d,C)};F(w,d=>{e(u)&&d(k)})}var V=$(w,2);{var T=d=>{var C=Os(),x=c(C,!0);l(C),U(()=>he(x,e(n))),v(d,C)};F(V,d=>{e(n)&&d(T)})}l(ce),l(_e),l(D),l(Y),l(K),Ke(R,()=>e(o).anthropic,d=>ke(o,e(o).anthropic=d)),Ke(G,()=>e(o).openai,d=>ke(o,e(o).openai=d)),Ke(re,()=>e(o).google,d=>ke(o,e(o).google=d)),Ke(se,()=>e(o).ollamaHost,d=>ke(o,e(o).ollamaHost=d)),Ke(W,()=>e(o).localHost,d=>ke(o,e(o).localHost=d)),oe("click",K,La(z)),oe("keydown",K,d=>d.key==="Escape"&&z()),v(A,K)};F(_,A=>{m()&&A(q)})}v(s,f),Fe(),b()}var Ks=I('<div class="sidebar-backdrop svelte-1b4tzcm" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=I('<div class="empty-state svelte-1b4tzcm"><h2 class="svelte-1b4tzcm">Start a new conversation</h2> <p class="svelte-1b4tzcm">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1b4tzcm"><div class="feature svelte-1b4tzcm"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1b4tzcm"><!> <span>Vision support for images</span></div></div></div>'),Vs=I('<div class="settings-portal svelte-1b4tzcm"><!></div>'),Fs=I('<div class="chat-container svelte-1b4tzcm"><!> <!> <main class="chat-main svelte-1b4tzcm"><header class="chat-header svelte-1b4tzcm"><!> <h1 class="chat-title svelte-1b4tzcm"> </h1> <!></header> <div class="chat-messages svelte-1b4tzcm"><!></div> <div class="input-container svelte-1b4tzcm"><!></div></main></div> <!>',1);function ao(s,t){Ve(t,!1);const[r,b]=yt(),a=()=>je(jt,"$activeChat",r),m=()=>je(vt,"$settingsStore",r);let i=ne(!1),o=ne(!0),L=ne(""),u=ne(!1),n=ne(!1),z=ne([]),h=ne({search:!1}),f=ne(),_=ne(!1);function q(){g(i,window.innerWidth<768),e(i)?g(o,!1):g(o,!0)}Xe(()=>{q(),window.addEventListener("resize",q);function p(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`)}return p(),window.addEventListener("resize",p),()=>{window.removeEventListener("resize",q),window.removeEventListener("resize",p)}});function A(){g(o,!e(o))}async function K({detail:p}){var de,be,Ae;if(!a())return;const y=a().model.provider;if(console.log("Current settings store state:",m()),y==="openai"&&!((de=m().apiKeys)!=null&&de.openai)){console.warn("OpenAI API key not set, opening settings dialog"),g(_,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(y==="anthropic"&&!((be=m().apiKeys)!=null&&be.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),g(_,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(y==="google"&&!((Ae=m().apiKeys)!=null&&Ae.google)){console.warn("Google API key not set, opening settings dialog"),g(_,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:N,media:M,tools:X}=p;console.log("Media items in submission:",M),await ie.addMessage(a().id,{role:"user",content:N,media:M}),g(L,""),g(z,[]),setTimeout(()=>{e(f)&&ke(f,e(f).scrollTop=e(f).scrollHeight)},100);const j=await ie.addMessage(a().id,{role:"assistant",content:""});g(u,!0),g(n,!0);try{const we=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",we);const ee=a().model.id;if(y==="anthropic")await Aa(ee,we,H=>{ie.updateMessage(a().id,j,{content:H})},()=>{g(u,!1),g(n,!1),setTimeout(()=>{e(f)&&ke(f,e(f).scrollTop=e(f).scrollHeight)},100)},H=>{console.error("Error generating response:",H),ie.updateMessage(a().id,j,{content:`Error generating response: – ${H.message}`}),g(u,!1),g(n,!1)},H=>{ie.updateMessage(a().id,j,{thinking:H})});else if(y==="openai")if(e(n))await Ia(ee,we,H=>{ie.updateMessage(a().id,j,{content:H})},()=>{g(u,!1),g(n,!1),setTimeout(()=>{e(f)&&ke(f,e(f).scrollTop=e(f).scrollHeight)},100)},H=>{console.error("Error generating response from OpenAI:",H);const me=H.message||"An unknown error occurred";ie.updateMessage(a().id,j,{content:`Error: ${me}`}),g(u,!1),g(n,!1)});else try{const H=await Sa(ee,we);ie.updateMessage(a().id,j,{content:H}),g(u,!1)}catch(H){console.error("Error generating non-streaming response from OpenAI:",H);const me=H.message||"An unknown error occurred";throw ie.updateMessage(a().id,j,{content:`Error: ${me}`}),g(u,!1),H}else if(y==="google")await Ea(ee,we,(H,me)=>{ie.updateMessage(a().id,j,{content:H,media:me})},()=>{g(u,!1),g(n,!1),setTimeout(()=>{e(f)&&ke(f,e(f).scrollTop=e(f).scrollHeight)},100)},H=>{console.error("Error generating response from Google:",H);const me=H.message||"An unknown error occurred";ie.updateMessage(a().id,j,{content:`Error: ${me}`}),g(u,!1),g(n,!1)},H=>{ie.updateMessage(a().id,j,{thinking:H})});else if(y==="ollama")try{await za(ee,we,H=>{ie.updateMessage(a().id,j,{content:H})},()=>{g(u,!1),g(n,!1),setTimeout(()=>{e(f)&&ke(f,e(f).scrollTop=e(f).scrollHeight)},100)},H=>{console.error("Error generating response from Ollama:",H);const me=H.message||"An unknown error occurred";ie.updateMessage(a().id,j,{content:`Error connecting to Ollama: ${me}. Make sure Ollama is running locally.`}),g(u,!1),g(n,!1)})}catch(H){throw console.error("Error generating response from Ollama:",H),H}else{let H="";const me="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of me)await new Promise(et=>setTimeout(et,50)),H+=Ze+" ",ie.updateMessage(a().id,j,{content:H.trim()});g(u,!1),g(n,!1)}}catch(we){if(console.error("Error generating response:",we),e(u)){const ee=we.message||"An unknown error occurred";ie.updateMessage(a().id,j,{content:`Error: ${ee}`}),g(u,!1),g(n,!1)}}}function Y(p){p.forEach(async y=>{const N=xa(),M=y.name,X=y.size;let j="other",de,be;console.log(`Processing file: ${M}, type: ${y.type}, size: ${X} bytes`);const Ae=ee=>{var H;if(ee.type.includes("pdf")||ee.type.includes("word")||ee.type.includes("excel")||ee.type.includes("spreadsheet")||ee.type.includes("presentation")||ee.type.includes("officedocument")||ee.type.includes("application/rtf")||ee.type.includes("text/rtf"))return!0;if(!ee.type||ee.type==="application/octet-stream"){const me=(H=M.split(".").pop())==null?void 0:H.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(me||"")}return!1};if(y.type.startsWith("image/")){j="image";try{de=await B(y),console.log(`Created data URL for image ${M} (length: ${de.length} chars)`)}catch(ee){console.error(`Failed to create data URL for ${M}:`,ee)}}else if(y.type.startsWith("audio/"))j="audio";else if(y.type.startsWith("video/"))j="video";else if(y.type.startsWith("text/"))j="text";else if(Ae(y)){if(j="document",a()&&a().model.provider==="openai")try{be=await Ma(y),console.log(`Document ${M} uploaded to OpenAI with ID: ${be}`)}catch(ee){console.error(`Failed to upload document to OpenAI: ${ee.message}`),alert(`Failed to upload document to OpenAI: ${ee.message}`)}try{de=await B(y),console.log(`Created data URL for document ${M}, mime type: ${y.type}`),console.log(`Document data URL length: ${de.length} chars`),X>5*1024*1024&&console.warn(`Warning: Large document (${(X/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(ee){console.error(`Failed to create data URL for ${M}:`,ee)}}const we={id:N,type:j,name:M,preview:de,size:X,timestamp:Date.now(),fileId:be};console.log(`Adding media item: ${j} ${M}`),g(z,[...e(z),we])})}async function B(p){return new Promise((y,N)=>{const M=new FileReader;M.onload=()=>{const X=M.result;y(X)},M.onerror=X=>{console.error("Error reading file:",X),N(X)},M.readAsDataURL(p)})}function P({detail:p}){const{tool:y,enabled:N}=p;g(h,{...e(h),[y]:N})}function D(){console.log("Start audio capture")}function _e(){console.log("Stop audio capture")}function S(){console.log("Start video capture")}function E(){console.log("Stop video capture")}Re();var R=Fs(),Q=ve(R),G=c(Q);ss(G,{get isMobile(){return e(i)},get isExpanded(){return e(o)},$$events:{toggleSidebar:({detail:p})=>g(o,p)}});var J=$(G,2);{var re=p=>{var y=Ks();oe("click",y,()=>g(o,!1)),oe("keydown",y,N=>N.key==="Escape"&&g(o,!1)),v(p,y)};F(J,p=>{e(i)&&e(o)&&p(re)})}var Z=$(J,2),se=c(Z),le=c(se);{var W=p=>{xe(p,{variant:"icon","aria-label":"Open menu",$$events:{click:A},children:(y,N)=>{Ht(y,{size:20})},$$slots:{default:!0}})};F(le,p=>{e(i)&&p(W)})}var ce=$(le,2),O=c(ce,!0);l(ce);var w=$(ce,2);xe(w,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>g(_,!0)},children:(p,y)=>{Ba(p,{size:20})},$$slots:{default:!0}}),l(se);var k=$(se,2),V=c(k);{var T=p=>{var y=fe(),N=ve(y);Se(N,1,()=>a().messages,Ie,(M,X,j)=>{const de=pe(()=>e(n)&&j===a().messages.length-1&&e(X).role==="assistant"),be=pe(()=>j===a().messages.length-1);Is(M,{get message(){return e(X)},get isStreaming(){return e(de)},get scrollToBottom(){return e(be)}})}),v(p,y)},d=p=>{var y=Rs(),N=$(c(y),4),M=c(N),X=c(M);Dt(X,{size:16}),Ne(2),l(M);var j=$(M,2),de=c(j);Ra(de,{size:16}),Ne(2),l(j),l(N),l(y),v(p,y)};F(V,p=>{a()&&a().messages.length>0?p(T):p(d,!1)})}l(k),bt(k,p=>g(f,p),()=>e(f));var C=$(k,2),x=c(C);js(x,{get tools(){return e(h)},get disabled(){return e(u)},placeholder:"Send a message...",get value(){return e(L)},set value(p){g(L,p)},get mediaItems(){return e(z)},set mediaItems(p){g(z,p)},$$events:{submit:K,uploadFile:p=>Y(p.detail),toggleTool:P,startAudioCapture:D,stopAudioCapture:_e,startVideoCapture:S,stopVideoCapture:E},$$legacy:!0}),l(C),l(Z),l(Q);var te=$(Q,2);{var ue=p=>{var y=Vs(),N=c(y);Ds(N,{isOpen:!0,$$events:{close:()=>g(_,!1)}}),l(y),v(p,y)};F(te,p=>{e(_)&&p(ue)})}U(()=>{var p;return he(O,((p=a())==null?void 0:p.model.name)||"AI Assistant")}),v(s,R),Fe(),b()}export{ao as component};
