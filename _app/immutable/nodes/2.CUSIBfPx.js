import{a as Ut,n as Yt,b as v,c as fe,t as z,d as Xt}from"../chunks/DGLxlnBC.js";import{i as Ke}from"../chunks/fso8Beey.js";import{v as St,b as It,aD as Et,s as Ue,h as me,j as zt,a as dt,G as e,aa as pe,c as Jt,r as $t,d as Ye,g as qe,m as Qt,e as ft,f as gt,p as Pt,aE as ot,t as Ct,a7 as Zt,y as ct,aF as mt,aG as kt,aH as ht,B as ea,$ as wt,a4 as Tt,aI as ta,aJ as aa,q as sa,aK as oa,aL as qt,aM as ra,k as la,E as na,aN as ia,aO as da,N as Nt,a6 as ca,a5 as va,w as Ve,T as W,z as Re,X as M,V as c,W as n,S as ce,aP as _t,aQ as re,al as Xe,aR as Ze,aS as bt,D as u,aT as De,P as xt,aU as xe}from"../chunks/DyeNOqZH.js";import{s as he}from"../chunks/BVJrVRJT.js";import{i as B}from"../chunks/B6mDmHmM.js";import{l as ua,m as pa,o as ee,p as fa}from"../chunks/B3dKbglg.js";import{i as ga,l as be,p as oe,s as Ie,b as et}from"../chunks/C9WvkRMI.js";import{a as je,s as yt}from"../chunks/H3nJOYWQ.js";import{s as we,b as vt,C as ma,d as Ne,e as jt,c as de,f as ha,a as $e,r as Qe}from"../chunks/Cv0rH00-.js";import{i as _a,o as ba,g as ya,b as $a,l as ka,c as wa,s as ut,v as xa,u as Ma,e as Aa,f as Sa,h as Ia,j as Ea,k as za}from"../chunks/Y7cVukrA.js";import{M as rt}from"../chunks/BdzHd83Y.js";function Ae(s,t){return t}function Pa(s,t,o,b){for(var a=[],g=t.length,l=0;l<g;l++)aa(t[l].e,a,!0);var r=g>0&&a.length===0&&o!==null;if(r){var j=o.parentNode;sa(j),j.append(o),b.clear(),Te(s,t[0].prev,t[g-1].next)}oa(a,()=>{for(var p=0;p<g;p++){var d=t[p];r||(b.delete(d.k),Te(s,d.prev,d.next)),qt(d.e,!r)}})}function Se(s,t,o,b,a,g=null){var l=s,r={flags:t,items:new Map,first:null},j=(t&Et)!==0;if(j){var p=s;l=me?Ue(zt(p)):p.appendChild(St())}me&&dt();var d=null,P=!1,m=pe(()=>{var f=o();return Tt(f)?f:f==null?[]:Ct(f)});It(()=>{var f=e(m),h=f.length;if(P&&h===0)return;P=h===0;let q=!1;if(me){var I=l.data===Jt;I!==(h===0)&&(l=$t(),Ue(l),Ye(!1),q=!0)}if(me){for(var H=null,Z,U=0;U<h;U++){if(qe.nodeType===8&&qe.data===Qt){l=qe,q=!0,Ye(!1);break}var D=f[U],K=b(D,U);Z=Dt(qe,r,H,null,D,K,U,a,t,o),r.items.set(K,Z),H=Z}h>0&&Ue($t())}me||Ca(f,r,l,a,t,b,o),g!==null&&(h===0?d?ft(d):d=gt(()=>g(l)):d!==null&&Pt(d,()=>{d=null})),q&&Ye(!0),e(m)}),me&&(l=qe)}function Ca(s,t,o,b,a,g,l){var X,Y,ne,G;var r=(a&ta)!==0,j=(a&(mt|ht))!==0,p=s.length,d=t.items,P=t.first,m=P,f,h=null,q,I=[],H=[],Z,U,D,K;if(r)for(K=0;K<p;K+=1)Z=s[K],U=g(Z,K),D=d.get(U),D!==void 0&&((X=D.a)==null||X.measure(),(q??(q=new Set)).add(D));for(K=0;K<p;K+=1){if(Z=s[K],U=g(Z,K),D=d.get(U),D===void 0){var ke=m?m.e.nodes_start:o;h=Dt(ke,t,h,h===null?t.first:h.next,Z,U,K,b,a,l),d.set(U,h),I=[],H=[],m=h.next;continue}if(j&&Ta(D,Z,K,a),(D.e.f&ot)!==0&&(ft(D.e),r&&((Y=D.a)==null||Y.unfix(),(q??(q=new Set)).delete(D))),D!==m){if(f!==void 0&&f.has(D)){if(I.length<H.length){var T=H[0],O;h=T.prev;var R=I[0],Q=I[I.length-1];for(O=0;O<I.length;O+=1)Mt(I[O],T,o);for(O=0;O<H.length;O+=1)f.delete(H[O]);Te(t,R.prev,Q.next),Te(t,h,R),Te(t,Q,T),m=T,h=Q,K-=1,I=[],H=[]}else f.delete(D),Mt(D,m,o),Te(t,D.prev,D.next),Te(t,D,h===null?t.first:h.next),Te(t,h,D),h=D;continue}for(I=[],H=[];m!==null&&m.k!==U;)(m.e.f&ot)===0&&(f??(f=new Set)).add(m),H.push(m),m=m.next;if(m===null)continue;D=m}I.push(D),h=D,m=D.next}if(m!==null||f!==void 0){for(var F=f===void 0?[]:Ct(f);m!==null;)(m.e.f&ot)===0&&F.push(m),m=m.next;var V=F.length;if(V>0){var le=(a&Et)!==0&&p===0?o:null;if(r){for(K=0;K<V;K+=1)(ne=F[K].a)==null||ne.measure();for(K=0;K<V;K+=1)(G=F[K].a)==null||G.fix()}Pa(t,F,le,d)}}r&&Zt(()=>{var ie;if(q!==void 0)for(D of q)(ie=D.a)==null||ie.apply()}),ct.first=t.first&&t.first.e,ct.last=h&&h.e}function Ta(s,t,o,b){(b&mt)!==0&&kt(s.v,t),(b&ht)!==0?kt(s.i,o):s.i=o}function Dt(s,t,o,b,a,g,l,r,j,p){var d=(j&mt)!==0,P=(j&ra)===0,m=d?P?ea(a):wt(a):a,f=(j&ht)===0?l:wt(l),h={i:f,v:m,k:g,a:null,e:null,prev:o,next:b};try{return h.e=gt(()=>r(s,m,f,p),me),h.e.prev=o&&o.e,h.e.next=b&&b.e,o===null?t.first=h:(o.next=h,o.e.next=h.e),b!==null&&(b.prev=h,b.e.prev=h.e),h}finally{}}function Mt(s,t,o){for(var b=s.next?s.next.e.nodes_start:o,a=t?t.e.nodes_start:o,g=s.e.nodes_start;g!==b;){var l=la(g);a.before(g),g=l}}function Te(s,t,o){t===null?s.first=o:(t.next=o,t.e.next=o&&o.e),o!==null&&(o.prev=t,o.e.prev=t&&t.e)}function qa(s,t,o,b,a,g){let l=me;me&&dt();var r,j,p=null;me&&qe.nodeType===1&&(p=qe,dt());var d=me?qe:s,P;It(()=>{const m=t()||null;var f=ia;m!==r&&(P&&(m===null?Pt(P,()=>{P=null,j=null}):m===j?ft(P):qt(P)),m&&m!==j&&(P=gt(()=>{if(p=me?p:document.createElementNS(f,m),Ut(p,p),b){me&&ua(m)&&p.append(document.createComment(""));var h=me?zt(p):p.appendChild(St());me&&(h===null?Ye(!1):Ue(h)),b(p,h)}ct.nodes_end=p,d.before(p)})),r=m,r&&(j=r))},na),l&&(Ye(!0),Ue(d))}function We(s,t,o=t){var b=da();pa(s,"input",a=>{var g=a?s.defaultValue:s.value;if(g=lt(s)?nt(g):g,o(g),b&&g!==(g=t())){var l=s.selectionStart,r=s.selectionEnd;s.value=g??"",r!==null&&(s.selectionStart=l,s.selectionEnd=Math.min(r,s.value.length))}}),(me&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&o(lt(s)?nt(s.value):s.value),ca(()=>{var a=t();lt(s)&&a===nt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function lt(s){var t=s.type;return t==="number"||t==="range"}function nt(s){return s===""?null:+s}function pt(s,t,o){if(s.multiple)return ja(s,t);for(var b of s.options){var a=Ot(b);if(ga(a,t)){b.selected=!0;return}}(!o||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let o=!0;va(()=>{t&&pt(s,Nt(t),o),o=!1;var b=new MutationObserver(()=>{var a=s.__value;pt(s,a)});return b.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{b.disconnect()}})}function ja(s,t){for(var o of s.options)o.selected=~t.indexOf(Ot(o))}function Ot(s){return"__value"in s?s.__value:s.value}function Da(s){return function(...t){var o=t[0];o.target===this&&(s==null||s.apply(this,t))}}function At(s){return function(...t){var o=t[0];return o.stopPropagation(),s==null?void 0:s.apply(this,t)}}function it(s,t){var g;var o=(g=s.$$events)==null?void 0:g[t.type],b=Tt(o)?o.slice():o==null?[]:[o];for(var a of b)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var La=Yt("<svg><!><!></svg>");function Ee(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]),b=be(o,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let a=oe(t,"name",8,void 0),g=oe(t,"color",8,"currentColor"),l=oe(t,"size",8,24),r=oe(t,"strokeWidth",8,2),j=oe(t,"absoluteStrokeWidth",8,!1),p=oe(t,"iconNode",24,()=>[]);const d=(...q)=>q.filter((I,H,Z)=>!!I&&Z.indexOf(I)===H).join(" ");Ke();var P=La();let m;var f=c(P);Se(f,1,p,Ae,(q,I)=>{let H=()=>e(I)[0],Z=()=>e(I)[1];var U=fe(),D=ce(U);qa(D,H,!0,(K,ke)=>{let T;W(()=>T=vt(K,T,{...Z()}))}),v(q,U)});var h=M(f);we(h,t,"default",{}),n(P),W((q,I)=>m=vt(P,m,{...Oa,...b,width:l(),height:l(),stroke:g(),"stroke-width":q,class:I}),[()=>j()?Number(r())*24/Number(l()):r(),()=>d("lucide-icon","lucide",a()?`lucide-${a()}`:"",o.class)],pe),v(s,P),Re()}function Ha(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"chevron-left"},()=>o,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Ka(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"circle-arrow-up"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m16 12-4-4-4 4"}],["path",{d:"M12 16V8"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Va(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"globe"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Ra(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"image"},()=>o,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Ga(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"message-square"},()=>o,{iconNode:[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Fa(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"mic"},()=>o,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Lt(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"notebook-pen"},()=>o,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Ht(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"paperclip"},()=>o,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Ba(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"settings"},()=>o,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Wa(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"video"},()=>o,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}function Kt(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Ie({name:"x"},()=>o,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,g)=>{var l=fe(),r=ce(l);we(r,t,"default",{}),v(a,l)},$$slots:{default:!0}}))}var Ua=z('<div class="spinner svelte-1pi70xe"></div>'),Ya=z("<button><!> <!></button>");function Me(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]),b=be(o,["type","variant","size","disabled","loading","fullWidth"]);let a=oe(t,"type",8,"button"),g=oe(t,"variant",8,"primary"),l=oe(t,"size",8,"md"),r=oe(t,"disabled",8,!1),j=oe(t,"loading",8,!1),p=oe(t,"fullWidth",8,!1);var d=Ya();let P;var m=c(d);{var f=q=>{var I=Ua();v(q,I)};B(m,q=>{j()&&q(f)})}var h=M(m,2);we(h,t,"default",{}),n(d),W(q=>P=vt(d,P,{type:a(),class:`button ${g()??""} ${l()??""} ${(p()?"full-width":"")??""}`,disabled:r(),...b,[ma]:q},"svelte-1pi70xe"),[()=>({loading:j()})],pe),ee("click",d,function(q){it.call(this,t,q)}),ee("keydown",d,function(q){it.call(this,t,q)}),ee("keyup",d,function(q){it.call(this,t,q)}),v(s,d)}var Xa=z('<option class="svelte-1dlkpw5"> </option>'),Ja=z('<optgroup label="Local Models" class="svelte-1dlkpw5"></optgroup>'),Qa=z('<option class="svelte-1dlkpw5"> </option>'),Za=z('<option class="svelte-1dlkpw5"> </option>'),es=z('<option disabled class="svelte-1dlkpw5"> </option>'),ts=z('<!> <span class="svelte-1dlkpw5">New Chat</span>',1),as=z('<button type="button"><span class="chat-title svelte-1dlkpw5"> </span> <!></button>'),ss=z('<aside><div class="sidebar-header svelte-1dlkpw5"><div class="logo-container svelte-1dlkpw5"><!> <h2 class="svelte-1dlkpw5">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1dlkpw5"><div class="model-selector svelte-1dlkpw5"><select class="select-styled svelte-1dlkpw5"><!><optgroup label="OpenAI Models" class="svelte-1dlkpw5"></optgroup><optgroup label="Google Models" class="svelte-1dlkpw5"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1dlkpw5"></optgroup></select></div> <!> <div class="chats-list svelte-1dlkpw5"></div></div></aside>');function os(s,t){var ie;Ve(t,!1);const[o,b]=yt(),a=()=>je(jt,"$activeChat",o),g=()=>je(wa,"$allModelsStore",o),l=()=>je(ka,"$localModelsStore",o),r=()=>je(de,"$chatStore",o);let j=oe(t,"isMobile",8,!1),p=oe(t,"isExpanded",8,!0);const d=_t();let P=re(((ie=a())==null?void 0:ie.model.id)||"claude-3-5-sonnet");Xe(async()=>{await _a()});function m(){const L=g().find(x=>x.id===e(P));L&&de.createNewChat(L)}function f(L){de.selectChat(L),j()&&d("toggleSidebar",!1)}function h(L,x){x.stopPropagation(),de.deleteChat(L)}function q(L){const x=L.target;if(u(P,x.value),a()){const k=g().find(w=>w.id===e(P));k&&de.updateChatModel(a().id,k)}}Ze(()=>a(),()=>{a()&&u(P,a().model.id)}),bt(),Ke();var I=ss();let H;var Z=c(I),U=c(Z),D=c(U);Ga(D,{size:24,color:"var(--accent-color)"}),De(2),n(U);var K=M(U,2);{var ke=L=>{const x=pe(()=>p()?"Collapse sidebar":"Expand sidebar");Me(L,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(x)},$$events:{click:()=>d("toggleSidebar",!p())},children:(k,w)=>{Ha(k,{size:20})},$$slots:{default:!0}})};B(K,L=>{j()&&L(ke)})}n(Z);var T=M(Z,2),O=c(T),R=c(O);Na(R,()=>e(P));var Q,F=c(R);{var V=L=>{var x=Ja();Se(x,5,l,Ae,(k,w)=>{var E=Xa(),ae={},ge=c(E,!0);n(E),W(()=>{ae!==(ae=e(w).id)&&(E.value=(E.__value=e(w).id)==null?"":e(w).id),he(ge,e(w).name)}),v(k,E)}),n(x),v(L,x)};B(F,L=>{l().length>0&&L(V)})}var le=M(F);Se(le,5,()=>ba,Ae,(L,x)=>{var k=Qa(),w={},E=c(k,!0);n(k),W(()=>{w!==(w=e(x).id)&&(k.value=(k.__value=e(x).id)==null?"":e(x).id),he(E,e(x).name)}),v(L,k)}),n(le);var X=M(le);Se(X,5,()=>ya,Ae,(L,x)=>{var k=Za(),w={},E=c(k,!0);n(k),W(()=>{w!==(w=e(x).id)&&(k.value=(k.__value=e(x).id)==null?"":e(x).id),he(E,e(x).name)}),v(L,k)}),n(X);var Y=M(X);Se(Y,5,()=>$a,Ae,(L,x)=>{var k=es(),w={},E=c(k,!0);n(k),W(()=>{w!==(w=e(x).id)&&(k.value=(k.__value=e(x).id)==null?"":e(x).id),he(E,e(x).name)}),v(L,k)}),n(Y),n(R),n(O);var ne=M(O,2);Me(ne,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:m},children:(L,x)=>{var k=ts(),w=ce(k);Lt(w,{size:16}),De(2),v(L,k)},$$slots:{default:!0}});var G=M(ne,2);Se(G,5,()=>r().chats,Ae,(L,x)=>{var k=as();let w;var E=c(k),ae=c(E,!0);n(E);var ge=M(E,2);Me(ge,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:ve=>h(e(x).id,ve)},children:(ve,ye)=>{Kt(ve,{size:16})},$$slots:{default:!0}}),n(k),W(ve=>{w=Ne(k,1,"chat-item svelte-1dlkpw5",null,w,ve),he(ae,e(x).title||"New Chat")},[()=>{var ve;return{active:e(x).id===((ve=a())==null?void 0:ve.id)}}],pe),ee("click",k,()=>f(e(x).id)),v(L,k)}),n(G),n(T),n(I),W(L=>{H=Ne(I,1,"sidebar svelte-1dlkpw5",null,H,L),Q!==(Q=e(P))&&(R.value=(R.__value=e(P))==null?"":e(P),pt(R,e(P)))},[()=>({expanded:p()})],pe),ee("change",R,q),v(s,I),Re(),b()}var rs=z('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),ls=z('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),ns=z('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),is=z('<div class="file-size svelte-1mjurqb"> </div>'),ds=z('<span class="document-status success svelte-1mjurqb"> </span>'),cs=z('<span class="document-status info svelte-1mjurqb">Document attached</span>'),vs=z('<span class="document-status success svelte-1mjurqb">Document processed</span>'),us=z('<span class="document-status info svelte-1mjurqb">Document</span>'),ps=z('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),fs=z('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">📄</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),gs=z('<div class="media-container svelte-1mjurqb"></div>'),ms=z('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),hs=z('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),_s=z('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),bs=z('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ys=z('<div class="media-container assistant-media svelte-1mjurqb"></div>'),$s=z('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),ks=z('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ws=z('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),xs=z('<div class="content system-message svelte-1mjurqb"><!></div>'),Ms=z('<div class="timestamp svelte-1mjurqb"> </div>'),As=z('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">×</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),Ss=z("<div><!> <!></div> <!>",1);function Is(s,t){Ve(t,!1);const o=re(),b=re();let a=oe(t,"message",8),g=oe(t,"isStreaming",8,!1),l=oe(t,"scrollToBottom",8,!1),r=re(!1),j=re(""),p=re(""),d=re();Xe(()=>{if(l()&&e(d)){const T=e(d).parentElement;T&&(T.scrollTop=T.scrollHeight)}});function P(T,O=2){if(T===0)return"0 Bytes";const R=1024,Q=O<0?0:O,F=["Bytes","KB","MB","GB","TB"],V=Math.floor(Math.log(T)/Math.log(R));return parseFloat((T/Math.pow(R,V)).toFixed(Q))+" "+F[V]}function m(T,O="Preview image"){u(j,T),u(p,O),u(r,!0)}function f(){u(r,!1)}Ze(()=>xt(a()),()=>{u(o,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Ze(()=>xt(a()),()=>{u(b,`message ${a().role}`)}),bt(),Ke();var h=Ss(),q=ce(h),I=c(q);{var H=T=>{var O=ms(),R=c(O),Q=c(R),F=c(Q,!0);n(Q),n(R);var V=M(R,2);{var le=X=>{var Y=gs();Se(Y,5,()=>a().media,Ae,(ne,G,ie)=>{var L=fe(),x=ce(L);{var k=E=>{var ae=rs(),ge=c(ae);$e(ge,"alt",`Image ${ie+1}`),n(ae),W(()=>$e(ge,"src",e(G).preview)),ee("click",ae,()=>{e(G).preview&&m(e(G).preview,`Image ${ie+1}`)}),ee("keydown",ae,ve=>{if(ve.key==="Enter"||ve.key===" "){if(ve.preventDefault(),!e(G).preview)return;m(e(G).preview,`Image ${ie+1}`)}}),v(E,ae)},w=(E,ae)=>{{var ge=ye=>{var ze=ls();W(()=>$e(ze,"src",e(G).preview)),v(ye,ze)},ve=(ye,ze)=>{{var y=i=>{var _=ns();W(()=>$e(_,"src",e(G).preview)),v(i,_)},$=(i,_)=>{{var A=S=>{var J=fs(),se=M(c(J),2),_e=c(se),te=c(_e,!0);n(_e);var N=M(_e,2);{var C=Pe=>{var Ce=is(),Fe=c(Ce,!0);n(Ce),W(Be=>he(Fe,Be),[()=>P(e(G).size)],pe),v(Pe,Ce)};B(N,Pe=>{e(G).size&&Pe(C)})}var ue=M(N,2),Ge=c(ue);{var tt=Pe=>{var Ce=ds(),Fe=c(Ce);n(Ce),W(Be=>he(Fe,`✓ Uploaded to OpenAI (ID: ${Be??""}...)`),[()=>e(G).fileId.substring(0,8)],pe),v(Pe,Ce)},Vt=(Pe,Ce)=>{{var Fe=Oe=>{var Je=fe(),Rt=ce(Je);{var Gt=Le=>{var at=cs();v(Le,at)},Ft=(Le,at)=>{{var Bt=He=>{var st=vs();v(He,st)},Wt=He=>{var st=us();v(He,st)};B(Le,He=>{a().role==="assistant"?He(Bt):He(Wt,!1)},at)}};B(Rt,Le=>{a().role==="user"?Le(Gt):Le(Ft,!1)})}v(Oe,Je)},Be=Oe=>{var Je=ps();v(Oe,Je)};B(Pe,Oe=>{e(G).preview?Oe(Fe):Oe(Be,!1)},Ce)}};B(Ge,Pe=>{e(G).fileId?Pe(tt):Pe(Vt,!1)})}n(ue),n(se),n(J),W(()=>he(te,e(G).name||"Document")),v(S,J)};B(i,S=>{e(G).type==="document"&&S(A)},_)}};B(ye,i=>{e(G).type==="video"?i(y):i($,!1)},ze)}};B(E,ye=>{e(G).type==="audio"?ye(ge):ye(ve,!1)},ae)}};B(x,E=>{e(G).type==="image"?E(k):E(w,!1)})}v(ne,L)}),n(Y),v(X,Y)};B(V,X=>{a().media&&a().media.length>0&&X(le)})}n(O),W(()=>he(F,a().content)),v(T,O)},Z=(T,O)=>{{var R=F=>{var V=ws(),le=c(V);rt(le,{get content(){return a().content},get scrollToBottom(){return l()}});var X=M(le,2);{var Y=x=>{var k=ys();Se(k,5,()=>a().media,Ae,(w,E,ae)=>{var ge=fe(),ve=ce(ge);{var ye=y=>{var $=hs(),i=c($);$e(i,"alt",`Generated image ${ae+1}`),De(2),n($),W(()=>$e(i,"src",e(E).preview)),ee("click",$,()=>{e(E).preview&&m(e(E).preview,`Generated image ${ae+1}`)}),ee("keydown",$,_=>{if(_.key==="Enter"||_.key===" "){if(_.preventDefault(),!e(E).preview)return;m(e(E).preview,`Generated image ${ae+1}`)}}),v(y,$)},ze=(y,$)=>{{var i=A=>{var S=_s();W(()=>$e(S,"src",e(E).preview)),v(A,S)},_=(A,S)=>{{var J=se=>{var _e=bs();W(()=>$e(_e,"src",e(E).preview)),v(se,_e)};B(A,se=>{e(E).type==="video"&&se(J)},S)}};B(y,A=>{e(E).type==="audio"?A(i):A(_,!1)},$)}};B(ve,y=>{e(E).type==="image"?y(ye):y(ze,!1)})}v(w,ge)}),n(k),v(x,k)};B(X,x=>{a().media&&a().media.length>0&&x(Y)})}var ne=M(X,2);{var G=x=>{var k=$s(),w=M(c(k),2),E=c(w);rt(E,{get content(){return a().thinking},scrollToBottom:!1}),n(w),n(k),v(x,k)};B(ne,x=>{a().thinking&&x(G)})}var ie=M(ne,2);{var L=x=>{var k=ks();v(x,k)};B(ie,x=>{g()&&x(L)})}n(V),v(F,V)},Q=(F,V)=>{{var le=X=>{var Y=xs(),ne=c(Y);rt(ne,{get content(){return a().content},get scrollToBottom(){return l()}}),n(Y),v(X,Y)};B(F,X=>{a().role==="system"&&X(le)},V)}};B(T,F=>{a().role==="assistant"?F(R):F(Q,!1)},O)}};B(I,T=>{a().role==="user"?T(H):T(Z,!1)})}var U=M(I,2);{var D=T=>{var O=Ms(),R=c(O,!0);n(O),W(()=>he(R,e(o))),v(T,O)};B(U,T=>{a().role==="user"&&T(D)})}n(q),et(q,T=>u(d,T),()=>e(d));var K=M(q,2);{var ke=T=>{var O=As(),R=c(O),Q=c(R),F=M(Q,2),V=M(F,2),le=c(V,!0);n(V),n(R),n(O),W(()=>{$e(F,"src",e(j)),$e(F,"alt",e(p)),he(le,e(p))}),ee("click",Q,f),ee("click",R,At(()=>{})),ee("keydown",R,At(()=>{})),ee("click",O,f),ee("keydown",O,X=>X.key==="Escape"&&f()),v(T,O)};B(K,T=>{e(r)&&T(ke)})}W(()=>Ne(q,1,ha(e(b)),"svelte-1mjurqb")),v(s,h),Re()}var Es=z('<img class="svelte-1uk35kr">'),zs=z('<div class="file-preview svelte-1uk35kr"><span class="svelte-1uk35kr"> </span></div>'),Ps=z('<div class="media-item svelte-1uk35kr"><!> <button type="button" class="remove-media svelte-1uk35kr" aria-label="Remove media">&times;</button></div>'),Cs=z("<div><!></div>"),Ts=z("<div><!></div>"),qs=z("<div><!></div>"),Ns=z('<button type="button"> </button>'),js=z('<div class="message-input-container svelte-1uk35kr"><div class="media-preview svelte-1uk35kr"></div> <div role="region" aria-label="Message input area with file drop zone"><div class="input-container svelte-1uk35kr"><textarea rows="2" inputmode="text" enterkeyhint="done" class="svelte-1uk35kr"></textarea></div> <div class="actions-bar svelte-1uk35kr"><div class="left-actions svelte-1uk35kr"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple class="svelte-1uk35kr"> <!> <!> <!> <!></div> <div class="right-actions svelte-1uk35kr"><!></div></div></div> <div class="tools-bar svelte-1uk35kr"></div></div>');function Ds(s,t){Ve(t,!1);let o=oe(t,"value",12,""),b=oe(t,"placeholder",8,"Send a message..."),a=oe(t,"disabled",8,!1),g=oe(t,"isRecording",8,!1),l=oe(t,"isCapturingVideo",8,!1),r=oe(t,"mediaItems",28,()=>[]),j=oe(t,"tools",24,()=>({}));const p=_t();let d=re(),P=re(),m=!1,f=re(!1);Xe(()=>(h(),window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}));function h(){m=window.innerWidth<768}function q(){e(d)&&(xe(d,e(d).style.height="auto"),xe(d,e(d).style.height=`${Math.min(e(d).scrollHeight,200)}px`))}function I(){a()||!o().trim()&&r().length===0||(p("submit",{content:o().trim(),media:r(),tools:j()}),o(""),e(d)&&xe(d,e(d).style.height="auto"))}function H(i){i.key==="Enter"&&!i.shiftKey&&!m&&(i.preventDefault(),I())}function Z(){g()?p("stopAudioCapture"):p("startAudioCapture")}function U(){l()?p("stopVideoCapture"):p("startVideoCapture")}function D(i){const _=i.target;if(_.files&&_.files.length>0){const A=Array.from(_.files);p("uploadFile",A),_.value=""}}function K(i){const _=!j()[i];p("toggleTool",{tool:i,enabled:_})}function ke(i){i.preventDefault(),i.stopPropagation(),a()||u(f,!0)}function T(i){i.preventDefault(),i.stopPropagation(),a()||u(f,!0)}function O(i){i.preventDefault(),i.stopPropagation(),i.target===e(P)&&u(f,!1)}function R(i){var _;if(i.preventDefault(),i.stopPropagation(),u(f,!1),!a()&&(_=i.dataTransfer)!=null&&_.files&&i.dataTransfer.files.length>0){const A=Array.from(i.dataTransfer.files);p("uploadFile",A)}}Ze(()=>e(d),()=>{e(d)&&q()}),bt(),Ke();var Q=js(),F=c(Q);Se(F,5,r,Ae,(i,_)=>{var A=Ps(),S=c(A);{var J=te=>{var N=Es();W(()=>{$e(N,"src",e(_).preview),$e(N,"alt",e(_).name)}),v(te,N)},se=te=>{var N=zs(),C=c(N),ue=c(C,!0);n(C),n(N),W(()=>he(ue,e(_).name)),v(te,N)};B(S,te=>{e(_).type==="image"&&e(_).preview?te(J):te(se,!1)})}var _e=M(S,2);n(A),ee("click",_e,()=>{r(r().filter(te=>te.id!==e(_).id))}),v(i,A)}),n(F);var V=M(F,2);let le;var X=c(V),Y=c(X);fa(Y),et(Y,i=>u(d,i),()=>e(d)),n(X);var ne=M(X,2),G=c(ne),ie=c(G),L=M(ie,2);Me(L,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var i;return(i=document.getElementById("file-upload"))==null?void 0:i.click()}},children:(i,_)=>{Ht(i,{size:18})},$$slots:{default:!0}});var x=M(L,2);const k=pe(()=>a()||g()),w=pe(()=>g()?"Stop recording":"Start recording");Me(x,{variant:"icon",size:"sm",get disabled(){return e(k)},get"aria-label"(){return e(w)},$$events:{click:Z},children:(i,_)=>{var A=Cs();let S;var J=c(A);Fa(J,{size:18}),n(A),W(se=>S=Ne(A,1,"svelte-1uk35kr",null,S,se),[()=>({active:g()})],pe),v(i,A)},$$slots:{default:!0}});var E=M(x,2);const ae=pe(()=>a()||g()),ge=pe(()=>l()?"Stop video capture":"Start video capture");Me(E,{variant:"icon",size:"sm",get disabled(){return e(ae)},get"aria-label"(){return e(ge)},$$events:{click:U},children:(i,_)=>{var A=Ts();let S;var J=c(A);Wa(J,{size:18}),n(A),W(se=>S=Ne(A,1,"svelte-1uk35kr",null,S,se),[()=>({active:l()})],pe),v(i,A)},$$slots:{default:!0}});var ve=M(E,2);Me(ve,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>K("search")},children:(i,_)=>{var A=qs();let S;var J=c(A);Va(J,{size:18}),n(A),W(se=>S=Ne(A,1,"svelte-1uk35kr",null,S,se),[()=>({active:j().search})],pe),v(i,A)},$$slots:{default:!0}}),n(G);var ye=M(G,2),ze=c(ye);const y=pe(()=>a()||!o().trim()&&r().length===0);Me(ze,{variant:"icon",size:"sm",get disabled(){return e(y)},class:"send-button","aria-label":"Send message",$$events:{click:I},children:(i,_)=>{Ka(i,{size:20,strokeWidth:2.5})},$$slots:{default:!0}}),n(ye),n(ne),n(V),et(V,i=>u(P,i),()=>e(P));var $=M(V,2);Se($,5,()=>Object.entries(j()),Ae,(i,_)=>{let A=()=>e(_)[0],S=()=>e(_)[1];var J=fe(),se=ce(J);{var _e=te=>{var N=Ns();let C;var ue=c(N,!0);n(N),W(Ge=>{C=Ne(N,1,"tool-button svelte-1uk35kr",null,C,Ge),$e(N,"aria-label",`Toggle ${A()??""}`),he(ue,A())},[()=>({enabled:S()})],pe),ee("click",N,()=>K(A())),v(te,N)};B(se,te=>{A()!=="search"&&te(_e)})}v(i,J)}),n($),n(Q),W(i=>{le=Ne(V,1,"input-bubble svelte-1uk35kr",null,le,i),$e(Y,"placeholder",b()),Y.disabled=a()},[()=>({dragging:e(f)})],pe),We(Y,o),ee("keydown",Y,H),ee("input",Y,q),ee("change",ie,D),ee("dragenter",V,ke),ee("dragover",V,T),ee("dragleave",V,O),ee("drop",V,R),v(s,Q),Re()}var Os=z('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Ls=z('<span class="error-message svelte-8a76oy"> </span>'),Hs=z('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ks(s,t){Ve(t,!1);const[o,b]=yt(),a=()=>je(ut,"$settingsStore",o);let g=oe(t,"isOpen",8,!1);const l=_t();let r=re({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434"}),j=re(!1),p=re(!1),d=re("");Xe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const I=a().apiKeys||{};console.log("Stored API keys from settings store:",I),u(r,{anthropic:I.anthropic||"",openai:I.openai||"",google:I.google||"",ollamaHost:I.ollamaHost||"http://localhost:11434"}),console.log("Initialized API key form with:",e(r))});function P(){l("close")}async function m(){var I;u(j,!0),u(p,!1),u(d,"");try{console.log("Saving API keys to settingsStore:",e(r)),e(r).google&&(console.log("EXACT GOOGLE KEY BEING SAVED: ",e(r).google),console.log(`Google key before saving: length=${e(r).google.length}, starts with=${e(r).google.substring(0,4)}`)),await ut.updateApiKeys({anthropic:e(r).anthropic,openai:e(r).openai,google:e(r).google,ollamaHost:e(r).ollamaHost||"http://localhost:11434"}),console.log("API keys saved. Current settingsStore value:",a());try{const H={...a(),apiKeys:{...a().apiKeys}};localStorage.setItem("gervais-api-backup",JSON.stringify(H)),console.log("API keys also backed up to localStorage")}catch(H){console.error("Failed to backup API keys to localStorage:",H)}(I=a().apiKeys)!=null&&I.google&&(console.log("EXACT GOOGLE KEY AFTER SAVING: ",a().apiKeys.google),console.log(`Google key after saving: length=${a().apiKeys.google.length}, starts with=${a().apiKeys.google.substring(0,4)}`)),u(p,!0),console.log("API keys saved successfully"),setTimeout(()=>{u(p,!1)},3e3)}catch(H){console.error("Failed to save API keys:",H),u(d,H instanceof Error?H.message:"Unknown error"),u(j,!1)}finally{u(j,!1)}}Ke();var f=fe(),h=ce(f);{var q=I=>{var H=Hs(),Z=c(H),U=c(Z),D=M(c(U),2);Me(D,{variant:"icon","aria-label":"Close settings",$$events:{click:P},children:(w,E)=>{Kt(w,{size:20})},$$slots:{default:!0}}),n(U);var K=M(U,2),ke=c(K),T=M(c(ke),4),O=c(T),R=M(c(O),2);Qe(R),n(O);var Q=M(O,2),F=M(c(Q),2);Qe(F),n(Q);var V=M(Q,2),le=M(c(V),2);Qe(le),n(V);var X=M(V,2),Y=M(c(X),2);Qe(Y),De(2),n(X),n(T);var ne=M(T,2),G=c(ne);Me(G,{variant:"primary",get disabled(){return e(j)},$$events:{click:m},children:(w,E)=>{De();var ae=Xt();W(()=>he(ae,e(j)?"Saving...":"Save API Keys")),v(w,ae)},$$slots:{default:!0}});var ie=M(G,2);{var L=w=>{var E=Os();v(w,E)};B(ie,w=>{e(p)&&w(L)})}var x=M(ie,2);{var k=w=>{var E=Ls(),ae=c(E,!0);n(E),W(()=>he(ae,e(d))),v(w,E)};B(x,w=>{e(d)&&w(k)})}n(ne),n(ke),n(K),n(Z),n(H),We(R,()=>e(r).anthropic,w=>xe(r,e(r).anthropic=w)),We(F,()=>e(r).openai,w=>xe(r,e(r).openai=w)),We(le,()=>e(r).google,w=>xe(r,e(r).google=w)),We(Y,()=>e(r).ollamaHost,w=>xe(r,e(r).ollamaHost=w)),ee("click",H,Da(P)),ee("keydown",H,w=>w.key==="Escape"&&P()),v(I,H)};B(h,I=>{g()&&I(q)})}v(s,f),Re(),b()}var Vs=z('<div class="sidebar-backdrop svelte-1b4tzcm" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=z('<div class="empty-state svelte-1b4tzcm"><h2 class="svelte-1b4tzcm">Start a new conversation</h2> <p class="svelte-1b4tzcm">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1b4tzcm"><div class="feature svelte-1b4tzcm"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1b4tzcm"><!> <span>Vision support for images</span></div></div></div>'),Gs=z('<div class="settings-portal svelte-1b4tzcm"><!></div>'),Fs=z('<div class="chat-container svelte-1b4tzcm"><!> <!> <main class="chat-main svelte-1b4tzcm"><header class="chat-header svelte-1b4tzcm"><!> <h1 class="chat-title svelte-1b4tzcm"> </h1> <!></header> <div class="chat-messages svelte-1b4tzcm"><!></div> <div class="input-container svelte-1b4tzcm"><!></div></main></div> <!>',1);function so(s,t){Ve(t,!1);const[o,b]=yt(),a=()=>je(jt,"$activeChat",o),g=()=>je(ut,"$settingsStore",o);let l=re(!1),r=re(!0),j=re(""),p=re(!1),d=re(!1),P=re([]),m=re({search:!1}),f=re(),h=re(!1);function q(){u(l,window.innerWidth<768),e(l)?u(r,!1):u(r,!0)}Xe(()=>{q(),window.addEventListener("resize",q);function y(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`)}return y(),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",q),window.removeEventListener("resize",y)}});function I(){u(r,!e(r))}async function H({detail:y}){var J,se,_e;if(!a())return;const $=a().model.provider;if(console.log("Current settings store state:",g()),$==="openai"&&!((J=g().apiKeys)!=null&&J.openai)){console.warn("OpenAI API key not set, opening settings dialog"),u(h,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if($==="anthropic"&&!((se=g().apiKeys)!=null&&se.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),u(h,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if($==="google"&&!((_e=g().apiKeys)!=null&&_e.google)){console.warn("Google API key not set, opening settings dialog"),u(h,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:i,media:_,tools:A}=y;console.log("Media items in submission:",_),await de.addMessage(a().id,{role:"user",content:i,media:_}),u(j,""),u(P,[]),setTimeout(()=>{e(f)&&xe(f,e(f).scrollTop=e(f).scrollHeight)},100);const S=await de.addMessage(a().id,{role:"assistant",content:""});u(p,!0),u(d,!0);try{const te=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",te);const N=a().model.id;if($==="anthropic")await Aa(N,te,C=>{de.updateMessage(a().id,S,{content:C})},()=>{u(p,!1),u(d,!1),setTimeout(()=>{e(f)&&xe(f,e(f).scrollTop=e(f).scrollHeight)},100)},C=>{console.error("Error generating response:",C),de.updateMessage(a().id,S,{content:`Error generating response: – ${C.message}`}),u(p,!1),u(d,!1)},C=>{de.updateMessage(a().id,S,{thinking:C})});else if($==="openai")if(e(d))await Sa(N,te,C=>{de.updateMessage(a().id,S,{content:C})},()=>{u(p,!1),u(d,!1),setTimeout(()=>{e(f)&&xe(f,e(f).scrollTop=e(f).scrollHeight)},100)},C=>{console.error("Error generating response from OpenAI:",C);const ue=C.message||"An unknown error occurred";de.updateMessage(a().id,S,{content:`Error: ${ue}`}),u(p,!1),u(d,!1)});else try{const C=await Ia(N,te);de.updateMessage(a().id,S,{content:C}),u(p,!1)}catch(C){console.error("Error generating non-streaming response from OpenAI:",C);const ue=C.message||"An unknown error occurred";throw de.updateMessage(a().id,S,{content:`Error: ${ue}`}),u(p,!1),C}else if($==="google")await Ea(N,te,(C,ue)=>{de.updateMessage(a().id,S,{content:C,media:ue})},()=>{u(p,!1),u(d,!1),setTimeout(()=>{e(f)&&xe(f,e(f).scrollTop=e(f).scrollHeight)},100)},C=>{console.error("Error generating response from Google:",C);const ue=C.message||"An unknown error occurred";de.updateMessage(a().id,S,{content:`Error: ${ue}`}),u(p,!1),u(d,!1)},C=>{de.updateMessage(a().id,S,{thinking:C})});else if($==="ollama")try{await za(N,te,C=>{de.updateMessage(a().id,S,{content:C})},()=>{u(p,!1),u(d,!1),setTimeout(()=>{e(f)&&xe(f,e(f).scrollTop=e(f).scrollHeight)},100)},C=>{console.error("Error generating response from Ollama:",C);const ue=C.message||"An unknown error occurred";de.updateMessage(a().id,S,{content:`Error connecting to Ollama: ${ue}. Make sure Ollama is running locally.`}),u(p,!1),u(d,!1)})}catch(C){throw console.error("Error generating response from Ollama:",C),C}else{let C="";const ue="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ge of ue)await new Promise(tt=>setTimeout(tt,50)),C+=Ge+" ",de.updateMessage(a().id,S,{content:C.trim()});u(p,!1),u(d,!1)}}catch(te){if(console.error("Error generating response:",te),e(p)){const N=te.message||"An unknown error occurred";de.updateMessage(a().id,S,{content:`Error: ${N}`}),u(p,!1),u(d,!1)}}}function Z(y){y.forEach(async $=>{const i=xa(),_=$.name,A=$.size;let S="other",J,se;console.log(`Processing file: ${_}, type: ${$.type}, size: ${A} bytes`);const _e=N=>{var C;if(N.type.includes("pdf")||N.type.includes("word")||N.type.includes("excel")||N.type.includes("spreadsheet")||N.type.includes("presentation")||N.type.includes("officedocument")||N.type.includes("application/rtf")||N.type.includes("text/rtf"))return!0;if(!N.type||N.type==="application/octet-stream"){const ue=(C=_.split(".").pop())==null?void 0:C.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ue||"")}return!1};if($.type.startsWith("image/")){S="image";try{J=await U($),console.log(`Created data URL for image ${_} (length: ${J.length} chars)`)}catch(N){console.error(`Failed to create data URL for ${_}:`,N)}}else if($.type.startsWith("audio/"))S="audio";else if($.type.startsWith("video/"))S="video";else if($.type.startsWith("text/"))S="text";else if(_e($)){if(S="document",a()&&a().model.provider==="openai")try{se=await Ma($),console.log(`Document ${_} uploaded to OpenAI with ID: ${se}`)}catch(N){console.error(`Failed to upload document to OpenAI: ${N.message}`),alert(`Failed to upload document to OpenAI: ${N.message}`)}try{J=await U($),console.log(`Created data URL for document ${_}, mime type: ${$.type}`),console.log(`Document data URL length: ${J.length} chars`),A>5*1024*1024&&console.warn(`Warning: Large document (${(A/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(N){console.error(`Failed to create data URL for ${_}:`,N)}}const te={id:i,type:S,name:_,preview:J,size:A,timestamp:Date.now(),fileId:se};console.log(`Adding media item: ${S} ${_}`),u(P,[...e(P),te])})}async function U(y){return new Promise(($,i)=>{const _=new FileReader;_.onload=()=>{const A=_.result;$(A)},_.onerror=A=>{console.error("Error reading file:",A),i(A)},_.readAsDataURL(y)})}function D({detail:y}){const{tool:$,enabled:i}=y;u(m,{...e(m),[$]:i})}function K(){console.log("Start audio capture")}function ke(){console.log("Stop audio capture")}function T(){console.log("Start video capture")}function O(){console.log("Stop video capture")}Ke();var R=Fs(),Q=ce(R),F=c(Q);os(F,{get isMobile(){return e(l)},get isExpanded(){return e(r)},$$events:{toggleSidebar:({detail:y})=>u(r,y)}});var V=M(F,2);{var le=y=>{var $=Vs();ee("click",$,()=>u(r,!1)),ee("keydown",$,i=>i.key==="Escape"&&u(r,!1)),v(y,$)};B(V,y=>{e(l)&&e(r)&&y(le)})}var X=M(V,2),Y=c(X),ne=c(Y);{var G=y=>{Me(y,{variant:"icon","aria-label":"Open menu",$$events:{click:I},children:($,i)=>{Lt($,{size:20})},$$slots:{default:!0}})};B(ne,y=>{e(l)&&y(G)})}var ie=M(ne,2),L=c(ie,!0);n(ie);var x=M(ie,2);Me(x,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>u(h,!0)},children:(y,$)=>{Ba(y,{size:20})},$$slots:{default:!0}}),n(Y);var k=M(Y,2),w=c(k);{var E=y=>{var $=fe(),i=ce($);Se(i,1,()=>a().messages,Ae,(_,A,S)=>{const J=pe(()=>e(d)&&S===a().messages.length-1&&e(A).role==="assistant"),se=pe(()=>S===a().messages.length-1);Is(_,{get message(){return e(A)},get isStreaming(){return e(J)},get scrollToBottom(){return e(se)}})}),v(y,$)},ae=y=>{var $=Rs(),i=M(c($),4),_=c(i),A=c(_);Ht(A,{size:16}),De(2),n(_);var S=M(_,2),J=c(S);Ra(J,{size:16}),De(2),n(S),n(i),n($),v(y,$)};B(w,y=>{a()&&a().messages.length>0?y(E):y(ae,!1)})}n(k),et(k,y=>u(f,y),()=>e(f));var ge=M(k,2),ve=c(ge);Ds(ve,{get tools(){return e(m)},get disabled(){return e(p)},placeholder:"Send a message...",get value(){return e(j)},set value(y){u(j,y)},get mediaItems(){return e(P)},set mediaItems(y){u(P,y)},$$events:{submit:H,uploadFile:y=>Z(y.detail),toggleTool:D,startAudioCapture:K,stopAudioCapture:ke,startVideoCapture:T,stopVideoCapture:O},$$legacy:!0}),n(ge),n(X),n(Q);var ye=M(Q,2);{var ze=y=>{var $=Gs(),i=c($);Ks(i,{isOpen:!0,$$events:{close:()=>u(h,!1)}}),n($),v(y,$)};B(ye,y=>{e(h)&&y(ze)})}W(()=>{var y;return he(L,((y=a())==null?void 0:y.model.name)||"AI Assistant")}),v(s,R),Re(),b()}export{so as component};
