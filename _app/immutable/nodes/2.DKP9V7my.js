import{a as Wt,n as Ut,b as m,c as ye,t as x,d as Yt}from"../chunks/CD-cSNpP.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as Mt,b as It,s as Ue,h as pe,j as St,a as it,G as e,aa as ve,c as Xt,r as $t,d as Ye,g as Te,m as Jt,e as pt,f as ft,p as Et,aD as st,t as Ct,a7 as Qt,y as ct,aE as mt,aF as wt,aG as gt,B as Zt,$ as kt,aH as qt,a4 as Pt,aI as ea,aJ as ta,q as aa,aK as sa,aL as zt,aM as oa,k as ra,E as la,aN as na,aO as ia,N as Tt,a6 as ca,a5 as va,w as Fe,V as u,X as $,T as V,z as Ve,W as i,S as de,aP as ht,aQ as le,al as Qe,aR as Je,aS as _t,D as h,aT as Ne,P as xt,aU as $e}from"../chunks/BSv_i5Hy.js";import{s as fe}from"../chunks/XUjQEjo_.js";import{i as F}from"../chunks/Cec3cEQU.js";import{l as da,m as ua,o as ne,p as pa}from"../chunks/Bl1F-iLh.js";import{i as fa,l as we,p as ae,s as qe,b as yt}from"../chunks/DYD2hZ7I.js";import{a as je,s as bt}from"../chunks/HG7v26tk.js";import{s as Ie,b as vt,C as ma,d as Ke,a as ge,e as Nt,c as re,f as ga,r as We}from"../chunks/uxZwVYDM.js";import{i as ha,o as _a,g as ya,b as ba,l as $a,c as wa,s as dt,v as ka,u as xa,e as Aa,f as Ma,h as Ia,j as Sa,k as Ea}from"../chunks/BFkVdgW4.js";import{M as ot}from"../chunks/CoxQhQk-.js";function xe(s,t){return t}function Ca(s,t,r,b){for(var a=[],_=t.length,o=0;o<_;o++)ta(t[o].e,a,!0);var c=_>0&&a.length===0&&r!==null;if(c){var N=r.parentNode;aa(N),N.append(r),b.clear(),ze(s,t[0].prev,t[_-1].next)}sa(a,()=>{for(var p=0;p<_;p++){var v=t[p];c||(b.delete(v.k),ze(s,v.prev,v.next)),zt(v.e,!c)}})}function Ae(s,t,r,b,a,_=null){var o=s,c={flags:t,items:new Map,first:null},N=(t&qt)!==0;if(N){var p=s;o=pe?Ue(St(p)):p.appendChild(Mt())}pe&&it();var v=null,E=!1,f=ve(()=>{var g=r();return Pt(g)?g:g==null?[]:Ct(g)});It(()=>{var g=e(f),y=g.length;if(E&&y===0)return;E=y===0;let P=!1;if(pe){var j=o.data===Xt;j!==(y===0)&&(o=$t(),Ue(o),Ye(!1),P=!0)}if(pe){for(var Y=null,B,D=0;D<y;D++){if(Te.nodeType===8&&Te.data===Jt){o=Te,P=!0,Ye(!1);break}var I=g[D],S=b(I,D);B=jt(Te,c,Y,null,I,S,D,a,t,r),c.items.set(S,B),Y=B}y>0&&Ue($t())}pe||qa(g,c,o,a,t,b,r),_!==null&&(y===0?v?pt(v):v=ft(()=>_(o)):v!==null&&Et(v,()=>{v=null})),P&&Ye(!0),e(f)}),pe&&(o=Te)}function qa(s,t,r,b,a,_,o){var X,ee,ie,K;var c=(a&ea)!==0,N=(a&(mt|gt))!==0,p=s.length,v=t.items,E=t.first,f=E,g,y=null,P,j=[],Y=[],B,D,I,S;if(c)for(S=0;S<p;S+=1)B=s[S],D=_(B,S),I=v.get(D),I!==void 0&&((X=I.a)==null||X.measure(),(P??(P=new Set)).add(I));for(S=0;S<p;S+=1){if(B=s[S],D=_(B,S),I=v.get(D),I===void 0){var he=f?f.e.nodes_start:r;y=jt(he,t,y,y===null?t.first:y.next,B,D,S,b,a,o),v.set(D,y),j=[],Y=[],f=y.next;continue}if(N&&Pa(I,B,S,a),(I.e.f&st)!==0&&(pt(I.e),c&&((ee=I.a)==null||ee.unfix(),(P??(P=new Set)).delete(I))),I!==f){if(g!==void 0&&g.has(I)){if(j.length<Y.length){var A=Y[0],z;y=A.prev;var H=j[0],Q=j[j.length-1];for(z=0;z<j.length;z+=1)At(j[z],A,r);for(z=0;z<Y.length;z+=1)g.delete(Y[z]);ze(t,H.prev,Q.next),ze(t,y,H),ze(t,Q,A),f=A,y=Q,S-=1,j=[],Y=[]}else g.delete(I),At(I,f,r),ze(t,I.prev,I.next),ze(t,I,y===null?t.first:y.next),ze(t,y,I),y=I;continue}for(j=[],Y=[];f!==null&&f.k!==D;)(f.e.f&st)===0&&(g??(g=new Set)).add(f),Y.push(f),f=f.next;if(f===null)continue;I=f}j.push(I),y=I,f=I.next}if(f!==null||g!==void 0){for(var R=g===void 0?[]:Ct(g);f!==null;)(f.e.f&st)===0&&R.push(f),f=f.next;var W=R.length;if(W>0){var oe=(a&qt)!==0&&p===0?r:null;if(c){for(S=0;S<W;S+=1)(ie=R[S].a)==null||ie.measure();for(S=0;S<W;S+=1)(K=R[S].a)==null||K.fix()}Ca(t,R,oe,v)}}c&&Qt(()=>{var C;if(P!==void 0)for(I of P)(C=I.a)==null||C.apply()}),ct.first=t.first&&t.first.e,ct.last=y&&y.e}function Pa(s,t,r,b){(b&mt)!==0&&wt(s.v,t),(b&gt)!==0?wt(s.i,r):s.i=r}function jt(s,t,r,b,a,_,o,c,N,p){var v=(N&mt)!==0,E=(N&oa)===0,f=v?E?Zt(a):kt(a):a,g=(N&gt)===0?o:kt(o),y={i:g,v:f,k:_,a:null,e:null,prev:r,next:b};try{return y.e=ft(()=>c(s,f,g,p),pe),y.e.prev=r&&r.e,y.e.next=b&&b.e,r===null?t.first=y:(r.next=y,r.e.next=y.e),b!==null&&(b.prev=y,b.e.prev=y.e),y}finally{}}function At(s,t,r){for(var b=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,_=s.e.nodes_start;_!==b;){var o=ra(_);a.before(_),_=o}}function ze(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function za(s,t,r,b,a,_){let o=pe;pe&&it();var c,N,p=null;pe&&Te.nodeType===1&&(p=Te,it());var v=pe?Te:s,E;It(()=>{const f=t()||null;var g=na;f!==c&&(E&&(f===null?Et(E,()=>{E=null,N=null}):f===N?pt(E):zt(E)),f&&f!==N&&(E=ft(()=>{if(p=pe?p:document.createElementNS(g,f),Wt(p,p),b){pe&&da(f)&&p.append(document.createComment(""));var y=pe?St(p):p.appendChild(Mt());pe&&(y===null?Ye(!1):Ue(y)),b(p,y)}ct.nodes_end=p,v.before(p)})),c=f,c&&(N=c))},la),o&&(Ye(!0),Ue(v))}function De(s,t,r=t){var b=ia();ua(s,"input",a=>{var _=a?s.defaultValue:s.value;if(_=rt(s)?lt(_):_,r(_),b&&_!==(_=t())){var o=s.selectionStart,c=s.selectionEnd;s.value=_??"",c!==null&&(s.selectionStart=o,s.selectionEnd=Math.min(c,s.value.length))}}),(pe&&s.defaultValue!==s.value||Tt(t)==null&&s.value)&&r(rt(s)?lt(s.value):s.value),ca(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,r){if(s.multiple)return Na(s,t);for(var b of s.options){var a=Lt(b);if(fa(a,t)){b.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function Ta(s,t){let r=!0;va(()=>{t&&ut(s,Tt(t),r),r=!1;var b=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return b.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{b.disconnect()}})}function Na(s,t){for(var r of s.options)r.selected=~t.indexOf(Lt(r))}function Lt(s){return"__value"in s?s.__value:s.value}function ja(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function La(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function nt(s,t){var _;var r=(_=s.$$events)==null?void 0:_[t.type],b=Pt(r)?r.slice():r==null?[]:[r];for(var a of b)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Ha={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Oa=Ut("<svg><!><!></svg>");function Pe(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]),b=we(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Fe(t,!1);let a=ae(t,"name",8,void 0),_=ae(t,"color",8,"currentColor"),o=ae(t,"size",8,24),c=ae(t,"strokeWidth",8,2),N=ae(t,"absoluteStrokeWidth",8,!1),p=ae(t,"iconNode",24,()=>[]);const v=(...P)=>P.filter((j,Y,B)=>!!j&&B.indexOf(j)===Y).join(" ");Re();var E=Oa();let f;var g=u(E);Ae(g,1,p,xe,(P,j)=>{let Y=()=>e(j)[0],B=()=>e(j)[1];var D=ye(),I=de(D);za(I,Y,!0,(S,he)=>{let A;V(()=>A=vt(S,A,{...B()}))}),m(P,D)});var y=$(g);Ie(y,t,"default",{}),i(E),V((P,j)=>f=vt(E,f,{...Ha,...b,width:o(),height:o(),stroke:_(),"stroke-width":P,class:j}),[()=>N()?Number(c())*24/Number(o()):c(),()=>v("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],ve),m(s,E),Ve()}function Da(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"camera"},()=>r,{iconNode:[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Ka(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Ra(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Fa(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Ht(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"notebook-pen"},()=>r,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Ot(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Va(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"send"},()=>r,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Ba(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}function Dt(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,_)=>{var o=ye(),c=de(o);Ie(c,t,"default",{}),m(a,o)},$$slots:{default:!0}}))}var Ga=x('<div class="spinner svelte-1pi70xe"></div>'),Wa=x("<button><!> <!></button>");function Me(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]),b=we(r,["type","variant","size","disabled","loading","fullWidth"]);let a=ae(t,"type",8,"button"),_=ae(t,"variant",8,"primary"),o=ae(t,"size",8,"md"),c=ae(t,"disabled",8,!1),N=ae(t,"loading",8,!1),p=ae(t,"fullWidth",8,!1);var v=Wa();let E;var f=u(v);{var g=P=>{var j=Ga();m(P,j)};F(f,P=>{N()&&P(g)})}var y=$(f,2);Ie(y,t,"default",{}),i(v),V(P=>E=vt(v,E,{type:a(),class:`button ${_()??""} ${o()??""} ${(p()?"full-width":"")??""}`,disabled:c(),...b,[ma]:P},"svelte-1pi70xe"),[()=>({loading:N()})],ve),ne("click",v,function(P){nt.call(this,t,P)}),ne("keydown",v,function(P){nt.call(this,t,P)}),ne("keyup",v,function(P){nt.call(this,t,P)}),m(s,v)}var Ua=x('<option class="svelte-1m60q0l"> </option>'),Ya=x('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Xa=x('<option class="svelte-1m60q0l"> </option>'),Ja=x('<option class="svelte-1m60q0l"> </option>'),Qa=x('<option disabled class="svelte-1m60q0l"> </option>'),Za=x('<!> <span class="svelte-1m60q0l">New Chat</span>',1),es=x('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),ts=x('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function as(s,t){var C;Fe(t,!1);const[r,b]=bt(),a=()=>je(Nt,"$activeChat",r),_=()=>je(wa,"$allModelsStore",r),o=()=>je($a,"$localModelsStore",r),c=()=>je(re,"$chatStore",r);let N=ae(t,"isMobile",8,!1),p=ae(t,"isExpanded",8,!0);const v=ht();let E=le(((C=a())==null?void 0:C.model.id)||"claude-3-5-sonnet");Qe(async()=>{await ha()});function f(){const l=_().find(n=>n.id===e(E));l&&re.createNewChat(l)}function g(l){re.selectChat(l),N()&&v("toggleSidebar",!1)}function y(l,n){n.stopPropagation(),re.deleteChat(l)}function P(l){const n=l.target;if(h(E,n.value),a()){const d=_().find(q=>q.id===e(E));d&&re.updateChatModel(a().id,d)}}Je(()=>a(),()=>{a()&&h(E,a().model.id)}),_t(),Re();var j=ts();let Y;var B=u(j),D=u(B),I=u(D);Ne(2),i(D);var S=$(D,2);{var he=l=>{const n=ve(()=>p()?"Collapse sidebar":"Expand sidebar");Me(l,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(n)},$$events:{click:()=>v("toggleSidebar",!p())},children:(d,q)=>{Ka(d,{size:20})},$$slots:{default:!0}})};F(S,l=>{N()&&l(he)})}i(B);var A=$(B,2),z=u(A),H=u(z);Ta(H,()=>e(E));var Q,R=u(H);{var W=l=>{var n=Ya();Ae(n,5,o,xe,(d,q)=>{var M=Ua(),se={},Z=u(M,!0);i(M),V(()=>{se!==(se=e(q).id)&&(M.value=(M.__value=e(q).id)==null?"":e(q).id),fe(Z,e(q).name)}),m(d,M)}),i(n),m(l,n)};F(R,l=>{o().length>0&&l(W)})}var oe=$(R);Ae(oe,5,()=>_a,xe,(l,n)=>{var d=Xa(),q={},M=u(d,!0);i(d),V(()=>{q!==(q=e(n).id)&&(d.value=(d.__value=e(n).id)==null?"":e(n).id),fe(M,e(n).name)}),m(l,d)}),i(oe);var X=$(oe);Ae(X,5,()=>ya,xe,(l,n)=>{var d=Ja(),q={},M=u(d,!0);i(d),V(()=>{q!==(q=e(n).id)&&(d.value=(d.__value=e(n).id)==null?"":e(n).id),fe(M,e(n).name)}),m(l,d)}),i(X);var ee=$(X);Ae(ee,5,()=>ba,xe,(l,n)=>{var d=Qa(),q={},M=u(d,!0);i(d),V(()=>{q!==(q=e(n).id)&&(d.value=(d.__value=e(n).id)==null?"":e(n).id),fe(M,e(n).name)}),m(l,d)}),i(ee),i(H),i(z);var ie=$(z,2);Me(ie,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:f},children:(l,n)=>{var d=Za(),q=de(d);Ht(q,{size:16}),Ne(2),m(l,d)},$$slots:{default:!0}});var K=$(ie,2);Ae(K,5,()=>c().chats,xe,(l,n)=>{var d=es();let q;var M=u(d),se=u(M,!0);i(M);var Z=$(M,2);Me(Z,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:J=>y(e(n).id,J)},children:(J,_e)=>{Dt(J,{size:16})},$$slots:{default:!0}}),i(d),V(J=>{q=Ke(d,1,"chat-item svelte-1m60q0l",null,q,J),fe(se,e(n).title||"New Chat")},[()=>{var J;return{active:e(n).id===((J=a())==null?void 0:J.id)}}],ve),ne("click",d,()=>g(e(n).id)),m(l,d)}),i(K),i(A),i(j),V(l=>{Y=Ke(j,1,"sidebar svelte-1m60q0l",null,Y,l),ge(I,"src","/gervais/logo.svg"),Q!==(Q=e(E))&&(H.value=(H.__value=e(E))==null?"":e(E),ut(H,e(E)))},[()=>({expanded:p()})],ve),ne("change",H,P),m(s,j),Ve(),b()}var ss=x('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),os=x('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),rs=x('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ls=x('<div class="file-size svelte-1mjurqb"> </div>'),ns=x('<span class="document-status success svelte-1mjurqb"> </span>'),is=x('<span class="document-status info svelte-1mjurqb">Document attached</span>'),cs=x('<span class="document-status success svelte-1mjurqb">Document processed</span>'),vs=x('<span class="document-status info svelte-1mjurqb">Document</span>'),ds=x('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),us=x('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">📄</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),ps=x('<div class="media-container svelte-1mjurqb"></div>'),fs=x('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),ms=x('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),gs=x('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),hs=x('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),_s=x('<div class="media-container assistant-media svelte-1mjurqb"></div>'),ys=x('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),bs=x('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),$s=x('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ws=x('<div class="content system-message svelte-1mjurqb"><!></div>'),ks=x('<div class="timestamp svelte-1mjurqb"> </div>'),xs=x('<div class="image-modal-overlay svelte-1mjurqb" role="button" tabindex="0"><div class="image-modal-content svelte-1mjurqb"><button class="close-modal svelte-1mjurqb">×</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),As=x("<div><!> <!></div> <!>",1);function Ms(s,t){Fe(t,!1);const r=le(),b=le();let a=ae(t,"message",8),_=ae(t,"isStreaming",8,!1),o=ae(t,"scrollToBottom",8,!1),c=le(!1),N=le(""),p=le(""),v=le();Qe(()=>{if(o()&&e(v)){const A=e(v).parentElement;A&&(A.scrollTop=A.scrollHeight)}});function E(A,z=2){if(A===0)return"0 Bytes";const H=1024,Q=z<0?0:z,R=["Bytes","KB","MB","GB","TB"],W=Math.floor(Math.log(A)/Math.log(H));return parseFloat((A/Math.pow(H,W)).toFixed(Q))+" "+R[W]}function f(A,z="Preview image"){h(N,A),h(p,z),h(c,!0)}function g(){h(c,!1)}Je(()=>xt(a()),()=>{h(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Je(()=>xt(a()),()=>{h(b,`message ${a().role}`)}),_t(),Re();var y=As(),P=de(y),j=u(P);{var Y=A=>{var z=fs(),H=u(z),Q=u(H),R=u(Q,!0);i(Q),i(H);var W=$(H,2);{var oe=X=>{var ee=ps();Ae(ee,5,()=>a().media,xe,(ie,K,C)=>{var l=ye(),n=de(l);{var d=M=>{var se=ss(),Z=u(se);ge(Z,"alt",`Image ${C+1}`),i(se),V(()=>ge(Z,"src",e(K).preview)),ne("click",se,()=>{e(K).preview&&f(e(K).preview,`Image ${C+1}`)}),ne("keydown",se,J=>{if(J.key==="Enter"||J.key===" "){if(J.preventDefault(),!e(K).preview)return;f(e(K).preview,`Image ${C+1}`)}}),m(M,se)},q=(M,se)=>{{var Z=_e=>{var Se=os();V(()=>ge(Se,"src",e(K).preview)),m(_e,Se)},J=(_e,Se)=>{{var k=G=>{var O=rs();V(()=>ge(O,"src",e(K).preview)),m(G,O)},w=(G,O)=>{{var te=L=>{var ce=us(),me=$(u(ce),2),ke=u(me),be=u(ke,!0);i(ke);var U=$(ke,2);{var T=Ee=>{var Ce=ls(),Be=u(Ce,!0);i(Ce),V(Ge=>fe(Be,Ge),[()=>E(e(K).size)],ve),m(Ee,Ce)};F(U,Ee=>{e(K).size&&Ee(T)})}var ue=$(U,2),Ze=u(ue);{var et=Ee=>{var Ce=ns(),Be=u(Ce);i(Ce),V(Ge=>fe(Be,`✓ Uploaded to OpenAI (ID: ${Ge??""}...)`),[()=>e(K).fileId.substring(0,8)],ve),m(Ee,Ce)},Kt=(Ee,Ce)=>{{var Be=Le=>{var Xe=ye(),Rt=de(Xe);{var Ft=He=>{var tt=is();m(He,tt)},Vt=(He,tt)=>{{var Bt=Oe=>{var at=cs();m(Oe,at)},Gt=Oe=>{var at=vs();m(Oe,at)};F(He,Oe=>{a().role==="assistant"?Oe(Bt):Oe(Gt,!1)},tt)}};F(Rt,He=>{a().role==="user"?He(Ft):He(Vt,!1)})}m(Le,Xe)},Ge=Le=>{var Xe=ds();m(Le,Xe)};F(Ee,Le=>{e(K).preview?Le(Be):Le(Ge,!1)},Ce)}};F(Ze,Ee=>{e(K).fileId?Ee(et):Ee(Kt,!1)})}i(ue),i(me),i(ce),V(()=>fe(be,e(K).name||"Document")),m(L,ce)};F(G,L=>{e(K).type==="document"&&L(te)},O)}};F(_e,G=>{e(K).type==="video"?G(k):G(w,!1)},Se)}};F(M,_e=>{e(K).type==="audio"?_e(Z):_e(J,!1)},se)}};F(n,M=>{e(K).type==="image"?M(d):M(q,!1)})}m(ie,l)}),i(ee),m(X,ee)};F(W,X=>{a().media&&a().media.length>0&&X(oe)})}i(z),V(()=>fe(R,a().content)),m(A,z)},B=(A,z)=>{{var H=R=>{var W=$s(),oe=u(W);ot(oe,{get content(){return a().content},get scrollToBottom(){return o()}});var X=$(oe,2);{var ee=n=>{var d=_s();Ae(d,5,()=>a().media,xe,(q,M,se)=>{var Z=ye(),J=de(Z);{var _e=k=>{var w=ms(),G=u(w);ge(G,"alt",`Generated image ${se+1}`),Ne(2),i(w),V(()=>ge(G,"src",e(M).preview)),ne("click",w,()=>{e(M).preview&&f(e(M).preview,`Generated image ${se+1}`)}),ne("keydown",w,O=>{if(O.key==="Enter"||O.key===" "){if(O.preventDefault(),!e(M).preview)return;f(e(M).preview,`Generated image ${se+1}`)}}),m(k,w)},Se=(k,w)=>{{var G=te=>{var L=gs();V(()=>ge(L,"src",e(M).preview)),m(te,L)},O=(te,L)=>{{var ce=me=>{var ke=hs();V(()=>ge(ke,"src",e(M).preview)),m(me,ke)};F(te,me=>{e(M).type==="video"&&me(ce)},L)}};F(k,te=>{e(M).type==="audio"?te(G):te(O,!1)},w)}};F(J,k=>{e(M).type==="image"?k(_e):k(Se,!1)})}m(q,Z)}),i(d),m(n,d)};F(X,n=>{a().media&&a().media.length>0&&n(ee)})}var ie=$(X,2);{var K=n=>{var d=ys(),q=$(u(d),2),M=u(q);ot(M,{get content(){return a().thinking},scrollToBottom:!1}),i(q),i(d),m(n,d)};F(ie,n=>{a().thinking&&n(K)})}var C=$(ie,2);{var l=n=>{var d=bs();m(n,d)};F(C,n=>{_()&&n(l)})}i(W),m(R,W)},Q=(R,W)=>{{var oe=X=>{var ee=ws(),ie=u(ee);ot(ie,{get content(){return a().content},get scrollToBottom(){return o()}}),i(ee),m(X,ee)};F(R,X=>{a().role==="system"&&X(oe)},W)}};F(A,R=>{a().role==="assistant"?R(H):R(Q,!1)},z)}};F(j,A=>{a().role==="user"?A(Y):A(B,!1)})}var D=$(j,2);{var I=A=>{var z=ks(),H=u(z,!0);i(z),V(()=>fe(H,e(r))),m(A,z)};F(D,A=>{a().role==="user"&&A(I)})}i(P),yt(P,A=>h(v,A),()=>e(v));var S=$(P,2);{var he=A=>{var z=xs(),H=u(z),Q=u(H),R=$(Q,2),W=$(R,2),oe=u(W,!0);i(W),i(H),i(z),V(()=>{ge(R,"src",e(N)),ge(R,"alt",e(p)),fe(oe,e(p))}),ne("click",Q,g),ne("click",H,La(()=>{})),ne("click",z,g),ne("keydown",z,X=>X.key==="Escape"&&g()),m(A,z)};F(S,A=>{e(c)&&A(he)})}V(()=>Ke(P,1,ga(e(b)),"svelte-1mjurqb")),m(s,y),Ve()}var Is=x('<img class="svelte-1h9ett2">'),Ss=x('<div class="file-preview svelte-1h9ett2"><span> </span></div>'),Es=x('<div class="media-item svelte-1h9ett2"><!> <button type="button" class="remove-media svelte-1h9ett2" aria-label="Remove media">&times;</button></div>'),Cs=x("<div><!></div>"),qs=x("<div><!></div>"),Ps=x('<button type="button"> </button>'),zs=x('<div class="message-input-container svelte-1h9ett2"><div class="media-preview svelte-1h9ett2"></div> <div class="input-container svelte-1h9ett2"><textarea rows="1" class="svelte-1h9ett2"></textarea> <div class="actions svelte-1h9ett2"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!></div></div> <div class="tools-bar svelte-1h9ett2"></div></div>');function Ts(s,t){Fe(t,!1);let r=ae(t,"value",12,""),b=ae(t,"placeholder",8,"Send a message..."),a=ae(t,"disabled",8,!1),_=ae(t,"isRecording",8,!1),o=ae(t,"isCapturingVideo",8,!1),c=ae(t,"mediaItems",28,()=>[]),N=ae(t,"tools",24,()=>({}));const p=ht();let v=le();function E(){e(v)&&($e(v,e(v).style.height="auto"),$e(v,e(v).style.height=`${Math.min(e(v).scrollHeight,200)}px`))}function f(){a()||!r().trim()&&c().length===0||(p("submit",{content:r().trim(),media:c(),tools:N()}),r(""),e(v)&&$e(v,e(v).style.height="auto"))}function g(C){C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),f())}function y(){_()?p("stopAudioCapture"):p("startAudioCapture")}function P(){o()?p("stopVideoCapture"):p("startVideoCapture")}function j(C){const l=C.target;if(l.files&&l.files.length>0){const n=Array.from(l.files);p("uploadFile",n),l.value=""}}function Y(C){const l=!N()[C];p("toggleTool",{tool:C,enabled:l})}Je(()=>e(v),()=>{e(v)&&E()}),_t(),Re();var B=zs(),D=u(B);Ae(D,5,c,xe,(C,l)=>{var n=Es(),d=u(n);{var q=Z=>{var J=Is();V(()=>{ge(J,"src",e(l).preview),ge(J,"alt",e(l).name)}),m(Z,J)},M=Z=>{var J=Ss(),_e=u(J),Se=u(_e,!0);i(_e),i(J),V(()=>fe(Se,e(l).name)),m(Z,J)};F(d,Z=>{e(l).type==="image"&&e(l).preview?Z(q):Z(M,!1)})}var se=$(d,2);i(n),ne("click",se,()=>{c(c().filter(Z=>Z.id!==e(l).id))}),m(C,n)}),i(D);var I=$(D,2),S=u(I);pa(S),yt(S,C=>h(v,C),()=>e(v));var he=$(S,2),A=u(he),z=$(A,2);Me(z,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var C;return(C=document.getElementById("file-upload"))==null?void 0:C.click()}},children:(C,l)=>{Ot(C,{size:18})},$$slots:{default:!0}});var H=$(z,2);const Q=ve(()=>a()||_()),R=ve(()=>_()?"Stop recording":"Start recording");Me(H,{variant:"icon",size:"sm",get disabled(){return e(Q)},get"aria-label"(){return e(R)},$$events:{click:y},children:(C,l)=>{var n=Cs();let d;var q=u(n);Fa(q,{size:18}),i(n),V(M=>d=Ke(n,1,"",null,d,M),[()=>({active:_()})],ve),m(C,n)},$$slots:{default:!0}});var W=$(H,2);const oe=ve(()=>a()||_()),X=ve(()=>o()?"Stop video capture":"Start video capture");Me(W,{variant:"icon",size:"sm",get disabled(){return e(oe)},get"aria-label"(){return e(X)},$$events:{click:P},children:(C,l)=>{var n=qs();let d;var q=u(n);Da(q,{size:18}),i(n),V(M=>d=Ke(n,1,"",null,d,M),[()=>({active:o()})],ve),m(C,n)},$$slots:{default:!0}});var ee=$(W,2);const ie=ve(()=>a()||!r().trim()&&c().length===0);Me(ee,{variant:"icon",size:"sm",get disabled(){return e(ie)},"aria-label":"Send message",$$events:{click:f},children:(C,l)=>{Va(C,{size:18})},$$slots:{default:!0}}),i(he),i(I);var K=$(I,2);Ae(K,5,()=>Object.entries(N()),xe,(C,l)=>{let n=()=>e(l)[0],d=()=>e(l)[1];var q=Ps();let M;var se=u(q,!0);i(q),V(Z=>{M=Ke(q,1,"tool-button svelte-1h9ett2",null,M,Z),ge(q,"aria-label",`Toggle ${n()??""}`),fe(se,n())},[()=>({enabled:d()})],ve),ne("click",q,()=>Y(n())),m(C,q)}),i(K),i(B),V(()=>{ge(S,"placeholder",b()),S.disabled=a()}),De(S,r),ne("keydown",S,g),ne("change",A,j),m(s,B),Ve()}var Ns=x('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),js=x('<span class="error-message svelte-8a76oy"> </span>'),Ls=x('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Hs(s,t){Fe(t,!1);const[r,b]=bt(),a=()=>je(dt,"$settingsStore",r),_=ht();let o=le({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),c=le(!1),N=le(!1),p=le("");Qe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const l=a().apiKeys||{};console.log("Stored API keys from settings store:",l),h(o,{anthropic:l.anthropic||"",openai:l.openai||"",google:l.google||"",ollamaHost:l.ollamaHost||"http://localhost:11434",localHost:l.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(o))});function v(){_("close")}async function E(){var l;h(c,!0),h(N,!1),h(p,"");try{if(console.log("Saving API keys to settingsStore:",e(o)),e(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(o).openai),console.log(`OpenAI key before saving: length=${e(o).openai.length}, starts with=${e(o).openai.substring(0,4)}`);const n=[...e(o).openai.substring(0,10)].map(d=>d.charCodeAt(0));console.log(`First 10 character codes: ${n.join(", ")}`)}if(await dt.updateApiKeys({anthropic:e(o).anthropic,openai:e(o).openai,google:e(o).google,ollamaHost:e(o).ollamaHost||"http://localhost:11434",localHost:e(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(l=a().apiKeys)!=null&&l.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const n=[...a().apiKeys.openai.substring(0,10)].map(d=>d.charCodeAt(0));console.log(`First 10 character codes after saving: ${n.join(", ")}`)}h(N,!0),console.log("API keys saved successfully"),setTimeout(()=>{h(N,!1)},3e3)}catch(n){console.error("Failed to save API keys:",n),h(p,n instanceof Error?n.message:"Unknown error")}finally{h(c,!1)}}Re();var f=Ls(),g=u(f),y=u(g),P=$(u(y),2);Me(P,{variant:"icon","aria-label":"Close settings",$$events:{click:v},children:(l,n)=>{Dt(l,{size:20})},$$slots:{default:!0}}),i(y);var j=$(y,2),Y=u(j),B=$(u(Y),4),D=u(B),I=$(u(D),2);We(I),i(D);var S=$(D,2),he=$(u(S),2);We(he),i(S);var A=$(S,2),z=$(u(A),2);We(z),i(A);var H=$(A,2),Q=$(u(H),2);We(Q),Ne(2),i(H);var R=$(H,2),W=$(u(R),2);We(W),Ne(2),i(R),i(B);var oe=$(B,2),X=u(oe);Me(X,{variant:"primary",get disabled(){return e(c)},$$events:{click:E},children:(l,n)=>{Ne();var d=Yt();V(()=>fe(d,e(c)?"Saving...":"Save API Keys")),m(l,d)},$$slots:{default:!0}});var ee=$(X,2);{var ie=l=>{var n=Ns();m(l,n)};F(ee,l=>{e(N)&&l(ie)})}var K=$(ee,2);{var C=l=>{var n=js(),d=u(n,!0);i(n),V(()=>fe(d,e(p))),m(l,n)};F(K,l=>{e(p)&&l(C)})}i(oe),i(Y),i(j),i(g),i(f),De(I,()=>e(o).anthropic,l=>$e(o,e(o).anthropic=l)),De(he,()=>e(o).openai,l=>$e(o,e(o).openai=l)),De(z,()=>e(o).google,l=>$e(o,e(o).google=l)),De(Q,()=>e(o).ollamaHost,l=>$e(o,e(o).ollamaHost=l)),De(W,()=>e(o).localHost,l=>$e(o,e(o).localHost=l)),ne("click",f,ja(v)),ne("keydown",f,l=>l.key==="Escape"&&v()),m(s,f),Ve(),b()}var Os=x('<div class="sidebar-backdrop svelte-u7neki" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Ds=x('<div class="empty-state svelte-u7neki"><h2 class="svelte-u7neki">Start a new conversation</h2> <p class="svelte-u7neki">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-u7neki"><div class="feature svelte-u7neki"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-u7neki"><!> <span>Vision support for images</span></div></div></div>'),Ks=x('<div class="settings-portal svelte-u7neki"><!></div>'),Rs=x('<div class="chat-container svelte-u7neki"><!> <!> <main class="chat-main svelte-u7neki"><header class="chat-header svelte-u7neki"><!> <h1 class="chat-title svelte-u7neki"> </h1> <!></header> <div class="chat-messages svelte-u7neki"><!></div> <div class="input-container svelte-u7neki"><!></div></main></div> <!>',1);function eo(s,t){Fe(t,!1);const[r,b]=bt(),a=()=>je(Nt,"$activeChat",r),_=()=>je(dt,"$settingsStore",r);let o=le(!1),c=le(!0),N=le(""),p=le(!1),v=le(!1),E=le([]),f=le({search:!1}),g=le(),y=le(!1);function P(){h(o,window.innerWidth<768),e(o)?h(c,!1):h(c,!0)}Qe(()=>(P(),window.addEventListener("resize",P),()=>{window.removeEventListener("resize",P)}));function j(){h(c,!e(c))}async function Y({detail:k}){var ce,me,ke;if(!a())return;const w=a().model.provider;if(console.log("Current settings store state:",_()),w==="openai"&&!((ce=_().apiKeys)!=null&&ce.openai)){console.warn("OpenAI API key not set, opening settings dialog"),h(y,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(w==="anthropic"&&!((me=_().apiKeys)!=null&&me.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),h(y,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(w==="google"&&!((ke=_().apiKeys)!=null&&ke.google)){console.warn("Google API key not set, opening settings dialog"),h(y,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:G,media:O,tools:te}=k;console.log("Media items in submission:",O),await re.addMessage(a().id,{role:"user",content:G,media:O}),h(N,""),h(E,[]),setTimeout(()=>{e(g)&&$e(g,e(g).scrollTop=e(g).scrollHeight)},100);const L=await re.addMessage(a().id,{role:"assistant",content:""});h(p,!0),h(v,!0);try{const be=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",be);const U=a().model.id;if(w==="anthropic")await Aa(U,be,T=>{re.updateMessage(a().id,L,{content:T})},()=>{h(p,!1),h(v,!1),setTimeout(()=>{e(g)&&$e(g,e(g).scrollTop=e(g).scrollHeight)},100)},T=>{console.error("Error generating response:",T),re.updateMessage(a().id,L,{content:`Error generating response: – ${T.message}`}),h(p,!1),h(v,!1)},T=>{re.updateMessage(a().id,L,{thinking:T})});else if(w==="openai")if(e(v))await Ma(U,be,T=>{re.updateMessage(a().id,L,{content:T})},()=>{h(p,!1),h(v,!1),setTimeout(()=>{e(g)&&$e(g,e(g).scrollTop=e(g).scrollHeight)},100)},T=>{console.error("Error generating response from OpenAI:",T);const ue=T.message||"An unknown error occurred";re.updateMessage(a().id,L,{content:`Error: ${ue}`}),h(p,!1),h(v,!1)});else try{const T=await Ia(U,be);re.updateMessage(a().id,L,{content:T}),h(p,!1)}catch(T){console.error("Error generating non-streaming response from OpenAI:",T);const ue=T.message||"An unknown error occurred";throw re.updateMessage(a().id,L,{content:`Error: ${ue}`}),h(p,!1),T}else if(w==="google")await Sa(U,be,(T,ue)=>{re.updateMessage(a().id,L,{content:T,media:ue})},()=>{h(p,!1),h(v,!1),setTimeout(()=>{e(g)&&$e(g,e(g).scrollTop=e(g).scrollHeight)},100)},T=>{console.error("Error generating response from Google:",T);const ue=T.message||"An unknown error occurred";re.updateMessage(a().id,L,{content:`Error: ${ue}`}),h(p,!1),h(v,!1)},T=>{re.updateMessage(a().id,L,{thinking:T})});else if(w==="ollama")try{await Ea(U,be,T=>{re.updateMessage(a().id,L,{content:T})},()=>{h(p,!1),h(v,!1),setTimeout(()=>{e(g)&&$e(g,e(g).scrollTop=e(g).scrollHeight)},100)},T=>{console.error("Error generating response from Ollama:",T);const ue=T.message||"An unknown error occurred";re.updateMessage(a().id,L,{content:`Error connecting to Ollama: ${ue}. Make sure Ollama is running locally.`}),h(p,!1),h(v,!1)})}catch(T){throw console.error("Error generating response from Ollama:",T),T}else{let T="";const ue="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of ue)await new Promise(et=>setTimeout(et,50)),T+=Ze+" ",re.updateMessage(a().id,L,{content:T.trim()});h(p,!1),h(v,!1)}}catch(be){if(console.error("Error generating response:",be),e(p)){const U=be.message||"An unknown error occurred";re.updateMessage(a().id,L,{content:`Error: ${U}`}),h(p,!1),h(v,!1)}}}function B(k){k.forEach(async w=>{const G=ka(),O=w.name,te=w.size;let L="other",ce,me;console.log(`Processing file: ${O}, type: ${w.type}, size: ${te} bytes`);const ke=U=>{var T;if(U.type.includes("pdf")||U.type.includes("word")||U.type.includes("excel")||U.type.includes("spreadsheet")||U.type.includes("presentation")||U.type.includes("officedocument")||U.type.includes("application/rtf")||U.type.includes("text/rtf"))return!0;if(!U.type||U.type==="application/octet-stream"){const ue=(T=O.split(".").pop())==null?void 0:T.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ue||"")}return!1};if(w.type.startsWith("image/")){L="image";try{ce=await D(w),console.log(`Created data URL for image ${O} (length: ${ce.length} chars)`)}catch(U){console.error(`Failed to create data URL for ${O}:`,U)}}else if(w.type.startsWith("audio/"))L="audio";else if(w.type.startsWith("video/"))L="video";else if(w.type.startsWith("text/"))L="text";else if(ke(w)){if(L="document",a()&&a().model.provider==="openai")try{me=await xa(w),console.log(`Document ${O} uploaded to OpenAI with ID: ${me}`)}catch(U){console.error(`Failed to upload document to OpenAI: ${U.message}`),alert(`Failed to upload document to OpenAI: ${U.message}`)}try{ce=await D(w),console.log(`Created data URL for document ${O}, mime type: ${w.type}`),console.log(`Document data URL length: ${ce.length} chars`),te>5*1024*1024&&console.warn(`Warning: Large document (${(te/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(U){console.error(`Failed to create data URL for ${O}:`,U)}}const be={id:G,type:L,name:O,preview:ce,size:te,timestamp:Date.now(),fileId:me};console.log(`Adding media item: ${L} ${O}`),h(E,[...e(E),be])})}async function D(k){return new Promise((w,G)=>{const O=new FileReader;O.onload=()=>{const te=O.result;w(te)},O.onerror=te=>{console.error("Error reading file:",te),G(te)},O.readAsDataURL(k)})}function I({detail:k}){const{tool:w,enabled:G}=k;h(f,{...e(f),[w]:G})}function S(){console.log("Start audio capture")}function he(){console.log("Stop audio capture")}function A(){console.log("Start video capture")}function z(){console.log("Stop video capture")}Re();var H=Rs(),Q=de(H),R=u(Q);as(R,{get isMobile(){return e(o)},get isExpanded(){return e(c)},$$events:{toggleSidebar:({detail:k})=>h(c,k)}});var W=$(R,2);{var oe=k=>{var w=Os();ne("click",w,()=>h(c,!1)),ne("keydown",w,G=>G.key==="Escape"&&h(c,!1)),m(k,w)};F(W,k=>{e(o)&&e(c)&&k(oe)})}var X=$(W,2),ee=u(X),ie=u(ee);{var K=k=>{Me(k,{variant:"icon","aria-label":"Open menu",$$events:{click:j},children:(w,G)=>{Ht(w,{size:20})},$$slots:{default:!0}})};F(ie,k=>{e(o)&&k(K)})}var C=$(ie,2),l=u(C,!0);i(C);var n=$(C,2);Me(n,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>h(y,!0)},children:(k,w)=>{Ba(k,{size:20})},$$slots:{default:!0}}),i(ee);var d=$(ee,2),q=u(d);{var M=k=>{var w=ye(),G=de(w);Ae(G,1,()=>a().messages,xe,(O,te,L)=>{const ce=ve(()=>e(v)&&L===a().messages.length-1&&e(te).role==="assistant"),me=ve(()=>L===a().messages.length-1);Ms(O,{get message(){return e(te)},get isStreaming(){return e(ce)},get scrollToBottom(){return e(me)}})}),m(k,w)},se=k=>{var w=Ds(),G=$(u(w),4),O=u(G),te=u(O);Ot(te,{size:16}),Ne(2),i(O);var L=$(O,2),ce=u(L);Ra(ce,{size:16}),Ne(2),i(L),i(G),i(w),m(k,w)};F(q,k=>{a()&&a().messages.length>0?k(M):k(se,!1)})}i(d),yt(d,k=>h(g,k),()=>e(g));var Z=$(d,2),J=u(Z);Ts(J,{get tools(){return e(f)},get disabled(){return e(p)},placeholder:"Send a message...",get value(){return e(N)},set value(k){h(N,k)},get mediaItems(){return e(E)},set mediaItems(k){h(E,k)},$$events:{submit:Y,uploadFile:k=>B(k.detail),toggleTool:I,startAudioCapture:S,stopAudioCapture:he,startVideoCapture:A,stopVideoCapture:z},$$legacy:!0}),i(Z),i(X),i(Q);var _e=$(Q,2);{var Se=k=>{var w=Ks(),G=u(w);Hs(G,{$$events:{close:()=>h(y,!1)}}),i(w),m(k,w)};F(_e,k=>{e(y)&&k(Se)})}V(()=>{var k;return fe(l,((k=a())==null?void 0:k.model.name)||"AI Assistant")}),m(s,H),Ve(),b()}export{eo as component};
