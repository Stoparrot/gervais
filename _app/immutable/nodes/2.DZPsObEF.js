import{a as Ut,n as Yt,b as v,c as fe,t as I,d as Xt}from"../chunks/B53aYDk4.js";import{i as Ve}from"../chunks/iPtxYXkW.js";import{v as St,b as Et,aD as It,s as Ye,h as he,j as Pt,a as dt,G as e,aa as pe,c as Jt,r as $t,d as Xe,g as qe,m as Qt,e as ft,f as gt,p as Ct,aE as ot,t as zt,a7 as Zt,y as ct,aF as mt,aG as wt,aH as ht,B as ea,$ as kt,a4 as Tt,aI as ta,aJ as aa,q as sa,aK as oa,aL as qt,aM as ra,k as la,E as ia,aN as na,aO as da,N as Nt,a6 as ca,a5 as va,w as Re,T as W,z as Fe,X as A,V as c,W as n,S as ve,aP as _t,aQ as le,al as Je,aR as et,aS as bt,D as f,aT as Oe,P as xt,aU as xe}from"../chunks/HdFacVVh.js";import{s as _e}from"../chunks/scx_I3NF.js";import{i as G}from"../chunks/B9A-6FJL.js";import{l as ua,m as pa,o as Q,p as fa}from"../chunks/BQXpTCfL.js";import{i as ga,l as be,p as re,s as Ie,b as tt}from"../chunks/C31peXCk.js";import{a as je,s as yt}from"../chunks/BNNRLxDv.js";import{s as ke,b as vt,C as ma,d as Ne,e as Dt,c as ce,f as ha,a as ye,r as Ze}from"../chunks/BqOXQazp.js";import{i as _a,o as ba,g as ya,b as $a,l as wa,c as ka,s as ut,v as xa,u as Ma,e as Aa,f as Sa,h as Ea,j as Ia,k as Pa}from"../chunks/DKo2NcW4.js";import{M as rt}from"../chunks/Cj9_wu-f.js";function Se(s,t){return t}function Ca(s,t,o,b){for(var a=[],m=t.length,i=0;i<m;i++)aa(t[i].e,a,!0);var r=m>0&&a.length===0&&o!==null;if(r){var q=o.parentNode;sa(q),q.append(o),b.clear(),Te(s,t[0].prev,t[m-1].next)}oa(a,()=>{for(var u=0;u<m;u++){var d=t[u];r||(b.delete(d.k),Te(s,d.prev,d.next)),qt(d.e,!r)}})}function Ee(s,t,o,b,a,m=null){var i=s,r={flags:t,items:new Map,first:null},q=(t&It)!==0;if(q){var u=s;i=he?Ye(Pt(u)):u.appendChild(St())}he&&dt();var d=null,P=!1,h=pe(()=>{var g=o();return Tt(g)?g:g==null?[]:zt(g)});Et(()=>{var g=e(h),_=g.length;if(P&&_===0)return;P=_===0;let T=!1;if(he){var E=i.data===Jt;E!==(_===0)&&(i=$t(),Ye(i),Xe(!1),T=!0)}if(he){for(var L=null,Z,U=0;U<_;U++){if(qe.nodeType===8&&qe.data===Qt){i=qe,T=!0,Xe(!1);break}var N=g[U],H=b(N,U);Z=jt(qe,r,L,null,N,H,U,a,t,o),r.items.set(H,Z),L=Z}_>0&&Ye($t())}he||za(g,r,i,a,t,b,o),m!==null&&(_===0?d?ft(d):d=gt(()=>m(i)):d!==null&&Ct(d,()=>{d=null})),T&&Xe(!0),e(h)}),he&&(i=qe)}function za(s,t,o,b,a,m,i){var J,ae,ee,F;var r=(a&ta)!==0,q=(a&(mt|ht))!==0,u=s.length,d=t.items,P=t.first,h=P,g,_=null,T,E=[],L=[],Z,U,N,H;if(r)for(H=0;H<u;H+=1)Z=s[H],U=m(Z,H),N=d.get(U),N!==void 0&&((J=N.a)==null||J.measure(),(T??(T=new Set)).add(N));for(H=0;H<u;H+=1){if(Z=s[H],U=m(Z,H),N=d.get(U),N===void 0){var $e=h?h.e.nodes_start:o;_=jt($e,t,_,_===null?t.first:_.next,Z,U,H,b,a,i),d.set(U,_),E=[],L=[],h=_.next;continue}if(q&&Ta(N,Z,H,a),(N.e.f&ot)!==0&&(ft(N.e),r&&((ae=N.a)==null||ae.unfix(),(T??(T=new Set)).delete(N))),N!==h){if(g!==void 0&&g.has(N)){if(E.length<L.length){var z=L[0],D;_=z.prev;var V=E[0],te=E[E.length-1];for(D=0;D<E.length;D+=1)Mt(E[D],z,o);for(D=0;D<L.length;D+=1)g.delete(L[D]);Te(t,V.prev,te.next),Te(t,_,V),Te(t,te,z),h=z,_=te,H-=1,E=[],L=[]}else g.delete(N),Mt(N,h,o),Te(t,N.prev,N.next),Te(t,N,_===null?t.first:_.next),Te(t,_,N),_=N;continue}for(E=[],L=[];h!==null&&h.k!==U;)(h.e.f&ot)===0&&(g??(g=new Set)).add(h),L.push(h),h=h.next;if(h===null)continue;N=h}E.push(N),_=N,h=N.next}if(h!==null||g!==void 0){for(var R=g===void 0?[]:zt(g);h!==null;)(h.e.f&ot)===0&&R.push(h),h=h.next;var Y=R.length;if(Y>0){var X=(a&It)!==0&&u===0?o:null;if(r){for(H=0;H<Y;H+=1)(ee=R[H].a)==null||ee.measure();for(H=0;H<Y;H+=1)(F=R[H].a)==null||F.fix()}Ca(t,R,X,d)}}r&&Zt(()=>{var ie;if(T!==void 0)for(N of T)(ie=N.a)==null||ie.apply()}),ct.first=t.first&&t.first.e,ct.last=_&&_.e}function Ta(s,t,o,b){(b&mt)!==0&&wt(s.v,t),(b&ht)!==0?wt(s.i,o):s.i=o}function jt(s,t,o,b,a,m,i,r,q,u){var d=(q&mt)!==0,P=(q&ra)===0,h=d?P?ea(a):kt(a):a,g=(q&ht)===0?i:kt(i),_={i:g,v:h,k:m,a:null,e:null,prev:o,next:b};try{return _.e=gt(()=>r(s,h,g,u),he),_.e.prev=o&&o.e,_.e.next=b&&b.e,o===null?t.first=_:(o.next=_,o.e.next=_.e),b!==null&&(b.prev=_,b.e.prev=_.e),_}finally{}}function Mt(s,t,o){for(var b=s.next?s.next.e.nodes_start:o,a=t?t.e.nodes_start:o,m=s.e.nodes_start;m!==b;){var i=la(m);a.before(m),m=i}}function Te(s,t,o){t===null?s.first=o:(t.next=o,t.e.next=o&&o.e),o!==null&&(o.prev=t,o.e.prev=t&&t.e)}function qa(s,t,o,b,a,m){let i=he;he&&dt();var r,q,u=null;he&&qe.nodeType===1&&(u=qe,dt());var d=he?qe:s,P;Et(()=>{const h=t()||null;var g=na;h!==r&&(P&&(h===null?Ct(P,()=>{P=null,q=null}):h===q?ft(P):qt(P)),h&&h!==q&&(P=gt(()=>{if(u=he?u:document.createElementNS(g,h),Ut(u,u),b){he&&ua(h)&&u.append(document.createComment(""));var _=he?Pt(u):u.appendChild(St());he&&(_===null?Xe(!1):Ye(_)),b(u,_)}ct.nodes_end=u,d.before(u)})),r=h,r&&(q=r))},ia),i&&(Xe(!0),Ye(d))}function Ue(s,t,o=t){var b=da();pa(s,"input",a=>{var m=a?s.defaultValue:s.value;if(m=lt(s)?it(m):m,o(m),b&&m!==(m=t())){var i=s.selectionStart,r=s.selectionEnd;s.value=m??"",r!==null&&(s.selectionStart=i,s.selectionEnd=Math.min(r,s.value.length))}}),(he&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&o(lt(s)?it(s.value):s.value),ca(()=>{var a=t();lt(s)&&a===it(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function lt(s){var t=s.type;return t==="number"||t==="range"}function it(s){return s===""?null:+s}function pt(s,t,o){if(s.multiple)return Da(s,t);for(var b of s.options){var a=Ot(b);if(ga(a,t)){b.selected=!0;return}}(!o||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let o=!0;va(()=>{t&&pt(s,Nt(t),o),o=!1;var b=new MutationObserver(()=>{var a=s.__value;pt(s,a)});return b.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{b.disconnect()}})}function Da(s,t){for(var o of s.options)o.selected=~t.indexOf(Ot(o))}function Ot(s){return"__value"in s?s.__value:s.value}function ja(s){return function(...t){var o=t[0];o.target===this&&(s==null||s.apply(this,t))}}function At(s){return function(...t){var o=t[0];return o.stopPropagation(),s==null?void 0:s.apply(this,t)}}function nt(s,t){var m;var o=(m=s.$$events)==null?void 0:m[t.type],b=Tt(o)?o.slice():o==null?[]:[o];for(var a of b)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var La=Yt("<svg><!><!></svg>");function Pe(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]),b=be(o,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Re(t,!1);let a=re(t,"name",8,void 0),m=re(t,"color",8,"currentColor"),i=re(t,"size",8,24),r=re(t,"strokeWidth",8,2),q=re(t,"absoluteStrokeWidth",8,!1),u=re(t,"iconNode",24,()=>[]);const d=(...T)=>T.filter((E,L,Z)=>!!E&&Z.indexOf(E)===L).join(" ");Ve();var P=La();let h;var g=c(P);Ee(g,1,u,Se,(T,E)=>{let L=()=>e(E)[0],Z=()=>e(E)[1];var U=fe(),N=ve(U);qa(N,L,!0,(H,$e)=>{let z;W(()=>z=vt(H,z,{...Z()}))}),v(T,U)});var _=A(g);ke(_,t,"default",{}),n(P),W((T,E)=>h=vt(P,h,{...Oa,...b,width:i(),height:i(),stroke:m(),"stroke-width":T,class:E}),[()=>q()?Number(r())*24/Number(i()):r(),()=>d("lucide-icon","lucide",a()?`lucide-${a()}`:"",o.class)],pe),v(s,P),Fe()}function Ha(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"chevron-left"},()=>o,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ka(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"circle-arrow-up"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m16 12-4-4-4 4"}],["path",{d:"M12 16V8"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Va(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"globe"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ra(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"image"},()=>o,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Fa(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"message-square"},()=>o,{iconNode:[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ga(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"mic"},()=>o,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Lt(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"notebook-pen"},()=>o,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ht(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"paperclip"},()=>o,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ba(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"settings"},()=>o,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Wa(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"video"},()=>o,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Kt(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]);Pe(s,Ie({name:"x"},()=>o,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,m)=>{var i=fe(),r=ve(i);ke(r,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}var Ua=I('<div class="spinner svelte-1pi70xe"></div>'),Ya=I("<button><!> <!></button>");function Me(s,t){const o=be(t,["children","$$slots","$$events","$$legacy"]),b=be(o,["type","variant","size","disabled","loading","fullWidth"]);let a=re(t,"type",8,"button"),m=re(t,"variant",8,"primary"),i=re(t,"size",8,"md"),r=re(t,"disabled",8,!1),q=re(t,"loading",8,!1),u=re(t,"fullWidth",8,!1);var d=Ya();let P;var h=c(d);{var g=T=>{var E=Ua();v(T,E)};G(h,T=>{q()&&T(g)})}var _=A(h,2);ke(_,t,"default",{}),n(d),W(T=>P=vt(d,P,{type:a(),class:`button ${m()??""} ${i()??""} ${(u()?"full-width":"")??""}`,disabled:r(),...b,[ma]:T},"svelte-1pi70xe"),[()=>({loading:q()})],pe),Q("click",d,function(T){nt.call(this,t,T)}),Q("keydown",d,function(T){nt.call(this,t,T)}),Q("keyup",d,function(T){nt.call(this,t,T)}),v(s,d)}var Xa=I('<option class="svelte-1dlkpw5"> </option>'),Ja=I('<optgroup label="Local Models" class="svelte-1dlkpw5"></optgroup>'),Qa=I('<option class="svelte-1dlkpw5"> </option>'),Za=I('<option class="svelte-1dlkpw5"> </option>'),es=I('<option disabled class="svelte-1dlkpw5"> </option>'),ts=I('<!> <span class="svelte-1dlkpw5">New Chat</span>',1),as=I('<button type="button"><span class="chat-title svelte-1dlkpw5"> </span> <!></button>'),ss=I('<aside><div class="sidebar-header svelte-1dlkpw5"><div class="logo-container svelte-1dlkpw5"><!> <h2 class="svelte-1dlkpw5">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1dlkpw5"><div class="model-selector svelte-1dlkpw5"><select class="select-styled svelte-1dlkpw5"><!><optgroup label="OpenAI Models" class="svelte-1dlkpw5"></optgroup><optgroup label="Google Models" class="svelte-1dlkpw5"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1dlkpw5"></optgroup></select></div> <!> <div class="chats-list svelte-1dlkpw5"></div></div></aside>');function os(s,t){var ie;Re(t,!1);const[o,b]=yt(),a=()=>je(Dt,"$activeChat",o),m=()=>je(ka,"$allModelsStore",o),i=()=>je(wa,"$localModelsStore",o),r=()=>je(ce,"$chatStore",o);let q=re(t,"isMobile",8,!1),u=re(t,"isExpanded",8,!0);const d=_t();let P=le(((ie=a())==null?void 0:ie.model.id)||"claude-3-5-sonnet");Je(async()=>{await _a()});function h(){const O=m().find(M=>M.id===e(P));O&&ce.createNewChat(O)}function g(O){ce.selectChat(O),q()&&d("toggleSidebar",!1)}function _(O,M){M.stopPropagation(),ce.deleteChat(O)}function T(O){const M=O.target;if(f(P,M.value),a()){const $=m().find(k=>k.id===e(P));$&&ce.updateChatModel(a().id,$)}}et(()=>a(),()=>{a()&&f(P,a().model.id)}),bt(),Ve();var E=ss();let L;var Z=c(E),U=c(Z),N=c(U);Fa(N,{size:24,color:"var(--accent-color)"}),Oe(2),n(U);var H=A(U,2);{var $e=O=>{const M=pe(()=>u()?"Collapse sidebar":"Expand sidebar");Me(O,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(M)},$$events:{click:()=>d("toggleSidebar",!u())},children:($,k)=>{Ha($,{size:20})},$$slots:{default:!0}})};G(H,O=>{q()&&O($e)})}n(Z);var z=A(Z,2),D=c(z),V=c(D);Na(V,()=>e(P));var te,R=c(V);{var Y=O=>{var M=Ja();Ee(M,5,i,Se,($,k)=>{var C=Xa(),se={},me=c(C,!0);n(C),W(()=>{se!==(se=e(k).id)&&(C.value=(C.__value=e(k).id)==null?"":e(k).id),_e(me,e(k).name)}),v($,C)}),n(M),v(O,M)};G(R,O=>{i().length>0&&O(Y)})}var X=A(R);Ee(X,5,()=>ba,Se,(O,M)=>{var $=Qa(),k={},C=c($,!0);n($),W(()=>{k!==(k=e(M).id)&&($.value=($.__value=e(M).id)==null?"":e(M).id),_e(C,e(M).name)}),v(O,$)}),n(X);var J=A(X);Ee(J,5,()=>ya,Se,(O,M)=>{var $=Za(),k={},C=c($,!0);n($),W(()=>{k!==(k=e(M).id)&&($.value=($.__value=e(M).id)==null?"":e(M).id),_e(C,e(M).name)}),v(O,$)}),n(J);var ae=A(J);Ee(ae,5,()=>$a,Se,(O,M)=>{var $=es(),k={},C=c($,!0);n($),W(()=>{k!==(k=e(M).id)&&($.value=($.__value=e(M).id)==null?"":e(M).id),_e(C,e(M).name)}),v(O,$)}),n(ae),n(V),n(D);var ee=A(D,2);Me(ee,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:h},children:(O,M)=>{var $=ts(),k=ve($);Lt(k,{size:16}),Oe(2),v(O,$)},$$slots:{default:!0}});var F=A(ee,2);Ee(F,5,()=>r().chats,Se,(O,M)=>{var $=as();let k;var C=c($),se=c(C,!0);n(C);var me=A(C,2);Me(me,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:ue=>_(e(M).id,ue)},children:(ue,we)=>{Kt(ue,{size:16})},$$slots:{default:!0}}),n($),W(ue=>{k=Ne($,1,"chat-item svelte-1dlkpw5",null,k,ue),_e(se,e(M).title||"New Chat")},[()=>{var ue;return{active:e(M).id===((ue=a())==null?void 0:ue.id)}}],pe),Q("click",$,()=>g(e(M).id)),v(O,$)}),n(F),n(z),n(E),W(O=>{L=Ne(E,1,"sidebar svelte-1dlkpw5",null,L,O),te!==(te=e(P))&&(V.value=(V.__value=e(P))==null?"":e(P),pt(V,e(P)))},[()=>({expanded:u()})],pe),Q("change",V,T),v(s,E),Fe(),b()}var rs=I('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),ls=I('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),is=I('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ns=I('<div class="file-size svelte-1mjurqb"> </div>'),ds=I('<span class="document-status success svelte-1mjurqb"> </span>'),cs=I('<span class="document-status info svelte-1mjurqb">Document attached</span>'),vs=I('<span class="document-status success svelte-1mjurqb">Document processed</span>'),us=I('<span class="document-status info svelte-1mjurqb">Document</span>'),ps=I('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),fs=I('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">ðŸ“„</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),gs=I('<div class="media-container svelte-1mjurqb"></div>'),ms=I('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),hs=I('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),_s=I('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),bs=I('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ys=I('<div class="media-container assistant-media svelte-1mjurqb"></div>'),$s=I('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),ws=I('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ks=I('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),xs=I('<div class="content system-message svelte-1mjurqb"><!></div>'),Ms=I('<div class="timestamp svelte-1mjurqb"> </div>'),As=I('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">Ã—</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),Ss=I("<div><!> <!></div> <!>",1);function Es(s,t){Re(t,!1);const o=le(),b=le();let a=re(t,"message",8),m=re(t,"isStreaming",8,!1),i=re(t,"scrollToBottom",8,!1),r=le(!1),q=le(""),u=le(""),d=le();Je(()=>{if(i()&&e(d)){const z=e(d).parentElement;z&&(z.scrollTop=z.scrollHeight)}});function P(z,D=2){if(z===0)return"0 Bytes";const V=1024,te=D<0?0:D,R=["Bytes","KB","MB","GB","TB"],Y=Math.floor(Math.log(z)/Math.log(V));return parseFloat((z/Math.pow(V,Y)).toFixed(te))+" "+R[Y]}function h(z,D="Preview image"){f(q,z),f(u,D),f(r,!0)}function g(){f(r,!1)}et(()=>xt(a()),()=>{f(o,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),et(()=>xt(a()),()=>{f(b,`message ${a().role}`)}),bt(),Ve();var _=Ss(),T=ve(_),E=c(T);{var L=z=>{var D=ms(),V=c(D),te=c(V),R=c(te,!0);n(te),n(V);var Y=A(V,2);{var X=J=>{var ae=gs();Ee(ae,5,()=>a().media,Se,(ee,F,ie)=>{var O=fe(),M=ve(O);{var $=C=>{var se=rs(),me=c(se);ye(me,"alt",`Image ${ie+1}`),n(se),W(()=>ye(me,"src",e(F).preview)),Q("click",se,()=>{e(F).preview&&h(e(F).preview,`Image ${ie+1}`)}),Q("keydown",se,ue=>{if(ue.key==="Enter"||ue.key===" "){if(ue.preventDefault(),!e(F).preview)return;h(e(F).preview,`Image ${ie+1}`)}}),v(C,se)},k=(C,se)=>{{var me=we=>{var Ae=ls();W(()=>ye(Ae,"src",e(F).preview)),v(we,Ae)},ue=(we,Ae)=>{{var y=B=>{var l=is();W(()=>ye(l,"src",e(F).preview)),v(B,l)},x=(B,l)=>{{var S=p=>{var K=fs(),oe=A(c(K),2),de=c(oe),ge=c(de,!0);n(de);var j=A(de,2);{var w=Ce=>{var ze=ns(),Be=c(ze,!0);n(ze),W(We=>_e(Be,We),[()=>P(e(F).size)],pe),v(Ce,ze)};G(j,Ce=>{e(F).size&&Ce(w)})}var ne=A(j,2),De=c(ne);{var Ge=Ce=>{var ze=ds(),Be=c(ze);n(ze),W(We=>_e(Be,`âœ“ Uploaded to OpenAI (ID: ${We??""}...)`),[()=>e(F).fileId.substring(0,8)],pe),v(Ce,ze)},Vt=(Ce,ze)=>{{var Be=Le=>{var Qe=fe(),Rt=ve(Qe);{var Ft=He=>{var at=cs();v(He,at)},Gt=(He,at)=>{{var Bt=Ke=>{var st=vs();v(Ke,st)},Wt=Ke=>{var st=us();v(Ke,st)};G(He,Ke=>{a().role==="assistant"?Ke(Bt):Ke(Wt,!1)},at)}};G(Rt,He=>{a().role==="user"?He(Ft):He(Gt,!1)})}v(Le,Qe)},We=Le=>{var Qe=ps();v(Le,Qe)};G(Ce,Le=>{e(F).preview?Le(Be):Le(We,!1)},ze)}};G(De,Ce=>{e(F).fileId?Ce(Ge):Ce(Vt,!1)})}n(ne),n(oe),n(K),W(()=>_e(ge,e(F).name||"Document")),v(p,K)};G(B,p=>{e(F).type==="document"&&p(S)},l)}};G(we,B=>{e(F).type==="video"?B(y):B(x,!1)},Ae)}};G(C,we=>{e(F).type==="audio"?we(me):we(ue,!1)},se)}};G(M,C=>{e(F).type==="image"?C($):C(k,!1)})}v(ee,O)}),n(ae),v(J,ae)};G(Y,J=>{a().media&&a().media.length>0&&J(X)})}n(D),W(()=>_e(R,a().content)),v(z,D)},Z=(z,D)=>{{var V=R=>{var Y=ks(),X=c(Y);rt(X,{get content(){return a().content},get scrollToBottom(){return i()}});var J=A(X,2);{var ae=M=>{var $=ys();Ee($,5,()=>a().media,Se,(k,C,se)=>{var me=fe(),ue=ve(me);{var we=y=>{var x=hs(),B=c(x);ye(B,"alt",`Generated image ${se+1}`),Oe(2),n(x),W(()=>ye(B,"src",e(C).preview)),Q("click",x,()=>{e(C).preview&&h(e(C).preview,`Generated image ${se+1}`)}),Q("keydown",x,l=>{if(l.key==="Enter"||l.key===" "){if(l.preventDefault(),!e(C).preview)return;h(e(C).preview,`Generated image ${se+1}`)}}),v(y,x)},Ae=(y,x)=>{{var B=S=>{var p=_s();W(()=>ye(p,"src",e(C).preview)),v(S,p)},l=(S,p)=>{{var K=oe=>{var de=bs();W(()=>ye(de,"src",e(C).preview)),v(oe,de)};G(S,oe=>{e(C).type==="video"&&oe(K)},p)}};G(y,S=>{e(C).type==="audio"?S(B):S(l,!1)},x)}};G(ue,y=>{e(C).type==="image"?y(we):y(Ae,!1)})}v(k,me)}),n($),v(M,$)};G(J,M=>{a().media&&a().media.length>0&&M(ae)})}var ee=A(J,2);{var F=M=>{var $=$s(),k=A(c($),2),C=c(k);rt(C,{get content(){return a().thinking},scrollToBottom:!1}),n(k),n($),v(M,$)};G(ee,M=>{a().thinking&&M(F)})}var ie=A(ee,2);{var O=M=>{var $=ws();v(M,$)};G(ie,M=>{m()&&M(O)})}n(Y),v(R,Y)},te=(R,Y)=>{{var X=J=>{var ae=xs(),ee=c(ae);rt(ee,{get content(){return a().content},get scrollToBottom(){return i()}}),n(ae),v(J,ae)};G(R,J=>{a().role==="system"&&J(X)},Y)}};G(z,R=>{a().role==="assistant"?R(V):R(te,!1)},D)}};G(E,z=>{a().role==="user"?z(L):z(Z,!1)})}var U=A(E,2);{var N=z=>{var D=Ms(),V=c(D,!0);n(D),W(()=>_e(V,e(o))),v(z,D)};G(U,z=>{a().role==="user"&&z(N)})}n(T),tt(T,z=>f(d,z),()=>e(d));var H=A(T,2);{var $e=z=>{var D=As(),V=c(D),te=c(V),R=A(te,2),Y=A(R,2),X=c(Y,!0);n(Y),n(V),n(D),W(()=>{ye(R,"src",e(q)),ye(R,"alt",e(u)),_e(X,e(u))}),Q("click",te,g),Q("click",V,At(()=>{})),Q("keydown",V,At(()=>{})),Q("click",D,g),Q("keydown",D,J=>J.key==="Escape"&&g()),v(z,D)};G(H,z=>{e(r)&&z($e)})}W(()=>Ne(T,1,ha(e(b)),"svelte-1mjurqb")),v(s,_),Fe()}var Is=I('<img class="svelte-19rdo90">'),Ps=I('<div class="file-preview svelte-19rdo90"><span class="svelte-19rdo90"> </span></div>'),Cs=I('<div class="media-item svelte-19rdo90"><!> <button type="button" class="remove-media svelte-19rdo90" aria-label="Remove media">&times;</button></div>'),zs=I("<div><!></div>"),Ts=I("<div><!></div>"),qs=I("<div><!></div>"),Ns=I('<button type="button"> </button>'),Ds=I('<div class="message-input-container svelte-19rdo90"><div class="media-preview svelte-19rdo90"></div> <div role="region" aria-label="Message input area with file drop zone"><div class="input-container svelte-19rdo90"><textarea rows="2" enterkeyhint="enter" class="svelte-19rdo90"></textarea></div> <div class="actions-bar svelte-19rdo90"><div class="left-actions svelte-19rdo90"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple class="svelte-19rdo90"> <!> <!> <!> <!></div> <div class="right-actions svelte-19rdo90"><!></div></div></div> <div class="tools-bar svelte-19rdo90"></div></div>');function js(s,t){Re(t,!1);let o=re(t,"value",12,""),b=re(t,"placeholder",8,"Send a message..."),a=re(t,"disabled",8,!1),m=re(t,"isRecording",8,!1),i=re(t,"isCapturingVideo",8,!1),r=re(t,"mediaItems",28,()=>[]),q=re(t,"tools",24,()=>({}));const u=_t();let d=le(),P=le(),h=!1,g=le(!1);Je(()=>(_(),window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_)}));function _(){h=window.innerWidth<768}function T(){e(d)&&(xe(d,e(d).style.height="auto"),xe(d,e(d).style.height=`${Math.min(e(d).scrollHeight,200)}px`))}function E(){a()||!o().trim()&&r().length===0||(u("submit",{content:o().trim(),media:r(),tools:q()}),o(""),e(d)&&xe(d,e(d).style.height="auto"))}function L(l){l.key==="Enter"&&!l.shiftKey&&!h&&(l.preventDefault(),E())}function Z(){m()?u("stopAudioCapture"):u("startAudioCapture")}function U(){i()?u("stopVideoCapture"):u("startVideoCapture")}function N(l){const S=l.target;if(S.files&&S.files.length>0){const p=Array.from(S.files);u("uploadFile",p),S.value=""}}function H(l){const S=!q()[l];u("toggleTool",{tool:l,enabled:S})}function $e(l){l.preventDefault(),l.stopPropagation(),a()||f(g,!0)}function z(l){l.preventDefault(),l.stopPropagation(),a()||f(g,!0)}function D(l){l.preventDefault(),l.stopPropagation(),l.target===e(P)&&f(g,!1)}function V(l){var S;if(l.preventDefault(),l.stopPropagation(),f(g,!1),!a()&&(S=l.dataTransfer)!=null&&S.files&&l.dataTransfer.files.length>0){const p=Array.from(l.dataTransfer.files);if(document.activeElement===e(d)&&(e(d).blur(),setTimeout(()=>{e(d).focus()},10)),u("uploadFile",p),l.dataTransfer.items)for(let K=0;K<l.dataTransfer.items.length;K++)l.dataTransfer.items[K].kind==="string"&&(l.dataTransfer.items.remove(K),K--)}}function te(l){var S;if(!a()&&(S=l.clipboardData)!=null&&S.files&&l.clipboardData.files.length>0){l.preventDefault();const p=Array.from(l.clipboardData.files);u("uploadFile",p)}}et(()=>e(d),()=>{e(d)&&T()}),bt(),Ve();var R=Ds(),Y=c(R);Ee(Y,5,r,Se,(l,S)=>{var p=Cs(),K=c(p);{var oe=j=>{var w=Is();W(()=>{ye(w,"src",e(S).preview),ye(w,"alt",e(S).name)}),v(j,w)},de=j=>{var w=Ps(),ne=c(w),De=c(ne,!0);n(ne),n(w),W(()=>_e(De,e(S).name)),v(j,w)};G(K,j=>{e(S).type==="image"&&e(S).preview?j(oe):j(de,!1)})}var ge=A(K,2);n(p),Q("click",ge,()=>{r(r().filter(j=>j.id!==e(S).id))}),v(l,p)}),n(Y);var X=A(Y,2);let J;var ae=c(X),ee=c(ae);fa(ee),tt(ee,l=>f(d,l),()=>e(d)),n(ae);var F=A(ae,2),ie=c(F),O=c(ie),M=A(O,2);Me(M,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var l;return(l=document.getElementById("file-upload"))==null?void 0:l.click()}},children:(l,S)=>{Ht(l,{size:18})},$$slots:{default:!0}});var $=A(M,2);const k=pe(()=>a()||m()),C=pe(()=>m()?"Stop recording":"Start recording");Me($,{variant:"icon",size:"sm",get disabled(){return e(k)},get"aria-label"(){return e(C)},$$events:{click:Z},children:(l,S)=>{var p=zs();let K;var oe=c(p);Ga(oe,{size:18}),n(p),W(de=>K=Ne(p,1,"svelte-19rdo90",null,K,de),[()=>({active:m()})],pe),v(l,p)},$$slots:{default:!0}});var se=A($,2);const me=pe(()=>a()||m()),ue=pe(()=>i()?"Stop video capture":"Start video capture");Me(se,{variant:"icon",size:"sm",get disabled(){return e(me)},get"aria-label"(){return e(ue)},$$events:{click:U},children:(l,S)=>{var p=Ts();let K;var oe=c(p);Wa(oe,{size:18}),n(p),W(de=>K=Ne(p,1,"svelte-19rdo90",null,K,de),[()=>({active:i()})],pe),v(l,p)},$$slots:{default:!0}});var we=A(se,2);Me(we,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>H("search")},children:(l,S)=>{var p=qs();let K;var oe=c(p);Va(oe,{size:18}),n(p),W(de=>K=Ne(p,1,"svelte-19rdo90",null,K,de),[()=>({active:q().search})],pe),v(l,p)},$$slots:{default:!0}}),n(ie);var Ae=A(ie,2),y=c(Ae);const x=pe(()=>a()||!o().trim()&&r().length===0);Me(y,{variant:"icon",size:"sm",get disabled(){return e(x)},class:"send-button","aria-label":"Send message",$$events:{click:E},children:(l,S)=>{Ka(l,{size:20,strokeWidth:2.5})},$$slots:{default:!0}}),n(Ae),n(F),n(X),tt(X,l=>f(P,l),()=>e(P));var B=A(X,2);Ee(B,5,()=>Object.entries(q()),Se,(l,S)=>{let p=()=>e(S)[0],K=()=>e(S)[1];var oe=fe(),de=ve(oe);{var ge=j=>{var w=Ns();let ne;var De=c(w,!0);n(w),W(Ge=>{ne=Ne(w,1,"tool-button svelte-19rdo90",null,ne,Ge),ye(w,"aria-label",`Toggle ${p()??""}`),_e(De,p())},[()=>({enabled:K()})],pe),Q("click",w,()=>H(p())),v(j,w)};G(de,j=>{p()!=="search"&&j(ge)})}v(l,oe)}),n(B),n(R),W(l=>{J=Ne(X,1,"input-bubble svelte-19rdo90",null,J,l),ye(ee,"placeholder",b()),ee.disabled=a()},[()=>({dragging:e(g)})],pe),Ue(ee,o),Q("keydown",ee,L),Q("input",ee,T),Q("paste",ee,te),Q("change",O,N),Q("dragenter",X,$e),Q("dragover",X,z),Q("dragleave",X,D),Q("drop",X,V),v(s,R),Fe()}var Os=I('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Ls=I('<span class="error-message svelte-8a76oy"> </span>'),Hs=I('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ks(s,t){Re(t,!1);const[o,b]=yt(),a=()=>je(ut,"$settingsStore",o);let m=re(t,"isOpen",8,!1);const i=_t();let r=le({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434"}),q=le(!1),u=le(!1),d=le("");Je(()=>{console.log("Settings component mounted, current settingsStore value:",a());const E=a().apiKeys||{};console.log("Stored API keys from settings store:",E),f(r,{anthropic:E.anthropic||"",openai:E.openai||"",google:E.google||"",ollamaHost:E.ollamaHost||"http://localhost:11434"}),console.log("Initialized API key form with:",e(r))});function P(){i("close")}async function h(){var E;f(q,!0),f(u,!1),f(d,"");try{console.log("Saving API keys to settingsStore:",e(r)),e(r).google&&(console.log("EXACT GOOGLE KEY BEING SAVED: ",e(r).google),console.log(`Google key before saving: length=${e(r).google.length}, starts with=${e(r).google.substring(0,4)}`)),await ut.updateApiKeys({anthropic:e(r).anthropic,openai:e(r).openai,google:e(r).google,ollamaHost:e(r).ollamaHost||"http://localhost:11434"}),console.log("API keys saved. Current settingsStore value:",a());try{const L={...a(),apiKeys:{...a().apiKeys}};localStorage.setItem("gervais-api-backup",JSON.stringify(L)),console.log("API keys also backed up to localStorage")}catch(L){console.error("Failed to backup API keys to localStorage:",L)}(E=a().apiKeys)!=null&&E.google&&(console.log("EXACT GOOGLE KEY AFTER SAVING: ",a().apiKeys.google),console.log(`Google key after saving: length=${a().apiKeys.google.length}, starts with=${a().apiKeys.google.substring(0,4)}`)),f(u,!0),console.log("API keys saved successfully"),setTimeout(()=>{f(u,!1)},3e3)}catch(L){console.error("Failed to save API keys:",L),f(d,L instanceof Error?L.message:"Unknown error"),f(q,!1)}finally{f(q,!1)}}Ve();var g=fe(),_=ve(g);{var T=E=>{var L=Hs(),Z=c(L),U=c(Z),N=A(c(U),2);Me(N,{variant:"icon","aria-label":"Close settings",$$events:{click:P},children:(k,C)=>{Kt(k,{size:20})},$$slots:{default:!0}}),n(U);var H=A(U,2),$e=c(H),z=A(c($e),4),D=c(z),V=A(c(D),2);Ze(V),n(D);var te=A(D,2),R=A(c(te),2);Ze(R),n(te);var Y=A(te,2),X=A(c(Y),2);Ze(X),n(Y);var J=A(Y,2),ae=A(c(J),2);Ze(ae),Oe(2),n(J),n(z);var ee=A(z,2),F=c(ee);Me(F,{variant:"primary",get disabled(){return e(q)},$$events:{click:h},children:(k,C)=>{Oe();var se=Xt();W(()=>_e(se,e(q)?"Saving...":"Save API Keys")),v(k,se)},$$slots:{default:!0}});var ie=A(F,2);{var O=k=>{var C=Os();v(k,C)};G(ie,k=>{e(u)&&k(O)})}var M=A(ie,2);{var $=k=>{var C=Ls(),se=c(C,!0);n(C),W(()=>_e(se,e(d))),v(k,C)};G(M,k=>{e(d)&&k($)})}n(ee),n($e),n(H),n(Z),n(L),Ue(V,()=>e(r).anthropic,k=>xe(r,e(r).anthropic=k)),Ue(R,()=>e(r).openai,k=>xe(r,e(r).openai=k)),Ue(X,()=>e(r).google,k=>xe(r,e(r).google=k)),Ue(ae,()=>e(r).ollamaHost,k=>xe(r,e(r).ollamaHost=k)),Q("click",L,ja(P)),Q("keydown",L,k=>k.key==="Escape"&&P()),v(E,L)};G(_,E=>{m()&&E(T)})}v(s,g),Fe(),b()}var Vs=I('<div class="sidebar-backdrop svelte-12wgxam" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=I('<div class="empty-state svelte-12wgxam"><h2 class="svelte-12wgxam">Start a new conversation</h2> <p class="svelte-12wgxam">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-12wgxam"><div class="feature svelte-12wgxam"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-12wgxam"><!> <span>Vision support for images</span></div></div></div>'),Fs=I('<div class="settings-portal svelte-12wgxam"><!></div>'),Gs=I('<div class="chat-container svelte-12wgxam"><!> <!> <main class="chat-main svelte-12wgxam"><header class="chat-header svelte-12wgxam"><!> <h1 class="chat-title svelte-12wgxam"> </h1> <!></header> <div class="chat-messages svelte-12wgxam"><!></div> <div class="input-container svelte-12wgxam"><!></div></main></div> <!>',1);function so(s,t){Re(t,!1);const[o,b]=yt(),a=()=>je(Dt,"$activeChat",o),m=()=>je(ut,"$settingsStore",o);let i=le(!1),r=le(!0),q=le(""),u=le(!1),d=le(!1),P=le([]),h=le({search:!1}),g=le(),_=le(!1);function T(){f(i,window.innerWidth<768),e(i)?f(r,!1):f(r,!0)}Je(()=>{T(),window.addEventListener("resize",T);function y(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`)}return y(),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",T),window.removeEventListener("resize",y)}});function E(){f(r,!e(r))}async function L({detail:y}){var K,oe,de;if(!a())return;const x=a().model.provider;if(console.log("Current settings store state:",m()),x==="openai"&&!((K=m().apiKeys)!=null&&K.openai)){console.warn("OpenAI API key not set, opening settings dialog"),f(_,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(x==="anthropic"&&!((oe=m().apiKeys)!=null&&oe.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),f(_,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(x==="google"&&!((de=m().apiKeys)!=null&&de.google)){console.warn("Google API key not set, opening settings dialog"),f(_,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:B,media:l,tools:S}=y;console.log("Media items in submission:",l),await ce.addMessage(a().id,{role:"user",content:B,media:l}),f(q,""),f(P,[]),setTimeout(()=>{e(g)&&xe(g,e(g).scrollTop=e(g).scrollHeight)},100);const p=await ce.addMessage(a().id,{role:"assistant",content:""});f(u,!0),f(d,!0);try{const ge=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",ge);const j=a().model.id;if(x==="anthropic")await Aa(j,ge,w=>{ce.updateMessage(a().id,p,{content:w})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(g)&&xe(g,e(g).scrollTop=e(g).scrollHeight)},100)},w=>{console.error("Error generating response:",w),ce.updateMessage(a().id,p,{content:`Error generating response: â€“ ${w.message}`}),f(u,!1),f(d,!1)},w=>{ce.updateMessage(a().id,p,{thinking:w})});else if(x==="openai")if(e(d))await Sa(j,ge,w=>{ce.updateMessage(a().id,p,{content:w})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(g)&&xe(g,e(g).scrollTop=e(g).scrollHeight)},100)},w=>{console.error("Error generating response from OpenAI:",w);const ne=w.message||"An unknown error occurred";ce.updateMessage(a().id,p,{content:`Error: ${ne}`}),f(u,!1),f(d,!1)});else try{const w=await Ea(j,ge);ce.updateMessage(a().id,p,{content:w}),f(u,!1)}catch(w){console.error("Error generating non-streaming response from OpenAI:",w);const ne=w.message||"An unknown error occurred";throw ce.updateMessage(a().id,p,{content:`Error: ${ne}`}),f(u,!1),w}else if(x==="google")await Ia(j,ge,(w,ne)=>{ce.updateMessage(a().id,p,{content:w,media:ne})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(g)&&xe(g,e(g).scrollTop=e(g).scrollHeight)},100)},w=>{console.error("Error generating response from Google:",w);const ne=w.message||"An unknown error occurred";ce.updateMessage(a().id,p,{content:`Error: ${ne}`}),f(u,!1),f(d,!1)},w=>{ce.updateMessage(a().id,p,{thinking:w})});else if(x==="ollama")try{await Pa(j,ge,w=>{ce.updateMessage(a().id,p,{content:w})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(g)&&xe(g,e(g).scrollTop=e(g).scrollHeight)},100)},w=>{console.error("Error generating response from Ollama:",w);const ne=w.message||"An unknown error occurred";ce.updateMessage(a().id,p,{content:`Error connecting to Ollama: ${ne}. Make sure Ollama is running locally.`}),f(u,!1),f(d,!1)})}catch(w){throw console.error("Error generating response from Ollama:",w),w}else{let w="";const ne="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const De of ne)await new Promise(Ge=>setTimeout(Ge,50)),w+=De+" ",ce.updateMessage(a().id,p,{content:w.trim()});f(u,!1),f(d,!1)}}catch(ge){if(console.error("Error generating response:",ge),e(u)){const j=ge.message||"An unknown error occurred";ce.updateMessage(a().id,p,{content:`Error: ${j}`}),f(u,!1),f(d,!1)}}}function Z(y){y.forEach(async x=>{const B=xa(),l=x.name,S=x.size;let p="other",K,oe;console.log(`Processing file: ${l}, type: ${x.type}, size: ${S} bytes`);const de=j=>{var w;if(j.type.includes("pdf")||j.type.includes("word")||j.type.includes("excel")||j.type.includes("spreadsheet")||j.type.includes("presentation")||j.type.includes("officedocument")||j.type.includes("application/rtf")||j.type.includes("text/rtf"))return!0;if(!j.type||j.type==="application/octet-stream"){const ne=(w=l.split(".").pop())==null?void 0:w.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ne||"")}return!1};if(x.type.startsWith("image/")){p="image";try{K=await U(x),console.log(`Created data URL for image ${l} (length: ${K.length} chars)`)}catch(j){console.error(`Failed to create data URL for ${l}:`,j)}}else if(x.type.startsWith("audio/"))p="audio";else if(x.type.startsWith("video/"))p="video";else if(x.type.startsWith("text/"))p="text";else if(de(x)){if(p="document",a()&&a().model.provider==="openai")try{oe=await Ma(x),console.log(`Document ${l} uploaded to OpenAI with ID: ${oe}`)}catch(j){console.error(`Failed to upload document to OpenAI: ${j.message}`),alert(`Failed to upload document to OpenAI: ${j.message}`)}try{K=await U(x),console.log(`Created data URL for document ${l}, mime type: ${x.type}`),console.log(`Document data URL length: ${K.length} chars`),S>5*1024*1024&&console.warn(`Warning: Large document (${(S/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(j){console.error(`Failed to create data URL for ${l}:`,j)}}const ge={id:B,type:p,name:l,preview:K,size:S,timestamp:Date.now(),fileId:oe};console.log(`Adding media item: ${p} ${l}`),f(P,[...e(P),ge])})}async function U(y){return new Promise((x,B)=>{const l=new FileReader;l.onload=()=>{const S=l.result;x(S)},l.onerror=S=>{console.error("Error reading file:",S),B(S)},l.readAsDataURL(y)})}function N({detail:y}){const{tool:x,enabled:B}=y;f(h,{...e(h),[x]:B})}function H(){console.log("Start audio capture")}function $e(){console.log("Stop audio capture")}function z(){console.log("Start video capture")}function D(){console.log("Stop video capture")}Ve();var V=Gs(),te=ve(V),R=c(te);os(R,{get isMobile(){return e(i)},get isExpanded(){return e(r)},$$events:{toggleSidebar:({detail:y})=>f(r,y)}});var Y=A(R,2);{var X=y=>{var x=Vs();Q("click",x,()=>f(r,!1)),Q("keydown",x,B=>B.key==="Escape"&&f(r,!1)),v(y,x)};G(Y,y=>{e(i)&&e(r)&&y(X)})}var J=A(Y,2),ae=c(J),ee=c(ae);{var F=y=>{Me(y,{variant:"icon","aria-label":"Open menu",$$events:{click:E},children:(x,B)=>{Lt(x,{size:20})},$$slots:{default:!0}})};G(ee,y=>{e(i)&&y(F)})}var ie=A(ee,2),O=c(ie,!0);n(ie);var M=A(ie,2);Me(M,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>f(_,!0)},children:(y,x)=>{Ba(y,{size:20})},$$slots:{default:!0}}),n(ae);var $=A(ae,2),k=c($);{var C=y=>{var x=fe(),B=ve(x);Ee(B,1,()=>a().messages,Se,(l,S,p)=>{const K=pe(()=>e(d)&&p===a().messages.length-1&&e(S).role==="assistant"),oe=pe(()=>p===a().messages.length-1);Es(l,{get message(){return e(S)},get isStreaming(){return e(K)},get scrollToBottom(){return e(oe)}})}),v(y,x)},se=y=>{var x=Rs(),B=A(c(x),4),l=c(B),S=c(l);Ht(S,{size:16}),Oe(2),n(l);var p=A(l,2),K=c(p);Ra(K,{size:16}),Oe(2),n(p),n(B),n(x),v(y,x)};G(k,y=>{a()&&a().messages.length>0?y(C):y(se,!1)})}n($),tt($,y=>f(g,y),()=>e(g));var me=A($,2),ue=c(me);js(ue,{get tools(){return e(h)},get disabled(){return e(u)},placeholder:"Send a message...",get value(){return e(q)},set value(y){f(q,y)},get mediaItems(){return e(P)},set mediaItems(y){f(P,y)},$$events:{submit:L,uploadFile:y=>Z(y.detail),toggleTool:N,startAudioCapture:H,stopAudioCapture:$e,startVideoCapture:z,stopVideoCapture:D},$$legacy:!0}),n(me),n(J),n(te);var we=A(te,2);{var Ae=y=>{var x=Fs(),B=c(x);Ks(B,{isOpen:!0,$$events:{close:()=>f(_,!1)}}),n(x),v(y,x)};G(we,y=>{e(_)&&y(Ae)})}W(()=>{var y;return _e(O,((y=a())==null?void 0:y.model.name)||"AI Assistant")}),v(s,V),Fe(),b()}export{so as component};
