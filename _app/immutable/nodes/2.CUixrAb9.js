import{a as Ft,n as Vt,b as p,c as ge,t as P,d as Bt}from"../chunks/D9u51XOd.js";import{i as Ke}from"../chunks/DSKYDh3O.js";import{v as wt,b as kt,s as Ge,h as he,j as xt,a as st,G as e,aa as de,c as Gt,r as ht,d as We,g as Pe,m as Wt,e as it,f as dt,p as Mt,aD as Qe,t as At,a7 as Ut,y as ot,aE as ct,aF as mt,aG as vt,B as jt,$ as _t,aH as St,a4 as It,aI as Yt,aJ as Xt,q as qt,aK as Jt,aL as Et,aM as Qt,k as Zt,E as ea,aN as ta,aO as aa,N as Ct,a6 as sa,a5 as oa,w as Fe,V as g,X as x,T as G,z as Ve,W as d,S as ce,aP as ut,aQ as ie,al as Ye,aR as je,aS as ft,D as y,aT as Ne,P as $t,aU as be}from"../chunks/BSv_i5Hy.js";import{s as me}from"../chunks/YMX71UVP.js";import{i as B}from"../chunks/Cec3cEQU.js";import{l as ra,m as na,o as pe,p as la}from"../chunks/Bl1F-iLh.js";import{i as ia,l as _e,p as Q,s as Ae,b as pt}from"../chunks/DYD2hZ7I.js";import{a as ze,s as Xe}from"../chunks/HG7v26tk.js";import{s as ke,b as rt,C as da,d as Le,a as ye,e as gt,c as oe,f as ca,r as Be}from"../chunks/iDGMNxyX.js";import{i as yt,o as va,g as ua,b as fa,l as pa,c as ga,s as nt,v as ha,u as ma,e as _a,f as $a,h as ya,j as ba,k as wa}from"../chunks/B-f_YzIn.js";import{M as Ze}from"../chunks/DgKoE4Zr.js";function xe(s,t){return t}function ka(s,t,n,w){for(var a=[],h=t.length,l=0;l<h;l++)Xt(t[l].e,a,!0);var r=h>0&&a.length===0&&n!==null;if(r){var O=n.parentNode;qt(O),O.append(n),w.clear(),Ce(s,t[0].prev,t[h-1].next)}Jt(a,()=>{for(var m=0;m<h;m++){var v=t[m];r||(w.delete(v.k),Ce(s,v.prev,v.next)),Et(v.e,!r)}})}function Me(s,t,n,w,a,h=null){var l=s,r={flags:t,items:new Map,first:null},O=(t&St)!==0;if(O){var m=s;l=he?Ge(xt(m)):m.appendChild(wt())}he&&st();var v=null,S=!1,u=de(()=>{var c=n();return It(c)?c:c==null?[]:At(c)});kt(()=>{var c=e(u),k=c.length;if(S&&k===0)return;S=k===0;let L=!1;if(he){var f=l.data===Gt;f!==(k===0)&&(l=ht(),Ge(l),We(!1),L=!0)}if(he){for(var I=null,N,R=0;R<k;R++){if(Pe.nodeType===8&&Pe.data===Wt){l=Pe,L=!0,We(!1);break}var M=c[R],E=w(M,R);N=Pt(Pe,r,I,null,M,E,R,a,t,n),r.items.set(E,N),I=N}k>0&&Ge(ht())}he||xa(c,r,l,a,t,w,n),h!==null&&(k===0?v?it(v):v=dt(()=>h(l)):v!==null&&Mt(v,()=>{v=null})),L&&We(!0),e(u)}),he&&(l=Pe)}function xa(s,t,n,w,a,h,l){var q,ee,K,Z;var r=(a&Yt)!==0,O=(a&(ct|vt))!==0,m=s.length,v=t.items,S=t.first,u=S,c,k=null,L,f=[],I=[],N,R,M,E;if(r)for(E=0;E<m;E+=1)N=s[E],R=h(N,E),M=v.get(R),M!==void 0&&((q=M.a)==null||q.measure(),(L??(L=new Set)).add(M));for(E=0;E<m;E+=1){if(N=s[E],R=h(N,E),M=v.get(R),M===void 0){var re=u?u.e.nodes_start:n;k=Pt(re,t,k,k===null?t.first:k.next,N,R,E,w,a,l),v.set(R,k),f=[],I=[],u=k.next;continue}if(O&&Ma(M,N,E,a),(M.e.f&Qe)!==0&&(it(M.e),r&&((ee=M.a)==null||ee.unfix(),(L??(L=new Set)).delete(M))),M!==u){if(c!==void 0&&c.has(M)){if(f.length<I.length){var W=I[0],U;k=W.prev;var te=f[0],T=f[f.length-1];for(U=0;U<f.length;U+=1)bt(f[U],W,n);for(U=0;U<I.length;U+=1)c.delete(I[U]);Ce(t,te.prev,T.next),Ce(t,k,te),Ce(t,T,W),u=W,k=T,E-=1,f=[],I=[]}else c.delete(M),bt(M,u,n),Ce(t,M.prev,M.next),Ce(t,M,k===null?t.first:k.next),Ce(t,k,M),k=M;continue}for(f=[],I=[];u!==null&&u.k!==R;)(u.e.f&Qe)===0&&(c??(c=new Set)).add(u),I.push(u),u=u.next;if(u===null)continue;M=u}f.push(M),k=M,u=M.next}if(u!==null||c!==void 0){for(var j=c===void 0?[]:At(c);u!==null;)(u.e.f&Qe)===0&&j.push(u),u=u.next;var ae=j.length;if(ae>0){var X=(a&St)!==0&&m===0?n:null;if(r){for(E=0;E<ae;E+=1)(K=j[E].a)==null||K.measure();for(E=0;E<ae;E+=1)(Z=j[E].a)==null||Z.fix()}ka(t,j,X,v)}}r&&Ut(()=>{var se;if(L!==void 0)for(M of L)(se=M.a)==null||se.apply()}),ot.first=t.first&&t.first.e,ot.last=k&&k.e}function Ma(s,t,n,w){(w&ct)!==0&&mt(s.v,t),(w&vt)!==0?mt(s.i,n):s.i=n}function Pt(s,t,n,w,a,h,l,r,O,m){var v=(O&ct)!==0,S=(O&Qt)===0,u=v?S?jt(a):_t(a):a,c=(O&vt)===0?l:_t(l),k={i:c,v:u,k:h,a:null,e:null,prev:n,next:w};try{return k.e=dt(()=>r(s,u,c,m),he),k.e.prev=n&&n.e,k.e.next=w&&w.e,n===null?t.first=k:(n.next=k,n.e.next=k.e),w!==null&&(w.prev=k,w.e.prev=k.e),k}finally{}}function bt(s,t,n){for(var w=s.next?s.next.e.nodes_start:n,a=t?t.e.nodes_start:n,h=s.e.nodes_start;h!==w;){var l=Zt(h);a.before(h),h=l}}function Ce(s,t,n){t===null?s.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Aa(s,t,n,w,a,h){let l=he;he&&st();var r,O,m=null;he&&Pe.nodeType===1&&(m=Pe,st());var v=he?Pe:s,S;kt(()=>{const u=t()||null;var c=ta;u!==r&&(S&&(u===null?Mt(S,()=>{S=null,O=null}):u===O?it(S):Et(S)),u&&u!==O&&(S=dt(()=>{if(m=he?m:document.createElementNS(c,u),Ft(m,m),w){he&&ra(u)&&m.append(document.createComment(""));var k=he?xt(m):m.appendChild(wt());he&&(k===null?We(!1):Ge(k)),w(m,k)}ot.nodes_end=m,v.before(m)})),r=u,r&&(O=r))},ea),l&&(We(!0),Ge(v))}function Re(s,t,n=t){var w=aa();na(s,"input",a=>{var h=a?s.defaultValue:s.value;if(h=et(s)?tt(h):h,n(h),w&&h!==(h=t())){var l=s.selectionStart,r=s.selectionEnd;s.value=h??"",r!==null&&(s.selectionStart=l,s.selectionEnd=Math.min(r,s.value.length))}}),(he&&s.defaultValue!==s.value||Ct(t)==null&&s.value)&&n(et(s)?tt(s.value):s.value),sa(()=>{var a=t();et(s)&&a===tt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function et(s){var t=s.type;return t==="number"||t==="range"}function tt(s){return s===""?null:+s}function lt(s,t,n){if(s.multiple)return Ia(s,t);for(var w of s.options){var a=zt(w);if(ia(a,t)){w.selected=!0;return}}(!n||t!==void 0)&&(s.selectedIndex=-1)}function Sa(s,t){let n=!0;oa(()=>{t&&lt(s,Ct(t),n),n=!1;var w=new MutationObserver(()=>{var a=s.__value;lt(s,a)});return w.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{w.disconnect()}})}function Ia(s,t){for(var n of s.options)n.selected=~t.indexOf(zt(n))}function zt(s){return"__value"in s?s.__value:s.value}function Ea(s){return function(...t){var n=t[0];n.target===this&&(s==null||s.apply(this,t))}}function at(s,t){var h;var n=(h=s.$$events)==null?void 0:h[t.type],w=It(n)?n.slice():n==null?[]:[n];for(var a of w)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Ca={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Pa=Vt("<svg><!><!></svg>");function Se(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]),w=_e(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Fe(t,!1);let a=Q(t,"name",8,void 0),h=Q(t,"color",8,"currentColor"),l=Q(t,"size",8,24),r=Q(t,"strokeWidth",8,2),O=Q(t,"absoluteStrokeWidth",8,!1),m=Q(t,"iconNode",24,()=>[]);const v=(...L)=>L.filter((f,I,N)=>!!f&&N.indexOf(f)===I).join(" ");Ke();var S=Pa();let u;var c=g(S);Me(c,1,m,xe,(L,f)=>{let I=()=>e(f)[0],N=()=>e(f)[1];var R=ge(),M=ce(R);Aa(M,I,!0,(E,re)=>{let W;G(()=>W=rt(E,W,{...N()}))}),p(L,R)});var k=x(c);ke(k,t,"default",{}),d(S),G((L,f)=>u=rt(S,u,{...Ca,...w,width:l(),height:l(),stroke:h(),"stroke-width":L,class:f}),[()=>O()?Number(r())*24/Number(l()):r(),()=>v("lucide-icon","lucide",a()?`lucide-${a()}`:"",n.class)],de),p(s,S),Ve()}function za(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"camera"},()=>n,{iconNode:[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Ta(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"chevron-left"},()=>n,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Tt(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"image"},()=>n,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Na(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"menu"},()=>n,{iconNode:[["line",{x1:"4",x2:"20",y1:"12",y2:"12"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function La(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"mic"},()=>n,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Nt(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"paperclip"},()=>n,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Oa(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"plus"},()=>n,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Ha(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"refresh-cw"},()=>n,{iconNode:[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Da(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"send"},()=>n,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Ra(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"settings"},()=>n,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}function Lt(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]);Se(s,Ae({name:"x"},()=>n,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,h)=>{var l=ge(),r=ce(l);ke(r,t,"default",{}),p(a,l)},$$slots:{default:!0}}))}var Ka=P('<div class="spinner svelte-1pi70xe"></div>'),Fa=P("<button><!> <!></button>");function we(s,t){const n=_e(t,["children","$$slots","$$events","$$legacy"]),w=_e(n,["type","variant","size","disabled","loading","fullWidth"]);let a=Q(t,"type",8,"button"),h=Q(t,"variant",8,"primary"),l=Q(t,"size",8,"md"),r=Q(t,"disabled",8,!1),O=Q(t,"loading",8,!1),m=Q(t,"fullWidth",8,!1);var v=Fa();let S;var u=g(v);{var c=L=>{var f=Ka();p(L,f)};B(u,L=>{O()&&L(c)})}var k=x(u,2);ke(k,t,"default",{}),d(v),G(L=>S=rt(v,S,{type:a(),class:`button ${h()??""} ${l()??""} ${(m()?"full-width":"")??""}`,disabled:r(),...w,[da]:L},"svelte-1pi70xe"),[()=>({loading:O()})],de),pe("click",v,function(L){at.call(this,t,L)}),pe("keydown",v,function(L){at.call(this,t,L)}),pe("keyup",v,function(L){at.call(this,t,L)}),p(s,v)}var Va=P("<option> </option>"),Ba=P('<optgroup label="Local Models" class="svelte-6bchvb"></optgroup>'),Ga=P("<option> </option>"),Wa=P("<option> </option>"),Ua=P("<option disabled> </option>"),ja=P("<span><!></span>"),Ya=P("<!> New Chat",1),Xa=P('<button type="button"><span class="chat-title svelte-6bchvb"> </span> <!></button>'),qa=P('<aside><div class="sidebar-header svelte-6bchvb"><div class="logo-container svelte-6bchvb"><img alt="Gervais Logo" class="logo svelte-6bchvb"> <h2 class="svelte-6bchvb">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-6bchvb"><div class="model-selector svelte-6bchvb"><select class="select-styled svelte-6bchvb"><!><optgroup label="OpenAI Models" class="svelte-6bchvb"></optgroup><optgroup label="Google Models" class="svelte-6bchvb"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-6bchvb"></optgroup></select> <!></div> <!> <div class="chats-list svelte-6bchvb"></div></div></aside>');function Ja(s,t){var ve;Fe(t,!1);const[n,w]=Xe(),a=()=>ze(gt,"$activeChat",n),h=()=>ze(ga,"$allModelsStore",n),l=()=>ze(pa,"$localModelsStore",n),r=()=>ze(oe,"$chatStore",n);let O=Q(t,"isMobile",8,!1),m=Q(t,"isExpanded",8,!0);const v=ut();let S=ie(((ve=a())==null?void 0:ve.model.id)||"claude-3-5-sonnet"),u=ie(!1);Ye(async()=>{y(u,!0),await yt(),y(u,!1)});async function c(){y(u,!0),await yt(),y(u,!1)}function k(){const z=h().find(A=>A.id===e(S));z&&oe.createNewChat(z)}function L(z){oe.selectChat(z),O()&&v("toggleSidebar",!1)}function f(z,A){A.stopPropagation(),oe.deleteChat(z)}function I(z){const A=z.target;if(y(S,A.value),a()){const o=h().find(i=>i.id===e(S));o&&oe.updateChatModel(a().id,o)}}je(()=>a(),()=>{a()&&y(S,a().model.id)}),ft(),Ke();var N=qa();let R;var M=g(N),E=g(M),re=g(E);Ne(2),d(E);var W=x(E,2);{var U=z=>{const A=de(()=>m()?"Collapse sidebar":"Expand sidebar");we(z,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(A)},$$events:{click:()=>v("toggleSidebar",!m())},children:(o,i)=>{Ta(o,{size:20})},$$slots:{default:!0}})};B(W,z=>{O()&&z(U)})}d(M);var te=x(M,2),T=g(te),j=g(T);Sa(j,()=>e(S));var ae,X=g(j);{var q=z=>{var A=Ba();Me(A,5,l,xe,(o,i)=>{var b=Va(),F={},_=g(b,!0);d(b),G(()=>{F!==(F=e(i).id)&&(b.value=(b.__value=e(i).id)==null?"":e(i).id),me(_,e(i).name)}),p(o,b)}),d(A),p(z,A)};B(X,z=>{l().length>0&&z(q)})}var ee=x(X);Me(ee,5,()=>va,xe,(z,A)=>{var o=Ga(),i={},b=g(o,!0);d(o),G(()=>{i!==(i=e(A).id)&&(o.value=(o.__value=e(A).id)==null?"":e(A).id),me(b,e(A).name)}),p(z,o)}),d(ee);var K=x(ee);Me(K,5,()=>ua,xe,(z,A)=>{var o=Wa(),i={},b=g(o,!0);d(o),G(()=>{i!==(i=e(A).id)&&(o.value=(o.__value=e(A).id)==null?"":e(A).id),me(b,e(A).name)}),p(z,o)}),d(K);var Z=x(K);Me(Z,5,()=>fa,xe,(z,A)=>{var o=Ua(),i={},b=g(o,!0);d(o),G(()=>{i!==(i=e(A).id)&&(o.value=(o.__value=e(A).id)==null?"":e(A).id),me(b,e(A).name)}),p(z,o)}),d(Z),d(j);var se=x(j,2);we(se,{variant:"icon",size:"sm",get disabled(){return e(u)},"aria-label":"Refresh models",$$events:{click:c},children:(z,A)=>{var o=ja();let i;var b=g(o);Ha(b,{size:16}),d(o),G(F=>i=Le(o,1,"svelte-6bchvb",null,i,F),[()=>({loading:e(u)})],de),p(z,o)},$$slots:{default:!0}}),d(T);var ue=x(T,2);we(ue,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:k},children:(z,A)=>{var o=Ya(),i=ce(o);Oa(i,{size:16}),Ne(),p(z,o)},$$slots:{default:!0}});var ne=x(ue,2);Me(ne,5,()=>r().chats,xe,(z,A)=>{var o=Xa();let i;var b=g(o),F=g(b,!0);d(b);var _=x(b,2);we(_,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:$=>f(e(A).id,$)},children:($,Y)=>{Lt($,{size:16})},$$slots:{default:!0}}),d(o),G($=>{i=Le(o,1,"chat-item svelte-6bchvb",null,i,$),me(F,e(A).title||"New Chat")},[()=>{var $;return{active:e(A).id===(($=a())==null?void 0:$.id)}}],de),pe("click",o,()=>L(e(A).id)),p(z,o)}),d(ne),d(te),d(N),G(z=>{R=Le(N,1,"sidebar svelte-6bchvb",null,R,z),ye(re,"src","/gervais/logo.svg"),ae!==(ae=e(S))&&(j.value=(j.__value=e(S))==null?"":e(S),lt(j,e(S)))},[()=>({expanded:m()})],de),pe("change",j,I),p(s,N),Ve(),w()}var Qa=P('<button type="button" class="media-preview-button svelte-1n24o7f"><img class="media-preview svelte-1n24o7f"></button>'),Za=P('<audio controls class="media-preview svelte-1n24o7f">Your browser does not support the audio element.</audio>'),es=P('<video controls class="media-preview svelte-1n24o7f"><track kind="captions" src="" label="English captions" class="svelte-1n24o7f"> Your browser does not support the video element.</video>',2),ts=P('<div class="file-size svelte-1n24o7f"> </div>'),as=P('<span class="document-status success svelte-1n24o7f"> </span>'),ss=P('<span class="document-status info svelte-1n24o7f">Document attached</span>'),os=P('<span class="document-status success svelte-1n24o7f">Document processed</span>'),rs=P('<span class="document-status info svelte-1n24o7f">Document</span>'),ns=P('<span class="document-status error svelte-1n24o7f">Failed to process document</span>'),ls=P('<div class="document-file svelte-1n24o7f" role="button" tabindex="0"><div class="file-icon svelte-1n24o7f">📄</div> <div class="file-info svelte-1n24o7f"><div class="file-name svelte-1n24o7f"> </div> <!> <div class="file-status svelte-1n24o7f"><!></div></div></div>'),is=P('<div class="media-container svelte-1n24o7f"></div>'),ds=P('<div class="message-bubble svelte-1n24o7f"><div class="content svelte-1n24o7f"><p class="svelte-1n24o7f"> </p></div> <!></div>'),cs=P('<button type="button" class="media-preview-button svelte-1n24o7f"><img class="media-preview assistant-image svelte-1n24o7f"></button>'),vs=P('<audio controls class="media-preview svelte-1n24o7f">Your browser does not support the audio element.</audio>'),us=P('<video controls class="media-preview svelte-1n24o7f"><track kind="captions" src="" label="English captions" class="svelte-1n24o7f"> Your browser does not support the video element.</video>',2),fs=P('<div class="media-container assistant-media svelte-1n24o7f"></div>'),ps=P('<details class="thinking svelte-1n24o7f"><summary class="svelte-1n24o7f">Show thinking</summary> <div class="thinking-content svelte-1n24o7f"><!></div></details>'),gs=P('<div class="typing-indicator svelte-1n24o7f"><span class="svelte-1n24o7f"></span> <span class="svelte-1n24o7f"></span> <span class="svelte-1n24o7f"></span></div>'),hs=P('<div class="content svelte-1n24o7f"><!> <!> <!> <!></div>'),ms=P('<div class="content system-message svelte-1n24o7f"><!></div>'),_s=P('<div class="timestamp svelte-1n24o7f"> </div>'),$s=P("<div><!> <!></div>");function ys(s,t){Fe(t,!1);const n=ie(),w=ie();let a=Q(t,"message",8),h=Q(t,"isStreaming",8,!1),l=Q(t,"scrollToBottom",8,!1),r=ie();Ye(()=>{if(l()&&e(r)){const f=e(r).parentElement;f&&(f.scrollTop=f.scrollHeight)}});function O(f,I=2){if(f===0)return"0 Bytes";const N=1024,R=I<0?0:I,M=["Bytes","KB","MB","GB","TB"],E=Math.floor(Math.log(f)/Math.log(N));return parseFloat((f/Math.pow(N,E)).toFixed(R))+" "+M[E]}function m(f){window.open(f,"_blank")}je(()=>$t(a()),()=>{y(n,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),je(()=>$t(a()),()=>{y(w,`message ${a().role}`)}),ft(),Ke();var v=$s(),S=g(v);{var u=f=>{var I=ds(),N=g(I),R=g(N),M=g(R,!0);d(R),d(N);var E=x(N,2);{var re=W=>{var U=is();Me(U,5,()=>a().media,xe,(te,T,j)=>{var ae=ge(),X=ce(ae);{var q=K=>{var Z=Qa(),se=g(Z);ye(se,"alt",`Image ${j+1}`),d(Z),G(()=>ye(se,"src",e(T).preview)),pe("click",Z,()=>{e(T).preview&&m(e(T).preview)}),pe("keydown",Z,ue=>{if(ue.key==="Enter"||ue.key===" "){if(ue.preventDefault(),!e(T).preview)return;m(e(T).preview)}}),p(K,Z)},ee=(K,Z)=>{{var se=ne=>{var ve=Za();G(()=>ye(ve,"src",e(T).preview)),p(ne,ve)},ue=(ne,ve)=>{{var z=o=>{var i=es();G(()=>ye(i,"src",e(T).preview)),p(o,i)},A=(o,i)=>{{var b=F=>{var _=ls(),$=x(g(_),2),Y=g($),H=g(Y,!0);d(Y);var J=x(Y,2);{var V=D=>{var C=ts(),le=g(C,!0);d(C),G(Te=>me(le,Te),[()=>O(e(T).size)],de),p(D,C)};B(J,D=>{e(T).size&&D(V)})}var fe=x(J,2),Ie=g(fe);{var Oe=D=>{var C=as(),le=g(C);d(C),G(Te=>me(le,`✓ Uploaded to OpenAI (ID: ${Te??""}...)`),[()=>e(T).fileId.substring(0,8)],de),p(D,C)},$e=(D,C)=>{{var le=Ee=>{var Ue=ge(),Ot=ce(Ue);{var Ht=He=>{var qe=ss();p(He,qe)},Dt=(He,qe)=>{{var Rt=De=>{var Je=os();p(De,Je)},Kt=De=>{var Je=rs();p(De,Je)};B(He,De=>{a().role==="assistant"?De(Rt):De(Kt,!1)},qe)}};B(Ot,He=>{a().role==="user"?He(Ht):He(Dt,!1)})}p(Ee,Ue)},Te=Ee=>{var Ue=ns();p(Ee,Ue)};B(D,Ee=>{e(T).preview?Ee(le):Ee(Te,!1)},C)}};B(Ie,D=>{e(T).fileId?D(Oe):D($e,!1)})}d(fe),d($),d(_),G(()=>me(H,e(T).name||"Document")),p(F,_)};B(o,F=>{e(T).type==="document"&&F(b)},i)}};B(ne,o=>{e(T).type==="video"?o(z):o(A,!1)},ve)}};B(K,ne=>{e(T).type==="audio"?ne(se):ne(ue,!1)},Z)}};B(X,K=>{e(T).type==="image"?K(q):K(ee,!1)})}p(te,ae)}),d(U),p(W,U)};B(E,W=>{a().media&&a().media.length>0&&W(re)})}d(I),G(()=>me(M,a().content)),p(f,I)},c=(f,I)=>{{var N=M=>{var E=hs(),re=g(E);Ze(re,{get content(){return a().content},get scrollToBottom(){return l()}});var W=x(re,2);{var U=X=>{var q=fs();Me(q,5,()=>a().media,xe,(ee,K,Z)=>{var se=ge(),ue=ce(se);{var ne=z=>{var A=cs(),o=g(A);ye(o,"alt",`Generated image ${Z+1}`),d(A),G(()=>ye(o,"src",e(K).preview)),pe("click",A,()=>{e(K).preview&&m(e(K).preview)}),pe("keydown",A,i=>{if(i.key==="Enter"||i.key===" "){if(i.preventDefault(),!e(K).preview)return;m(e(K).preview)}}),p(z,A)},ve=(z,A)=>{{var o=b=>{var F=vs();G(()=>ye(F,"src",e(K).preview)),p(b,F)},i=(b,F)=>{{var _=$=>{var Y=us();G(()=>ye(Y,"src",e(K).preview)),p($,Y)};B(b,$=>{e(K).type==="video"&&$(_)},F)}};B(z,b=>{e(K).type==="audio"?b(o):b(i,!1)},A)}};B(ue,z=>{e(K).type==="image"?z(ne):z(ve,!1)})}p(ee,se)}),d(q),p(X,q)};B(W,X=>{a().media&&a().media.length>0&&X(U)})}var te=x(W,2);{var T=X=>{var q=ps(),ee=x(g(q),2),K=g(ee);Ze(K,{get content(){return a().thinking},scrollToBottom:!1}),d(ee),d(q),p(X,q)};B(te,X=>{a().thinking&&X(T)})}var j=x(te,2);{var ae=X=>{var q=gs();p(X,q)};B(j,X=>{h()&&X(ae)})}d(E),p(M,E)},R=(M,E)=>{{var re=W=>{var U=ms(),te=g(U);Ze(te,{get content(){return a().content},get scrollToBottom(){return l()}}),d(U),p(W,U)};B(M,W=>{a().role==="system"&&W(re)},E)}};B(f,M=>{a().role==="assistant"?M(N):M(R,!1)},I)}};B(S,f=>{a().role==="user"?f(u):f(c,!1)})}var k=x(S,2);{var L=f=>{var I=_s(),N=g(I,!0);d(I),G(()=>me(N,e(n))),p(f,I)};B(k,f=>{a().role==="user"&&f(L)})}d(v),pt(v,f=>y(r,f),()=>e(r)),G(()=>Le(v,1,ca(e(w)),"svelte-1n24o7f")),p(s,v),Ve()}var bs=P('<button type="button"> </button>'),ws=P('<img class="svelte-3d1bh">'),ks=P('<div class="file-preview svelte-3d1bh"><span> </span></div>'),xs=P('<div class="media-item svelte-3d1bh"><!> <button type="button" class="remove-media svelte-3d1bh" aria-label="Remove media">&times;</button></div>'),Ms=P("<div><!></div>"),As=P("<div><!></div>"),Ss=P('<div class="message-input-container svelte-3d1bh"><div class="tools-bar svelte-3d1bh"></div> <div class="media-preview svelte-3d1bh"></div> <div class="input-container svelte-3d1bh"><textarea rows="1" class="svelte-3d1bh"></textarea> <div class="actions svelte-3d1bh"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!> <!></div></div></div>');function Is(s,t){Fe(t,!1);const[n,w]=Xe(),a=()=>ze(gt,"$activeChat",n);let h=Q(t,"value",12,""),l=Q(t,"placeholder",8,"Send a message..."),r=Q(t,"disabled",8,!1),O=Q(t,"isRecording",8,!1),m=Q(t,"isCapturingVideo",8,!1),v=Q(t,"mediaItems",28,()=>[]),S=Q(t,"tools",24,()=>({}));const u=ut();let c=ie();function k(){e(c)&&(be(c,e(c).style.height="auto"),be(c,e(c).style.height=`${Math.min(e(c).scrollHeight,200)}px`))}function L(){r()||!h().trim()&&v().length===0||(u("submit",{content:h().trim(),media:v(),tools:S()}),h(""),e(c)&&be(c,e(c).style.height="auto"))}function f(o){o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),L())}function I(){O()?u("stopAudioCapture"):u("startAudioCapture")}function N(){m()?u("stopVideoCapture"):u("startVideoCapture")}function R(o){const i=o.target;if(i.files&&i.files.length>0){const b=Array.from(i.files);u("uploadFile",b),i.value=""}}function M(o){const i=!S()[o];u("toggleTool",{tool:o,enabled:i})}function E(){var o,i,b,F;if(!r()){if(((i=(o=a())==null?void 0:o.model)==null?void 0:i.provider)!=="google"||!((F=(b=a())==null?void 0:b.model)!=null&&F.supportsImageGeneration)){alert("Please select a Google Gemini model that supports image generation");return}h("Generate an image of a fluffy sheep standing in a green meadow with flowers. Make sure to include an image in your response."),L()}}je(()=>e(c),()=>{e(c)&&k()}),ft(),Ke();var re=Ss(),W=g(re);Me(W,5,()=>Object.entries(S()),xe,(o,i)=>{let b=()=>e(i)[0],F=()=>e(i)[1];var _=bs();let $;var Y=g(_,!0);d(_),G(H=>{$=Le(_,1,"tool-button svelte-3d1bh",null,$,H),ye(_,"aria-label",`Toggle ${b()??""}`),me(Y,b())},[()=>({enabled:F()})],de),pe("click",_,()=>M(b())),p(o,_)}),d(W);var U=x(W,2);Me(U,5,v,xe,(o,i)=>{var b=xs(),F=g(b);{var _=H=>{var J=ws();G(()=>{ye(J,"src",e(i).preview),ye(J,"alt",e(i).name)}),p(H,J)},$=H=>{var J=ks(),V=g(J),fe=g(V,!0);d(V),d(J),G(()=>me(fe,e(i).name)),p(H,J)};B(F,H=>{e(i).type==="image"&&e(i).preview?H(_):H($,!1)})}var Y=x(F,2);d(b),pe("click",Y,()=>{v(v().filter(H=>H.id!==e(i).id))}),p(o,b)}),d(U);var te=x(U,2),T=g(te);la(T),pt(T,o=>y(c,o),()=>e(c));var j=x(T,2),ae=g(j),X=x(ae,2);we(X,{variant:"icon",size:"sm",get disabled(){return r()},"aria-label":"Upload file",$$events:{click:()=>{var o;return(o=document.getElementById("file-upload"))==null?void 0:o.click()}},children:(o,i)=>{Nt(o,{size:18})},$$slots:{default:!0}});var q=x(X,2);const ee=de(()=>r()||m()),K=de(()=>O()?"Stop recording":"Start recording");we(q,{variant:"icon",size:"sm",get disabled(){return e(ee)},get"aria-label"(){return e(K)},$$events:{click:I},children:(o,i)=>{var b=Ms();let F;var _=g(b);La(_,{size:18}),d(b),G($=>F=Le(b,1,"",null,F,$),[()=>({active:O()})],de),p(o,b)},$$slots:{default:!0}});var Z=x(q,2);const se=de(()=>r()||O()),ue=de(()=>m()?"Stop video capture":"Start video capture");we(Z,{variant:"icon",size:"sm",get disabled(){return e(se)},get"aria-label"(){return e(ue)},$$events:{click:N},children:(o,i)=>{var b=As();let F;var _=g(b);za(_,{size:18}),d(b),G($=>F=Le(b,1,"",null,F,$),[()=>({active:m()})],de),p(o,b)},$$slots:{default:!0}});var ne=x(Z,2);{var ve=o=>{we(o,{variant:"icon",size:"sm",get disabled(){return r()},"aria-label":"Test image generation",$$events:{click:E},children:(i,b)=>{Tt(i,{size:18})},$$slots:{default:!0}})};B(ne,o=>{var i,b,F,_;((b=(i=a())==null?void 0:i.model)==null?void 0:b.provider)==="google"&&((_=(F=a())==null?void 0:F.model)!=null&&_.supportsImageGeneration)&&o(ve)})}var z=x(ne,2);const A=de(()=>r()||!h().trim()&&v().length===0);we(z,{variant:"icon",size:"sm",get disabled(){return e(A)},"aria-label":"Send message",$$events:{click:L},children:(o,i)=>{Da(o,{size:18})},$$slots:{default:!0}}),d(j),d(te),d(re),G(()=>{ye(T,"placeholder",l()),T.disabled=r()}),Re(T,h),pe("keydown",T,f),pe("change",ae,R),p(s,re),Ve(),w()}var Es=P('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Cs=P('<span class="error-message svelte-8a76oy"> </span>'),Ps=P('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function zs(s,t){Fe(t,!1);const[n,w]=Xe(),a=()=>ze(nt,"$settingsStore",n);let h=Q(t,"isOpen",8,!1);const l=ut();let r=ie({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),O=ie(!1),m=ie(!1),v=ie("");Ye(()=>{console.log("Settings component mounted, current settingsStore value:",a());const f=a().apiKeys||{};console.log("Stored API keys from settings store:",f),y(r,{anthropic:f.anthropic||"",openai:f.openai||"",google:f.google||"",ollamaHost:f.ollamaHost||"http://localhost:11434",localHost:f.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(r))});function S(){l("close")}async function u(){var f;y(O,!0),y(m,!1),y(v,"");try{if(console.log("Saving API keys to settingsStore:",e(r)),e(r).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(r).openai),console.log(`OpenAI key before saving: length=${e(r).openai.length}, starts with=${e(r).openai.substring(0,4)}`);const I=[...e(r).openai.substring(0,10)].map(N=>N.charCodeAt(0));console.log(`First 10 character codes: ${I.join(", ")}`)}if(await nt.updateApiKeys({anthropic:e(r).anthropic,openai:e(r).openai,google:e(r).google,ollamaHost:e(r).ollamaHost||"http://localhost:11434",localHost:e(r).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(f=a().apiKeys)!=null&&f.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const I=[...a().apiKeys.openai.substring(0,10)].map(N=>N.charCodeAt(0));console.log(`First 10 character codes after saving: ${I.join(", ")}`)}y(m,!0),console.log("API keys saved successfully"),setTimeout(()=>{y(m,!1)},3e3)}catch(I){console.error("Failed to save API keys:",I),y(v,I instanceof Error?I.message:"Unknown error")}finally{y(O,!1)}}Ke();var c=ge(),k=ce(c);{var L=f=>{var I=Ps(),N=g(I),R=g(N),M=x(g(R),2);we(M,{variant:"icon","aria-label":"Close settings",$$events:{click:S},children:(o,i)=>{Lt(o,{size:20})},$$slots:{default:!0}}),d(R);var E=x(R,2),re=g(E),W=x(g(re),4),U=g(W),te=x(g(U),2);Be(te),d(U);var T=x(U,2),j=x(g(T),2);Be(j),d(T);var ae=x(T,2),X=x(g(ae),2);Be(X),d(ae);var q=x(ae,2),ee=x(g(q),2);Be(ee),Ne(2),d(q);var K=x(q,2),Z=x(g(K),2);Be(Z),Ne(2),d(K),d(W);var se=x(W,2),ue=g(se);we(ue,{variant:"primary",get disabled(){return e(O)},$$events:{click:u},children:(o,i)=>{Ne();var b=Bt();G(()=>me(b,e(O)?"Saving...":"Save API Keys")),p(o,b)},$$slots:{default:!0}});var ne=x(ue,2);{var ve=o=>{var i=Es();p(o,i)};B(ne,o=>{e(m)&&o(ve)})}var z=x(ne,2);{var A=o=>{var i=Cs(),b=g(i,!0);d(i),G(()=>me(b,e(v))),p(o,i)};B(z,o=>{e(v)&&o(A)})}d(se),d(re),d(E),d(N),d(I),Re(te,()=>e(r).anthropic,o=>be(r,e(r).anthropic=o)),Re(j,()=>e(r).openai,o=>be(r,e(r).openai=o)),Re(X,()=>e(r).google,o=>be(r,e(r).google=o)),Re(ee,()=>e(r).ollamaHost,o=>be(r,e(r).ollamaHost=o)),Re(Z,()=>e(r).localHost,o=>be(r,e(r).localHost=o)),pe("click",I,Ea(S)),pe("keydown",I,o=>o.key==="Escape"&&S()),p(f,I)};B(k,f=>{h()&&f(L)})}p(s,c),Ve(),w()}var Ts=P('<div class="sidebar-backdrop svelte-1jdnw89" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Ns=P('<div class="empty-state svelte-1jdnw89"><h2 class="svelte-1jdnw89">Start a new conversation</h2> <p class="svelte-1jdnw89">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1jdnw89"><div class="feature svelte-1jdnw89"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1jdnw89"><!> <span>Vision support for images</span></div></div></div>'),Ls=P('<div class="chat-container svelte-1jdnw89"><!> <!> <main class="chat-main svelte-1jdnw89"><header class="chat-header svelte-1jdnw89"><!> <h1 class="chat-title svelte-1jdnw89"> </h1> <!></header> <div class="chat-messages svelte-1jdnw89"><!></div> <div class="input-container svelte-1jdnw89"><!></div></main></div> <!>',1);function js(s,t){Fe(t,!1);const[n,w]=Xe(),a=()=>ze(gt,"$activeChat",n),h=()=>ze(nt,"$settingsStore",n);let l=ie(!1),r=ie(!0),O=ie(""),m=ie(!1),v=ie(!1),S=ie([]),u=ie({search:!1}),c=ie(),k=ie(!1);function L(){y(l,window.innerWidth<768),e(l)?y(r,!1):y(r,!0)}Ye(()=>(L(),window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L)}));function f(){y(r,!e(r))}async function I({detail:_}){var fe,Ie,Oe;if(!a())return;const $=a().model.provider;if(console.log("Current settings store state:",h()),$==="openai"&&!((fe=h().apiKeys)!=null&&fe.openai)){console.warn("OpenAI API key not set, opening settings dialog"),y(k,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if($==="anthropic"&&!((Ie=h().apiKeys)!=null&&Ie.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),y(k,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if($==="google"&&!((Oe=h().apiKeys)!=null&&Oe.google)){console.warn("Google API key not set, opening settings dialog"),y(k,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:Y,media:H,tools:J}=_;console.log("Media items in submission:",H),await oe.addMessage(a().id,{role:"user",content:Y,media:H}),y(O,""),y(S,[]),setTimeout(()=>{e(c)&&be(c,e(c).scrollTop=e(c).scrollHeight)},100);const V=await oe.addMessage(a().id,{role:"assistant",content:""});y(m,!0),y(v,!0);try{const $e=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",$e);const D=a().model.id;if($==="anthropic")await _a(D,$e,C=>{oe.updateMessage(a().id,V,{content:C})},()=>{y(m,!1),y(v,!1),setTimeout(()=>{e(c)&&be(c,e(c).scrollTop=e(c).scrollHeight)},100)},C=>{console.error("Error generating response:",C),oe.updateMessage(a().id,V,{content:`Error generating response: – ${C.message}`}),y(m,!1),y(v,!1)},C=>{oe.updateMessage(a().id,V,{thinking:C})});else if($==="openai")if(e(v))await $a(D,$e,C=>{oe.updateMessage(a().id,V,{content:C})},()=>{y(m,!1),y(v,!1),setTimeout(()=>{e(c)&&be(c,e(c).scrollTop=e(c).scrollHeight)},100)},C=>{console.error("Error generating response from OpenAI:",C);const le=C.message||"An unknown error occurred";oe.updateMessage(a().id,V,{content:`Error: ${le}`}),y(m,!1),y(v,!1)});else try{const C=await ya(D,$e);oe.updateMessage(a().id,V,{content:C}),y(m,!1)}catch(C){console.error("Error generating non-streaming response from OpenAI:",C);const le=C.message||"An unknown error occurred";throw oe.updateMessage(a().id,V,{content:`Error: ${le}`}),y(m,!1),C}else if($==="google")await ba(D,$e,(C,le)=>{oe.updateMessage(a().id,V,{content:C,media:le})},()=>{y(m,!1),y(v,!1),setTimeout(()=>{e(c)&&be(c,e(c).scrollTop=e(c).scrollHeight)},100)},C=>{console.error("Error generating response from Google:",C);const le=C.message||"An unknown error occurred";oe.updateMessage(a().id,V,{content:`Error: ${le}`}),y(m,!1),y(v,!1)},C=>{oe.updateMessage(a().id,V,{thinking:C})});else if($==="ollama")try{await wa(D,$e,C=>{oe.updateMessage(a().id,V,{content:C})},()=>{y(m,!1),y(v,!1),setTimeout(()=>{e(c)&&be(c,e(c).scrollTop=e(c).scrollHeight)},100)},C=>{console.error("Error generating response from Ollama:",C);const le=C.message||"An unknown error occurred";oe.updateMessage(a().id,V,{content:`Error connecting to Ollama: ${le}. Make sure Ollama is running locally.`}),y(m,!1),y(v,!1)})}catch(C){throw console.error("Error generating response from Ollama:",C),C}else{let C="";const le="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Te of le)await new Promise(Ee=>setTimeout(Ee,50)),C+=Te+" ",oe.updateMessage(a().id,V,{content:C.trim()});y(m,!1),y(v,!1)}}catch($e){if(console.error("Error generating response:",$e),e(m)){const D=$e.message||"An unknown error occurred";oe.updateMessage(a().id,V,{content:`Error: ${D}`}),y(m,!1),y(v,!1)}}}function N(_){_.forEach(async $=>{const Y=ha(),H=$.name,J=$.size;let V="other",fe,Ie;console.log(`Processing file: ${H}, type: ${$.type}, size: ${J} bytes`);const Oe=D=>{var C;if(D.type.includes("pdf")||D.type.includes("word")||D.type.includes("excel")||D.type.includes("spreadsheet")||D.type.includes("presentation")||D.type.includes("officedocument")||D.type.includes("application/rtf")||D.type.includes("text/rtf"))return!0;if(!D.type||D.type==="application/octet-stream"){const le=(C=H.split(".").pop())==null?void 0:C.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(le||"")}return!1};if($.type.startsWith("image/")){V="image";try{fe=await R($),console.log(`Created data URL for image ${H} (length: ${fe.length} chars)`)}catch(D){console.error(`Failed to create data URL for ${H}:`,D)}}else if($.type.startsWith("audio/"))V="audio";else if($.type.startsWith("video/"))V="video";else if($.type.startsWith("text/"))V="text";else if(Oe($)){if(V="document",a()&&a().model.provider==="openai")try{Ie=await ma($),console.log(`Document ${H} uploaded to OpenAI with ID: ${Ie}`)}catch(D){console.error(`Failed to upload document to OpenAI: ${D.message}`),alert(`Failed to upload document to OpenAI: ${D.message}`)}try{fe=await R($),console.log(`Created data URL for document ${H}, mime type: ${$.type}`),console.log(`Document data URL length: ${fe.length} chars`),J>5*1024*1024&&console.warn(`Warning: Large document (${(J/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(D){console.error(`Failed to create data URL for ${H}:`,D)}}const $e={id:Y,type:V,name:H,preview:fe,size:J,timestamp:Date.now(),fileId:Ie};console.log(`Adding media item: ${V} ${H}`),y(S,[...e(S),$e])})}async function R(_){return new Promise(($,Y)=>{const H=new FileReader;H.onload=()=>{const J=H.result;$(J)},H.onerror=J=>{console.error("Error reading file:",J),Y(J)},H.readAsDataURL(_)})}function M({detail:_}){const{tool:$,enabled:Y}=_;y(u,{...e(u),[$]:Y})}function E(){console.log("Start audio capture")}function re(){console.log("Stop audio capture")}function W(){console.log("Start video capture")}function U(){console.log("Stop video capture")}Ke();var te=Ls(),T=ce(te),j=g(T);Ja(j,{get isMobile(){return e(l)},get isExpanded(){return e(r)},$$events:{toggleSidebar:({detail:_})=>y(r,_)}});var ae=x(j,2);{var X=_=>{var $=Ts();pe("click",$,()=>y(r,!1)),pe("keydown",$,Y=>Y.key==="Escape"&&y(r,!1)),p(_,$)};B(ae,_=>{e(l)&&e(r)&&_(X)})}var q=x(ae,2),ee=g(q),K=g(ee);{var Z=_=>{we(_,{variant:"icon","aria-label":"Open menu",$$events:{click:f},children:($,Y)=>{Na($,{size:20})},$$slots:{default:!0}})};B(K,_=>{e(l)&&_(Z)})}var se=x(K,2),ue=g(se,!0);d(se);var ne=x(se,2);we(ne,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>y(k,!0)},children:(_,$)=>{Ra(_,{size:20})},$$slots:{default:!0}}),d(ee);var ve=x(ee,2),z=g(ve);{var A=_=>{var $=ge(),Y=ce($);Me(Y,1,()=>a().messages,xe,(H,J,V)=>{const fe=de(()=>e(v)&&V===a().messages.length-1&&e(J).role==="assistant"),Ie=de(()=>V===a().messages.length-1);ys(H,{get message(){return e(J)},get isStreaming(){return e(fe)},get scrollToBottom(){return e(Ie)}})}),p(_,$)},o=_=>{var $=Ns(),Y=x(g($),4),H=g(Y),J=g(H);Nt(J,{size:16}),Ne(2),d(H);var V=x(H,2),fe=g(V);Tt(fe,{size:16}),Ne(2),d(V),d(Y),d($),p(_,$)};B(z,_=>{a()&&a().messages.length>0?_(A):_(o,!1)})}d(ve),pt(ve,_=>y(c,_),()=>e(c));var i=x(ve,2),b=g(i);Is(b,{get tools(){return e(u)},get disabled(){return e(m)},placeholder:"Send a message...",get value(){return e(O)},set value(_){y(O,_)},get mediaItems(){return e(S)},set mediaItems(_){y(S,_)},$$events:{submit:I,uploadFile:_=>N(_.detail),toggleTool:M,startAudioCapture:E,stopAudioCapture:re,startVideoCapture:W,stopVideoCapture:U},$$legacy:!0}),d(i),d(q),d(T);var F=x(T,2);zs(F,{get isOpen(){return e(k)},$$events:{close:()=>y(k,!1)}}),G(()=>{var _;return me(ue,((_=a())==null?void 0:_.title)||"New Chat")}),p(s,te),Ve(),w()}export{js as component};
