import{a as Ut,n as Yt,b as p,c as pe,t as A,d as Xt}from"../chunks/D9u51XOd.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as It,b as St,s as We,h as fe,j as Et,a as it,G as e,aa as ve,c as Jt,r as yt,d as Ue,g as Te,m as Qt,e as pt,f as ft,p as Ct,aD as st,t as Pt,a7 as Zt,y as ct,aE as gt,aF as wt,aG as mt,B as ea,$ as kt,aH as zt,a4 as Tt,aI as ta,aJ as aa,q as sa,aK as oa,aL as Nt,aM as ra,k as la,E as na,aN as ia,aO as ca,N as qt,a6 as da,a5 as va,w as Ke,V as u,X as x,T as B,z as Ge,W as i,S as ce,aP as ht,aQ as oe,al as Qe,aR as Je,aS as _t,D as m,aT as qe,P as xt,aU as we}from"../chunks/BSv_i5Hy.js";import{s as ge}from"../chunks/YMX71UVP.js";import{i as V}from"../chunks/Cec3cEQU.js";import{l as ua,m as pa,o as ie,p as fa}from"../chunks/Bl1F-iLh.js";import{i as ga,l as be,p as ee,s as Se,b as bt}from"../chunks/DYD2hZ7I.js";import{a as Ne,s as Ze}from"../chunks/HG7v26tk.js";import{s as xe,b as dt,C as ma,d as je,a as _e,e as $t,c as ne,f as ha,r as Be}from"../chunks/DWvqKENP.js";import{i as Mt,o as _a,g as ba,b as $a,l as ya,c as wa,s as vt,v as ka,u as xa,e as Ma,f as Aa,h as Ia,j as Sa,k as Ea}from"../chunks/fllmau90.js";import{M as ot}from"../chunks/DdcB1Oy2.js";function Ae(s,t){return t}function Ca(s,t,l,w){for(var a=[],_=t.length,n=0;n<_;n++)aa(t[n].e,a,!0);var r=_>0&&a.length===0&&l!==null;if(r){var q=l.parentNode;sa(q),q.append(l),w.clear(),ze(s,t[0].prev,t[_-1].next)}oa(a,()=>{for(var b=0;b<_;b++){var f=t[b];r||(w.delete(f.k),ze(s,f.prev,f.next)),Nt(f.e,!r)}})}function Ie(s,t,l,w,a,_=null){var n=s,r={flags:t,items:new Map,first:null},q=(t&zt)!==0;if(q){var b=s;n=fe?We(Et(b)):b.appendChild(It())}fe&&it();var f=null,M=!1,v=ve(()=>{var c=l();return Tt(c)?c:c==null?[]:Pt(c)});St(()=>{var c=e(v),k=c.length;if(M&&k===0)return;M=k===0;let C=!1;if(fe){var E=n.data===Jt;E!==(k===0)&&(n=yt(),We(n),Ue(!1),C=!0)}if(fe){for(var H=null,F,W=0;W<k;W++){if(Te.nodeType===8&&Te.data===Qt){n=Te,C=!0,Ue(!1);break}var P=c[W],L=w(P,W);F=jt(Te,r,H,null,P,L,W,a,t,l),r.items.set(L,F),H=F}k>0&&We(yt())}fe||Pa(c,r,n,a,t,w,l),_!==null&&(k===0?f?pt(f):f=ft(()=>_(n)):f!==null&&Ct(f,()=>{f=null})),C&&Ue(!0),e(v)}),fe&&(n=Te)}function Pa(s,t,l,w,a,_,n){var J,Z,le,G;var r=(a&ta)!==0,q=(a&(gt|mt))!==0,b=s.length,f=t.items,M=t.first,v=M,c,k=null,C,E=[],H=[],F,W,P,L;if(r)for(L=0;L<b;L+=1)F=s[L],W=_(F,L),P=f.get(W),P!==void 0&&((J=P.a)==null||J.measure(),(C??(C=new Set)).add(P));for(L=0;L<b;L+=1){if(F=s[L],W=_(F,L),P=f.get(W),P===void 0){var me=v?v.e.nodes_start:l;k=jt(me,t,k,k===null?t.first:k.next,F,W,L,w,a,n),f.set(W,k),E=[],H=[],v=k.next;continue}if(q&&za(P,F,L,a),(P.e.f&st)!==0&&(pt(P.e),r&&((Z=P.a)==null||Z.unfix(),(C??(C=new Set)).delete(P))),P!==v){if(c!==void 0&&c.has(P)){if(E.length<H.length){var I=H[0],T;k=I.prev;var X=E[0],K=E[E.length-1];for(T=0;T<E.length;T+=1)At(E[T],I,l);for(T=0;T<H.length;T+=1)c.delete(H[T]);ze(t,X.prev,K.next),ze(t,k,X),ze(t,K,I),v=I,k=K,L-=1,E=[],H=[]}else c.delete(P),At(P,v,l),ze(t,P.prev,P.next),ze(t,P,k===null?t.first:k.next),ze(t,k,P),k=P;continue}for(E=[],H=[];v!==null&&v.k!==W;)(v.e.f&st)===0&&(c??(c=new Set)).add(v),H.push(v),v=v.next;if(v===null)continue;P=v}E.push(P),k=P,v=P.next}if(v!==null||c!==void 0){for(var O=c===void 0?[]:Pt(c);v!==null;)(v.e.f&st)===0&&O.push(v),v=v.next;var U=O.length;if(U>0){var re=(a&zt)!==0&&b===0?l:null;if(r){for(L=0;L<U;L+=1)(le=O[L].a)==null||le.measure();for(L=0;L<U;L+=1)(G=O[L].a)==null||G.fix()}Ca(t,O,re,f)}}r&&Zt(()=>{var de;if(C!==void 0)for(P of C)(de=P.a)==null||de.apply()}),ct.first=t.first&&t.first.e,ct.last=k&&k.e}function za(s,t,l,w){(w&gt)!==0&&wt(s.v,t),(w&mt)!==0?wt(s.i,l):s.i=l}function jt(s,t,l,w,a,_,n,r,q,b){var f=(q&gt)!==0,M=(q&ra)===0,v=f?M?ea(a):kt(a):a,c=(q&mt)===0?n:kt(n),k={i:c,v,k:_,a:null,e:null,prev:l,next:w};try{return k.e=ft(()=>r(s,v,c,b),fe),k.e.prev=l&&l.e,k.e.next=w&&w.e,l===null?t.first=k:(l.next=k,l.e.next=k.e),w!==null&&(w.prev=k,w.e.prev=k.e),k}finally{}}function At(s,t,l){for(var w=s.next?s.next.e.nodes_start:l,a=t?t.e.nodes_start:l,_=s.e.nodes_start;_!==w;){var n=la(_);a.before(_),_=n}}function ze(s,t,l){t===null?s.first=l:(t.next=l,t.e.next=l&&l.e),l!==null&&(l.prev=t,l.e.prev=t&&t.e)}function Ta(s,t,l,w,a,_){let n=fe;fe&&it();var r,q,b=null;fe&&Te.nodeType===1&&(b=Te,it());var f=fe?Te:s,M;St(()=>{const v=t()||null;var c=ia;v!==r&&(M&&(v===null?Ct(M,()=>{M=null,q=null}):v===q?pt(M):Nt(M)),v&&v!==q&&(M=ft(()=>{if(b=fe?b:document.createElementNS(c,v),Ut(b,b),w){fe&&ua(v)&&b.append(document.createComment(""));var k=fe?Et(b):b.appendChild(It());fe&&(k===null?Ue(!1):We(k)),w(b,k)}ct.nodes_end=b,f.before(b)})),r=v,r&&(q=r))},na),n&&(Ue(!0),We(f))}function De(s,t,l=t){var w=ca();pa(s,"input",a=>{var _=a?s.defaultValue:s.value;if(_=rt(s)?lt(_):_,l(_),w&&_!==(_=t())){var n=s.selectionStart,r=s.selectionEnd;s.value=_??"",r!==null&&(s.selectionStart=n,s.selectionEnd=Math.min(r,s.value.length))}}),(fe&&s.defaultValue!==s.value||qt(t)==null&&s.value)&&l(rt(s)?lt(s.value):s.value),da(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,l){if(s.multiple)return qa(s,t);for(var w of s.options){var a=Lt(w);if(ga(a,t)){w.selected=!0;return}}(!l||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let l=!0;va(()=>{t&&ut(s,qt(t),l),l=!1;var w=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return w.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{w.disconnect()}})}function qa(s,t){for(var l of s.options)l.selected=~t.indexOf(Lt(l))}function Lt(s){return"__value"in s?s.__value:s.value}function ja(s){return function(...t){var l=t[0];l.target===this&&(s==null||s.apply(this,t))}}function La(s){return function(...t){var l=t[0];return l.stopPropagation(),s==null?void 0:s.apply(this,t)}}function nt(s,t){var _;var l=(_=s.$$events)==null?void 0:_[t.type],w=Tt(l)?l.slice():l==null?[]:[l];for(var a of w)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ha=Yt("<svg><!><!></svg>");function Ee(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]),w=be(l,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ke(t,!1);let a=ee(t,"name",8,void 0),_=ee(t,"color",8,"currentColor"),n=ee(t,"size",8,24),r=ee(t,"strokeWidth",8,2),q=ee(t,"absoluteStrokeWidth",8,!1),b=ee(t,"iconNode",24,()=>[]);const f=(...C)=>C.filter((E,H,F)=>!!E&&F.indexOf(E)===H).join(" ");Re();var M=Ha();let v;var c=u(M);Ie(c,1,b,Ae,(C,E)=>{let H=()=>e(E)[0],F=()=>e(E)[1];var W=pe(),P=ce(W);Ta(P,H,!0,(L,me)=>{let I;B(()=>I=dt(L,I,{...F()}))}),p(C,W)});var k=x(c);xe(k,t,"default",{}),i(M),B((C,E)=>v=dt(M,v,{...Oa,...w,width:n(),height:n(),stroke:_(),"stroke-width":C,class:E}),[()=>q()?Number(r())*24/Number(n()):r(),()=>f("lucide-icon","lucide",a()?`lucide-${a()}`:"",l.class)],ve),p(s,M),Ge()}function Da(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"camera"},()=>l,{iconNode:[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Ra(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"chevron-left"},()=>l,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Ot(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"image"},()=>l,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Ka(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"menu"},()=>l,{iconNode:[["line",{x1:"4",x2:"20",y1:"12",y2:"12"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Ga(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"mic"},()=>l,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Ht(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"paperclip"},()=>l,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Fa(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"plus"},()=>l,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Va(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"refresh-cw"},()=>l,{iconNode:[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Ba(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"send"},()=>l,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Wa(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"settings"},()=>l,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}function Dt(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]);Ee(s,Se({name:"x"},()=>l,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,_)=>{var n=pe(),r=ce(n);xe(r,t,"default",{}),p(a,n)},$$slots:{default:!0}}))}var Ua=A('<div class="spinner svelte-1pi70xe"></div>'),Ya=A("<button><!> <!></button>");function ke(s,t){const l=be(t,["children","$$slots","$$events","$$legacy"]),w=be(l,["type","variant","size","disabled","loading","fullWidth"]);let a=ee(t,"type",8,"button"),_=ee(t,"variant",8,"primary"),n=ee(t,"size",8,"md"),r=ee(t,"disabled",8,!1),q=ee(t,"loading",8,!1),b=ee(t,"fullWidth",8,!1);var f=Ya();let M;var v=u(f);{var c=C=>{var E=Ua();p(C,E)};V(v,C=>{q()&&C(c)})}var k=x(v,2);xe(k,t,"default",{}),i(f),B(C=>M=dt(f,M,{type:a(),class:`button ${_()??""} ${n()??""} ${(b()?"full-width":"")??""}`,disabled:r(),...w,[ma]:C},"svelte-1pi70xe"),[()=>({loading:q()})],ve),ie("click",f,function(C){nt.call(this,t,C)}),ie("keydown",f,function(C){nt.call(this,t,C)}),ie("keyup",f,function(C){nt.call(this,t,C)}),p(s,f)}var Xa=A("<option> </option>"),Ja=A('<optgroup label="Local Models" class="svelte-6bchvb"></optgroup>'),Qa=A("<option> </option>"),Za=A("<option> </option>"),es=A("<option disabled> </option>"),ts=A("<span><!></span>"),as=A("<!> New Chat",1),ss=A('<button type="button"><span class="chat-title svelte-6bchvb"> </span> <!></button>'),os=A('<aside><div class="sidebar-header svelte-6bchvb"><div class="logo-container svelte-6bchvb"><img alt="Gervais Logo" class="logo svelte-6bchvb"> <h2 class="svelte-6bchvb">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-6bchvb"><div class="model-selector svelte-6bchvb"><select class="select-styled svelte-6bchvb"><!><optgroup label="OpenAI Models" class="svelte-6bchvb"></optgroup><optgroup label="Google Models" class="svelte-6bchvb"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-6bchvb"></optgroup></select> <!></div> <!> <div class="chats-list svelte-6bchvb"></div></div></aside>');function rs(s,t){var ae;Ke(t,!1);const[l,w]=Ze(),a=()=>Ne($t,"$activeChat",l),_=()=>Ne(wa,"$allModelsStore",l),n=()=>Ne(ya,"$localModelsStore",l),r=()=>Ne(ne,"$chatStore",l);let q=ee(t,"isMobile",8,!1),b=ee(t,"isExpanded",8,!0);const f=ht();let M=oe(((ae=a())==null?void 0:ae.model.id)||"claude-3-5-sonnet"),v=oe(!1);Qe(async()=>{m(v,!0),await Mt(),m(v,!1)});async function c(){m(v,!0),await Mt(),m(v,!1)}function k(){const z=_().find($=>$.id===e(M));z&&ne.createNewChat(z)}function C(z){ne.selectChat(z),q()&&f("toggleSidebar",!1)}function E(z,$){$.stopPropagation(),ne.deleteChat(z)}function H(z){const $=z.target;if(m(M,$.value),a()){const o=_().find(d=>d.id===e(M));o&&ne.updateChatModel(a().id,o)}}Je(()=>a(),()=>{a()&&m(M,a().model.id)}),_t(),Re();var F=os();let W;var P=u(F),L=u(P),me=u(L);qe(2),i(L);var I=x(L,2);{var T=z=>{const $=ve(()=>b()?"Collapse sidebar":"Expand sidebar");ke(z,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e($)},$$events:{click:()=>f("toggleSidebar",!b())},children:(o,d)=>{Ra(o,{size:20})},$$slots:{default:!0}})};V(I,z=>{q()&&z(T)})}i(P);var X=x(P,2),K=u(X),O=u(K);Na(O,()=>e(M));var U,re=u(O);{var J=z=>{var $=Ja();Ie($,5,n,Ae,(o,d)=>{var y=Xa(),D={},h=u(y,!0);i(y),B(()=>{D!==(D=e(d).id)&&(y.value=(y.__value=e(d).id)==null?"":e(d).id),ge(h,e(d).name)}),p(o,y)}),i($),p(z,$)};V(re,z=>{n().length>0&&z(J)})}var Z=x(re);Ie(Z,5,()=>_a,Ae,(z,$)=>{var o=Qa(),d={},y=u(o,!0);i(o),B(()=>{d!==(d=e($).id)&&(o.value=(o.__value=e($).id)==null?"":e($).id),ge(y,e($).name)}),p(z,o)}),i(Z);var le=x(Z);Ie(le,5,()=>ba,Ae,(z,$)=>{var o=Za(),d={},y=u(o,!0);i(o),B(()=>{d!==(d=e($).id)&&(o.value=(o.__value=e($).id)==null?"":e($).id),ge(y,e($).name)}),p(z,o)}),i(le);var G=x(le);Ie(G,5,()=>$a,Ae,(z,$)=>{var o=es(),d={},y=u(o,!0);i(o),B(()=>{d!==(d=e($).id)&&(o.value=(o.__value=e($).id)==null?"":e($).id),ge(y,e($).name)}),p(z,o)}),i(G),i(O);var de=x(O,2);ke(de,{variant:"icon",size:"sm",get disabled(){return e(v)},"aria-label":"Refresh models",$$events:{click:c},children:(z,$)=>{var o=ts();let d;var y=u(o);Va(y,{size:16}),i(o),B(D=>d=je(o,1,"svelte-6bchvb",null,d,D),[()=>({loading:e(v)})],ve),p(z,o)},$$slots:{default:!0}}),i(K);var $e=x(K,2);ke($e,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:k},children:(z,$)=>{var o=as(),d=ce(o);Fa(d,{size:16}),qe(),p(z,o)},$$slots:{default:!0}});var te=x($e,2);Ie(te,5,()=>r().chats,Ae,(z,$)=>{var o=ss();let d;var y=u(o),D=u(y,!0);i(y);var h=x(y,2);ke(h,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:g=>E(e($).id,g)},children:(g,Y)=>{Dt(g,{size:16})},$$slots:{default:!0}}),i(o),B(g=>{d=je(o,1,"chat-item svelte-6bchvb",null,d,g),ge(D,e($).title||"New Chat")},[()=>{var g;return{active:e($).id===((g=a())==null?void 0:g.id)}}],ve),ie("click",o,()=>C(e($).id)),p(z,o)}),i(te),i(X),i(F),B(z=>{W=je(F,1,"sidebar svelte-6bchvb",null,W,z),_e(me,"src","/gervais/logo.svg"),U!==(U=e(M))&&(O.value=(O.__value=e(M))==null?"":e(M),ut(O,e(M)))},[()=>({expanded:b()})],ve),ie("change",O,H),p(s,F),Ge(),w()}var ls=A('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),ns=A('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),is=A('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),cs=A('<div class="file-size svelte-1mjurqb"> </div>'),ds=A('<span class="document-status success svelte-1mjurqb"> </span>'),vs=A('<span class="document-status info svelte-1mjurqb">Document attached</span>'),us=A('<span class="document-status success svelte-1mjurqb">Document processed</span>'),ps=A('<span class="document-status info svelte-1mjurqb">Document</span>'),fs=A('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),gs=A('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">📄</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),ms=A('<div class="media-container svelte-1mjurqb"></div>'),hs=A('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),_s=A('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),bs=A('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),$s=A('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ys=A('<div class="media-container assistant-media svelte-1mjurqb"></div>'),ws=A('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),ks=A('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),xs=A('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),Ms=A('<div class="content system-message svelte-1mjurqb"><!></div>'),As=A('<div class="timestamp svelte-1mjurqb"> </div>'),Is=A('<div class="image-modal-overlay svelte-1mjurqb" role="button" tabindex="0"><div class="image-modal-content svelte-1mjurqb"><button class="close-modal svelte-1mjurqb">×</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),Ss=A("<div><!> <!></div> <!>",1);function Es(s,t){Ke(t,!1);const l=oe(),w=oe();let a=ee(t,"message",8),_=ee(t,"isStreaming",8,!1),n=ee(t,"scrollToBottom",8,!1),r=oe(!1),q=oe(""),b=oe(""),f=oe();Qe(()=>{if(n()&&e(f)){const I=e(f).parentElement;I&&(I.scrollTop=I.scrollHeight)}});function M(I,T=2){if(I===0)return"0 Bytes";const X=1024,K=T<0?0:T,O=["Bytes","KB","MB","GB","TB"],U=Math.floor(Math.log(I)/Math.log(X));return parseFloat((I/Math.pow(X,U)).toFixed(K))+" "+O[U]}function v(I,T="Preview image"){m(q,I),m(b,T),m(r,!0)}function c(){m(r,!1)}Je(()=>xt(a()),()=>{m(l,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Je(()=>xt(a()),()=>{m(w,`message ${a().role}`)}),_t(),Re();var k=Ss(),C=ce(k),E=u(C);{var H=I=>{var T=hs(),X=u(T),K=u(X),O=u(K,!0);i(K),i(X);var U=x(X,2);{var re=J=>{var Z=ms();Ie(Z,5,()=>a().media,Ae,(le,G,de)=>{var $e=pe(),te=ce($e);{var ae=$=>{var o=ls(),d=u(o);_e(d,"alt",`Image ${de+1}`),i(o),B(()=>_e(d,"src",e(G).preview)),ie("click",o,()=>{e(G).preview&&v(e(G).preview,`Image ${de+1}`)}),ie("keydown",o,y=>{if(y.key==="Enter"||y.key===" "){if(y.preventDefault(),!e(G).preview)return;v(e(G).preview,`Image ${de+1}`)}}),p($,o)},z=($,o)=>{{var d=D=>{var h=ns();B(()=>_e(h,"src",e(G).preview)),p(D,h)},y=(D,h)=>{{var g=S=>{var R=is();B(()=>_e(R,"src",e(G).preview)),p(S,R)},Y=(S,R)=>{{var j=se=>{var ye=gs(),Me=x(u(ye),2),ue=u(Me),Q=u(ue,!0);i(ue);var N=x(ue,2);{var he=Ce=>{var Pe=cs(),Fe=u(Pe,!0);i(Pe),B(Ve=>ge(Fe,Ve),[()=>M(e(G).size)],ve),p(Ce,Pe)};V(N,Ce=>{e(G).size&&Ce(he)})}var Ye=x(N,2),et=u(Ye);{var Rt=Ce=>{var Pe=ds(),Fe=u(Pe);i(Pe),B(Ve=>ge(Fe,`✓ Uploaded to OpenAI (ID: ${Ve??""}...)`),[()=>e(G).fileId.substring(0,8)],ve),p(Ce,Pe)},Kt=(Ce,Pe)=>{{var Fe=Le=>{var Xe=pe(),Gt=ce(Xe);{var Ft=Oe=>{var tt=vs();p(Oe,tt)},Vt=(Oe,tt)=>{{var Bt=He=>{var at=us();p(He,at)},Wt=He=>{var at=ps();p(He,at)};V(Oe,He=>{a().role==="assistant"?He(Bt):He(Wt,!1)},tt)}};V(Gt,Oe=>{a().role==="user"?Oe(Ft):Oe(Vt,!1)})}p(Le,Xe)},Ve=Le=>{var Xe=fs();p(Le,Xe)};V(Ce,Le=>{e(G).preview?Le(Fe):Le(Ve,!1)},Pe)}};V(et,Ce=>{e(G).fileId?Ce(Rt):Ce(Kt,!1)})}i(Ye),i(Me),i(ye),B(()=>ge(Q,e(G).name||"Document")),p(se,ye)};V(S,se=>{e(G).type==="document"&&se(j)},R)}};V(D,S=>{e(G).type==="video"?S(g):S(Y,!1)},h)}};V($,D=>{e(G).type==="audio"?D(d):D(y,!1)},o)}};V(te,$=>{e(G).type==="image"?$(ae):$(z,!1)})}p(le,$e)}),i(Z),p(J,Z)};V(U,J=>{a().media&&a().media.length>0&&J(re)})}i(T),B(()=>ge(O,a().content)),p(I,T)},F=(I,T)=>{{var X=O=>{var U=xs(),re=u(U);ot(re,{get content(){return a().content},get scrollToBottom(){return n()}});var J=x(re,2);{var Z=te=>{var ae=ys();Ie(ae,5,()=>a().media,Ae,(z,$,o)=>{var d=pe(),y=ce(d);{var D=g=>{var Y=_s(),S=u(Y);_e(S,"alt",`Generated image ${o+1}`),qe(2),i(Y),B(()=>_e(S,"src",e($).preview)),ie("click",Y,()=>{e($).preview&&v(e($).preview,`Generated image ${o+1}`)}),ie("keydown",Y,R=>{if(R.key==="Enter"||R.key===" "){if(R.preventDefault(),!e($).preview)return;v(e($).preview,`Generated image ${o+1}`)}}),p(g,Y)},h=(g,Y)=>{{var S=j=>{var se=bs();B(()=>_e(se,"src",e($).preview)),p(j,se)},R=(j,se)=>{{var ye=Me=>{var ue=$s();B(()=>_e(ue,"src",e($).preview)),p(Me,ue)};V(j,Me=>{e($).type==="video"&&Me(ye)},se)}};V(g,j=>{e($).type==="audio"?j(S):j(R,!1)},Y)}};V(y,g=>{e($).type==="image"?g(D):g(h,!1)})}p(z,d)}),i(ae),p(te,ae)};V(J,te=>{a().media&&a().media.length>0&&te(Z)})}var le=x(J,2);{var G=te=>{var ae=ws(),z=x(u(ae),2),$=u(z);ot($,{get content(){return a().thinking},scrollToBottom:!1}),i(z),i(ae),p(te,ae)};V(le,te=>{a().thinking&&te(G)})}var de=x(le,2);{var $e=te=>{var ae=ks();p(te,ae)};V(de,te=>{_()&&te($e)})}i(U),p(O,U)},K=(O,U)=>{{var re=J=>{var Z=Ms(),le=u(Z);ot(le,{get content(){return a().content},get scrollToBottom(){return n()}}),i(Z),p(J,Z)};V(O,J=>{a().role==="system"&&J(re)},U)}};V(I,O=>{a().role==="assistant"?O(X):O(K,!1)},T)}};V(E,I=>{a().role==="user"?I(H):I(F,!1)})}var W=x(E,2);{var P=I=>{var T=As(),X=u(T,!0);i(T),B(()=>ge(X,e(l))),p(I,T)};V(W,I=>{a().role==="user"&&I(P)})}i(C),bt(C,I=>m(f,I),()=>e(f));var L=x(C,2);{var me=I=>{var T=Is(),X=u(T),K=u(X),O=x(K,2),U=x(O,2),re=u(U,!0);i(U),i(X),i(T),B(()=>{_e(O,"src",e(q)),_e(O,"alt",e(b)),ge(re,e(b))}),ie("click",K,c),ie("click",X,La(()=>{})),ie("click",T,c),ie("keydown",T,J=>J.key==="Escape"&&c()),p(I,T)};V(L,I=>{e(r)&&I(me)})}B(()=>je(C,1,ha(e(w)),"svelte-1mjurqb")),p(s,k),Ge()}var Cs=A('<button type="button"> </button>'),Ps=A('<img class="svelte-5d556v">'),zs=A('<div class="file-preview svelte-5d556v"><span> </span></div>'),Ts=A('<div class="media-item svelte-5d556v"><!> <button type="button" class="remove-media svelte-5d556v" aria-label="Remove media">&times;</button></div>'),Ns=A("<div><!></div>"),qs=A("<div><!></div>"),js=A('<div class="message-input-container svelte-5d556v"><div class="tools-bar svelte-5d556v"></div> <div class="media-preview svelte-5d556v"></div> <div class="input-container svelte-5d556v"><textarea rows="1" class="svelte-5d556v"></textarea> <div class="actions svelte-5d556v"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!> <!></div></div></div>');function Ls(s,t){Ke(t,!1);const[l,w]=Ze(),a=()=>Ne($t,"$activeChat",l);let _=ee(t,"value",12,""),n=ee(t,"placeholder",8,"Send a message..."),r=ee(t,"disabled",8,!1),q=ee(t,"isRecording",8,!1),b=ee(t,"isCapturingVideo",8,!1),f=ee(t,"mediaItems",28,()=>[]),M=ee(t,"tools",24,()=>({}));const v=ht();let c=oe();function k(){e(c)&&(we(c,e(c).style.height="auto"),we(c,e(c).style.height=`${Math.min(e(c).scrollHeight,200)}px`))}function C(){r()||!_().trim()&&f().length===0||(v("submit",{content:_().trim(),media:f(),tools:M()}),_(""),e(c)&&we(c,e(c).style.height="auto"))}function E(o){o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),C())}function H(){q()?v("stopAudioCapture"):v("startAudioCapture")}function F(){b()?v("stopVideoCapture"):v("startVideoCapture")}function W(o){const d=o.target;if(d.files&&d.files.length>0){const y=Array.from(d.files);v("uploadFile",y),d.value=""}}function P(o){const d=!M()[o];v("toggleTool",{tool:o,enabled:d})}function L(){var o,d,y,D;if(!r()){if(((d=(o=a())==null?void 0:o.model)==null?void 0:d.provider)!=="google"||!((D=(y=a())==null?void 0:y.model)!=null&&D.supportsImageGeneration)){alert("Please select a Google Gemini model that supports image generation");return}_("Generate an image of a fluffy sheep standing in a green meadow with flowers. Make sure to include an image in your response."),C()}}Je(()=>e(c),()=>{e(c)&&k()}),_t(),Re();var me=js(),I=u(me);Ie(I,5,()=>Object.entries(M()),Ae,(o,d)=>{let y=()=>e(d)[0],D=()=>e(d)[1];var h=Cs();let g;var Y=u(h,!0);i(h),B(S=>{g=je(h,1,"tool-button svelte-5d556v",null,g,S),_e(h,"aria-label",`Toggle ${y()??""}`),ge(Y,y())},[()=>({enabled:D()})],ve),ie("click",h,()=>P(y())),p(o,h)}),i(I);var T=x(I,2);Ie(T,5,f,Ae,(o,d)=>{var y=Ts(),D=u(y);{var h=S=>{var R=Ps();B(()=>{_e(R,"src",e(d).preview),_e(R,"alt",e(d).name)}),p(S,R)},g=S=>{var R=zs(),j=u(R),se=u(j,!0);i(j),i(R),B(()=>ge(se,e(d).name)),p(S,R)};V(D,S=>{e(d).type==="image"&&e(d).preview?S(h):S(g,!1)})}var Y=x(D,2);i(y),ie("click",Y,()=>{f(f().filter(S=>S.id!==e(d).id))}),p(o,y)}),i(T);var X=x(T,2),K=u(X);fa(K),bt(K,o=>m(c,o),()=>e(c));var O=x(K,2),U=u(O),re=x(U,2);ke(re,{variant:"icon",size:"sm",get disabled(){return r()},"aria-label":"Upload file",$$events:{click:()=>{var o;return(o=document.getElementById("file-upload"))==null?void 0:o.click()}},children:(o,d)=>{Ht(o,{size:18})},$$slots:{default:!0}});var J=x(re,2);const Z=ve(()=>r()||b()),le=ve(()=>q()?"Stop recording":"Start recording");ke(J,{variant:"icon",size:"sm",get disabled(){return e(Z)},get"aria-label"(){return e(le)},$$events:{click:H},children:(o,d)=>{var y=Ns();let D;var h=u(y);Ga(h,{size:18}),i(y),B(g=>D=je(y,1,"",null,D,g),[()=>({active:q()})],ve),p(o,y)},$$slots:{default:!0}});var G=x(J,2);const de=ve(()=>r()||q()),$e=ve(()=>b()?"Stop video capture":"Start video capture");ke(G,{variant:"icon",size:"sm",get disabled(){return e(de)},get"aria-label"(){return e($e)},$$events:{click:F},children:(o,d)=>{var y=qs();let D;var h=u(y);Da(h,{size:18}),i(y),B(g=>D=je(y,1,"",null,D,g),[()=>({active:b()})],ve),p(o,y)},$$slots:{default:!0}});var te=x(G,2);{var ae=o=>{ke(o,{variant:"icon",size:"sm",get disabled(){return r()},"aria-label":"Test image generation",$$events:{click:L},children:(d,y)=>{Ot(d,{size:18})},$$slots:{default:!0}})};V(te,o=>{var d,y,D,h;((y=(d=a())==null?void 0:d.model)==null?void 0:y.provider)==="google"&&((h=(D=a())==null?void 0:D.model)!=null&&h.supportsImageGeneration)&&o(ae)})}var z=x(te,2);const $=ve(()=>r()||!_().trim()&&f().length===0);ke(z,{variant:"icon",size:"sm",get disabled(){return e($)},"aria-label":"Send message",$$events:{click:C},children:(o,d)=>{Ba(o,{size:18})},$$slots:{default:!0}}),i(O),i(X),i(me),B(()=>{_e(K,"placeholder",n()),K.disabled=r()}),De(K,_),ie("keydown",K,E),ie("change",U,W),p(s,me),Ge(),w()}var Os=A('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Hs=A('<span class="error-message svelte-8a76oy"> </span>'),Ds=A('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Rs(s,t){Ke(t,!1);const[l,w]=Ze(),a=()=>Ne(vt,"$settingsStore",l);let _=ee(t,"isOpen",8,!1);const n=ht();let r=oe({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),q=oe(!1),b=oe(!1),f=oe("");Qe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const E=a().apiKeys||{};console.log("Stored API keys from settings store:",E),m(r,{anthropic:E.anthropic||"",openai:E.openai||"",google:E.google||"",ollamaHost:E.ollamaHost||"http://localhost:11434",localHost:E.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(r))});function M(){n("close")}async function v(){var E;m(q,!0),m(b,!1),m(f,"");try{if(console.log("Saving API keys to settingsStore:",e(r)),e(r).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(r).openai),console.log(`OpenAI key before saving: length=${e(r).openai.length}, starts with=${e(r).openai.substring(0,4)}`);const H=[...e(r).openai.substring(0,10)].map(F=>F.charCodeAt(0));console.log(`First 10 character codes: ${H.join(", ")}`)}if(await vt.updateApiKeys({anthropic:e(r).anthropic,openai:e(r).openai,google:e(r).google,ollamaHost:e(r).ollamaHost||"http://localhost:11434",localHost:e(r).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(E=a().apiKeys)!=null&&E.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const H=[...a().apiKeys.openai.substring(0,10)].map(F=>F.charCodeAt(0));console.log(`First 10 character codes after saving: ${H.join(", ")}`)}m(b,!0),console.log("API keys saved successfully"),setTimeout(()=>{m(b,!1)},3e3)}catch(H){console.error("Failed to save API keys:",H),m(f,H instanceof Error?H.message:"Unknown error")}finally{m(q,!1)}}Re();var c=pe(),k=ce(c);{var C=E=>{var H=Ds(),F=u(H),W=u(F),P=x(u(W),2);ke(P,{variant:"icon","aria-label":"Close settings",$$events:{click:M},children:(o,d)=>{Dt(o,{size:20})},$$slots:{default:!0}}),i(W);var L=x(W,2),me=u(L),I=x(u(me),4),T=u(I),X=x(u(T),2);Be(X),i(T);var K=x(T,2),O=x(u(K),2);Be(O),i(K);var U=x(K,2),re=x(u(U),2);Be(re),i(U);var J=x(U,2),Z=x(u(J),2);Be(Z),qe(2),i(J);var le=x(J,2),G=x(u(le),2);Be(G),qe(2),i(le),i(I);var de=x(I,2),$e=u(de);ke($e,{variant:"primary",get disabled(){return e(q)},$$events:{click:v},children:(o,d)=>{qe();var y=Xt();B(()=>ge(y,e(q)?"Saving...":"Save API Keys")),p(o,y)},$$slots:{default:!0}});var te=x($e,2);{var ae=o=>{var d=Os();p(o,d)};V(te,o=>{e(b)&&o(ae)})}var z=x(te,2);{var $=o=>{var d=Hs(),y=u(d,!0);i(d),B(()=>ge(y,e(f))),p(o,d)};V(z,o=>{e(f)&&o($)})}i(de),i(me),i(L),i(F),i(H),De(X,()=>e(r).anthropic,o=>we(r,e(r).anthropic=o)),De(O,()=>e(r).openai,o=>we(r,e(r).openai=o)),De(re,()=>e(r).google,o=>we(r,e(r).google=o)),De(Z,()=>e(r).ollamaHost,o=>we(r,e(r).ollamaHost=o)),De(G,()=>e(r).localHost,o=>we(r,e(r).localHost=o)),ie("click",H,ja(M)),ie("keydown",H,o=>o.key==="Escape"&&M()),p(E,H)};V(k,E=>{_()&&E(C)})}p(s,c),Ge(),w()}var Ks=A('<div class="sidebar-backdrop svelte-1wl1sab" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Gs=A('<div class="empty-state svelte-1wl1sab"><h2 class="svelte-1wl1sab">Start a new conversation</h2> <p class="svelte-1wl1sab">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1wl1sab"><div class="feature svelte-1wl1sab"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1wl1sab"><!> <span>Vision support for images</span></div></div></div>'),Fs=A('<div class="chat-container svelte-1wl1sab"><!> <!> <main class="chat-main svelte-1wl1sab"><header class="chat-header svelte-1wl1sab"><!> <h1 class="chat-title svelte-1wl1sab"> </h1> <!></header> <div class="chat-messages svelte-1wl1sab"><!></div> <div class="input-container svelte-1wl1sab"><!></div></main></div> <!>',1);function ao(s,t){Ke(t,!1);const[l,w]=Ze(),a=()=>Ne($t,"$activeChat",l),_=()=>Ne(vt,"$settingsStore",l);let n=oe(!1),r=oe(!0),q=oe(""),b=oe(!1),f=oe(!1),M=oe([]),v=oe({search:!1}),c=oe(),k=oe(!1);function C(){m(n,window.innerWidth<768),e(n)?m(r,!1):m(r,!0)}Qe(()=>(C(),window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C)}));function E(){m(r,!e(r))}async function H({detail:h}){var se,ye,Me;if(!a())return;const g=a().model.provider;if(console.log("Current settings store state:",_()),g==="openai"&&!((se=_().apiKeys)!=null&&se.openai)){console.warn("OpenAI API key not set, opening settings dialog"),m(k,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(g==="anthropic"&&!((ye=_().apiKeys)!=null&&ye.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),m(k,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(g==="google"&&!((Me=_().apiKeys)!=null&&Me.google)){console.warn("Google API key not set, opening settings dialog"),m(k,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:Y,media:S,tools:R}=h;console.log("Media items in submission:",S),await ne.addMessage(a().id,{role:"user",content:Y,media:S}),m(q,""),m(M,[]),setTimeout(()=>{e(c)&&we(c,e(c).scrollTop=e(c).scrollHeight)},100);const j=await ne.addMessage(a().id,{role:"assistant",content:""});m(b,!0),m(f,!0);try{const ue=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",ue);const Q=a().model.id;if(g==="anthropic")await Ma(Q,ue,N=>{ne.updateMessage(a().id,j,{content:N})},()=>{m(b,!1),m(f,!1),setTimeout(()=>{e(c)&&we(c,e(c).scrollTop=e(c).scrollHeight)},100)},N=>{console.error("Error generating response:",N),ne.updateMessage(a().id,j,{content:`Error generating response: – ${N.message}`}),m(b,!1),m(f,!1)},N=>{ne.updateMessage(a().id,j,{thinking:N})});else if(g==="openai")if(e(f))await Aa(Q,ue,N=>{ne.updateMessage(a().id,j,{content:N})},()=>{m(b,!1),m(f,!1),setTimeout(()=>{e(c)&&we(c,e(c).scrollTop=e(c).scrollHeight)},100)},N=>{console.error("Error generating response from OpenAI:",N);const he=N.message||"An unknown error occurred";ne.updateMessage(a().id,j,{content:`Error: ${he}`}),m(b,!1),m(f,!1)});else try{const N=await Ia(Q,ue);ne.updateMessage(a().id,j,{content:N}),m(b,!1)}catch(N){console.error("Error generating non-streaming response from OpenAI:",N);const he=N.message||"An unknown error occurred";throw ne.updateMessage(a().id,j,{content:`Error: ${he}`}),m(b,!1),N}else if(g==="google")await Sa(Q,ue,(N,he)=>{ne.updateMessage(a().id,j,{content:N,media:he})},()=>{m(b,!1),m(f,!1),setTimeout(()=>{e(c)&&we(c,e(c).scrollTop=e(c).scrollHeight)},100)},N=>{console.error("Error generating response from Google:",N);const he=N.message||"An unknown error occurred";ne.updateMessage(a().id,j,{content:`Error: ${he}`}),m(b,!1),m(f,!1)},N=>{ne.updateMessage(a().id,j,{thinking:N})});else if(g==="ollama")try{await Ea(Q,ue,N=>{ne.updateMessage(a().id,j,{content:N})},()=>{m(b,!1),m(f,!1),setTimeout(()=>{e(c)&&we(c,e(c).scrollTop=e(c).scrollHeight)},100)},N=>{console.error("Error generating response from Ollama:",N);const he=N.message||"An unknown error occurred";ne.updateMessage(a().id,j,{content:`Error connecting to Ollama: ${he}. Make sure Ollama is running locally.`}),m(b,!1),m(f,!1)})}catch(N){throw console.error("Error generating response from Ollama:",N),N}else{let N="";const he="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ye of he)await new Promise(et=>setTimeout(et,50)),N+=Ye+" ",ne.updateMessage(a().id,j,{content:N.trim()});m(b,!1),m(f,!1)}}catch(ue){if(console.error("Error generating response:",ue),e(b)){const Q=ue.message||"An unknown error occurred";ne.updateMessage(a().id,j,{content:`Error: ${Q}`}),m(b,!1),m(f,!1)}}}function F(h){h.forEach(async g=>{const Y=ka(),S=g.name,R=g.size;let j="other",se,ye;console.log(`Processing file: ${S}, type: ${g.type}, size: ${R} bytes`);const Me=Q=>{var N;if(Q.type.includes("pdf")||Q.type.includes("word")||Q.type.includes("excel")||Q.type.includes("spreadsheet")||Q.type.includes("presentation")||Q.type.includes("officedocument")||Q.type.includes("application/rtf")||Q.type.includes("text/rtf"))return!0;if(!Q.type||Q.type==="application/octet-stream"){const he=(N=S.split(".").pop())==null?void 0:N.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(he||"")}return!1};if(g.type.startsWith("image/")){j="image";try{se=await W(g),console.log(`Created data URL for image ${S} (length: ${se.length} chars)`)}catch(Q){console.error(`Failed to create data URL for ${S}:`,Q)}}else if(g.type.startsWith("audio/"))j="audio";else if(g.type.startsWith("video/"))j="video";else if(g.type.startsWith("text/"))j="text";else if(Me(g)){if(j="document",a()&&a().model.provider==="openai")try{ye=await xa(g),console.log(`Document ${S} uploaded to OpenAI with ID: ${ye}`)}catch(Q){console.error(`Failed to upload document to OpenAI: ${Q.message}`),alert(`Failed to upload document to OpenAI: ${Q.message}`)}try{se=await W(g),console.log(`Created data URL for document ${S}, mime type: ${g.type}`),console.log(`Document data URL length: ${se.length} chars`),R>5*1024*1024&&console.warn(`Warning: Large document (${(R/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(Q){console.error(`Failed to create data URL for ${S}:`,Q)}}const ue={id:Y,type:j,name:S,preview:se,size:R,timestamp:Date.now(),fileId:ye};console.log(`Adding media item: ${j} ${S}`),m(M,[...e(M),ue])})}async function W(h){return new Promise((g,Y)=>{const S=new FileReader;S.onload=()=>{const R=S.result;g(R)},S.onerror=R=>{console.error("Error reading file:",R),Y(R)},S.readAsDataURL(h)})}function P({detail:h}){const{tool:g,enabled:Y}=h;m(v,{...e(v),[g]:Y})}function L(){console.log("Start audio capture")}function me(){console.log("Stop audio capture")}function I(){console.log("Start video capture")}function T(){console.log("Stop video capture")}Re();var X=Fs(),K=ce(X),O=u(K);rs(O,{get isMobile(){return e(n)},get isExpanded(){return e(r)},$$events:{toggleSidebar:({detail:h})=>m(r,h)}});var U=x(O,2);{var re=h=>{var g=Ks();ie("click",g,()=>m(r,!1)),ie("keydown",g,Y=>Y.key==="Escape"&&m(r,!1)),p(h,g)};V(U,h=>{e(n)&&e(r)&&h(re)})}var J=x(U,2),Z=u(J),le=u(Z);{var G=h=>{ke(h,{variant:"icon","aria-label":"Open menu",$$events:{click:E},children:(g,Y)=>{Ka(g,{size:20})},$$slots:{default:!0}})};V(le,h=>{e(n)&&h(G)})}var de=x(le,2),$e=u(de,!0);i(de);var te=x(de,2);ke(te,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>m(k,!0)},children:(h,g)=>{Wa(h,{size:20})},$$slots:{default:!0}}),i(Z);var ae=x(Z,2),z=u(ae);{var $=h=>{var g=pe(),Y=ce(g);Ie(Y,1,()=>a().messages,Ae,(S,R,j)=>{const se=ve(()=>e(f)&&j===a().messages.length-1&&e(R).role==="assistant"),ye=ve(()=>j===a().messages.length-1);Es(S,{get message(){return e(R)},get isStreaming(){return e(se)},get scrollToBottom(){return e(ye)}})}),p(h,g)},o=h=>{var g=Gs(),Y=x(u(g),4),S=u(Y),R=u(S);Ht(R,{size:16}),qe(2),i(S);var j=x(S,2),se=u(j);Ot(se,{size:16}),qe(2),i(j),i(Y),i(g),p(h,g)};V(z,h=>{a()&&a().messages.length>0?h($):h(o,!1)})}i(ae),bt(ae,h=>m(c,h),()=>e(c));var d=x(ae,2),y=u(d);Ls(y,{get tools(){return e(v)},get disabled(){return e(b)},placeholder:"Send a message...",get value(){return e(q)},set value(h){m(q,h)},get mediaItems(){return e(M)},set mediaItems(h){m(M,h)},$$events:{submit:H,uploadFile:h=>F(h.detail),toggleTool:P,startAudioCapture:L,stopAudioCapture:me,startVideoCapture:I,stopVideoCapture:T},$$legacy:!0}),i(d),i(J),i(K);var D=x(K,2);Rs(D,{get isOpen(){return e(k)},$$events:{close:()=>m(k,!1)}}),B(()=>{var h;return ge($e,((h=a())==null?void 0:h.title)||"New Chat")}),p(s,X),Ge(),w()}export{ao as component};
