import{a as Ut,n as Yt,b as v,c as fe,t as E,d as Xt}from"../chunks/B53aYDk4.js";import{i as Re}from"../chunks/iPtxYXkW.js";import{v as Et,b as It,aD as Pt,s as Ye,h as ge,j as Ct,a as ct,G as e,aa as ue,c as Jt,r as wt,d as Xe,g as Ne,m as Qt,e as gt,f as mt,p as Tt,aE as rt,t as zt,a7 as Zt,y as vt,aF as ht,aG as kt,aH as _t,B as ea,$ as xt,a4 as jt,aI as ta,aJ as aa,q as sa,aK as oa,aL as qt,aM as ra,k as la,E as ia,aN as na,aO as da,N as Nt,a6 as ca,a5 as va,w as Fe,T as B,z as Ge,X as A,V as c,W as n,S as ne,aP as bt,aQ as le,al as Je,aR as et,aS as yt,D as f,aT as Le,P as At,aU as Se}from"../chunks/HdFacVVh.js";import{s as me}from"../chunks/scx_I3NF.js";import{i as G}from"../chunks/B9A-6FJL.js";import{l as ua,m as fa,o as ee,p as pa}from"../chunks/BQXpTCfL.js";import{i as ga,l as _e,p as re,s as Te,b as tt}from"../chunks/C31peXCk.js";import{a as Oe,s as $t}from"../chunks/BNNRLxDv.js";import{s as xe,b as ut,C as ma,d as De,e as Dt,c as ie,f as ha,a as $e,r as Ze}from"../chunks/BqOXQazp.js";import{i as _a,o as ba,g as ya,b as $a,l as wa,c as ka,s as ft,v as xa,u as Aa,e as Ma,f as Sa,h as Ea,j as Ia,k as Pa}from"../chunks/DKo2NcW4.js";import{M as lt}from"../chunks/Cj9_wu-f.js";function Pe(s,t){return t}function Ca(s,t,r,y){for(var a=[],g=t.length,i=0;i<g;i++)aa(t[i].e,a,!0);var l=g>0&&a.length===0&&r!==null;if(l){var q=r.parentNode;sa(q),q.append(r),y.clear(),qe(s,t[0].prev,t[g-1].next)}oa(a,()=>{for(var u=0;u<g;u++){var d=t[u];l||(y.delete(d.k),qe(s,d.prev,d.next)),qt(d.e,!l)}})}function Ce(s,t,r,y,a,g=null){var i=s,l={flags:t,items:new Map,first:null},q=(t&Pt)!==0;if(q){var u=s;i=ge?Ye(Ct(u)):u.appendChild(Et())}ge&&ct();var d=null,I=!1,_=ue(()=>{var p=r();return jt(p)?p:p==null?[]:zt(p)});It(()=>{var p=e(_),b=p.length;if(I&&b===0)return;I=b===0;let z=!1;if(ge){var S=i.data===Jt;S!==(b===0)&&(i=wt(),Ye(i),Xe(!1),z=!0)}if(ge){for(var L=null,te,W=0;W<b;W++){if(Ne.nodeType===8&&Ne.data===Qt){i=Ne,z=!0,Xe(!1);break}var N=p[W],H=y(N,W);te=Ot(Ne,l,L,null,N,H,W,a,t,r),l.items.set(H,te),L=te}b>0&&Ye(wt())}ge||Ta(p,l,i,a,t,y,r),g!==null&&(b===0?d?gt(d):d=mt(()=>g(i)):d!==null&&Tt(d,()=>{d=null})),z&&Xe(!0),e(_)}),ge&&(i=Ne)}function Ta(s,t,r,y,a,g,i){var J,se,Q,F;var l=(a&ta)!==0,q=(a&(ht|_t))!==0,u=s.length,d=t.items,I=t.first,_=I,p,b=null,z,S=[],L=[],te,W,N,H;if(l)for(H=0;H<u;H+=1)te=s[H],W=g(te,H),N=d.get(W),N!==void 0&&((J=N.a)==null||J.measure(),(z??(z=new Set)).add(N));for(H=0;H<u;H+=1){if(te=s[H],W=g(te,H),N=d.get(W),N===void 0){var we=_?_.e.nodes_start:r;b=Ot(we,t,b,b===null?t.first:b.next,te,W,H,y,a,i),d.set(W,b),S=[],L=[],_=b.next;continue}if(q&&za(N,te,H,a),(N.e.f&rt)!==0&&(gt(N.e),l&&((se=N.a)==null||se.unfix(),(z??(z=new Set)).delete(N))),N!==_){if(p!==void 0&&p.has(N)){if(S.length<L.length){var C=L[0],D;b=C.prev;var K=S[0],ae=S[S.length-1];for(D=0;D<S.length;D+=1)Mt(S[D],C,r);for(D=0;D<L.length;D+=1)p.delete(L[D]);qe(t,K.prev,ae.next),qe(t,b,K),qe(t,ae,C),_=C,b=ae,H-=1,S=[],L=[]}else p.delete(N),Mt(N,_,r),qe(t,N.prev,N.next),qe(t,N,b===null?t.first:b.next),qe(t,b,N),b=N;continue}for(S=[],L=[];_!==null&&_.k!==W;)(_.e.f&rt)===0&&(p??(p=new Set)).add(_),L.push(_),_=_.next;if(_===null)continue;N=_}S.push(N),b=N,_=N.next}if(_!==null||p!==void 0){for(var R=p===void 0?[]:zt(p);_!==null;)(_.e.f&rt)===0&&R.push(_),_=_.next;var U=R.length;if(U>0){var Y=(a&Pt)!==0&&u===0?r:null;if(l){for(H=0;H<U;H+=1)(Q=R[H].a)==null||Q.measure();for(H=0;H<U;H+=1)(F=R[H].a)==null||F.fix()}Ca(t,R,Y,d)}}l&&Zt(()=>{var de;if(z!==void 0)for(N of z)(de=N.a)==null||de.apply()}),vt.first=t.first&&t.first.e,vt.last=b&&b.e}function za(s,t,r,y){(y&ht)!==0&&kt(s.v,t),(y&_t)!==0?kt(s.i,r):s.i=r}function Ot(s,t,r,y,a,g,i,l,q,u){var d=(q&ht)!==0,I=(q&ra)===0,_=d?I?ea(a):xt(a):a,p=(q&_t)===0?i:xt(i),b={i:p,v:_,k:g,a:null,e:null,prev:r,next:y};try{return b.e=mt(()=>l(s,_,p,u),ge),b.e.prev=r&&r.e,b.e.next=y&&y.e,r===null?t.first=b:(r.next=b,r.e.next=b.e),y!==null&&(y.prev=b,y.e.prev=b.e),b}finally{}}function Mt(s,t,r){for(var y=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,g=s.e.nodes_start;g!==y;){var i=la(g);a.before(g),g=i}}function qe(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function ja(s,t,r,y,a,g){let i=ge;ge&&ct();var l,q,u=null;ge&&Ne.nodeType===1&&(u=Ne,ct());var d=ge?Ne:s,I;It(()=>{const _=t()||null;var p=na;_!==l&&(I&&(_===null?Tt(I,()=>{I=null,q=null}):_===q?gt(I):qt(I)),_&&_!==q&&(I=mt(()=>{if(u=ge?u:document.createElementNS(p,_),Ut(u,u),y){ge&&ua(_)&&u.append(document.createComment(""));var b=ge?Ct(u):u.appendChild(Et());ge&&(b===null?Xe(!1):Ye(b)),y(u,b)}vt.nodes_end=u,d.before(u)})),l=_,l&&(q=l))},ia),i&&(Xe(!0),Ye(d))}function Ue(s,t,r=t){var y=da();fa(s,"input",a=>{var g=a?s.defaultValue:s.value;if(g=it(s)?nt(g):g,r(g),y&&g!==(g=t())){var i=s.selectionStart,l=s.selectionEnd;s.value=g??"",l!==null&&(s.selectionStart=i,s.selectionEnd=Math.min(l,s.value.length))}}),(ge&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&r(it(s)?nt(s.value):s.value),ca(()=>{var a=t();it(s)&&a===nt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function it(s){var t=s.type;return t==="number"||t==="range"}function nt(s){return s===""?null:+s}function pt(s,t,r){if(s.multiple)return Na(s,t);for(var y of s.options){var a=Lt(y);if(ga(a,t)){y.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function qa(s,t){let r=!0;va(()=>{t&&pt(s,Nt(t),r),r=!1;var y=new MutationObserver(()=>{var a=s.__value;pt(s,a)});return y.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{y.disconnect()}})}function Na(s,t){for(var r of s.options)r.selected=~t.indexOf(Lt(r))}function Lt(s){return"__value"in s?s.__value:s.value}function Da(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function St(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function dt(s,t){var g;var r=(g=s.$$events)==null?void 0:g[t.type],y=jt(r)?r.slice():r==null?[]:[r];for(var a of y)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var La=Yt("<svg><!><!></svg>");function ze(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]),y=_e(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Fe(t,!1);let a=re(t,"name",8,void 0),g=re(t,"color",8,"currentColor"),i=re(t,"size",8,24),l=re(t,"strokeWidth",8,2),q=re(t,"absoluteStrokeWidth",8,!1),u=re(t,"iconNode",24,()=>[]);const d=(...z)=>z.filter((S,L,te)=>!!S&&te.indexOf(S)===L).join(" ");Re();var I=La();let _;var p=c(I);Ce(p,1,u,Pe,(z,S)=>{let L=()=>e(S)[0],te=()=>e(S)[1];var W=fe(),N=ne(W);ja(N,L,!0,(H,we)=>{let C;B(()=>C=ut(H,C,{...te()}))}),v(z,W)});var b=A(p);xe(b,t,"default",{}),n(I),B((z,S)=>_=ut(I,_,{...Oa,...y,width:i(),height:i(),stroke:g(),"stroke-width":z,class:S}),[()=>q()?Number(l())*24/Number(i()):l(),()=>d("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],ue),v(s,I),Ge()}function Ha(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ka(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"circle-arrow-up"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m16 12-4-4-4 4"}],["path",{d:"M12 16V8"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Va(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ra(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Fa(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"message-square"},()=>r,{iconNode:[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ga(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ht(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Kt(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"plus"},()=>r,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Ba(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Wa(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"video"},()=>r,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}function Vt(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]);ze(s,Te({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,g)=>{var i=fe(),l=ne(i);xe(l,t,"default",{}),v(a,i)},$$slots:{default:!0}}))}var Ua=E('<div class="spinner svelte-1pi70xe"></div>'),Ya=E("<button><!> <!></button>");function Ee(s,t){const r=_e(t,["children","$$slots","$$events","$$legacy"]),y=_e(r,["type","variant","size","disabled","loading","fullWidth"]);let a=re(t,"type",8,"button"),g=re(t,"variant",8,"primary"),i=re(t,"size",8,"md"),l=re(t,"disabled",8,!1),q=re(t,"loading",8,!1),u=re(t,"fullWidth",8,!1);var d=Ya();let I;var _=c(d);{var p=z=>{var S=Ua();v(z,S)};G(_,z=>{q()&&z(p)})}var b=A(_,2);xe(b,t,"default",{}),n(d),B(z=>I=ut(d,I,{type:a(),class:`button ${g()??""} ${i()??""} ${(u()?"full-width":"")??""}`,disabled:l(),...y,[ma]:z},"svelte-1pi70xe"),[()=>({loading:q()})],ue),ee("click",d,function(z){dt.call(this,t,z)}),ee("keydown",d,function(z){dt.call(this,t,z)}),ee("keyup",d,function(z){dt.call(this,t,z)}),v(s,d)}var Xa=E('<option class="svelte-8oybb9"> </option>'),Ja=E('<optgroup label="Local Models" class="svelte-8oybb9"></optgroup>'),Qa=E('<option class="svelte-8oybb9"> </option>'),Za=E('<option class="svelte-8oybb9"> </option>'),es=E('<option disabled class="svelte-8oybb9"> </option>'),ts=E('<!> <span class="svelte-8oybb9">New Chat</span>',1),as=E('<button type="button"><span class="chat-title svelte-8oybb9"> </span> <!></button>'),ss=E('<aside><div class="sidebar-header svelte-8oybb9"><div class="logo-container svelte-8oybb9"><!> <h2 class="svelte-8oybb9">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-8oybb9"><div class="model-selector svelte-8oybb9"><select class="select-styled svelte-8oybb9"><!><optgroup label="OpenAI Models" class="svelte-8oybb9"></optgroup><optgroup label="Google Models" class="svelte-8oybb9"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-8oybb9"></optgroup></select></div> <!> <div class="chats-list svelte-8oybb9"></div></div></aside>');function os(s,t){var de;Fe(t,!1);const[r,y]=$t(),a=()=>Oe(Dt,"$activeChat",r),g=()=>Oe(ka,"$allModelsStore",r),i=()=>Oe(wa,"$localModelsStore",r),l=()=>Oe(ie,"$chatStore",r);let q=re(t,"isMobile",8,!1),u=re(t,"isExpanded",8,!0);const d=bt();let I=le(((de=a())==null?void 0:de.model.id)||"claude-3-5-sonnet");Je(async()=>{await _a()});function _(){const j=g().find(k=>k.id===e(I));j&&ie.createNewChat(j)}function p(j){ie.selectChat(j),q()&&d("toggleSidebar",!1)}function b(j,k){k.stopPropagation(),ie.deleteChat(j)}function z(j){const k=j.target;if(f(I,k.value),a()){const x=g().find($=>$.id===e(I));x&&ie.updateChatModel(a().id,x)}}et(()=>a(),()=>{a()&&f(I,a().model.id)}),yt(),Re();var S=ss();let L;var te=c(S),W=c(te),N=c(W);Fa(N,{size:24,color:"var(--accent-color)"}),Le(2),n(W);var H=A(W,2);{var we=j=>{const k=ue(()=>u()?"Collapse sidebar":"Expand sidebar");Ee(j,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(k)},$$events:{click:()=>d("toggleSidebar",!u())},children:(x,$)=>{Ha(x,{size:20})},$$slots:{default:!0}})};G(H,j=>{q()&&j(we)})}n(te);var C=A(te,2),D=c(C),K=c(D);qa(K,()=>e(I));var ae,R=c(K);{var U=j=>{var k=Ja();Ce(k,5,i,Pe,(x,$)=>{var M=Xa(),oe={},he=c(M,!0);n(M),B(()=>{oe!==(oe=e($).id)&&(M.value=(M.__value=e($).id)==null?"":e($).id),me(he,e($).name)}),v(x,M)}),n(k),v(j,k)};G(R,j=>{i().length>0&&j(U)})}var Y=A(R);Ce(Y,5,()=>ba,Pe,(j,k)=>{var x=Qa(),$={},M=c(x,!0);n(x),B(()=>{$!==($=e(k).id)&&(x.value=(x.__value=e(k).id)==null?"":e(k).id),me(M,e(k).name)}),v(j,x)}),n(Y);var J=A(Y);Ce(J,5,()=>ya,Pe,(j,k)=>{var x=Za(),$={},M=c(x,!0);n(x),B(()=>{$!==($=e(k).id)&&(x.value=(x.__value=e(k).id)==null?"":e(k).id),me(M,e(k).name)}),v(j,x)}),n(J);var se=A(J);Ce(se,5,()=>$a,Pe,(j,k)=>{var x=es(),$={},M=c(x,!0);n(x),B(()=>{$!==($=e(k).id)&&(x.value=(x.__value=e(k).id)==null?"":e(k).id),me(M,e(k).name)}),v(j,x)}),n(se),n(K),n(D);var Q=A(D,2);Ee(Q,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:_},children:(j,k)=>{var x=ts(),$=ne(x);Kt($,{size:16}),Le(2),v(j,x)},$$slots:{default:!0}});var F=A(Q,2);Ce(F,5,()=>l().chats,Pe,(j,k)=>{var x=as();let $;var M=c(x),oe=c(M,!0);n(M);var he=A(M,2);Ee(he,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:ce=>b(e(k).id,ce)},children:(ce,be)=>{Vt(ce,{size:16})},$$slots:{default:!0}}),n(x),B(ce=>{$=De(x,1,"chat-item svelte-8oybb9",null,$,ce),me(oe,e(k).title||"New Chat")},[()=>{var ce;return{active:e(k).id===((ce=a())==null?void 0:ce.id)}}],ue),ee("click",x,()=>p(e(k).id)),v(j,x)}),n(F),n(C),n(S),B(j=>{L=De(S,1,"sidebar svelte-8oybb9",null,L,j),ae!==(ae=e(I))&&(K.value=(K.__value=e(I))==null?"":e(I),pt(K,e(I)))},[()=>({expanded:u()})],ue),ee("change",K,z),v(s,S),Ge(),y()}var rs=E('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),ls=E('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),is=E('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ns=E('<div class="file-size svelte-1mjurqb"> </div>'),ds=E('<span class="document-status success svelte-1mjurqb"> </span>'),cs=E('<span class="document-status info svelte-1mjurqb">Document attached</span>'),vs=E('<span class="document-status success svelte-1mjurqb">Document processed</span>'),us=E('<span class="document-status info svelte-1mjurqb">Document</span>'),fs=E('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),ps=E('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">ðŸ“„</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),gs=E('<div class="media-container svelte-1mjurqb"></div>'),ms=E('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),hs=E('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),_s=E('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),bs=E('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ys=E('<div class="media-container assistant-media svelte-1mjurqb"></div>'),$s=E('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),ws=E('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ks=E('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),xs=E('<div class="content system-message svelte-1mjurqb"><!></div>'),As=E('<div class="timestamp svelte-1mjurqb"> </div>'),Ms=E('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">Ã—</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),Ss=E("<div><!> <!></div> <!>",1);function Es(s,t){Fe(t,!1);const r=le(),y=le();let a=re(t,"message",8),g=re(t,"isStreaming",8,!1),i=re(t,"scrollToBottom",8,!1),l=le(!1),q=le(""),u=le(""),d=le();Je(()=>{if(i()&&e(d)){const C=e(d).parentElement;C&&(C.scrollTop=C.scrollHeight)}});function I(C,D=2){if(C===0)return"0 Bytes";const K=1024,ae=D<0?0:D,R=["Bytes","KB","MB","GB","TB"],U=Math.floor(Math.log(C)/Math.log(K));return parseFloat((C/Math.pow(K,U)).toFixed(ae))+" "+R[U]}function _(C,D="Preview image"){f(q,C),f(u,D),f(l,!0)}function p(){f(l,!1)}et(()=>At(a()),()=>{f(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),et(()=>At(a()),()=>{f(y,`message ${a().role}`)}),yt(),Re();var b=Ss(),z=ne(b),S=c(z);{var L=C=>{var D=ms(),K=c(D),ae=c(K),R=c(ae,!0);n(ae),n(K);var U=A(K,2);{var Y=J=>{var se=gs();Ce(se,5,()=>a().media,Pe,(Q,F,de)=>{var j=fe(),k=ne(j);{var x=M=>{var oe=rs(),he=c(oe);$e(he,"alt",`Image ${de+1}`),n(oe),B(()=>$e(he,"src",e(F).preview)),ee("click",oe,()=>{e(F).preview&&_(e(F).preview,`Image ${de+1}`)}),ee("keydown",oe,ce=>{if(ce.key==="Enter"||ce.key===" "){if(ce.preventDefault(),!e(F).preview)return;_(e(F).preview,`Image ${de+1}`)}}),v(M,oe)},$=(M,oe)=>{{var he=be=>{var Ie=ls();B(()=>$e(Ie,"src",e(F).preview)),v(be,Ie)},ce=(be,Ie)=>{{var Ae=h=>{var o=is();B(()=>$e(o,"src",e(F).preview)),v(h,o)},ke=(h,o)=>{{var w=m=>{var O=ps(),P=A(c(O),2),X=c(P),ye=c(X,!0);n(X);var ve=A(X,2);{var Z=Me=>{var je=ns(),Be=c(je,!0);n(je),B(We=>me(Be,We),[()=>I(e(F).size)],ue),v(Me,je)};G(ve,Me=>{e(F).size&&Me(Z)})}var V=A(ve,2),T=c(V);{var pe=Me=>{var je=ds(),Be=c(je);n(je),B(We=>me(Be,`âœ“ Uploaded to OpenAI (ID: ${We??""}...)`),[()=>e(F).fileId.substring(0,8)],ue),v(Me,je)},at=(Me,je)=>{{var Be=He=>{var Qe=fe(),Rt=ne(Qe);{var Ft=Ke=>{var st=cs();v(Ke,st)},Gt=(Ke,st)=>{{var Bt=Ve=>{var ot=vs();v(Ve,ot)},Wt=Ve=>{var ot=us();v(Ve,ot)};G(Ke,Ve=>{a().role==="assistant"?Ve(Bt):Ve(Wt,!1)},st)}};G(Rt,Ke=>{a().role==="user"?Ke(Ft):Ke(Gt,!1)})}v(He,Qe)},We=He=>{var Qe=fs();v(He,Qe)};G(Me,He=>{e(F).preview?He(Be):He(We,!1)},je)}};G(T,Me=>{e(F).fileId?Me(pe):Me(at,!1)})}n(V),n(P),n(O),B(()=>me(ye,e(F).name||"Document")),v(m,O)};G(h,m=>{e(F).type==="document"&&m(w)},o)}};G(be,h=>{e(F).type==="video"?h(Ae):h(ke,!1)},Ie)}};G(M,be=>{e(F).type==="audio"?be(he):be(ce,!1)},oe)}};G(k,M=>{e(F).type==="image"?M(x):M($,!1)})}v(Q,j)}),n(se),v(J,se)};G(U,J=>{a().media&&a().media.length>0&&J(Y)})}n(D),B(()=>me(R,a().content)),v(C,D)},te=(C,D)=>{{var K=R=>{var U=ks(),Y=c(U);lt(Y,{get content(){return a().content},get scrollToBottom(){return i()}});var J=A(Y,2);{var se=k=>{var x=ys();Ce(x,5,()=>a().media,Pe,($,M,oe)=>{var he=fe(),ce=ne(he);{var be=Ae=>{var ke=hs(),h=c(ke);$e(h,"alt",`Generated image ${oe+1}`),Le(2),n(ke),B(()=>$e(h,"src",e(M).preview)),ee("click",ke,()=>{e(M).preview&&_(e(M).preview,`Generated image ${oe+1}`)}),ee("keydown",ke,o=>{if(o.key==="Enter"||o.key===" "){if(o.preventDefault(),!e(M).preview)return;_(e(M).preview,`Generated image ${oe+1}`)}}),v(Ae,ke)},Ie=(Ae,ke)=>{{var h=w=>{var m=_s();B(()=>$e(m,"src",e(M).preview)),v(w,m)},o=(w,m)=>{{var O=P=>{var X=bs();B(()=>$e(X,"src",e(M).preview)),v(P,X)};G(w,P=>{e(M).type==="video"&&P(O)},m)}};G(Ae,w=>{e(M).type==="audio"?w(h):w(o,!1)},ke)}};G(ce,Ae=>{e(M).type==="image"?Ae(be):Ae(Ie,!1)})}v($,he)}),n(x),v(k,x)};G(J,k=>{a().media&&a().media.length>0&&k(se)})}var Q=A(J,2);{var F=k=>{var x=$s(),$=A(c(x),2),M=c($);lt(M,{get content(){return a().thinking},scrollToBottom:!1}),n($),n(x),v(k,x)};G(Q,k=>{a().thinking&&k(F)})}var de=A(Q,2);{var j=k=>{var x=ws();v(k,x)};G(de,k=>{g()&&k(j)})}n(U),v(R,U)},ae=(R,U)=>{{var Y=J=>{var se=xs(),Q=c(se);lt(Q,{get content(){return a().content},get scrollToBottom(){return i()}}),n(se),v(J,se)};G(R,J=>{a().role==="system"&&J(Y)},U)}};G(C,R=>{a().role==="assistant"?R(K):R(ae,!1)},D)}};G(S,C=>{a().role==="user"?C(L):C(te,!1)})}var W=A(S,2);{var N=C=>{var D=As(),K=c(D,!0);n(D),B(()=>me(K,e(r))),v(C,D)};G(W,C=>{a().role==="user"&&C(N)})}n(z),tt(z,C=>f(d,C),()=>e(d));var H=A(z,2);{var we=C=>{var D=Ms(),K=c(D),ae=c(K),R=A(ae,2),U=A(R,2),Y=c(U,!0);n(U),n(K),n(D),B(()=>{$e(R,"src",e(q)),$e(R,"alt",e(u)),me(Y,e(u))}),ee("click",ae,p),ee("click",K,St(()=>{})),ee("keydown",K,St(()=>{})),ee("click",D,p),ee("keydown",D,J=>J.key==="Escape"&&p()),v(C,D)};G(H,C=>{e(l)&&C(we)})}B(()=>De(z,1,ha(e(y)),"svelte-1mjurqb")),v(s,b),Ge()}var Is=E('<img class="svelte-4ggl67">'),Ps=E('<div class="file-preview svelte-4ggl67"><span class="svelte-4ggl67"> </span></div>'),Cs=E('<div class="media-item svelte-4ggl67"><!> <button type="button" class="remove-media svelte-4ggl67" aria-label="Remove media">&times;</button></div>'),Ts=E("<div><!></div>"),zs=E("<div><!></div>"),js=E("<div><!></div>"),qs=E('<button type="button"> </button>'),Ns=E('<div class="message-input-container svelte-4ggl67"><div class="media-preview svelte-4ggl67"></div> <div role="region" aria-label="Message input area with file drop zone"><div class="input-container svelte-4ggl67"><textarea rows="2" enterkeyhint="enter" class="svelte-4ggl67"></textarea></div> <div class="actions-bar svelte-4ggl67"><div class="left-actions svelte-4ggl67"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple class="svelte-4ggl67"> <!> <!> <!> <!></div> <div class="right-actions svelte-4ggl67"><!></div></div></div> <div class="tools-bar svelte-4ggl67"></div></div>');function Ds(s,t){Fe(t,!1);let r=re(t,"value",12,""),y=re(t,"placeholder",8,"Send a message..."),a=re(t,"disabled",8,!1),g=re(t,"isRecording",8,!1),i=re(t,"isCapturingVideo",8,!1),l=re(t,"mediaItems",28,()=>[]),q=re(t,"tools",24,()=>({}));const u=bt();let d=le(),I=le(),_=!1,p=le(!1);Je(()=>(b(),window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}));function b(){_=window.innerWidth<768}function z(){e(d)&&(Se(d,e(d).style.height="auto"),Se(d,e(d).style.height=`${Math.min(e(d).scrollHeight,200)}px`))}function S(){a()||!r().trim()&&l().length===0||(u("submit",{content:r().trim(),media:l(),tools:q()}),r(""),e(d)&&Se(d,e(d).style.height="auto"))}function L(o){o.key==="Enter"&&!o.shiftKey&&!_&&(o.preventDefault(),S())}function te(){g()?u("stopAudioCapture"):u("startAudioCapture")}function W(){i()?u("stopVideoCapture"):u("startVideoCapture")}function N(o){const w=o.target;if(w.files&&w.files.length>0){const m=Array.from(w.files);u("uploadFile",m),w.value=""}}function H(o){const w=!q()[o];u("toggleTool",{tool:o,enabled:w})}function we(o){o.preventDefault(),o.stopPropagation(),a()||f(p,!0)}function C(o){o.preventDefault(),o.stopPropagation(),a()||f(p,!0)}function D(o){o.preventDefault(),o.stopPropagation(),o.target===e(I)&&f(p,!1)}function K(o){var w;if(o.preventDefault(),o.stopPropagation(),f(p,!1),!a()&&(w=o.dataTransfer)!=null&&w.files&&o.dataTransfer.files.length>0){const m=Array.from(o.dataTransfer.files);if(document.activeElement===e(d)&&(e(d).blur(),setTimeout(()=>{e(d).focus()},10)),u("uploadFile",m),o.dataTransfer.items)for(let O=0;O<o.dataTransfer.items.length;O++)o.dataTransfer.items[O].kind==="string"&&(o.dataTransfer.items.remove(O),O--)}}function ae(o){var w;if(!a()&&(w=o.clipboardData)!=null&&w.files&&o.clipboardData.files.length>0){o.preventDefault();const m=Array.from(o.clipboardData.files);u("uploadFile",m)}}et(()=>e(d),()=>{e(d)&&z()}),yt(),Re();var R=Ns(),U=c(R);Ce(U,5,l,Pe,(o,w)=>{var m=Cs(),O=c(m);{var P=ve=>{var Z=Is();B(()=>{$e(Z,"src",e(w).preview),$e(Z,"alt",e(w).name)}),v(ve,Z)},X=ve=>{var Z=Ps(),V=c(Z),T=c(V,!0);n(V),n(Z),B(()=>me(T,e(w).name)),v(ve,Z)};G(O,ve=>{e(w).type==="image"&&e(w).preview?ve(P):ve(X,!1)})}var ye=A(O,2);n(m),ee("click",ye,()=>{l(l().filter(ve=>ve.id!==e(w).id))}),v(o,m)}),n(U);var Y=A(U,2);let J;var se=c(Y),Q=c(se);pa(Q),tt(Q,o=>f(d,o),()=>e(d)),n(se);var F=A(se,2),de=c(F),j=c(de),k=A(j,2);Ee(k,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var o;return(o=document.getElementById("file-upload"))==null?void 0:o.click()}},children:(o,w)=>{Ht(o,{size:18})},$$slots:{default:!0}});var x=A(k,2);const $=ue(()=>a()||g()),M=ue(()=>g()?"Stop recording":"Start recording");Ee(x,{variant:"icon",size:"sm",get disabled(){return e($)},get"aria-label"(){return e(M)},$$events:{click:te},children:(o,w)=>{var m=Ts();let O;var P=c(m);Ga(P,{size:18}),n(m),B(X=>O=De(m,1,"svelte-4ggl67",null,O,X),[()=>({active:g()})],ue),v(o,m)},$$slots:{default:!0}});var oe=A(x,2);const he=ue(()=>a()||g()),ce=ue(()=>i()?"Stop video capture":"Start video capture");Ee(oe,{variant:"icon",size:"sm",get disabled(){return e(he)},get"aria-label"(){return e(ce)},$$events:{click:W},children:(o,w)=>{var m=zs();let O;var P=c(m);Wa(P,{size:18}),n(m),B(X=>O=De(m,1,"svelte-4ggl67",null,O,X),[()=>({active:i()})],ue),v(o,m)},$$slots:{default:!0}});var be=A(oe,2);Ee(be,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>H("search")},children:(o,w)=>{var m=js();let O;var P=c(m);Va(P,{size:18}),n(m),B(X=>O=De(m,1,"svelte-4ggl67",null,O,X),[()=>({active:q().search})],ue),v(o,m)},$$slots:{default:!0}}),n(de);var Ie=A(de,2),Ae=c(Ie);const ke=ue(()=>a()||!r().trim()&&l().length===0);Ee(Ae,{variant:"icon",size:"sm",get disabled(){return e(ke)},class:"send-button","aria-label":"Send message",$$events:{click:S},children:(o,w)=>{Ka(o,{size:24,strokeWidth:2.5})},$$slots:{default:!0}}),n(Ie),n(F),n(Y),tt(Y,o=>f(I,o),()=>e(I));var h=A(Y,2);Ce(h,5,()=>Object.entries(q()),Pe,(o,w)=>{let m=()=>e(w)[0],O=()=>e(w)[1];var P=fe(),X=ne(P);{var ye=ve=>{var Z=qs();let V;var T=c(Z,!0);n(Z),B(pe=>{V=De(Z,1,"tool-button svelte-4ggl67",null,V,pe),$e(Z,"aria-label",`Toggle ${m()??""}`),me(T,m())},[()=>({enabled:O()})],ue),ee("click",Z,()=>H(m())),v(ve,Z)};G(X,ve=>{m()!=="search"&&ve(ye)})}v(o,P)}),n(h),n(R),B(o=>{J=De(Y,1,"input-bubble svelte-4ggl67",null,J,o),$e(Q,"placeholder",y()),Q.disabled=a()},[()=>({dragging:e(p)})],ue),Ue(Q,r),ee("keydown",Q,L),ee("input",Q,z),ee("paste",Q,ae),ee("change",j,N),ee("dragenter",Y,we),ee("dragover",Y,C),ee("dragleave",Y,D),ee("drop",Y,K),v(s,R),Ge()}var Os=E('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Ls=E('<span class="error-message svelte-8a76oy"> </span>'),Hs=E('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ks(s,t){Fe(t,!1);const[r,y]=$t(),a=()=>Oe(ft,"$settingsStore",r);let g=re(t,"isOpen",8,!1);const i=bt();let l=le({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434"}),q=le(!1),u=le(!1),d=le("");Je(()=>{console.log("Settings component mounted, current settingsStore value:",a());const S=a().apiKeys||{};console.log("Stored API keys from settings store:",S),f(l,{anthropic:S.anthropic||"",openai:S.openai||"",google:S.google||"",ollamaHost:S.ollamaHost||"http://localhost:11434"}),console.log("Initialized API key form with:",e(l))});function I(){i("close")}async function _(){var S;f(q,!0),f(u,!1),f(d,"");try{console.log("Saving API keys to settingsStore:",e(l)),e(l).google&&(console.log("EXACT GOOGLE KEY BEING SAVED: ",e(l).google),console.log(`Google key before saving: length=${e(l).google.length}, starts with=${e(l).google.substring(0,4)}`)),await ft.updateApiKeys({anthropic:e(l).anthropic,openai:e(l).openai,google:e(l).google,ollamaHost:e(l).ollamaHost||"http://localhost:11434"}),console.log("API keys saved. Current settingsStore value:",a());try{const L={...a(),apiKeys:{...a().apiKeys}};localStorage.setItem("gervais-api-backup",JSON.stringify(L)),console.log("API keys also backed up to localStorage")}catch(L){console.error("Failed to backup API keys to localStorage:",L)}(S=a().apiKeys)!=null&&S.google&&(console.log("EXACT GOOGLE KEY AFTER SAVING: ",a().apiKeys.google),console.log(`Google key after saving: length=${a().apiKeys.google.length}, starts with=${a().apiKeys.google.substring(0,4)}`)),f(u,!0),console.log("API keys saved successfully"),setTimeout(()=>{f(u,!1)},3e3)}catch(L){console.error("Failed to save API keys:",L),f(d,L instanceof Error?L.message:"Unknown error"),f(q,!1)}finally{f(q,!1)}}Re();var p=fe(),b=ne(p);{var z=S=>{var L=Hs(),te=c(L),W=c(te),N=A(c(W),2);Ee(N,{variant:"icon","aria-label":"Close settings",$$events:{click:I},children:($,M)=>{Vt($,{size:20})},$$slots:{default:!0}}),n(W);var H=A(W,2),we=c(H),C=A(c(we),4),D=c(C),K=A(c(D),2);Ze(K),n(D);var ae=A(D,2),R=A(c(ae),2);Ze(R),n(ae);var U=A(ae,2),Y=A(c(U),2);Ze(Y),n(U);var J=A(U,2),se=A(c(J),2);Ze(se),Le(2),n(J),n(C);var Q=A(C,2),F=c(Q);Ee(F,{variant:"primary",get disabled(){return e(q)},$$events:{click:_},children:($,M)=>{Le();var oe=Xt();B(()=>me(oe,e(q)?"Saving...":"Save API Keys")),v($,oe)},$$slots:{default:!0}});var de=A(F,2);{var j=$=>{var M=Os();v($,M)};G(de,$=>{e(u)&&$(j)})}var k=A(de,2);{var x=$=>{var M=Ls(),oe=c(M,!0);n(M),B(()=>me(oe,e(d))),v($,M)};G(k,$=>{e(d)&&$(x)})}n(Q),n(we),n(H),n(te),n(L),Ue(K,()=>e(l).anthropic,$=>Se(l,e(l).anthropic=$)),Ue(R,()=>e(l).openai,$=>Se(l,e(l).openai=$)),Ue(Y,()=>e(l).google,$=>Se(l,e(l).google=$)),Ue(se,()=>e(l).ollamaHost,$=>Se(l,e(l).ollamaHost=$)),ee("click",L,Da(I)),ee("keydown",L,$=>$.key==="Escape"&&I()),v(S,L)};G(b,S=>{g()&&S(z)})}v(s,p),Ge(),y()}var Vs=E('<div class="sidebar-backdrop svelte-jl09k0" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=E('<div class="empty-state svelte-jl09k0"><h2 class="svelte-jl09k0">Start a new conversation</h2> <p class="svelte-jl09k0">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-jl09k0"><div class="feature svelte-jl09k0"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-jl09k0"><!> <span>Vision support for images</span></div></div></div>'),Fs=E('<div class="settings-portal svelte-jl09k0"><!></div>'),Gs=E('<div class="chat-container svelte-jl09k0"><!> <!> <main class="chat-main svelte-jl09k0"><header class="chat-header svelte-jl09k0"><div class="left-side svelte-jl09k0"><!></div> <h1 class="chat-title svelte-jl09k0"> </h1> <div class="right-side svelte-jl09k0"><!></div></header> <div class="chat-messages svelte-jl09k0"><!></div> <div class="input-container svelte-jl09k0"><!></div></main></div> <!>',1);function so(s,t){Fe(t,!1);const[r,y]=$t(),a=()=>Oe(Dt,"$activeChat",r),g=()=>Oe(ft,"$settingsStore",r);let i=le(!1),l=le(!0),q=le(""),u=le(!1),d=le(!1),I=le([]),_=le({search:!1}),p=le(),b=le(!1);function z(){f(i,window.innerWidth<768),e(i)?f(l,!1):f(l,!0)}Je(()=>{z(),window.addEventListener("resize",z);function h(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`)}return h(),window.addEventListener("resize",h),()=>{window.removeEventListener("resize",z),window.removeEventListener("resize",h)}});function S(){f(l,!e(l))}async function L({detail:h}){var X,ye,ve;if(!a())return;const o=a().model.provider;if(console.log("Current settings store state:",g()),o==="openai"&&!((X=g().apiKeys)!=null&&X.openai)){console.warn("OpenAI API key not set, opening settings dialog"),f(b,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(o==="anthropic"&&!((ye=g().apiKeys)!=null&&ye.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),f(b,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(o==="google"&&!((ve=g().apiKeys)!=null&&ve.google)){console.warn("Google API key not set, opening settings dialog"),f(b,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:w,media:m,tools:O}=h;console.log("Media items in submission:",m),await ie.addMessage(a().id,{role:"user",content:w,media:m}),f(q,""),f(I,[]),setTimeout(()=>{e(p)&&Se(p,e(p).scrollTop=e(p).scrollHeight)},100);const P=await ie.addMessage(a().id,{role:"assistant",content:""});f(u,!0),f(d,!0);try{const Z=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",Z);const V=a().model.id;if(o==="anthropic")await Ma(V,Z,T=>{ie.updateMessage(a().id,P,{content:T})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(p)&&Se(p,e(p).scrollTop=e(p).scrollHeight)},100)},T=>{console.error("Error generating response:",T),ie.updateMessage(a().id,P,{content:`Error generating response: â€“ ${T.message}`}),f(u,!1),f(d,!1)},T=>{ie.updateMessage(a().id,P,{thinking:T})});else if(o==="openai")if(e(d))await Sa(V,Z,T=>{ie.updateMessage(a().id,P,{content:T})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(p)&&Se(p,e(p).scrollTop=e(p).scrollHeight)},100)},T=>{console.error("Error generating response from OpenAI:",T);const pe=T.message||"An unknown error occurred";ie.updateMessage(a().id,P,{content:`Error: ${pe}`}),f(u,!1),f(d,!1)});else try{const T=await Ea(V,Z);ie.updateMessage(a().id,P,{content:T}),f(u,!1)}catch(T){console.error("Error generating non-streaming response from OpenAI:",T);const pe=T.message||"An unknown error occurred";throw ie.updateMessage(a().id,P,{content:`Error: ${pe}`}),f(u,!1),T}else if(o==="google")await Ia(V,Z,(T,pe)=>{ie.updateMessage(a().id,P,{content:T,media:pe})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(p)&&Se(p,e(p).scrollTop=e(p).scrollHeight)},100)},T=>{console.error("Error generating response from Google:",T);const pe=T.message||"An unknown error occurred";ie.updateMessage(a().id,P,{content:`Error: ${pe}`}),f(u,!1),f(d,!1)},T=>{ie.updateMessage(a().id,P,{thinking:T})});else if(o==="ollama")try{await Pa(V,Z,T=>{ie.updateMessage(a().id,P,{content:T})},()=>{f(u,!1),f(d,!1),setTimeout(()=>{e(p)&&Se(p,e(p).scrollTop=e(p).scrollHeight)},100)},T=>{console.error("Error generating response from Ollama:",T);const pe=T.message||"An unknown error occurred";ie.updateMessage(a().id,P,{content:`Error connecting to Ollama: ${pe}. Make sure Ollama is running locally.`}),f(u,!1),f(d,!1)})}catch(T){throw console.error("Error generating response from Ollama:",T),T}else{let T="";const pe="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const at of pe)await new Promise(Me=>setTimeout(Me,50)),T+=at+" ",ie.updateMessage(a().id,P,{content:T.trim()});f(u,!1),f(d,!1)}}catch(Z){if(console.error("Error generating response:",Z),e(u)){const V=Z.message||"An unknown error occurred";ie.updateMessage(a().id,P,{content:`Error: ${V}`}),f(u,!1),f(d,!1)}}}function te(h){h.forEach(async o=>{const w=xa(),m=o.name,O=o.size;let P="other",X,ye;console.log(`Processing file: ${m}, type: ${o.type}, size: ${O} bytes`);const ve=V=>{var T;if(V.type.includes("pdf")||V.type.includes("word")||V.type.includes("excel")||V.type.includes("spreadsheet")||V.type.includes("presentation")||V.type.includes("officedocument")||V.type.includes("application/rtf")||V.type.includes("text/rtf"))return!0;if(!V.type||V.type==="application/octet-stream"){const pe=(T=m.split(".").pop())==null?void 0:T.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(pe||"")}return!1};if(o.type.startsWith("image/")){P="image";try{X=await W(o),console.log(`Created data URL for image ${m} (length: ${X.length} chars)`)}catch(V){console.error(`Failed to create data URL for ${m}:`,V)}}else if(o.type.startsWith("audio/"))P="audio";else if(o.type.startsWith("video/"))P="video";else if(o.type.startsWith("text/"))P="text";else if(ve(o)){if(P="document",a()&&a().model.provider==="openai")try{ye=await Aa(o),console.log(`Document ${m} uploaded to OpenAI with ID: ${ye}`)}catch(V){console.error(`Failed to upload document to OpenAI: ${V.message}`),alert(`Failed to upload document to OpenAI: ${V.message}`)}try{X=await W(o),console.log(`Created data URL for document ${m}, mime type: ${o.type}`),console.log(`Document data URL length: ${X.length} chars`),O>5*1024*1024&&console.warn(`Warning: Large document (${(O/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(V){console.error(`Failed to create data URL for ${m}:`,V)}}const Z={id:w,type:P,name:m,preview:X,size:O,timestamp:Date.now(),fileId:ye};console.log(`Adding media item: ${P} ${m}`),f(I,[...e(I),Z])})}async function W(h){return new Promise((o,w)=>{const m=new FileReader;m.onload=()=>{const O=m.result;o(O)},m.onerror=O=>{console.error("Error reading file:",O),w(O)},m.readAsDataURL(h)})}function N({detail:h}){const{tool:o,enabled:w}=h;f(_,{...e(_),[o]:w})}function H(){console.log("Start audio capture")}function we(){console.log("Stop audio capture")}function C(){console.log("Start video capture")}function D(){console.log("Stop video capture")}Re();var K=Gs(),ae=ne(K),R=c(ae);os(R,{get isMobile(){return e(i)},get isExpanded(){return e(l)},$$events:{toggleSidebar:({detail:h})=>f(l,h)}});var U=A(R,2);{var Y=h=>{var o=Vs();ee("click",o,()=>f(l,!1)),ee("keydown",o,w=>w.key==="Escape"&&f(l,!1)),v(h,o)};G(U,h=>{e(i)&&e(l)&&h(Y)})}var J=A(U,2),se=c(J),Q=c(se),F=c(Q);{var de=h=>{Ee(h,{variant:"icon","aria-label":"Open menu",$$events:{click:S},children:(o,w)=>{Kt(o,{size:20})},$$slots:{default:!0}})};G(F,h=>{e(i)&&h(de)})}n(Q);var j=A(Q,2),k=c(j,!0);n(j);var x=A(j,2),$=c(x);Ee($,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>f(b,!0)},children:(h,o)=>{Ba(h,{size:20})},$$slots:{default:!0}}),n(x),n(se);var M=A(se,2),oe=c(M);{var he=h=>{var o=fe(),w=ne(o);Ce(w,1,()=>a().messages,Pe,(m,O,P)=>{const X=ue(()=>e(d)&&P===a().messages.length-1&&e(O).role==="assistant"),ye=ue(()=>P===a().messages.length-1);Es(m,{get message(){return e(O)},get isStreaming(){return e(X)},get scrollToBottom(){return e(ye)}})}),v(h,o)},ce=h=>{var o=Rs(),w=A(c(o),4),m=c(w),O=c(m);Ht(O,{size:16}),Le(2),n(m);var P=A(m,2),X=c(P);Ra(X,{size:16}),Le(2),n(P),n(w),n(o),v(h,o)};G(oe,h=>{a()&&a().messages.length>0?h(he):h(ce,!1)})}n(M),tt(M,h=>f(p,h),()=>e(p));var be=A(M,2),Ie=c(be);Ds(Ie,{get tools(){return e(_)},get disabled(){return e(u)},placeholder:"Send a message...",get value(){return e(q)},set value(h){f(q,h)},get mediaItems(){return e(I)},set mediaItems(h){f(I,h)},$$events:{submit:L,uploadFile:h=>te(h.detail),toggleTool:N,startAudioCapture:H,stopAudioCapture:we,startVideoCapture:C,stopVideoCapture:D},$$legacy:!0}),n(be),n(J),n(ae);var Ae=A(ae,2);{var ke=h=>{var o=Fs(),w=c(o);Ks(w,{isOpen:!0,$$events:{close:()=>f(b,!1)}}),n(o),v(h,o)};G(Ae,h=>{e(b)&&h(ke)})}B(()=>{var h;return me(k,((h=a())==null?void 0:h.model.name)||"AI Assistant")}),v(s,K),Ge(),y()}export{so as component};
