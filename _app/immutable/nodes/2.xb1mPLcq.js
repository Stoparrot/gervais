import{a as Ut,n as Yt,b as d,c as me,t as M,d as Xt}from"../chunks/CD-cSNpP.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as It,b as St,s as Ue,h as _e,j as Et,a as it,G as e,aa as pe,c as Jt,r as $t,d as Ye,g as Te,m as Qt,e as pt,f as ft,p as zt,aD as st,t as Ct,a7 as Zt,y as ct,aE as mt,aF as wt,aG as gt,B as ea,$ as kt,aH as Pt,a4 as qt,aI as ta,aJ as aa,q as sa,aK as oa,aL as Tt,aM as ra,k as la,E as na,aN as ia,aO as ca,N as Nt,a6 as da,a5 as va,w as Ve,V as c,X as $,T as Y,z as Fe,W as l,S as ue,aP as ht,aQ as ie,al as Xe,aR as Qe,aS as _t,D as m,aT as Ne,P as xt,aU as ke}from"../chunks/BSv_i5Hy.js";import{s as be}from"../chunks/XUjQEjo_.js";import{i as U}from"../chunks/Cec3cEQU.js";import{l as ua,m as pa,o as oe,p as fa}from"../chunks/Bl1F-iLh.js";import{i as ma,l as $e,p as ae,s as ze,b as bt}from"../chunks/DYD2hZ7I.js";import{a as je,s as yt}from"../chunks/HG7v26tk.js";import{s as Ae,b as dt,C as ga,d as Le,a as he,e as jt,c as ce,f as ha,r as We}from"../chunks/uxZwVYDM.js";import{i as _a,o as ba,g as ya,b as $a,l as wa,c as ka,s as vt,v as xa,u as Aa,e as Ma,f as Ia,h as Sa,j as Ea,k as za}from"../chunks/BFkVdgW4.js";import{M as ot}from"../chunks/CoxQhQk-.js";function Ie(s,t){return t}function Ca(s,t,r,b){for(var a=[],g=t.length,n=0;n<g;n++)aa(t[n].e,a,!0);var o=g>0&&a.length===0&&r!==null;if(o){var L=r.parentNode;sa(L),L.append(r),b.clear(),qe(s,t[0].prev,t[g-1].next)}oa(a,()=>{for(var v=0;v<g;v++){var i=t[v];o||(b.delete(i.k),qe(s,i.prev,i.next)),Tt(i.e,!o)}})}function Se(s,t,r,b,a,g=null){var n=s,o={flags:t,items:new Map,first:null},L=(t&Pt)!==0;if(L){var v=s;n=_e?Ue(Et(v)):v.appendChild(It())}_e&&it();var i=null,x=!1,h=pe(()=>{var p=r();return qt(p)?p:p==null?[]:Ct(p)});St(()=>{var p=e(h),_=p.length;if(x&&_===0)return;x=_===0;let q=!1;if(_e){var A=n.data===Jt;A!==(_===0)&&(n=$t(),Ue(n),Ye(!1),q=!0)}if(_e){for(var R=null,X,J=0;J<_;J++){if(Te.nodeType===8&&Te.data===Qt){n=Te,q=!0,Ye(!1);break}var T=p[J],D=b(T,J);X=Lt(Te,o,R,null,T,D,J,a,t,r),o.items.set(D,X),R=X}_>0&&Ue($t())}_e||Pa(p,o,n,a,t,b,r),g!==null&&(_===0?i?pt(i):i=ft(()=>g(n)):i!==null&&zt(i,()=>{i=null})),q&&Ye(!0),e(h)}),_e&&(n=Te)}function Pa(s,t,r,b,a,g,n){var Z,se,de,G;var o=(a&ta)!==0,L=(a&(mt|gt))!==0,v=s.length,i=t.items,x=t.first,h=x,p,_=null,q,A=[],R=[],X,J,T,D;if(o)for(D=0;D<v;D+=1)X=s[D],J=g(X,D),T=i.get(J),T!==void 0&&((Z=T.a)==null||Z.measure(),(q??(q=new Set)).add(T));for(D=0;D<v;D+=1){if(X=s[D],J=g(X,D),T=i.get(J),T===void 0){var ye=h?h.e.nodes_start:r;_=Lt(ye,t,_,_===null?t.first:_.next,X,J,D,b,a,n),i.set(J,_),A=[],R=[],h=_.next;continue}if(L&&qa(T,X,D,a),(T.e.f&st)!==0&&(pt(T.e),o&&((se=T.a)==null||se.unfix(),(q??(q=new Set)).delete(T))),T!==h){if(p!==void 0&&p.has(T)){if(A.length<R.length){var I=R[0],C;_=I.prev;var N=A[0],te=A[A.length-1];for(C=0;C<A.length;C+=1)At(A[C],I,r);for(C=0;C<R.length;C+=1)p.delete(R[C]);qe(t,N.prev,te.next),qe(t,_,N),qe(t,te,I),h=I,_=te,D-=1,A=[],R=[]}else p.delete(T),At(T,h,r),qe(t,T.prev,T.next),qe(t,T,_===null?t.first:_.next),qe(t,_,T),_=T;continue}for(A=[],R=[];h!==null&&h.k!==J;)(h.e.f&st)===0&&(p??(p=new Set)).add(h),R.push(h),h=h.next;if(h===null)continue;T=h}A.push(T),_=T,h=T.next}if(h!==null||p!==void 0){for(var B=p===void 0?[]:Ct(p);h!==null;)(h.e.f&st)===0&&B.push(h),h=h.next;var Q=B.length;if(Q>0){var re=(a&Pt)!==0&&v===0?r:null;if(o){for(D=0;D<Q;D+=1)(de=B[D].a)==null||de.measure();for(D=0;D<Q;D+=1)(G=B[D].a)==null||G.fix()}Ca(t,B,re,i)}}o&&Zt(()=>{var ve;if(q!==void 0)for(T of q)(ve=T.a)==null||ve.apply()}),ct.first=t.first&&t.first.e,ct.last=_&&_.e}function qa(s,t,r,b){(b&mt)!==0&&wt(s.v,t),(b&gt)!==0?wt(s.i,r):s.i=r}function Lt(s,t,r,b,a,g,n,o,L,v){var i=(L&mt)!==0,x=(L&ra)===0,h=i?x?ea(a):kt(a):a,p=(L&gt)===0?n:kt(n),_={i:p,v:h,k:g,a:null,e:null,prev:r,next:b};try{return _.e=ft(()=>o(s,h,p,v),_e),_.e.prev=r&&r.e,_.e.next=b&&b.e,r===null?t.first=_:(r.next=_,r.e.next=_.e),b!==null&&(b.prev=_,b.e.prev=_.e),_}finally{}}function At(s,t,r){for(var b=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,g=s.e.nodes_start;g!==b;){var n=la(g);a.before(g),g=n}}function qe(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Ta(s,t,r,b,a,g){let n=_e;_e&&it();var o,L,v=null;_e&&Te.nodeType===1&&(v=Te,it());var i=_e?Te:s,x;St(()=>{const h=t()||null;var p=ia;h!==o&&(x&&(h===null?zt(x,()=>{x=null,L=null}):h===L?pt(x):Tt(x)),h&&h!==L&&(x=ft(()=>{if(v=_e?v:document.createElementNS(p,h),Ut(v,v),b){_e&&ua(h)&&v.append(document.createComment(""));var _=_e?Et(v):v.appendChild(It());_e&&(_===null?Ye(!1):Ue(_)),b(v,_)}ct.nodes_end=v,i.before(v)})),o=h,o&&(L=o))},na),n&&(Ye(!0),Ue(i))}function Ke(s,t,r=t){var b=ca();pa(s,"input",a=>{var g=a?s.defaultValue:s.value;if(g=rt(s)?lt(g):g,r(g),b&&g!==(g=t())){var n=s.selectionStart,o=s.selectionEnd;s.value=g??"",o!==null&&(s.selectionStart=n,s.selectionEnd=Math.min(o,s.value.length))}}),(_e&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&r(rt(s)?lt(s.value):s.value),da(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,r){if(s.multiple)return ja(s,t);for(var b of s.options){var a=Ht(b);if(ma(a,t)){b.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let r=!0;va(()=>{t&&ut(s,Nt(t),r),r=!1;var b=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return b.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{b.disconnect()}})}function ja(s,t){for(var r of s.options)r.selected=~t.indexOf(Ht(r))}function Ht(s){return"__value"in s?s.__value:s.value}function La(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function Mt(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function nt(s,t){var g;var r=(g=s.$$events)==null?void 0:g[t.type],b=qt(r)?r.slice():r==null?[]:[r];for(var a of b)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Ha={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Oa=Yt("<svg><!><!></svg>");function Ce(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]),b=$e(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let a=ae(t,"name",8,void 0),g=ae(t,"color",8,"currentColor"),n=ae(t,"size",8,24),o=ae(t,"strokeWidth",8,2),L=ae(t,"absoluteStrokeWidth",8,!1),v=ae(t,"iconNode",24,()=>[]);const i=(...q)=>q.filter((A,R,X)=>!!A&&X.indexOf(A)===R).join(" ");Re();var x=Oa();let h;var p=c(x);Se(p,1,v,Ie,(q,A)=>{let R=()=>e(A)[0],X=()=>e(A)[1];var J=me(),T=ue(J);Ta(T,R,!0,(D,ye)=>{let I;Y(()=>I=dt(D,I,{...X()}))}),d(q,J)});var _=$(p);Ae(_,t,"default",{}),l(x),Y((q,A)=>h=dt(x,h,{...Ha,...b,width:n(),height:n(),stroke:g(),"stroke-width":q,class:A}),[()=>L()?Number(o())*24/Number(n()):o(),()=>i("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],pe),d(s,x),Fe()}function Da(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Ka(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Ra(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Va(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Ot(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"notebook-pen"},()=>r,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Dt(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Fa(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"send"},()=>r,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Ba(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Ga(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"video"},()=>r,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}function Kt(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]);Ce(s,ze({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,g)=>{var n=me(),o=ue(n);Ae(o,t,"default",{}),d(a,n)},$$slots:{default:!0}}))}var Wa=M('<div class="spinner svelte-1pi70xe"></div>'),Ua=M("<button><!> <!></button>");function xe(s,t){const r=$e(t,["children","$$slots","$$events","$$legacy"]),b=$e(r,["type","variant","size","disabled","loading","fullWidth"]);let a=ae(t,"type",8,"button"),g=ae(t,"variant",8,"primary"),n=ae(t,"size",8,"md"),o=ae(t,"disabled",8,!1),L=ae(t,"loading",8,!1),v=ae(t,"fullWidth",8,!1);var i=Ua();let x;var h=c(i);{var p=q=>{var A=Wa();d(q,A)};U(h,q=>{L()&&q(p)})}var _=$(h,2);Ae(_,t,"default",{}),l(i),Y(q=>x=dt(i,x,{type:a(),class:`button ${g()??""} ${n()??""} ${(v()?"full-width":"")??""}`,disabled:o(),...b,[ga]:q},"svelte-1pi70xe"),[()=>({loading:L()})],pe),oe("click",i,function(q){nt.call(this,t,q)}),oe("keydown",i,function(q){nt.call(this,t,q)}),oe("keyup",i,function(q){nt.call(this,t,q)}),d(s,i)}var Ya=M('<option class="svelte-1m60q0l"> </option>'),Xa=M('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Ja=M('<option class="svelte-1m60q0l"> </option>'),Qa=M('<option class="svelte-1m60q0l"> </option>'),Za=M('<option disabled class="svelte-1m60q0l"> </option>'),es=M('<!> <span class="svelte-1m60q0l">New Chat</span>',1),ts=M('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),as=M('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function ss(s,t){var ve;Ve(t,!1);const[r,b]=yt(),a=()=>je(jt,"$activeChat",r),g=()=>je(ka,"$allModelsStore",r),n=()=>je(wa,"$localModelsStore",r),o=()=>je(ce,"$chatStore",r);let L=ae(t,"isMobile",8,!1),v=ae(t,"isExpanded",8,!0);const i=ht();let x=ie(((ve=a())==null?void 0:ve.model.id)||"claude-3-5-sonnet");Xe(async()=>{await _a()});function h(){const H=g().find(k=>k.id===e(x));H&&ce.createNewChat(H)}function p(H){ce.selectChat(H),L()&&i("toggleSidebar",!1)}function _(H,k){k.stopPropagation(),ce.deleteChat(H)}function q(H){const k=H.target;if(m(x,k.value),a()){const y=g().find(F=>F.id===e(x));y&&ce.updateChatModel(a().id,y)}}Qe(()=>a(),()=>{a()&&m(x,a().model.id)}),_t(),Re();var A=as();let R;var X=c(A),J=c(X),T=c(J);Ne(2),l(J);var D=$(J,2);{var ye=H=>{const k=pe(()=>v()?"Collapse sidebar":"Expand sidebar");xe(H,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(k)},$$events:{click:()=>i("toggleSidebar",!v())},children:(y,F)=>{Da(y,{size:20})},$$slots:{default:!0}})};U(D,H=>{L()&&H(ye)})}l(X);var I=$(X,2),C=c(I),N=c(C);Na(N,()=>e(x));var te,B=c(N);{var Q=H=>{var k=Xa();Se(k,5,n,Ie,(y,F)=>{var j=Ya(),E={},w=c(j,!0);l(j),Y(()=>{E!==(E=e(F).id)&&(j.value=(j.__value=e(F).id)==null?"":e(F).id),be(w,e(F).name)}),d(y,j)}),l(k),d(H,k)};U(B,H=>{n().length>0&&H(Q)})}var re=$(B);Se(re,5,()=>ba,Ie,(H,k)=>{var y=Ja(),F={},j=c(y,!0);l(y),Y(()=>{F!==(F=e(k).id)&&(y.value=(y.__value=e(k).id)==null?"":e(k).id),be(j,e(k).name)}),d(H,y)}),l(re);var Z=$(re);Se(Z,5,()=>ya,Ie,(H,k)=>{var y=Qa(),F={},j=c(y,!0);l(y),Y(()=>{F!==(F=e(k).id)&&(y.value=(y.__value=e(k).id)==null?"":e(k).id),be(j,e(k).name)}),d(H,y)}),l(Z);var se=$(Z);Se(se,5,()=>$a,Ie,(H,k)=>{var y=Za(),F={},j=c(y,!0);l(y),Y(()=>{F!==(F=e(k).id)&&(y.value=(y.__value=e(k).id)==null?"":e(k).id),be(j,e(k).name)}),d(H,y)}),l(se),l(N),l(C);var de=$(C,2);xe(de,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:h},children:(H,k)=>{var y=es(),F=ue(y);Ot(F,{size:16}),Ne(2),d(H,y)},$$slots:{default:!0}});var G=$(de,2);Se(G,5,()=>o().chats,Ie,(H,k)=>{var y=ts();let F;var j=c(y),E=c(j,!0);l(j);var w=$(j,2);xe(w,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:z=>_(e(k).id,z)},children:(z,V)=>{Kt(z,{size:16})},$$slots:{default:!0}}),l(y),Y(z=>{F=Le(y,1,"chat-item svelte-1m60q0l",null,F,z),be(E,e(k).title||"New Chat")},[()=>{var z;return{active:e(k).id===((z=a())==null?void 0:z.id)}}],pe),oe("click",y,()=>p(e(k).id)),d(H,y)}),l(G),l(I),l(A),Y(H=>{R=Le(A,1,"sidebar svelte-1m60q0l",null,R,H),he(T,"src","/gervais/logo.svg"),te!==(te=e(x))&&(N.value=(N.__value=e(x))==null?"":e(x),ut(N,e(x)))},[()=>({expanded:v()})],pe),oe("change",N,q),d(s,A),Fe(),b()}var os=M('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),rs=M('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),ls=M('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ns=M('<div class="file-size svelte-1mjurqb"> </div>'),is=M('<span class="document-status success svelte-1mjurqb"> </span>'),cs=M('<span class="document-status info svelte-1mjurqb">Document attached</span>'),ds=M('<span class="document-status success svelte-1mjurqb">Document processed</span>'),vs=M('<span class="document-status info svelte-1mjurqb">Document</span>'),us=M('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),ps=M('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">📄</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),fs=M('<div class="media-container svelte-1mjurqb"></div>'),ms=M('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),gs=M('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),hs=M('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),_s=M('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),bs=M('<div class="media-container assistant-media svelte-1mjurqb"></div>'),ys=M('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),$s=M('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ws=M('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ks=M('<div class="content system-message svelte-1mjurqb"><!></div>'),xs=M('<div class="timestamp svelte-1mjurqb"> </div>'),As=M('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">×</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),Ms=M("<div><!> <!></div> <!>",1);function Is(s,t){Ve(t,!1);const r=ie(),b=ie();let a=ae(t,"message",8),g=ae(t,"isStreaming",8,!1),n=ae(t,"scrollToBottom",8,!1),o=ie(!1),L=ie(""),v=ie(""),i=ie();Xe(()=>{if(n()&&e(i)){const I=e(i).parentElement;I&&(I.scrollTop=I.scrollHeight)}});function x(I,C=2){if(I===0)return"0 Bytes";const N=1024,te=C<0?0:C,B=["Bytes","KB","MB","GB","TB"],Q=Math.floor(Math.log(I)/Math.log(N));return parseFloat((I/Math.pow(N,Q)).toFixed(te))+" "+B[Q]}function h(I,C="Preview image"){m(L,I),m(v,C),m(o,!0)}function p(){m(o,!1)}Qe(()=>xt(a()),()=>{m(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Qe(()=>xt(a()),()=>{m(b,`message ${a().role}`)}),_t(),Re();var _=Ms(),q=ue(_),A=c(q);{var R=I=>{var C=ms(),N=c(C),te=c(N),B=c(te,!0);l(te),l(N);var Q=$(N,2);{var re=Z=>{var se=fs();Se(se,5,()=>a().media,Ie,(de,G,ve)=>{var H=me(),k=ue(H);{var y=j=>{var E=os(),w=c(E);he(w,"alt",`Image ${ve+1}`),l(E),Y(()=>he(w,"src",e(G).preview)),oe("click",E,()=>{e(G).preview&&h(e(G).preview,`Image ${ve+1}`)}),oe("keydown",E,z=>{if(z.key==="Enter"||z.key===" "){if(z.preventDefault(),!e(G).preview)return;h(e(G).preview,`Image ${ve+1}`)}}),d(j,E)},F=(j,E)=>{{var w=V=>{var le=rs();Y(()=>he(le,"src",e(G).preview)),d(V,le)},z=(V,le)=>{{var u=W=>{var S=ls();Y(()=>he(S,"src",e(G).preview)),d(W,S)},f=(W,S)=>{{var K=P=>{var ne=ps(),fe=$(c(ne),2),Me=c(fe),we=c(Me,!0);l(Me);var ee=$(Me,2);{var O=Ee=>{var Pe=ns(),Be=c(Pe,!0);l(Pe),Y(Ge=>be(Be,Ge),[()=>x(e(G).size)],pe),d(Ee,Pe)};U(ee,Ee=>{e(G).size&&Ee(O)})}var ge=$(ee,2),Ze=c(ge);{var et=Ee=>{var Pe=is(),Be=c(Pe);l(Pe),Y(Ge=>be(Be,`✓ Uploaded to OpenAI (ID: ${Ge??""}...)`),[()=>e(G).fileId.substring(0,8)],pe),d(Ee,Pe)},Rt=(Ee,Pe)=>{{var Be=He=>{var Je=me(),Vt=ue(Je);{var Ft=Oe=>{var tt=cs();d(Oe,tt)},Bt=(Oe,tt)=>{{var Gt=De=>{var at=ds();d(De,at)},Wt=De=>{var at=vs();d(De,at)};U(Oe,De=>{a().role==="assistant"?De(Gt):De(Wt,!1)},tt)}};U(Vt,Oe=>{a().role==="user"?Oe(Ft):Oe(Bt,!1)})}d(He,Je)},Ge=He=>{var Je=us();d(He,Je)};U(Ee,He=>{e(G).preview?He(Be):He(Ge,!1)},Pe)}};U(Ze,Ee=>{e(G).fileId?Ee(et):Ee(Rt,!1)})}l(ge),l(fe),l(ne),Y(()=>be(we,e(G).name||"Document")),d(P,ne)};U(W,P=>{e(G).type==="document"&&P(K)},S)}};U(V,W=>{e(G).type==="video"?W(u):W(f,!1)},le)}};U(j,V=>{e(G).type==="audio"?V(w):V(z,!1)},E)}};U(k,j=>{e(G).type==="image"?j(y):j(F,!1)})}d(de,H)}),l(se),d(Z,se)};U(Q,Z=>{a().media&&a().media.length>0&&Z(re)})}l(C),Y(()=>be(B,a().content)),d(I,C)},X=(I,C)=>{{var N=B=>{var Q=ws(),re=c(Q);ot(re,{get content(){return a().content},get scrollToBottom(){return n()}});var Z=$(re,2);{var se=k=>{var y=bs();Se(y,5,()=>a().media,Ie,(F,j,E)=>{var w=me(),z=ue(w);{var V=u=>{var f=gs(),W=c(f);he(W,"alt",`Generated image ${E+1}`),Ne(2),l(f),Y(()=>he(W,"src",e(j).preview)),oe("click",f,()=>{e(j).preview&&h(e(j).preview,`Generated image ${E+1}`)}),oe("keydown",f,S=>{if(S.key==="Enter"||S.key===" "){if(S.preventDefault(),!e(j).preview)return;h(e(j).preview,`Generated image ${E+1}`)}}),d(u,f)},le=(u,f)=>{{var W=K=>{var P=hs();Y(()=>he(P,"src",e(j).preview)),d(K,P)},S=(K,P)=>{{var ne=fe=>{var Me=_s();Y(()=>he(Me,"src",e(j).preview)),d(fe,Me)};U(K,fe=>{e(j).type==="video"&&fe(ne)},P)}};U(u,K=>{e(j).type==="audio"?K(W):K(S,!1)},f)}};U(z,u=>{e(j).type==="image"?u(V):u(le,!1)})}d(F,w)}),l(y),d(k,y)};U(Z,k=>{a().media&&a().media.length>0&&k(se)})}var de=$(Z,2);{var G=k=>{var y=ys(),F=$(c(y),2),j=c(F);ot(j,{get content(){return a().thinking},scrollToBottom:!1}),l(F),l(y),d(k,y)};U(de,k=>{a().thinking&&k(G)})}var ve=$(de,2);{var H=k=>{var y=$s();d(k,y)};U(ve,k=>{g()&&k(H)})}l(Q),d(B,Q)},te=(B,Q)=>{{var re=Z=>{var se=ks(),de=c(se);ot(de,{get content(){return a().content},get scrollToBottom(){return n()}}),l(se),d(Z,se)};U(B,Z=>{a().role==="system"&&Z(re)},Q)}};U(I,B=>{a().role==="assistant"?B(N):B(te,!1)},C)}};U(A,I=>{a().role==="user"?I(R):I(X,!1)})}var J=$(A,2);{var T=I=>{var C=xs(),N=c(C,!0);l(C),Y(()=>be(N,e(r))),d(I,C)};U(J,I=>{a().role==="user"&&I(T)})}l(q),bt(q,I=>m(i,I),()=>e(i));var D=$(q,2);{var ye=I=>{var C=As(),N=c(C),te=c(N),B=$(te,2),Q=$(B,2),re=c(Q,!0);l(Q),l(N),l(C),Y(()=>{he(B,"src",e(L)),he(B,"alt",e(v)),be(re,e(v))}),oe("click",te,p),oe("click",N,Mt(()=>{})),oe("keydown",N,Mt(()=>{})),oe("click",C,p),oe("keydown",C,Z=>Z.key==="Escape"&&p()),d(I,C)};U(D,I=>{e(o)&&I(ye)})}Y(()=>Le(q,1,ha(e(b)),"svelte-1mjurqb")),d(s,_),Fe()}var Ss=M('<img class="svelte-bl68k9">'),Es=M('<div class="file-preview svelte-bl68k9"><span> </span></div>'),zs=M('<div class="media-item svelte-bl68k9"><!> <button type="button" class="remove-media svelte-bl68k9" aria-label="Remove media">&times;</button></div>'),Cs=M("<div><!></div>"),Ps=M("<div><!></div>"),qs=M("<div><!></div>"),Ts=M('<button type="button"> </button>'),Ns=M('<div class="message-input-container svelte-bl68k9"><div class="media-preview svelte-bl68k9"></div> <div class="input-bubble svelte-bl68k9"><div class="input-container svelte-bl68k9"><textarea rows="2" class="svelte-bl68k9"></textarea></div> <div class="actions-bar svelte-bl68k9"><div class="left-actions svelte-bl68k9"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!></div> <div class="right-actions svelte-bl68k9"><!></div></div></div> <div class="tools-bar svelte-bl68k9"></div></div>');function js(s,t){Ve(t,!1);let r=ae(t,"value",12,""),b=ae(t,"placeholder",8,"Send a message..."),a=ae(t,"disabled",8,!1),g=ae(t,"isRecording",8,!1),n=ae(t,"isCapturingVideo",8,!1),o=ae(t,"mediaItems",28,()=>[]),L=ae(t,"tools",24,()=>({}));const v=ht();let i=ie(),x=ie(!1);Xe(()=>(h(),window.addEventListener("resize",h),e(i)&&e(x)&&e(i).setAttribute("enterkeyhint","done"),()=>{window.removeEventListener("resize",h)}));function h(){m(x,window.innerWidth<768),e(i)&&e(i).setAttribute("enterkeyhint",e(x)?"done":"send")}function p(){e(i)&&(ke(i,e(i).style.height="auto"),ke(i,e(i).style.height=`${Math.min(e(i).scrollHeight,200)}px`))}function _(){a()||!r().trim()&&o().length===0||(v("submit",{content:r().trim(),media:o(),tools:L()}),r(""),e(i)&&ke(i,e(i).style.height="auto"))}function q(w){w.key==="Enter"&&!w.shiftKey&&!e(x)&&(w.preventDefault(),_())}function A(w){e(x)&&w.key==="Enter"&&w.target instanceof HTMLTextAreaElement&&w.target.getAttribute("enterkeyhint")==="done"&&_()}function R(){g()?v("stopAudioCapture"):v("startAudioCapture")}function X(){n()?v("stopVideoCapture"):v("startVideoCapture")}function J(w){const z=w.target;if(z.files&&z.files.length>0){const V=Array.from(z.files);v("uploadFile",V),z.value=""}}function T(w){const z=!L()[w];v("toggleTool",{tool:w,enabled:z})}Qe(()=>e(i),()=>{e(i)&&p()}),_t(),Re();var D=Ns(),ye=c(D);Se(ye,5,o,Ie,(w,z)=>{var V=zs(),le=c(V);{var u=S=>{var K=Ss();Y(()=>{he(K,"src",e(z).preview),he(K,"alt",e(z).name)}),d(S,K)},f=S=>{var K=Es(),P=c(K),ne=c(P,!0);l(P),l(K),Y(()=>be(ne,e(z).name)),d(S,K)};U(le,S=>{e(z).type==="image"&&e(z).preview?S(u):S(f,!1)})}var W=$(le,2);l(V),oe("click",W,()=>{o(o().filter(S=>S.id!==e(z).id))}),d(w,V)}),l(ye);var I=$(ye,2),C=c(I),N=c(C);fa(N),bt(N,w=>m(i,w),()=>e(i)),l(C);var te=$(C,2),B=c(te),Q=c(B),re=$(Q,2);xe(re,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var w;return(w=document.getElementById("file-upload"))==null?void 0:w.click()}},children:(w,z)=>{Dt(w,{size:18})},$$slots:{default:!0}});var Z=$(re,2);const se=pe(()=>a()||g()),de=pe(()=>g()?"Stop recording":"Start recording");xe(Z,{variant:"icon",size:"sm",get disabled(){return e(se)},get"aria-label"(){return e(de)},$$events:{click:R},children:(w,z)=>{var V=Cs();let le;var u=c(V);Va(u,{size:18}),l(V),Y(f=>le=Le(V,1,"",null,le,f),[()=>({active:g()})],pe),d(w,V)},$$slots:{default:!0}});var G=$(Z,2);const ve=pe(()=>a()||g()),H=pe(()=>n()?"Stop video capture":"Start video capture");xe(G,{variant:"icon",size:"sm",get disabled(){return e(ve)},get"aria-label"(){return e(H)},$$events:{click:X},children:(w,z)=>{var V=Ps();let le;var u=c(V);Ga(u,{size:18}),l(V),Y(f=>le=Le(V,1,"",null,le,f),[()=>({active:n()})],pe),d(w,V)},$$slots:{default:!0}});var k=$(G,2);xe(k,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>T("search")},children:(w,z)=>{var V=qs();let le;var u=c(V);Ka(u,{size:18}),l(V),Y(f=>le=Le(V,1,"",null,le,f),[()=>({active:L().search})],pe),d(w,V)},$$slots:{default:!0}}),l(B);var y=$(B,2),F=c(y);const j=pe(()=>a()||!r().trim()&&o().length===0);xe(F,{variant:"icon",size:"sm",get disabled(){return e(j)},"aria-label":"Send message",$$events:{click:_},children:(w,z)=>{Fa(w,{size:18})},$$slots:{default:!0}}),l(y),l(te),l(I);var E=$(I,2);Se(E,5,()=>Object.entries(L()),Ie,(w,z)=>{let V=()=>e(z)[0],le=()=>e(z)[1];var u=me(),f=ue(u);{var W=S=>{var K=Ts();let P;var ne=c(K,!0);l(K),Y(fe=>{P=Le(K,1,"tool-button svelte-bl68k9",null,P,fe),he(K,"aria-label",`Toggle ${V()??""}`),be(ne,V())},[()=>({enabled:le()})],pe),oe("click",K,()=>T(V())),d(S,K)};U(f,S=>{V()!=="search"&&S(W)})}d(w,u)}),l(E),l(D),Y(()=>{he(N,"placeholder",b()),N.disabled=a(),he(N,"enterkeyhint",e(x)?"done":"send")}),Ke(N,r),oe("keydown",N,q),oe("keyup",N,A),oe("input",N,p),oe("change",Q,J),d(s,D),Fe()}var Ls=M('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Hs=M('<span class="error-message svelte-8a76oy"> </span>'),Os=M('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ds(s,t){Ve(t,!1);const[r,b]=yt(),a=()=>je(vt,"$settingsStore",r);let g=ae(t,"isOpen",8,!1);const n=ht();let o=ie({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),L=ie(!1),v=ie(!1),i=ie("");Xe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const A=a().apiKeys||{};console.log("Stored API keys from settings store:",A),m(o,{anthropic:A.anthropic||"",openai:A.openai||"",google:A.google||"",ollamaHost:A.ollamaHost||"http://localhost:11434",localHost:A.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(o))});function x(){n("close")}async function h(){var A;m(L,!0),m(v,!1),m(i,"");try{if(console.log("Saving API keys to settingsStore:",e(o)),e(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(o).openai),console.log(`OpenAI key before saving: length=${e(o).openai.length}, starts with=${e(o).openai.substring(0,4)}`);const R=[...e(o).openai.substring(0,10)].map(X=>X.charCodeAt(0));console.log(`First 10 character codes: ${R.join(", ")}`)}if(await vt.updateApiKeys({anthropic:e(o).anthropic,openai:e(o).openai,google:e(o).google,ollamaHost:e(o).ollamaHost||"http://localhost:11434",localHost:e(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(A=a().apiKeys)!=null&&A.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const R=[...a().apiKeys.openai.substring(0,10)].map(X=>X.charCodeAt(0));console.log(`First 10 character codes after saving: ${R.join(", ")}`)}m(v,!0),console.log("API keys saved successfully"),setTimeout(()=>{m(v,!1)},3e3)}catch(R){console.error("Failed to save API keys:",R),m(i,R instanceof Error?R.message:"Unknown error")}finally{m(L,!1)}}Re();var p=me(),_=ue(p);{var q=A=>{var R=Os(),X=c(R),J=c(X),T=$(c(J),2);xe(T,{variant:"icon","aria-label":"Close settings",$$events:{click:x},children:(E,w)=>{Kt(E,{size:20})},$$slots:{default:!0}}),l(J);var D=$(J,2),ye=c(D),I=$(c(ye),4),C=c(I),N=$(c(C),2);We(N),l(C);var te=$(C,2),B=$(c(te),2);We(B),l(te);var Q=$(te,2),re=$(c(Q),2);We(re),l(Q);var Z=$(Q,2),se=$(c(Z),2);We(se),Ne(2),l(Z);var de=$(Z,2),G=$(c(de),2);We(G),Ne(2),l(de),l(I);var ve=$(I,2),H=c(ve);xe(H,{variant:"primary",get disabled(){return e(L)},$$events:{click:h},children:(E,w)=>{Ne();var z=Xt();Y(()=>be(z,e(L)?"Saving...":"Save API Keys")),d(E,z)},$$slots:{default:!0}});var k=$(H,2);{var y=E=>{var w=Ls();d(E,w)};U(k,E=>{e(v)&&E(y)})}var F=$(k,2);{var j=E=>{var w=Hs(),z=c(w,!0);l(w),Y(()=>be(z,e(i))),d(E,w)};U(F,E=>{e(i)&&E(j)})}l(ve),l(ye),l(D),l(X),l(R),Ke(N,()=>e(o).anthropic,E=>ke(o,e(o).anthropic=E)),Ke(B,()=>e(o).openai,E=>ke(o,e(o).openai=E)),Ke(re,()=>e(o).google,E=>ke(o,e(o).google=E)),Ke(se,()=>e(o).ollamaHost,E=>ke(o,e(o).ollamaHost=E)),Ke(G,()=>e(o).localHost,E=>ke(o,e(o).localHost=E)),oe("click",R,La(x)),oe("keydown",R,E=>E.key==="Escape"&&x()),d(A,R)};U(_,A=>{g()&&A(q)})}d(s,p),Fe(),b()}var Ks=M('<div class="sidebar-backdrop svelte-1b4tzcm" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=M('<div class="empty-state svelte-1b4tzcm"><h2 class="svelte-1b4tzcm">Start a new conversation</h2> <p class="svelte-1b4tzcm">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-1b4tzcm"><div class="feature svelte-1b4tzcm"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-1b4tzcm"><!> <span>Vision support for images</span></div></div></div>'),Vs=M('<div class="settings-portal svelte-1b4tzcm"><!></div>'),Fs=M('<div class="chat-container svelte-1b4tzcm"><!> <!> <main class="chat-main svelte-1b4tzcm"><header class="chat-header svelte-1b4tzcm"><!> <h1 class="chat-title svelte-1b4tzcm"> </h1> <!></header> <div class="chat-messages svelte-1b4tzcm"><!></div> <div class="input-container svelte-1b4tzcm"><!></div></main></div> <!>',1);function ao(s,t){Ve(t,!1);const[r,b]=yt(),a=()=>je(jt,"$activeChat",r),g=()=>je(vt,"$settingsStore",r);let n=ie(!1),o=ie(!0),L=ie(""),v=ie(!1),i=ie(!1),x=ie([]),h=ie({search:!1}),p=ie(),_=ie(!1);function q(){m(n,window.innerWidth<768),e(n)?m(o,!1):m(o,!0)}Xe(()=>{q(),window.addEventListener("resize",q);function u(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`)}return u(),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",q),window.removeEventListener("resize",u)}});function A(){m(o,!e(o))}async function R({detail:u}){var ne,fe,Me;if(!a())return;const f=a().model.provider;if(console.log("Current settings store state:",g()),f==="openai"&&!((ne=g().apiKeys)!=null&&ne.openai)){console.warn("OpenAI API key not set, opening settings dialog"),m(_,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(f==="anthropic"&&!((fe=g().apiKeys)!=null&&fe.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),m(_,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(f==="google"&&!((Me=g().apiKeys)!=null&&Me.google)){console.warn("Google API key not set, opening settings dialog"),m(_,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:W,media:S,tools:K}=u;console.log("Media items in submission:",S),await ce.addMessage(a().id,{role:"user",content:W,media:S}),m(L,""),m(x,[]),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100);const P=await ce.addMessage(a().id,{role:"assistant",content:""});m(v,!0),m(i,!0);try{const we=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",we);const ee=a().model.id;if(f==="anthropic")await Ma(ee,we,O=>{ce.updateMessage(a().id,P,{content:O})},()=>{m(v,!1),m(i,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response:",O),ce.updateMessage(a().id,P,{content:`Error generating response: – ${O.message}`}),m(v,!1),m(i,!1)},O=>{ce.updateMessage(a().id,P,{thinking:O})});else if(f==="openai")if(e(i))await Ia(ee,we,O=>{ce.updateMessage(a().id,P,{content:O})},()=>{m(v,!1),m(i,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response from OpenAI:",O);const ge=O.message||"An unknown error occurred";ce.updateMessage(a().id,P,{content:`Error: ${ge}`}),m(v,!1),m(i,!1)});else try{const O=await Sa(ee,we);ce.updateMessage(a().id,P,{content:O}),m(v,!1)}catch(O){console.error("Error generating non-streaming response from OpenAI:",O);const ge=O.message||"An unknown error occurred";throw ce.updateMessage(a().id,P,{content:`Error: ${ge}`}),m(v,!1),O}else if(f==="google")await Ea(ee,we,(O,ge)=>{ce.updateMessage(a().id,P,{content:O,media:ge})},()=>{m(v,!1),m(i,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response from Google:",O);const ge=O.message||"An unknown error occurred";ce.updateMessage(a().id,P,{content:`Error: ${ge}`}),m(v,!1),m(i,!1)},O=>{ce.updateMessage(a().id,P,{thinking:O})});else if(f==="ollama")try{await za(ee,we,O=>{ce.updateMessage(a().id,P,{content:O})},()=>{m(v,!1),m(i,!1),setTimeout(()=>{e(p)&&ke(p,e(p).scrollTop=e(p).scrollHeight)},100)},O=>{console.error("Error generating response from Ollama:",O);const ge=O.message||"An unknown error occurred";ce.updateMessage(a().id,P,{content:`Error connecting to Ollama: ${ge}. Make sure Ollama is running locally.`}),m(v,!1),m(i,!1)})}catch(O){throw console.error("Error generating response from Ollama:",O),O}else{let O="";const ge="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of ge)await new Promise(et=>setTimeout(et,50)),O+=Ze+" ",ce.updateMessage(a().id,P,{content:O.trim()});m(v,!1),m(i,!1)}}catch(we){if(console.error("Error generating response:",we),e(v)){const ee=we.message||"An unknown error occurred";ce.updateMessage(a().id,P,{content:`Error: ${ee}`}),m(v,!1),m(i,!1)}}}function X(u){u.forEach(async f=>{const W=xa(),S=f.name,K=f.size;let P="other",ne,fe;console.log(`Processing file: ${S}, type: ${f.type}, size: ${K} bytes`);const Me=ee=>{var O;if(ee.type.includes("pdf")||ee.type.includes("word")||ee.type.includes("excel")||ee.type.includes("spreadsheet")||ee.type.includes("presentation")||ee.type.includes("officedocument")||ee.type.includes("application/rtf")||ee.type.includes("text/rtf"))return!0;if(!ee.type||ee.type==="application/octet-stream"){const ge=(O=S.split(".").pop())==null?void 0:O.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ge||"")}return!1};if(f.type.startsWith("image/")){P="image";try{ne=await J(f),console.log(`Created data URL for image ${S} (length: ${ne.length} chars)`)}catch(ee){console.error(`Failed to create data URL for ${S}:`,ee)}}else if(f.type.startsWith("audio/"))P="audio";else if(f.type.startsWith("video/"))P="video";else if(f.type.startsWith("text/"))P="text";else if(Me(f)){if(P="document",a()&&a().model.provider==="openai")try{fe=await Aa(f),console.log(`Document ${S} uploaded to OpenAI with ID: ${fe}`)}catch(ee){console.error(`Failed to upload document to OpenAI: ${ee.message}`),alert(`Failed to upload document to OpenAI: ${ee.message}`)}try{ne=await J(f),console.log(`Created data URL for document ${S}, mime type: ${f.type}`),console.log(`Document data URL length: ${ne.length} chars`),K>5*1024*1024&&console.warn(`Warning: Large document (${(K/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(ee){console.error(`Failed to create data URL for ${S}:`,ee)}}const we={id:W,type:P,name:S,preview:ne,size:K,timestamp:Date.now(),fileId:fe};console.log(`Adding media item: ${P} ${S}`),m(x,[...e(x),we])})}async function J(u){return new Promise((f,W)=>{const S=new FileReader;S.onload=()=>{const K=S.result;f(K)},S.onerror=K=>{console.error("Error reading file:",K),W(K)},S.readAsDataURL(u)})}function T({detail:u}){const{tool:f,enabled:W}=u;m(h,{...e(h),[f]:W})}function D(){console.log("Start audio capture")}function ye(){console.log("Stop audio capture")}function I(){console.log("Start video capture")}function C(){console.log("Stop video capture")}Re();var N=Fs(),te=ue(N),B=c(te);ss(B,{get isMobile(){return e(n)},get isExpanded(){return e(o)},$$events:{toggleSidebar:({detail:u})=>m(o,u)}});var Q=$(B,2);{var re=u=>{var f=Ks();oe("click",f,()=>m(o,!1)),oe("keydown",f,W=>W.key==="Escape"&&m(o,!1)),d(u,f)};U(Q,u=>{e(n)&&e(o)&&u(re)})}var Z=$(Q,2),se=c(Z),de=c(se);{var G=u=>{xe(u,{variant:"icon","aria-label":"Open menu",$$events:{click:A},children:(f,W)=>{Ot(f,{size:20})},$$slots:{default:!0}})};U(de,u=>{e(n)&&u(G)})}var ve=$(de,2),H=c(ve,!0);l(ve);var k=$(ve,2);xe(k,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>m(_,!0)},children:(u,f)=>{Ba(u,{size:20})},$$slots:{default:!0}}),l(se);var y=$(se,2),F=c(y);{var j=u=>{var f=me(),W=ue(f);Se(W,1,()=>a().messages,Ie,(S,K,P)=>{const ne=pe(()=>e(i)&&P===a().messages.length-1&&e(K).role==="assistant"),fe=pe(()=>P===a().messages.length-1);Is(S,{get message(){return e(K)},get isStreaming(){return e(ne)},get scrollToBottom(){return e(fe)}})}),d(u,f)},E=u=>{var f=Rs(),W=$(c(f),4),S=c(W),K=c(S);Dt(K,{size:16}),Ne(2),l(S);var P=$(S,2),ne=c(P);Ra(ne,{size:16}),Ne(2),l(P),l(W),l(f),d(u,f)};U(F,u=>{a()&&a().messages.length>0?u(j):u(E,!1)})}l(y),bt(y,u=>m(p,u),()=>e(p));var w=$(y,2),z=c(w);js(z,{get tools(){return e(h)},get disabled(){return e(v)},placeholder:"Send a message...",get value(){return e(L)},set value(u){m(L,u)},get mediaItems(){return e(x)},set mediaItems(u){m(x,u)},$$events:{submit:R,uploadFile:u=>X(u.detail),toggleTool:T,startAudioCapture:D,stopAudioCapture:ye,startVideoCapture:I,stopVideoCapture:C},$$legacy:!0}),l(w),l(Z),l(te);var V=$(te,2);{var le=u=>{var f=Vs(),W=c(f);Ds(W,{isOpen:!0,$$events:{close:()=>m(_,!1)}}),l(f),d(u,f)};U(V,u=>{e(_)&&u(le)})}Y(()=>{var u;return be(H,((u=a())==null?void 0:u.model.name)||"AI Assistant")}),d(s,N),Fe(),b()}export{ao as component};
