import{a as Ut,n as Yt,b as u,c as he,t as M,d as Xt}from"../chunks/CD-cSNpP.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as It,b as St,s as Ue,h as pe,j as Et,a as it,G as e,aa as ve,c as Jt,r as $t,d as Ye,g as Te,m as Qt,e as pt,f as ft,p as Ct,aD as st,t as qt,a7 as Zt,y as ct,aE as mt,aF as wt,aG as gt,B as ea,$ as kt,aH as Pt,a4 as zt,aI as ta,aJ as aa,q as sa,aK as oa,aL as Tt,aM as ra,k as la,E as na,aN as ia,aO as ca,N as Nt,a6 as va,a5 as da,w as Fe,V as v,X as $,T as Y,z as Ve,W as l,S as de,aP as ht,aQ as ne,al as Qe,aR as Je,aS as _t,D as m,aT as Ne,P as xt,aU as $e}from"../chunks/BSv_i5Hy.js";import{s as fe}from"../chunks/XUjQEjo_.js";import{i as G}from"../chunks/Cec3cEQU.js";import{l as ua,m as pa,o as oe,p as fa}from"../chunks/Bl1F-iLh.js";import{i as ma,l as we,p as te,s as qe,b as yt}from"../chunks/DYD2hZ7I.js";import{a as je,s as bt}from"../chunks/HG7v26tk.js";import{s as Ie,b as vt,C as ga,d as Ke,a as ge,e as jt,c as le,f as ha,r as We}from"../chunks/uxZwVYDM.js";import{i as _a,o as ya,g as ba,b as $a,l as wa,c as ka,s as dt,v as xa,u as Aa,e as Ma,f as Ia,h as Sa,j as Ea,k as Ca}from"../chunks/BFkVdgW4.js";import{M as ot}from"../chunks/CoxQhQk-.js";function xe(s,t){return t}function qa(s,t,r,b){for(var a=[],g=t.length,n=0;n<g;n++)aa(t[n].e,a,!0);var o=g>0&&a.length===0&&r!==null;if(o){var L=r.parentNode;sa(L),L.append(r),b.clear(),ze(s,t[0].prev,t[g-1].next)}oa(a,()=>{for(var d=0;d<g;d++){var i=t[d];o||(b.delete(i.k),ze(s,i.prev,i.next)),Tt(i.e,!o)}})}function Ae(s,t,r,b,a,g=null){var n=s,o={flags:t,items:new Map,first:null},L=(t&Pt)!==0;if(L){var d=s;n=pe?Ue(Et(d)):d.appendChild(It())}pe&&it();var i=null,E=!1,h=ve(()=>{var f=r();return zt(f)?f:f==null?[]:qt(f)});St(()=>{var f=e(h),y=f.length;if(E&&y===0)return;E=y===0;let T=!1;if(pe){var x=n.data===Jt;x!==(y===0)&&(n=$t(),Ue(n),Ye(!1),T=!0)}if(pe){for(var O=null,R,F=0;F<y;F++){if(Te.nodeType===8&&Te.data===Qt){n=Te,T=!0,Ye(!1);break}var P=f[F],z=b(P,F);R=Lt(Te,o,O,null,P,z,F,a,t,r),o.items.set(z,R),O=R}y>0&&Ue($t())}pe||Pa(f,o,n,a,t,b,r),g!==null&&(y===0?i?pt(i):i=ft(()=>g(n)):i!==null&&Ct(i,()=>{i=null})),T&&Ye(!0),e(h)}),pe&&(n=Te)}function Pa(s,t,r,b,a,g,n){var Q,ae,ie,V;var o=(a&ta)!==0,L=(a&(mt|gt))!==0,d=s.length,i=t.items,E=t.first,h=E,f,y=null,T,x=[],O=[],R,F,P,z;if(o)for(z=0;z<d;z+=1)R=s[z],F=g(R,z),P=i.get(F),P!==void 0&&((Q=P.a)==null||Q.measure(),(T??(T=new Set)).add(P));for(z=0;z<d;z+=1){if(R=s[z],F=g(R,z),P=i.get(F),P===void 0){var _e=h?h.e.nodes_start:r;y=Lt(_e,t,y,y===null?t.first:y.next,R,F,z,b,a,n),i.set(F,y),x=[],O=[],h=y.next;continue}if(L&&za(P,R,z,a),(P.e.f&st)!==0&&(pt(P.e),o&&((ae=P.a)==null||ae.unfix(),(T??(T=new Set)).delete(P))),P!==h){if(f!==void 0&&f.has(P)){if(x.length<O.length){var I=O[0],N;y=I.prev;var D=x[0],ee=x[x.length-1];for(N=0;N<x.length;N+=1)At(x[N],I,r);for(N=0;N<O.length;N+=1)f.delete(O[N]);ze(t,D.prev,ee.next),ze(t,y,D),ze(t,ee,I),h=I,y=ee,z-=1,x=[],O=[]}else f.delete(P),At(P,h,r),ze(t,P.prev,P.next),ze(t,P,y===null?t.first:y.next),ze(t,y,P),y=P;continue}for(x=[],O=[];h!==null&&h.k!==F;)(h.e.f&st)===0&&(f??(f=new Set)).add(h),O.push(h),h=h.next;if(h===null)continue;P=h}x.push(P),y=P,h=P.next}if(h!==null||f!==void 0){for(var W=f===void 0?[]:qt(f);h!==null;)(h.e.f&st)===0&&W.push(h),h=h.next;var X=W.length;if(X>0){var re=(a&Pt)!==0&&d===0?r:null;if(o){for(z=0;z<X;z+=1)(ie=W[z].a)==null||ie.measure();for(z=0;z<X;z+=1)(V=W[z].a)==null||V.fix()}qa(t,W,re,i)}}o&&Zt(()=>{var q;if(T!==void 0)for(P of T)(q=P.a)==null||q.apply()}),ct.first=t.first&&t.first.e,ct.last=y&&y.e}function za(s,t,r,b){(b&mt)!==0&&wt(s.v,t),(b&gt)!==0?wt(s.i,r):s.i=r}function Lt(s,t,r,b,a,g,n,o,L,d){var i=(L&mt)!==0,E=(L&ra)===0,h=i?E?ea(a):kt(a):a,f=(L&gt)===0?n:kt(n),y={i:f,v:h,k:g,a:null,e:null,prev:r,next:b};try{return y.e=ft(()=>o(s,h,f,d),pe),y.e.prev=r&&r.e,y.e.next=b&&b.e,r===null?t.first=y:(r.next=y,r.e.next=y.e),b!==null&&(b.prev=y,b.e.prev=y.e),y}finally{}}function At(s,t,r){for(var b=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,g=s.e.nodes_start;g!==b;){var n=la(g);a.before(g),g=n}}function ze(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Ta(s,t,r,b,a,g){let n=pe;pe&&it();var o,L,d=null;pe&&Te.nodeType===1&&(d=Te,it());var i=pe?Te:s,E;St(()=>{const h=t()||null;var f=ia;h!==o&&(E&&(h===null?Ct(E,()=>{E=null,L=null}):h===L?pt(E):Tt(E)),h&&h!==L&&(E=ft(()=>{if(d=pe?d:document.createElementNS(f,h),Ut(d,d),b){pe&&ua(h)&&d.append(document.createComment(""));var y=pe?Et(d):d.appendChild(It());pe&&(y===null?Ye(!1):Ue(y)),b(d,y)}ct.nodes_end=d,i.before(d)})),o=h,o&&(L=o))},na),n&&(Ye(!0),Ue(i))}function De(s,t,r=t){var b=ca();pa(s,"input",a=>{var g=a?s.defaultValue:s.value;if(g=rt(s)?lt(g):g,r(g),b&&g!==(g=t())){var n=s.selectionStart,o=s.selectionEnd;s.value=g??"",o!==null&&(s.selectionStart=n,s.selectionEnd=Math.min(o,s.value.length))}}),(pe&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&r(rt(s)?lt(s.value):s.value),va(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,r){if(s.multiple)return ja(s,t);for(var b of s.options){var a=Ot(b);if(ma(a,t)){b.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let r=!0;da(()=>{t&&ut(s,Nt(t),r),r=!1;var b=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return b.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{b.disconnect()}})}function ja(s,t){for(var r of s.options)r.selected=~t.indexOf(Ot(r))}function Ot(s){return"__value"in s?s.__value:s.value}function La(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function Mt(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function nt(s,t){var g;var r=(g=s.$$events)==null?void 0:g[t.type],b=zt(r)?r.slice():r==null?[]:[r];for(var a of b)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ha=Yt("<svg><!><!></svg>");function Pe(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]),b=we(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Fe(t,!1);let a=te(t,"name",8,void 0),g=te(t,"color",8,"currentColor"),n=te(t,"size",8,24),o=te(t,"strokeWidth",8,2),L=te(t,"absoluteStrokeWidth",8,!1),d=te(t,"iconNode",24,()=>[]);const i=(...T)=>T.filter((x,O,R)=>!!x&&R.indexOf(x)===O).join(" ");Re();var E=Ha();let h;var f=v(E);Ae(f,1,d,xe,(T,x)=>{let O=()=>e(x)[0],R=()=>e(x)[1];var F=he(),P=de(F);Ta(P,O,!0,(z,_e)=>{let I;Y(()=>I=vt(z,I,{...R()}))}),u(T,F)});var y=$(f);Ie(y,t,"default",{}),l(E),Y((T,x)=>h=vt(E,h,{...Oa,...b,width:n(),height:n(),stroke:g(),"stroke-width":T,class:x}),[()=>L()?Number(o())*24/Number(n()):o(),()=>i("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],ve),u(s,E),Ve()}function Da(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"camera"},()=>r,{iconNode:[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}],["circle",{cx:"12",cy:"13",r:"3"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ka(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ra(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Fa(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ht(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"notebook-pen"},()=>r,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Dt(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Va(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"send"},()=>r,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Ba(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}function Kt(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]);Pe(s,qe({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,g)=>{var n=he(),o=de(n);Ie(o,t,"default",{}),u(a,n)},$$slots:{default:!0}}))}var Ga=M('<div class="spinner svelte-1pi70xe"></div>'),Wa=M("<button><!> <!></button>");function Me(s,t){const r=we(t,["children","$$slots","$$events","$$legacy"]),b=we(r,["type","variant","size","disabled","loading","fullWidth"]);let a=te(t,"type",8,"button"),g=te(t,"variant",8,"primary"),n=te(t,"size",8,"md"),o=te(t,"disabled",8,!1),L=te(t,"loading",8,!1),d=te(t,"fullWidth",8,!1);var i=Wa();let E;var h=v(i);{var f=T=>{var x=Ga();u(T,x)};G(h,T=>{L()&&T(f)})}var y=$(h,2);Ie(y,t,"default",{}),l(i),Y(T=>E=vt(i,E,{type:a(),class:`button ${g()??""} ${n()??""} ${(d()?"full-width":"")??""}`,disabled:o(),...b,[ga]:T},"svelte-1pi70xe"),[()=>({loading:L()})],ve),oe("click",i,function(T){nt.call(this,t,T)}),oe("keydown",i,function(T){nt.call(this,t,T)}),oe("keyup",i,function(T){nt.call(this,t,T)}),u(s,i)}var Ua=M('<option class="svelte-1m60q0l"> </option>'),Ya=M('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Xa=M('<option class="svelte-1m60q0l"> </option>'),Ja=M('<option class="svelte-1m60q0l"> </option>'),Qa=M('<option disabled class="svelte-1m60q0l"> </option>'),Za=M('<!> <span class="svelte-1m60q0l">New Chat</span>',1),es=M('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),ts=M('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function as(s,t){var q;Fe(t,!1);const[r,b]=bt(),a=()=>je(jt,"$activeChat",r),g=()=>je(ka,"$allModelsStore",r),n=()=>je(wa,"$localModelsStore",r),o=()=>je(le,"$chatStore",r);let L=te(t,"isMobile",8,!1),d=te(t,"isExpanded",8,!0);const i=ht();let E=ne(((q=a())==null?void 0:q.model.id)||"claude-3-5-sonnet");Qe(async()=>{await _a()});function h(){const _=g().find(c=>c.id===e(E));_&&le.createNewChat(_)}function f(_){le.selectChat(_),L()&&i("toggleSidebar",!1)}function y(_,c){c.stopPropagation(),le.deleteChat(_)}function T(_){const c=_.target;if(m(E,c.value),a()){const p=g().find(C=>C.id===e(E));p&&le.updateChatModel(a().id,p)}}Je(()=>a(),()=>{a()&&m(E,a().model.id)}),_t(),Re();var x=ts();let O;var R=v(x),F=v(R),P=v(F);Ne(2),l(F);var z=$(F,2);{var _e=_=>{const c=ve(()=>d()?"Collapse sidebar":"Expand sidebar");Me(_,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(c)},$$events:{click:()=>i("toggleSidebar",!d())},children:(p,C)=>{Ka(p,{size:20})},$$slots:{default:!0}})};G(z,_=>{L()&&_(_e)})}l(R);var I=$(R,2),N=v(I),D=v(N);Na(D,()=>e(E));var ee,W=v(D);{var X=_=>{var c=Ya();Ae(c,5,n,xe,(p,C)=>{var A=Ua(),S={},B=v(A,!0);l(A),Y(()=>{S!==(S=e(C).id)&&(A.value=(A.__value=e(C).id)==null?"":e(C).id),fe(B,e(C).name)}),u(p,A)}),l(c),u(_,c)};G(W,_=>{n().length>0&&_(X)})}var re=$(W);Ae(re,5,()=>ya,xe,(_,c)=>{var p=Xa(),C={},A=v(p,!0);l(p),Y(()=>{C!==(C=e(c).id)&&(p.value=(p.__value=e(c).id)==null?"":e(c).id),fe(A,e(c).name)}),u(_,p)}),l(re);var Q=$(re);Ae(Q,5,()=>ba,xe,(_,c)=>{var p=Ja(),C={},A=v(p,!0);l(p),Y(()=>{C!==(C=e(c).id)&&(p.value=(p.__value=e(c).id)==null?"":e(c).id),fe(A,e(c).name)}),u(_,p)}),l(Q);var ae=$(Q);Ae(ae,5,()=>$a,xe,(_,c)=>{var p=Qa(),C={},A=v(p,!0);l(p),Y(()=>{C!==(C=e(c).id)&&(p.value=(p.__value=e(c).id)==null?"":e(c).id),fe(A,e(c).name)}),u(_,p)}),l(ae),l(D),l(N);var ie=$(N,2);Me(ie,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:h},children:(_,c)=>{var p=Za(),C=de(p);Ht(C,{size:16}),Ne(2),u(_,p)},$$slots:{default:!0}});var V=$(ie,2);Ae(V,5,()=>o().chats,xe,(_,c)=>{var p=es();let C;var A=v(p),S=v(A,!0);l(A);var B=$(A,2);Me(B,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:U=>y(e(c).id,U)},children:(U,ye)=>{Kt(U,{size:16})},$$slots:{default:!0}}),l(p),Y(U=>{C=Ke(p,1,"chat-item svelte-1m60q0l",null,C,U),fe(S,e(c).title||"New Chat")},[()=>{var U;return{active:e(c).id===((U=a())==null?void 0:U.id)}}],ve),oe("click",p,()=>f(e(c).id)),u(_,p)}),l(V),l(I),l(x),Y(_=>{O=Ke(x,1,"sidebar svelte-1m60q0l",null,O,_),ge(P,"src","/gervais/logo.svg"),ee!==(ee=e(E))&&(D.value=(D.__value=e(E))==null?"":e(E),ut(D,e(E)))},[()=>({expanded:d()})],ve),oe("change",D,T),u(s,x),Ve(),b()}var ss=M('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),os=M('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),rs=M('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ls=M('<div class="file-size svelte-1mjurqb"> </div>'),ns=M('<span class="document-status success svelte-1mjurqb"> </span>'),is=M('<span class="document-status info svelte-1mjurqb">Document attached</span>'),cs=M('<span class="document-status success svelte-1mjurqb">Document processed</span>'),vs=M('<span class="document-status info svelte-1mjurqb">Document</span>'),ds=M('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),us=M('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">ðŸ“„</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),ps=M('<div class="media-container svelte-1mjurqb"></div>'),fs=M('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),ms=M('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),gs=M('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),hs=M('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),_s=M('<div class="media-container assistant-media svelte-1mjurqb"></div>'),ys=M('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),bs=M('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),$s=M('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ws=M('<div class="content system-message svelte-1mjurqb"><!></div>'),ks=M('<div class="timestamp svelte-1mjurqb"> </div>'),xs=M('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">Ã—</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),As=M("<div><!> <!></div> <!>",1);function Ms(s,t){Fe(t,!1);const r=ne(),b=ne();let a=te(t,"message",8),g=te(t,"isStreaming",8,!1),n=te(t,"scrollToBottom",8,!1),o=ne(!1),L=ne(""),d=ne(""),i=ne();Qe(()=>{if(n()&&e(i)){const I=e(i).parentElement;I&&(I.scrollTop=I.scrollHeight)}});function E(I,N=2){if(I===0)return"0 Bytes";const D=1024,ee=N<0?0:N,W=["Bytes","KB","MB","GB","TB"],X=Math.floor(Math.log(I)/Math.log(D));return parseFloat((I/Math.pow(D,X)).toFixed(ee))+" "+W[X]}function h(I,N="Preview image"){m(L,I),m(d,N),m(o,!0)}function f(){m(o,!1)}Je(()=>xt(a()),()=>{m(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Je(()=>xt(a()),()=>{m(b,`message ${a().role}`)}),_t(),Re();var y=As(),T=de(y),x=v(T);{var O=I=>{var N=fs(),D=v(N),ee=v(D),W=v(ee,!0);l(ee),l(D);var X=$(D,2);{var re=Q=>{var ae=ps();Ae(ae,5,()=>a().media,xe,(ie,V,q)=>{var _=he(),c=de(_);{var p=A=>{var S=ss(),B=v(S);ge(B,"alt",`Image ${q+1}`),l(S),Y(()=>ge(B,"src",e(V).preview)),oe("click",S,()=>{e(V).preview&&h(e(V).preview,`Image ${q+1}`)}),oe("keydown",S,U=>{if(U.key==="Enter"||U.key===" "){if(U.preventDefault(),!e(V).preview)return;h(e(V).preview,`Image ${q+1}`)}}),u(A,S)},C=(A,S)=>{{var B=ye=>{var Se=os();Y(()=>ge(Se,"src",e(V).preview)),u(ye,Se)},U=(ye,Se)=>{{var k=J=>{var K=rs();Y(()=>ge(K,"src",e(V).preview)),u(J,K)},w=(J,K)=>{{var se=H=>{var ce=us(),me=$(v(ce),2),ke=v(me),be=v(ke,!0);l(ke);var Z=$(ke,2);{var j=Ee=>{var Ce=ls(),Be=v(Ce,!0);l(Ce),Y(Ge=>fe(Be,Ge),[()=>E(e(V).size)],ve),u(Ee,Ce)};G(Z,Ee=>{e(V).size&&Ee(j)})}var ue=$(Z,2),Ze=v(ue);{var et=Ee=>{var Ce=ns(),Be=v(Ce);l(Ce),Y(Ge=>fe(Be,`âœ“ Uploaded to OpenAI (ID: ${Ge??""}...)`),[()=>e(V).fileId.substring(0,8)],ve),u(Ee,Ce)},Rt=(Ee,Ce)=>{{var Be=Le=>{var Xe=he(),Ft=de(Xe);{var Vt=Oe=>{var tt=is();u(Oe,tt)},Bt=(Oe,tt)=>{{var Gt=He=>{var at=cs();u(He,at)},Wt=He=>{var at=vs();u(He,at)};G(Oe,He=>{a().role==="assistant"?He(Gt):He(Wt,!1)},tt)}};G(Ft,Oe=>{a().role==="user"?Oe(Vt):Oe(Bt,!1)})}u(Le,Xe)},Ge=Le=>{var Xe=ds();u(Le,Xe)};G(Ee,Le=>{e(V).preview?Le(Be):Le(Ge,!1)},Ce)}};G(Ze,Ee=>{e(V).fileId?Ee(et):Ee(Rt,!1)})}l(ue),l(me),l(ce),Y(()=>fe(be,e(V).name||"Document")),u(H,ce)};G(J,H=>{e(V).type==="document"&&H(se)},K)}};G(ye,J=>{e(V).type==="video"?J(k):J(w,!1)},Se)}};G(A,ye=>{e(V).type==="audio"?ye(B):ye(U,!1)},S)}};G(c,A=>{e(V).type==="image"?A(p):A(C,!1)})}u(ie,_)}),l(ae),u(Q,ae)};G(X,Q=>{a().media&&a().media.length>0&&Q(re)})}l(N),Y(()=>fe(W,a().content)),u(I,N)},R=(I,N)=>{{var D=W=>{var X=$s(),re=v(X);ot(re,{get content(){return a().content},get scrollToBottom(){return n()}});var Q=$(re,2);{var ae=c=>{var p=_s();Ae(p,5,()=>a().media,xe,(C,A,S)=>{var B=he(),U=de(B);{var ye=k=>{var w=ms(),J=v(w);ge(J,"alt",`Generated image ${S+1}`),Ne(2),l(w),Y(()=>ge(J,"src",e(A).preview)),oe("click",w,()=>{e(A).preview&&h(e(A).preview,`Generated image ${S+1}`)}),oe("keydown",w,K=>{if(K.key==="Enter"||K.key===" "){if(K.preventDefault(),!e(A).preview)return;h(e(A).preview,`Generated image ${S+1}`)}}),u(k,w)},Se=(k,w)=>{{var J=se=>{var H=gs();Y(()=>ge(H,"src",e(A).preview)),u(se,H)},K=(se,H)=>{{var ce=me=>{var ke=hs();Y(()=>ge(ke,"src",e(A).preview)),u(me,ke)};G(se,me=>{e(A).type==="video"&&me(ce)},H)}};G(k,se=>{e(A).type==="audio"?se(J):se(K,!1)},w)}};G(U,k=>{e(A).type==="image"?k(ye):k(Se,!1)})}u(C,B)}),l(p),u(c,p)};G(Q,c=>{a().media&&a().media.length>0&&c(ae)})}var ie=$(Q,2);{var V=c=>{var p=ys(),C=$(v(p),2),A=v(C);ot(A,{get content(){return a().thinking},scrollToBottom:!1}),l(C),l(p),u(c,p)};G(ie,c=>{a().thinking&&c(V)})}var q=$(ie,2);{var _=c=>{var p=bs();u(c,p)};G(q,c=>{g()&&c(_)})}l(X),u(W,X)},ee=(W,X)=>{{var re=Q=>{var ae=ws(),ie=v(ae);ot(ie,{get content(){return a().content},get scrollToBottom(){return n()}}),l(ae),u(Q,ae)};G(W,Q=>{a().role==="system"&&Q(re)},X)}};G(I,W=>{a().role==="assistant"?W(D):W(ee,!1)},N)}};G(x,I=>{a().role==="user"?I(O):I(R,!1)})}var F=$(x,2);{var P=I=>{var N=ks(),D=v(N,!0);l(N),Y(()=>fe(D,e(r))),u(I,N)};G(F,I=>{a().role==="user"&&I(P)})}l(T),yt(T,I=>m(i,I),()=>e(i));var z=$(T,2);{var _e=I=>{var N=xs(),D=v(N),ee=v(D),W=$(ee,2),X=$(W,2),re=v(X,!0);l(X),l(D),l(N),Y(()=>{ge(W,"src",e(L)),ge(W,"alt",e(d)),fe(re,e(d))}),oe("click",ee,f),oe("click",D,Mt(()=>{})),oe("keydown",D,Mt(()=>{})),oe("click",N,f),oe("keydown",N,Q=>Q.key==="Escape"&&f()),u(I,N)};G(z,I=>{e(o)&&I(_e)})}Y(()=>Ke(T,1,ha(e(b)),"svelte-1mjurqb")),u(s,y),Ve()}var Is=M('<img class="svelte-1h9ett2">'),Ss=M('<div class="file-preview svelte-1h9ett2"><span> </span></div>'),Es=M('<div class="media-item svelte-1h9ett2"><!> <button type="button" class="remove-media svelte-1h9ett2" aria-label="Remove media">&times;</button></div>'),Cs=M("<div><!></div>"),qs=M("<div><!></div>"),Ps=M('<button type="button"> </button>'),zs=M('<div class="message-input-container svelte-1h9ett2"><div class="media-preview svelte-1h9ett2"></div> <div class="input-container svelte-1h9ett2"><textarea rows="1" class="svelte-1h9ett2"></textarea> <div class="actions svelte-1h9ett2"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!></div></div> <div class="tools-bar svelte-1h9ett2"></div></div>');function Ts(s,t){Fe(t,!1);let r=te(t,"value",12,""),b=te(t,"placeholder",8,"Send a message..."),a=te(t,"disabled",8,!1),g=te(t,"isRecording",8,!1),n=te(t,"isCapturingVideo",8,!1),o=te(t,"mediaItems",28,()=>[]),L=te(t,"tools",24,()=>({}));const d=ht();let i=ne();function E(){e(i)&&($e(i,e(i).style.height="auto"),$e(i,e(i).style.height=`${Math.min(e(i).scrollHeight,200)}px`))}function h(){a()||!r().trim()&&o().length===0||(d("submit",{content:r().trim(),media:o(),tools:L()}),r(""),e(i)&&$e(i,e(i).style.height="auto"))}function f(q){q.key==="Enter"&&!q.shiftKey&&(q.preventDefault(),h())}function y(){g()?d("stopAudioCapture"):d("startAudioCapture")}function T(){n()?d("stopVideoCapture"):d("startVideoCapture")}function x(q){const _=q.target;if(_.files&&_.files.length>0){const c=Array.from(_.files);d("uploadFile",c),_.value=""}}function O(q){const _=!L()[q];d("toggleTool",{tool:q,enabled:_})}Je(()=>e(i),()=>{e(i)&&E()}),_t(),Re();var R=zs(),F=v(R);Ae(F,5,o,xe,(q,_)=>{var c=Es(),p=v(c);{var C=B=>{var U=Is();Y(()=>{ge(U,"src",e(_).preview),ge(U,"alt",e(_).name)}),u(B,U)},A=B=>{var U=Ss(),ye=v(U),Se=v(ye,!0);l(ye),l(U),Y(()=>fe(Se,e(_).name)),u(B,U)};G(p,B=>{e(_).type==="image"&&e(_).preview?B(C):B(A,!1)})}var S=$(p,2);l(c),oe("click",S,()=>{o(o().filter(B=>B.id!==e(_).id))}),u(q,c)}),l(F);var P=$(F,2),z=v(P);fa(z),yt(z,q=>m(i,q),()=>e(i));var _e=$(z,2),I=v(_e),N=$(I,2);Me(N,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var q;return(q=document.getElementById("file-upload"))==null?void 0:q.click()}},children:(q,_)=>{Dt(q,{size:18})},$$slots:{default:!0}});var D=$(N,2);const ee=ve(()=>a()||g()),W=ve(()=>g()?"Stop recording":"Start recording");Me(D,{variant:"icon",size:"sm",get disabled(){return e(ee)},get"aria-label"(){return e(W)},$$events:{click:y},children:(q,_)=>{var c=Cs();let p;var C=v(c);Fa(C,{size:18}),l(c),Y(A=>p=Ke(c,1,"",null,p,A),[()=>({active:g()})],ve),u(q,c)},$$slots:{default:!0}});var X=$(D,2);const re=ve(()=>a()||g()),Q=ve(()=>n()?"Stop video capture":"Start video capture");Me(X,{variant:"icon",size:"sm",get disabled(){return e(re)},get"aria-label"(){return e(Q)},$$events:{click:T},children:(q,_)=>{var c=qs();let p;var C=v(c);Da(C,{size:18}),l(c),Y(A=>p=Ke(c,1,"",null,p,A),[()=>({active:n()})],ve),u(q,c)},$$slots:{default:!0}});var ae=$(X,2);const ie=ve(()=>a()||!r().trim()&&o().length===0);Me(ae,{variant:"icon",size:"sm",get disabled(){return e(ie)},"aria-label":"Send message",$$events:{click:h},children:(q,_)=>{Va(q,{size:18})},$$slots:{default:!0}}),l(_e),l(P);var V=$(P,2);Ae(V,5,()=>Object.entries(L()),xe,(q,_)=>{let c=()=>e(_)[0],p=()=>e(_)[1];var C=Ps();let A;var S=v(C,!0);l(C),Y(B=>{A=Ke(C,1,"tool-button svelte-1h9ett2",null,A,B),ge(C,"aria-label",`Toggle ${c()??""}`),fe(S,c())},[()=>({enabled:p()})],ve),oe("click",C,()=>O(c())),u(q,C)}),l(V),l(R),Y(()=>{ge(z,"placeholder",b()),z.disabled=a()}),De(z,r),oe("keydown",z,f),oe("change",I,x),u(s,R),Ve()}var Ns=M('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),js=M('<span class="error-message svelte-8a76oy"> </span>'),Ls=M('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Os(s,t){Fe(t,!1);const[r,b]=bt(),a=()=>je(dt,"$settingsStore",r);let g=te(t,"isOpen",8,!1);const n=ht();let o=ne({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),L=ne(!1),d=ne(!1),i=ne("");Qe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const x=a().apiKeys||{};console.log("Stored API keys from settings store:",x),m(o,{anthropic:x.anthropic||"",openai:x.openai||"",google:x.google||"",ollamaHost:x.ollamaHost||"http://localhost:11434",localHost:x.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(o))});function E(){n("close")}async function h(){var x;m(L,!0),m(d,!1),m(i,"");try{if(console.log("Saving API keys to settingsStore:",e(o)),e(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(o).openai),console.log(`OpenAI key before saving: length=${e(o).openai.length}, starts with=${e(o).openai.substring(0,4)}`);const O=[...e(o).openai.substring(0,10)].map(R=>R.charCodeAt(0));console.log(`First 10 character codes: ${O.join(", ")}`)}if(await dt.updateApiKeys({anthropic:e(o).anthropic,openai:e(o).openai,google:e(o).google,ollamaHost:e(o).ollamaHost||"http://localhost:11434",localHost:e(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(x=a().apiKeys)!=null&&x.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const O=[...a().apiKeys.openai.substring(0,10)].map(R=>R.charCodeAt(0));console.log(`First 10 character codes after saving: ${O.join(", ")}`)}m(d,!0),console.log("API keys saved successfully"),setTimeout(()=>{m(d,!1)},3e3)}catch(O){console.error("Failed to save API keys:",O),m(i,O instanceof Error?O.message:"Unknown error")}finally{m(L,!1)}}Re();var f=he(),y=de(f);{var T=x=>{var O=Ls(),R=v(O),F=v(R),P=$(v(F),2);Me(P,{variant:"icon","aria-label":"Close settings",$$events:{click:E},children:(S,B)=>{Kt(S,{size:20})},$$slots:{default:!0}}),l(F);var z=$(F,2),_e=v(z),I=$(v(_e),4),N=v(I),D=$(v(N),2);We(D),l(N);var ee=$(N,2),W=$(v(ee),2);We(W),l(ee);var X=$(ee,2),re=$(v(X),2);We(re),l(X);var Q=$(X,2),ae=$(v(Q),2);We(ae),Ne(2),l(Q);var ie=$(Q,2),V=$(v(ie),2);We(V),Ne(2),l(ie),l(I);var q=$(I,2),_=v(q);Me(_,{variant:"primary",get disabled(){return e(L)},$$events:{click:h},children:(S,B)=>{Ne();var U=Xt();Y(()=>fe(U,e(L)?"Saving...":"Save API Keys")),u(S,U)},$$slots:{default:!0}});var c=$(_,2);{var p=S=>{var B=Ns();u(S,B)};G(c,S=>{e(d)&&S(p)})}var C=$(c,2);{var A=S=>{var B=js(),U=v(B,!0);l(B),Y(()=>fe(U,e(i))),u(S,B)};G(C,S=>{e(i)&&S(A)})}l(q),l(_e),l(z),l(R),l(O),De(D,()=>e(o).anthropic,S=>$e(o,e(o).anthropic=S)),De(W,()=>e(o).openai,S=>$e(o,e(o).openai=S)),De(re,()=>e(o).google,S=>$e(o,e(o).google=S)),De(ae,()=>e(o).ollamaHost,S=>$e(o,e(o).ollamaHost=S)),De(V,()=>e(o).localHost,S=>$e(o,e(o).localHost=S)),oe("click",O,La(E)),oe("keydown",O,S=>S.key==="Escape"&&E()),u(x,O)};G(y,x=>{g()&&x(T)})}u(s,f),Ve(),b()}var Hs=M('<div class="sidebar-backdrop svelte-u7neki" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Ds=M('<div class="empty-state svelte-u7neki"><h2 class="svelte-u7neki">Start a new conversation</h2> <p class="svelte-u7neki">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-u7neki"><div class="feature svelte-u7neki"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-u7neki"><!> <span>Vision support for images</span></div></div></div>'),Ks=M('<div class="settings-portal svelte-u7neki"><!></div>'),Rs=M('<div class="chat-container svelte-u7neki"><!> <!> <main class="chat-main svelte-u7neki"><header class="chat-header svelte-u7neki"><!> <h1 class="chat-title svelte-u7neki"> </h1> <!></header> <div class="chat-messages svelte-u7neki"><!></div> <div class="input-container svelte-u7neki"><!></div></main></div> <!>',1);function eo(s,t){Fe(t,!1);const[r,b]=bt(),a=()=>je(jt,"$activeChat",r),g=()=>je(dt,"$settingsStore",r);let n=ne(!1),o=ne(!0),L=ne(""),d=ne(!1),i=ne(!1),E=ne([]),h=ne({search:!1}),f=ne(),y=ne(!1);function T(){m(n,window.innerWidth<768),e(n)?m(o,!1):m(o,!0)}Qe(()=>(T(),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)}));function x(){m(o,!e(o))}async function O({detail:k}){var ce,me,ke;if(!a())return;const w=a().model.provider;if(console.log("Current settings store state:",g()),w==="openai"&&!((ce=g().apiKeys)!=null&&ce.openai)){console.warn("OpenAI API key not set, opening settings dialog"),m(y,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(w==="anthropic"&&!((me=g().apiKeys)!=null&&me.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),m(y,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(w==="google"&&!((ke=g().apiKeys)!=null&&ke.google)){console.warn("Google API key not set, opening settings dialog"),m(y,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:J,media:K,tools:se}=k;console.log("Media items in submission:",K),await le.addMessage(a().id,{role:"user",content:J,media:K}),m(L,""),m(E,[]),setTimeout(()=>{e(f)&&$e(f,e(f).scrollTop=e(f).scrollHeight)},100);const H=await le.addMessage(a().id,{role:"assistant",content:""});m(d,!0),m(i,!0);try{const be=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",be);const Z=a().model.id;if(w==="anthropic")await Ma(Z,be,j=>{le.updateMessage(a().id,H,{content:j})},()=>{m(d,!1),m(i,!1),setTimeout(()=>{e(f)&&$e(f,e(f).scrollTop=e(f).scrollHeight)},100)},j=>{console.error("Error generating response:",j),le.updateMessage(a().id,H,{content:`Error generating response: â€“ ${j.message}`}),m(d,!1),m(i,!1)},j=>{le.updateMessage(a().id,H,{thinking:j})});else if(w==="openai")if(e(i))await Ia(Z,be,j=>{le.updateMessage(a().id,H,{content:j})},()=>{m(d,!1),m(i,!1),setTimeout(()=>{e(f)&&$e(f,e(f).scrollTop=e(f).scrollHeight)},100)},j=>{console.error("Error generating response from OpenAI:",j);const ue=j.message||"An unknown error occurred";le.updateMessage(a().id,H,{content:`Error: ${ue}`}),m(d,!1),m(i,!1)});else try{const j=await Sa(Z,be);le.updateMessage(a().id,H,{content:j}),m(d,!1)}catch(j){console.error("Error generating non-streaming response from OpenAI:",j);const ue=j.message||"An unknown error occurred";throw le.updateMessage(a().id,H,{content:`Error: ${ue}`}),m(d,!1),j}else if(w==="google")await Ea(Z,be,(j,ue)=>{le.updateMessage(a().id,H,{content:j,media:ue})},()=>{m(d,!1),m(i,!1),setTimeout(()=>{e(f)&&$e(f,e(f).scrollTop=e(f).scrollHeight)},100)},j=>{console.error("Error generating response from Google:",j);const ue=j.message||"An unknown error occurred";le.updateMessage(a().id,H,{content:`Error: ${ue}`}),m(d,!1),m(i,!1)},j=>{le.updateMessage(a().id,H,{thinking:j})});else if(w==="ollama")try{await Ca(Z,be,j=>{le.updateMessage(a().id,H,{content:j})},()=>{m(d,!1),m(i,!1),setTimeout(()=>{e(f)&&$e(f,e(f).scrollTop=e(f).scrollHeight)},100)},j=>{console.error("Error generating response from Ollama:",j);const ue=j.message||"An unknown error occurred";le.updateMessage(a().id,H,{content:`Error connecting to Ollama: ${ue}. Make sure Ollama is running locally.`}),m(d,!1),m(i,!1)})}catch(j){throw console.error("Error generating response from Ollama:",j),j}else{let j="";const ue="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of ue)await new Promise(et=>setTimeout(et,50)),j+=Ze+" ",le.updateMessage(a().id,H,{content:j.trim()});m(d,!1),m(i,!1)}}catch(be){if(console.error("Error generating response:",be),e(d)){const Z=be.message||"An unknown error occurred";le.updateMessage(a().id,H,{content:`Error: ${Z}`}),m(d,!1),m(i,!1)}}}function R(k){k.forEach(async w=>{const J=xa(),K=w.name,se=w.size;let H="other",ce,me;console.log(`Processing file: ${K}, type: ${w.type}, size: ${se} bytes`);const ke=Z=>{var j;if(Z.type.includes("pdf")||Z.type.includes("word")||Z.type.includes("excel")||Z.type.includes("spreadsheet")||Z.type.includes("presentation")||Z.type.includes("officedocument")||Z.type.includes("application/rtf")||Z.type.includes("text/rtf"))return!0;if(!Z.type||Z.type==="application/octet-stream"){const ue=(j=K.split(".").pop())==null?void 0:j.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(ue||"")}return!1};if(w.type.startsWith("image/")){H="image";try{ce=await F(w),console.log(`Created data URL for image ${K} (length: ${ce.length} chars)`)}catch(Z){console.error(`Failed to create data URL for ${K}:`,Z)}}else if(w.type.startsWith("audio/"))H="audio";else if(w.type.startsWith("video/"))H="video";else if(w.type.startsWith("text/"))H="text";else if(ke(w)){if(H="document",a()&&a().model.provider==="openai")try{me=await Aa(w),console.log(`Document ${K} uploaded to OpenAI with ID: ${me}`)}catch(Z){console.error(`Failed to upload document to OpenAI: ${Z.message}`),alert(`Failed to upload document to OpenAI: ${Z.message}`)}try{ce=await F(w),console.log(`Created data URL for document ${K}, mime type: ${w.type}`),console.log(`Document data URL length: ${ce.length} chars`),se>5*1024*1024&&console.warn(`Warning: Large document (${(se/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(Z){console.error(`Failed to create data URL for ${K}:`,Z)}}const be={id:J,type:H,name:K,preview:ce,size:se,timestamp:Date.now(),fileId:me};console.log(`Adding media item: ${H} ${K}`),m(E,[...e(E),be])})}async function F(k){return new Promise((w,J)=>{const K=new FileReader;K.onload=()=>{const se=K.result;w(se)},K.onerror=se=>{console.error("Error reading file:",se),J(se)},K.readAsDataURL(k)})}function P({detail:k}){const{tool:w,enabled:J}=k;m(h,{...e(h),[w]:J})}function z(){console.log("Start audio capture")}function _e(){console.log("Stop audio capture")}function I(){console.log("Start video capture")}function N(){console.log("Stop video capture")}Re();var D=Rs(),ee=de(D),W=v(ee);as(W,{get isMobile(){return e(n)},get isExpanded(){return e(o)},$$events:{toggleSidebar:({detail:k})=>m(o,k)}});var X=$(W,2);{var re=k=>{var w=Hs();oe("click",w,()=>m(o,!1)),oe("keydown",w,J=>J.key==="Escape"&&m(o,!1)),u(k,w)};G(X,k=>{e(n)&&e(o)&&k(re)})}var Q=$(X,2),ae=v(Q),ie=v(ae);{var V=k=>{Me(k,{variant:"icon","aria-label":"Open menu",$$events:{click:x},children:(w,J)=>{Ht(w,{size:20})},$$slots:{default:!0}})};G(ie,k=>{e(n)&&k(V)})}var q=$(ie,2),_=v(q,!0);l(q);var c=$(q,2);Me(c,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>m(y,!0)},children:(k,w)=>{Ba(k,{size:20})},$$slots:{default:!0}}),l(ae);var p=$(ae,2),C=v(p);{var A=k=>{var w=he(),J=de(w);Ae(J,1,()=>a().messages,xe,(K,se,H)=>{const ce=ve(()=>e(i)&&H===a().messages.length-1&&e(se).role==="assistant"),me=ve(()=>H===a().messages.length-1);Ms(K,{get message(){return e(se)},get isStreaming(){return e(ce)},get scrollToBottom(){return e(me)}})}),u(k,w)},S=k=>{var w=Ds(),J=$(v(w),4),K=v(J),se=v(K);Dt(se,{size:16}),Ne(2),l(K);var H=$(K,2),ce=v(H);Ra(ce,{size:16}),Ne(2),l(H),l(J),l(w),u(k,w)};G(C,k=>{a()&&a().messages.length>0?k(A):k(S,!1)})}l(p),yt(p,k=>m(f,k),()=>e(f));var B=$(p,2),U=v(B);Ts(U,{get tools(){return e(h)},get disabled(){return e(d)},placeholder:"Send a message...",get value(){return e(L)},set value(k){m(L,k)},get mediaItems(){return e(E)},set mediaItems(k){m(E,k)},$$events:{submit:O,uploadFile:k=>R(k.detail),toggleTool:P,startAudioCapture:z,stopAudioCapture:_e,startVideoCapture:I,stopVideoCapture:N},$$legacy:!0}),l(B),l(Q),l(ee);var ye=$(ee,2);{var Se=k=>{var w=Ks(),J=v(w);Os(J,{$$events:{close:()=>m(y,!1)}}),l(w),u(k,w)};G(ye,k=>{e(y)&&k(Se)})}Y(()=>{var k;return fe(_,((k=a())==null?void 0:k.model.name)||"AI Assistant")}),u(s,D),Ve(),b()}export{eo as component};
