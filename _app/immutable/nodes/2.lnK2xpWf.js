import{a as Ut,n as Yt,b as u,c as fe,t as M,d as Xt}from"../chunks/CD-cSNpP.js";import{i as Re}from"../chunks/DSKYDh3O.js";import{v as Mt,b as It,s as Ue,h as ge,j as St,a as nt,G as e,aa as de,c as Jt,r as $t,d as Ye,g as Te,m as Qt,e as pt,f as ft,p as Et,aD as st,t as Ct,a7 as Zt,y as vt,aE as mt,aF as wt,aG as gt,B as ea,$ as kt,aH as Pt,a4 as zt,aI as ta,aJ as aa,q as sa,aK as oa,aL as Tt,aM as ra,k as la,E as ia,aN as na,aO as va,N as Nt,a6 as ca,a5 as da,w as Ve,V as v,X as x,T as Y,z as Fe,W as l,S as ce,aP as ht,aQ as ne,al as Qe,aR as Je,aS as _t,D as _,aT as Ne,P as xt,aU as we}from"../chunks/BSv_i5Hy.js";import{s as he}from"../chunks/XUjQEjo_.js";import{i as G}from"../chunks/Cec3cEQU.js";import{l as ua,m as pa,o as se,p as fa}from"../chunks/Bl1F-iLh.js";import{i as ma,l as be,p as te,s as Ee,b as yt}from"../chunks/DYD2hZ7I.js";import{a as je,s as bt}from"../chunks/HG7v26tk.js";import{s as Ae,b as ct,C as ga,d as Le,a as ye,e as jt,c as ie,f as ha,r as We}from"../chunks/uxZwVYDM.js";import{i as _a,o as ya,g as ba,b as $a,l as wa,c as ka,s as dt,v as xa,u as Aa,e as qa,f as Ma,h as Ia,j as Sa,k as Ea}from"../chunks/BFkVdgW4.js";import{M as ot}from"../chunks/CoxQhQk-.js";function Me(s,t){return t}function Ca(s,t,r,$){for(var a=[],m=t.length,i=0;i<m;i++)aa(t[i].e,a,!0);var o=m>0&&a.length===0&&r!==null;if(o){var z=r.parentNode;sa(z),z.append(r),$.clear(),ze(s,t[0].prev,t[m-1].next)}oa(a,()=>{for(var p=0;p<m;p++){var n=t[p];o||($.delete(n.k),ze(s,n.prev,n.next)),Tt(n.e,!o)}})}function Ie(s,t,r,$,a,m=null){var i=s,o={flags:t,items:new Map,first:null},z=(t&Pt)!==0;if(z){var p=s;i=ge?Ue(St(p)):p.appendChild(Mt())}ge&&nt();var n=null,S=!1,b=de(()=>{var g=r();return zt(g)?g:g==null?[]:Ct(g)});It(()=>{var g=e(b),w=g.length;if(S&&w===0)return;S=w===0;let P=!1;if(ge){var q=i.data===Jt;q!==(w===0)&&(i=$t(),Ue(i),Ye(!1),P=!0)}if(ge){for(var j=null,F,B=0;B<w;B++){if(Te.nodeType===8&&Te.data===Qt){i=Te,P=!0,Ye(!1);break}var E=g[B],L=$(E,B);F=Lt(Te,o,j,null,E,L,B,a,t,r),o.items.set(L,F),j=F}w>0&&Ue($t())}ge||Pa(g,o,i,a,t,$,r),m!==null&&(w===0?n?pt(n):n=ft(()=>m(i)):n!==null&&Et(n,()=>{n=null})),P&&Ye(!0),e(b)}),ge&&(i=Te)}function Pa(s,t,r,$,a,m,i){var X,ae,ve,U;var o=(a&ta)!==0,z=(a&(mt|gt))!==0,p=s.length,n=t.items,S=t.first,b=S,g,w=null,P,q=[],j=[],F,B,E,L;if(o)for(L=0;L<p;L+=1)F=s[L],B=m(F,L),E=n.get(B),E!==void 0&&((X=E.a)==null||X.measure(),(P??(P=new Set)).add(E));for(L=0;L<p;L+=1){if(F=s[L],B=m(F,L),E=n.get(B),E===void 0){var ue=b?b.e.nodes_start:r;w=Lt(ue,t,w,w===null?t.first:w.next,F,B,L,$,a,i),n.set(B,w),q=[],j=[],b=w.next;continue}if(z&&za(E,F,L,a),(E.e.f&st)!==0&&(pt(E.e),o&&((ae=E.a)==null||ae.unfix(),(P??(P=new Set)).delete(E))),E!==b){if(g!==void 0&&g.has(E)){if(q.length<j.length){var I=j[0],C;w=I.prev;var K=q[0],Z=q[q.length-1];for(C=0;C<q.length;C+=1)At(q[C],I,r);for(C=0;C<j.length;C+=1)g.delete(j[C]);ze(t,K.prev,Z.next),ze(t,w,K),ze(t,Z,I),b=I,w=Z,L-=1,q=[],j=[]}else g.delete(E),At(E,b,r),ze(t,E.prev,E.next),ze(t,E,w===null?t.first:w.next),ze(t,w,E),w=E;continue}for(q=[],j=[];b!==null&&b.k!==B;)(b.e.f&st)===0&&(g??(g=new Set)).add(b),j.push(b),b=b.next;if(b===null)continue;E=b}q.push(E),w=E,b=E.next}if(b!==null||g!==void 0){for(var W=g===void 0?[]:Ct(g);b!==null;)(b.e.f&st)===0&&W.push(b),b=b.next;var J=W.length;if(J>0){var oe=(a&Pt)!==0&&p===0?r:null;if(o){for(L=0;L<J;L+=1)(ve=W[L].a)==null||ve.measure();for(L=0;L<J;L+=1)(U=W[L].a)==null||U.fix()}Ca(t,W,oe,n)}}o&&Zt(()=>{var re;if(P!==void 0)for(E of P)(re=E.a)==null||re.apply()}),vt.first=t.first&&t.first.e,vt.last=w&&w.e}function za(s,t,r,$){($&mt)!==0&&wt(s.v,t),($&gt)!==0?wt(s.i,r):s.i=r}function Lt(s,t,r,$,a,m,i,o,z,p){var n=(z&mt)!==0,S=(z&ra)===0,b=n?S?ea(a):kt(a):a,g=(z&gt)===0?i:kt(i),w={i:g,v:b,k:m,a:null,e:null,prev:r,next:$};try{return w.e=ft(()=>o(s,b,g,p),ge),w.e.prev=r&&r.e,w.e.next=$&&$.e,r===null?t.first=w:(r.next=w,r.e.next=w.e),$!==null&&($.prev=w,$.e.prev=w.e),w}finally{}}function At(s,t,r){for(var $=s.next?s.next.e.nodes_start:r,a=t?t.e.nodes_start:r,m=s.e.nodes_start;m!==$;){var i=la(m);a.before(m),m=i}}function ze(s,t,r){t===null?s.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Ta(s,t,r,$,a,m){let i=ge;ge&&nt();var o,z,p=null;ge&&Te.nodeType===1&&(p=Te,nt());var n=ge?Te:s,S;It(()=>{const b=t()||null;var g=na;b!==o&&(S&&(b===null?Et(S,()=>{S=null,z=null}):b===z?pt(S):Tt(S)),b&&b!==z&&(S=ft(()=>{if(p=ge?p:document.createElementNS(g,b),Ut(p,p),$){ge&&ua(b)&&p.append(document.createComment(""));var w=ge?St(p):p.appendChild(Mt());ge&&(w===null?Ye(!1):Ue(w)),$(p,w)}vt.nodes_end=p,n.before(p)})),o=b,o&&(z=o))},ia),i&&(Ye(!0),Ue(n))}function Ke(s,t,r=t){var $=va();pa(s,"input",a=>{var m=a?s.defaultValue:s.value;if(m=rt(s)?lt(m):m,r(m),$&&m!==(m=t())){var i=s.selectionStart,o=s.selectionEnd;s.value=m??"",o!==null&&(s.selectionStart=i,s.selectionEnd=Math.min(o,s.value.length))}}),(ge&&s.defaultValue!==s.value||Nt(t)==null&&s.value)&&r(rt(s)?lt(s.value):s.value),ca(()=>{var a=t();rt(s)&&a===lt(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function rt(s){var t=s.type;return t==="number"||t==="range"}function lt(s){return s===""?null:+s}function ut(s,t,r){if(s.multiple)return ja(s,t);for(var $ of s.options){var a=Ot($);if(ma(a,t)){$.selected=!0;return}}(!r||t!==void 0)&&(s.selectedIndex=-1)}function Na(s,t){let r=!0;da(()=>{t&&ut(s,Nt(t),r),r=!1;var $=new MutationObserver(()=>{var a=s.__value;ut(s,a)});return $.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{$.disconnect()}})}function ja(s,t){for(var r of s.options)r.selected=~t.indexOf(Ot(r))}function Ot(s){return"__value"in s?s.__value:s.value}function La(s){return function(...t){var r=t[0];r.target===this&&(s==null||s.apply(this,t))}}function qt(s){return function(...t){var r=t[0];return r.stopPropagation(),s==null?void 0:s.apply(this,t)}}function it(s,t){var m;var r=(m=s.$$events)==null?void 0:m[t.type],$=zt(r)?r.slice():r==null?[]:[r];for(var a of $)a.call(this,t)}/**
 * @license lucide-svelte v0.479.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ha=Yt("<svg><!><!></svg>");function Ce(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]),$=be(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let a=te(t,"name",8,void 0),m=te(t,"color",8,"currentColor"),i=te(t,"size",8,24),o=te(t,"strokeWidth",8,2),z=te(t,"absoluteStrokeWidth",8,!1),p=te(t,"iconNode",24,()=>[]);const n=(...P)=>P.filter((q,j,F)=>!!q&&F.indexOf(q)===j).join(" ");Re();var S=Ha();let b;var g=v(S);Ie(g,1,p,Me,(P,q)=>{let j=()=>e(q)[0],F=()=>e(q)[1];var B=fe(),E=ce(B);Ta(E,j,!0,(L,ue)=>{let I;Y(()=>I=ct(L,I,{...F()}))}),u(P,B)});var w=x(g);Ae(w,t,"default",{}),l(S),Y((P,q)=>b=ct(S,b,{...Oa,...$,width:i(),height:i(),stroke:m(),"stroke-width":P,class:q}),[()=>z()?Number(o())*24/Number(i()):o(),()=>n("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)],de),u(s,S),Fe()}function Da(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Ka(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"globe"},()=>r,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Ra(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"image"},()=>r,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Va(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"mic"},()=>r,{iconNode:[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Ht(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"notebook-pen"},()=>r,{iconNode:[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}],["path",{d:"M2 6h4"}],["path",{d:"M2 10h4"}],["path",{d:"M2 14h4"}],["path",{d:"M2 18h4"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Dt(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"paperclip"},()=>r,{iconNode:[["path",{d:"M13.234 20.252 21 12.3"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Fa(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"send"},()=>r,{iconNode:[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Ba(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"settings"},()=>r,{iconNode:[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Ga(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"video"},()=>r,{iconNode:[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}function Kt(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]);Ce(s,Ee({name:"x"},()=>r,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(a,m)=>{var i=fe(),o=ce(i);Ae(o,t,"default",{}),u(a,i)},$$slots:{default:!0}}))}var Wa=M('<div class="spinner svelte-1pi70xe"></div>'),Ua=M("<button><!> <!></button>");function xe(s,t){const r=be(t,["children","$$slots","$$events","$$legacy"]),$=be(r,["type","variant","size","disabled","loading","fullWidth"]);let a=te(t,"type",8,"button"),m=te(t,"variant",8,"primary"),i=te(t,"size",8,"md"),o=te(t,"disabled",8,!1),z=te(t,"loading",8,!1),p=te(t,"fullWidth",8,!1);var n=Ua();let S;var b=v(n);{var g=P=>{var q=Wa();u(P,q)};G(b,P=>{z()&&P(g)})}var w=x(b,2);Ae(w,t,"default",{}),l(n),Y(P=>S=ct(n,S,{type:a(),class:`button ${m()??""} ${i()??""} ${(p()?"full-width":"")??""}`,disabled:o(),...$,[ga]:P},"svelte-1pi70xe"),[()=>({loading:z()})],de),se("click",n,function(P){it.call(this,t,P)}),se("keydown",n,function(P){it.call(this,t,P)}),se("keyup",n,function(P){it.call(this,t,P)}),u(s,n)}var Ya=M('<option class="svelte-1m60q0l"> </option>'),Xa=M('<optgroup label="Local Models" class="svelte-1m60q0l"></optgroup>'),Ja=M('<option class="svelte-1m60q0l"> </option>'),Qa=M('<option class="svelte-1m60q0l"> </option>'),Za=M('<option disabled class="svelte-1m60q0l"> </option>'),es=M('<!> <span class="svelte-1m60q0l">New Chat</span>',1),ts=M('<button type="button"><span class="chat-title svelte-1m60q0l"> </span> <!></button>'),as=M('<aside><div class="sidebar-header svelte-1m60q0l"><div class="logo-container svelte-1m60q0l"><img alt="Gervais Logo" class="logo svelte-1m60q0l"> <h2 class="svelte-1m60q0l">Gervais</h2></div> <!></div> <div class="sidebar-content svelte-1m60q0l"><div class="model-selector svelte-1m60q0l"><select class="select-styled svelte-1m60q0l"><!><optgroup label="OpenAI Models" class="svelte-1m60q0l"></optgroup><optgroup label="Google Models" class="svelte-1m60q0l"></optgroup><optgroup label="Anthropic Models (Disabled)" class="svelte-1m60q0l"></optgroup></select></div> <!> <div class="chats-list svelte-1m60q0l"></div></div></aside>');function ss(s,t){var re;Ve(t,!1);const[r,$]=bt(),a=()=>je(jt,"$activeChat",r),m=()=>je(ka,"$allModelsStore",r),i=()=>je(wa,"$localModelsStore",r),o=()=>je(ie,"$chatStore",r);let z=te(t,"isMobile",8,!1),p=te(t,"isExpanded",8,!0);const n=ht();let S=ne(((re=a())==null?void 0:re.model.id)||"claude-3-5-sonnet");Qe(async()=>{await _a()});function b(){const T=m().find(A=>A.id===e(S));T&&ie.createNewChat(T)}function g(T){ie.selectChat(T),z()&&n("toggleSidebar",!1)}function w(T,A){A.stopPropagation(),ie.deleteChat(T)}function P(T){const A=T.target;if(_(S,A.value),a()){const k=m().find(y=>y.id===e(S));k&&ie.updateChatModel(a().id,k)}}Je(()=>a(),()=>{a()&&_(S,a().model.id)}),_t(),Re();var q=as();let j;var F=v(q),B=v(F),E=v(B);Ne(2),l(B);var L=x(B,2);{var ue=T=>{const A=de(()=>p()?"Collapse sidebar":"Expand sidebar");xe(T,{variant:"icon",size:"sm",class:"collapse-button",get"aria-label"(){return e(A)},$$events:{click:()=>n("toggleSidebar",!p())},children:(k,y)=>{Da(k,{size:20})},$$slots:{default:!0}})};G(L,T=>{z()&&T(ue)})}l(F);var I=x(F,2),C=v(I),K=v(C);Na(K,()=>e(S));var Z,W=v(K);{var J=T=>{var A=Xa();Ie(A,5,i,Me,(k,y)=>{var h=Ya(),c={},D=v(h,!0);l(h),Y(()=>{c!==(c=e(y).id)&&(h.value=(h.__value=e(y).id)==null?"":e(y).id),he(D,e(y).name)}),u(k,h)}),l(A),u(T,A)};G(W,T=>{i().length>0&&T(J)})}var oe=x(W);Ie(oe,5,()=>ya,Me,(T,A)=>{var k=Ja(),y={},h=v(k,!0);l(k),Y(()=>{y!==(y=e(A).id)&&(k.value=(k.__value=e(A).id)==null?"":e(A).id),he(h,e(A).name)}),u(T,k)}),l(oe);var X=x(oe);Ie(X,5,()=>ba,Me,(T,A)=>{var k=Qa(),y={},h=v(k,!0);l(k),Y(()=>{y!==(y=e(A).id)&&(k.value=(k.__value=e(A).id)==null?"":e(A).id),he(h,e(A).name)}),u(T,k)}),l(X);var ae=x(X);Ie(ae,5,()=>$a,Me,(T,A)=>{var k=Za(),y={},h=v(k,!0);l(k),Y(()=>{y!==(y=e(A).id)&&(k.value=(k.__value=e(A).id)==null?"":e(A).id),he(h,e(A).name)}),u(T,k)}),l(ae),l(K),l(C);var ve=x(C,2);xe(ve,{variant:"primary",size:"md",fullWidth:!0,class:"new-chat-button",$$events:{click:b},children:(T,A)=>{var k=es(),y=ce(k);Ht(y,{size:16}),Ne(2),u(T,k)},$$slots:{default:!0}});var U=x(ve,2);Ie(U,5,()=>o().chats,Me,(T,A)=>{var k=ts();let y;var h=v(k),c=v(h,!0);l(h);var D=x(h,2);xe(D,{variant:"icon",size:"sm","aria-label":"Delete chat",$$events:{click:V=>w(e(A).id,V)},children:(V,le)=>{Kt(V,{size:16})},$$slots:{default:!0}}),l(k),Y(V=>{y=Le(k,1,"chat-item svelte-1m60q0l",null,y,V),he(c,e(A).title||"New Chat")},[()=>{var V;return{active:e(A).id===((V=a())==null?void 0:V.id)}}],de),se("click",k,()=>g(e(A).id)),u(T,k)}),l(U),l(I),l(q),Y(T=>{j=Le(q,1,"sidebar svelte-1m60q0l",null,j,T),ye(E,"src","/gervais/logo.svg"),Z!==(Z=e(S))&&(K.value=(K.__value=e(S))==null?"":e(S),ut(K,e(S)))},[()=>({expanded:p()})],de),se("change",K,P),u(s,q),Fe(),$()}var os=M('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"></button>'),rs=M('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),ls=M('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),is=M('<div class="file-size svelte-1mjurqb"> </div>'),ns=M('<span class="document-status success svelte-1mjurqb"> </span>'),vs=M('<span class="document-status info svelte-1mjurqb">Document attached</span>'),cs=M('<span class="document-status success svelte-1mjurqb">Document processed</span>'),ds=M('<span class="document-status info svelte-1mjurqb">Document</span>'),us=M('<span class="document-status error svelte-1mjurqb">Failed to process document</span>'),ps=M('<div class="document-file svelte-1mjurqb" role="button" tabindex="0"><div class="file-icon svelte-1mjurqb">ðŸ“„</div> <div class="file-info svelte-1mjurqb"><div class="file-name svelte-1mjurqb"> </div> <!> <div class="file-status svelte-1mjurqb"><!></div></div></div>'),fs=M('<div class="media-container svelte-1mjurqb"></div>'),ms=M('<div class="message-bubble svelte-1mjurqb"><div class="content svelte-1mjurqb"><p class="svelte-1mjurqb"> </p></div> <!></div>'),gs=M('<button type="button" class="media-preview-button svelte-1mjurqb"><img class="media-preview svelte-1mjurqb"> <div class="image-caption svelte-1mjurqb">Click to view full size</div></button>'),hs=M('<audio controls class="media-preview svelte-1mjurqb">Your browser does not support the audio element.</audio>'),_s=M('<video controls class="media-preview svelte-1mjurqb"><track kind="captions" src="" label="English captions" class="svelte-1mjurqb"> Your browser does not support the video element.</video>',2),ys=M('<div class="media-container assistant-media svelte-1mjurqb"></div>'),bs=M('<details class="thinking svelte-1mjurqb"><summary class="svelte-1mjurqb">Show thinking</summary> <div class="thinking-content svelte-1mjurqb"><!></div></details>'),$s=M('<div class="typing-indicator svelte-1mjurqb"><span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span> <span class="svelte-1mjurqb"></span></div>'),ws=M('<div class="content svelte-1mjurqb"><!> <!> <!> <!></div>'),ks=M('<div class="content system-message svelte-1mjurqb"><!></div>'),xs=M('<div class="timestamp svelte-1mjurqb"> </div>'),As=M('<div class="image-modal-overlay svelte-1mjurqb" role="dialog" aria-modal="true" tabindex="0"><div class="image-modal-content svelte-1mjurqb" role="presentation"><button class="close-modal svelte-1mjurqb" aria-label="Close image preview">Ã—</button> <img class="svelte-1mjurqb"> <div class="modal-caption svelte-1mjurqb"> </div></div></div>'),qs=M("<div><!> <!></div> <!>",1);function Ms(s,t){Ve(t,!1);const r=ne(),$=ne();let a=te(t,"message",8),m=te(t,"isStreaming",8,!1),i=te(t,"scrollToBottom",8,!1),o=ne(!1),z=ne(""),p=ne(""),n=ne();Qe(()=>{if(i()&&e(n)){const I=e(n).parentElement;I&&(I.scrollTop=I.scrollHeight)}});function S(I,C=2){if(I===0)return"0 Bytes";const K=1024,Z=C<0?0:C,W=["Bytes","KB","MB","GB","TB"],J=Math.floor(Math.log(I)/Math.log(K));return parseFloat((I/Math.pow(K,J)).toFixed(Z))+" "+W[J]}function b(I,C="Preview image"){_(z,I),_(p,C),_(o,!0)}function g(){_(o,!1)}Je(()=>xt(a()),()=>{_(r,new Date(a().timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))}),Je(()=>xt(a()),()=>{_($,`message ${a().role}`)}),_t(),Re();var w=qs(),P=ce(w),q=v(P);{var j=I=>{var C=ms(),K=v(C),Z=v(K),W=v(Z,!0);l(Z),l(K);var J=x(K,2);{var oe=X=>{var ae=fs();Ie(ae,5,()=>a().media,Me,(ve,U,re)=>{var T=fe(),A=ce(T);{var k=h=>{var c=os(),D=v(c);ye(D,"alt",`Image ${re+1}`),l(c),Y(()=>ye(D,"src",e(U).preview)),se("click",c,()=>{e(U).preview&&b(e(U).preview,`Image ${re+1}`)}),se("keydown",c,V=>{if(V.key==="Enter"||V.key===" "){if(V.preventDefault(),!e(U).preview)return;b(e(U).preview,`Image ${re+1}`)}}),u(h,c)},y=(h,c)=>{{var D=le=>{var ke=rs();Y(()=>ye(ke,"src",e(U).preview)),u(le,ke)},V=(le,ke)=>{{var f=R=>{var O=ls();Y(()=>ye(O,"src",e(U).preview)),u(R,O)},d=(R,O)=>{{var ee=H=>{var pe=ps(),_e=x(v(pe),2),qe=v(_e),$e=v(qe,!0);l(qe);var Q=x(qe,2);{var N=Se=>{var Pe=is(),Be=v(Pe,!0);l(Pe),Y(Ge=>he(Be,Ge),[()=>S(e(U).size)],de),u(Se,Pe)};G(Q,Se=>{e(U).size&&Se(N)})}var me=x(Q,2),Ze=v(me);{var et=Se=>{var Pe=ns(),Be=v(Pe);l(Pe),Y(Ge=>he(Be,`âœ“ Uploaded to OpenAI (ID: ${Ge??""}...)`),[()=>e(U).fileId.substring(0,8)],de),u(Se,Pe)},Rt=(Se,Pe)=>{{var Be=Oe=>{var Xe=fe(),Vt=ce(Xe);{var Ft=He=>{var tt=vs();u(He,tt)},Bt=(He,tt)=>{{var Gt=De=>{var at=cs();u(De,at)},Wt=De=>{var at=ds();u(De,at)};G(He,De=>{a().role==="assistant"?De(Gt):De(Wt,!1)},tt)}};G(Vt,He=>{a().role==="user"?He(Ft):He(Bt,!1)})}u(Oe,Xe)},Ge=Oe=>{var Xe=us();u(Oe,Xe)};G(Se,Oe=>{e(U).preview?Oe(Be):Oe(Ge,!1)},Pe)}};G(Ze,Se=>{e(U).fileId?Se(et):Se(Rt,!1)})}l(me),l(_e),l(pe),Y(()=>he($e,e(U).name||"Document")),u(H,pe)};G(R,H=>{e(U).type==="document"&&H(ee)},O)}};G(le,R=>{e(U).type==="video"?R(f):R(d,!1)},ke)}};G(h,le=>{e(U).type==="audio"?le(D):le(V,!1)},c)}};G(A,h=>{e(U).type==="image"?h(k):h(y,!1)})}u(ve,T)}),l(ae),u(X,ae)};G(J,X=>{a().media&&a().media.length>0&&X(oe)})}l(C),Y(()=>he(W,a().content)),u(I,C)},F=(I,C)=>{{var K=W=>{var J=ws(),oe=v(J);ot(oe,{get content(){return a().content},get scrollToBottom(){return i()}});var X=x(oe,2);{var ae=A=>{var k=ys();Ie(k,5,()=>a().media,Me,(y,h,c)=>{var D=fe(),V=ce(D);{var le=f=>{var d=gs(),R=v(d);ye(R,"alt",`Generated image ${c+1}`),Ne(2),l(d),Y(()=>ye(R,"src",e(h).preview)),se("click",d,()=>{e(h).preview&&b(e(h).preview,`Generated image ${c+1}`)}),se("keydown",d,O=>{if(O.key==="Enter"||O.key===" "){if(O.preventDefault(),!e(h).preview)return;b(e(h).preview,`Generated image ${c+1}`)}}),u(f,d)},ke=(f,d)=>{{var R=ee=>{var H=hs();Y(()=>ye(H,"src",e(h).preview)),u(ee,H)},O=(ee,H)=>{{var pe=_e=>{var qe=_s();Y(()=>ye(qe,"src",e(h).preview)),u(_e,qe)};G(ee,_e=>{e(h).type==="video"&&_e(pe)},H)}};G(f,ee=>{e(h).type==="audio"?ee(R):ee(O,!1)},d)}};G(V,f=>{e(h).type==="image"?f(le):f(ke,!1)})}u(y,D)}),l(k),u(A,k)};G(X,A=>{a().media&&a().media.length>0&&A(ae)})}var ve=x(X,2);{var U=A=>{var k=bs(),y=x(v(k),2),h=v(y);ot(h,{get content(){return a().thinking},scrollToBottom:!1}),l(y),l(k),u(A,k)};G(ve,A=>{a().thinking&&A(U)})}var re=x(ve,2);{var T=A=>{var k=$s();u(A,k)};G(re,A=>{m()&&A(T)})}l(J),u(W,J)},Z=(W,J)=>{{var oe=X=>{var ae=ks(),ve=v(ae);ot(ve,{get content(){return a().content},get scrollToBottom(){return i()}}),l(ae),u(X,ae)};G(W,X=>{a().role==="system"&&X(oe)},J)}};G(I,W=>{a().role==="assistant"?W(K):W(Z,!1)},C)}};G(q,I=>{a().role==="user"?I(j):I(F,!1)})}var B=x(q,2);{var E=I=>{var C=xs(),K=v(C,!0);l(C),Y(()=>he(K,e(r))),u(I,C)};G(B,I=>{a().role==="user"&&I(E)})}l(P),yt(P,I=>_(n,I),()=>e(n));var L=x(P,2);{var ue=I=>{var C=As(),K=v(C),Z=v(K),W=x(Z,2),J=x(W,2),oe=v(J,!0);l(J),l(K),l(C),Y(()=>{ye(W,"src",e(z)),ye(W,"alt",e(p)),he(oe,e(p))}),se("click",Z,g),se("click",K,qt(()=>{})),se("keydown",K,qt(()=>{})),se("click",C,g),se("keydown",C,X=>X.key==="Escape"&&g()),u(I,C)};G(L,I=>{e(o)&&I(ue)})}Y(()=>Le(P,1,ha(e($)),"svelte-1mjurqb")),u(s,w),Fe()}var Is=M('<img class="svelte-3q6qyw">'),Ss=M('<div class="file-preview svelte-3q6qyw"><span> </span></div>'),Es=M('<div class="media-item svelte-3q6qyw"><!> <button type="button" class="remove-media svelte-3q6qyw" aria-label="Remove media">&times;</button></div>'),Cs=M("<div><!></div>"),Ps=M("<div><!></div>"),zs=M("<div><!></div>"),Ts=M('<button type="button"> </button>'),Ns=M('<div class="message-input-container svelte-3q6qyw"><div class="media-preview svelte-3q6qyw"></div> <div class="input-bubble svelte-3q6qyw"><div class="input-container svelte-3q6qyw"><textarea rows="1" class="svelte-3q6qyw"></textarea></div> <div class="actions-bar svelte-3q6qyw"><div class="left-actions svelte-3q6qyw"><input type="file" id="file-upload" hidden accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,application/rtf,text/rtf,application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.presentation" multiple> <!> <!> <!> <!></div> <div class="right-actions svelte-3q6qyw"><!></div></div></div> <div class="tools-bar svelte-3q6qyw"></div></div>');function js(s,t){Ve(t,!1);let r=te(t,"value",12,""),$=te(t,"placeholder",8,"Send a message..."),a=te(t,"disabled",8,!1),m=te(t,"isRecording",8,!1),i=te(t,"isCapturingVideo",8,!1),o=te(t,"mediaItems",28,()=>[]),z=te(t,"tools",24,()=>({}));const p=ht();let n=ne();function S(){e(n)&&(we(n,e(n).style.height="auto"),we(n,e(n).style.height=`${Math.min(e(n).scrollHeight,200)}px`))}function b(){a()||!r().trim()&&o().length===0||(p("submit",{content:r().trim(),media:o(),tools:z()}),r(""),e(n)&&we(n,e(n).style.height="auto"))}function g(y){y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),b())}function w(){m()?p("stopAudioCapture"):p("startAudioCapture")}function P(){i()?p("stopVideoCapture"):p("startVideoCapture")}function q(y){const h=y.target;if(h.files&&h.files.length>0){const c=Array.from(h.files);p("uploadFile",c),h.value=""}}function j(y){const h=!z()[y];p("toggleTool",{tool:y,enabled:h})}Je(()=>e(n),()=>{e(n)&&S()}),_t(),Re();var F=Ns(),B=v(F);Ie(B,5,o,Me,(y,h)=>{var c=Es(),D=v(c);{var V=f=>{var d=Is();Y(()=>{ye(d,"src",e(h).preview),ye(d,"alt",e(h).name)}),u(f,d)},le=f=>{var d=Ss(),R=v(d),O=v(R,!0);l(R),l(d),Y(()=>he(O,e(h).name)),u(f,d)};G(D,f=>{e(h).type==="image"&&e(h).preview?f(V):f(le,!1)})}var ke=x(D,2);l(c),se("click",ke,()=>{o(o().filter(f=>f.id!==e(h).id))}),u(y,c)}),l(B);var E=x(B,2),L=v(E),ue=v(L);fa(ue),yt(ue,y=>_(n,y),()=>e(n)),l(L);var I=x(L,2),C=v(I),K=v(C),Z=x(K,2);xe(Z,{variant:"icon",size:"sm",get disabled(){return a()},"aria-label":"Upload file",$$events:{click:()=>{var y;return(y=document.getElementById("file-upload"))==null?void 0:y.click()}},children:(y,h)=>{Dt(y,{size:18})},$$slots:{default:!0}});var W=x(Z,2);const J=de(()=>a()||m()),oe=de(()=>m()?"Stop recording":"Start recording");xe(W,{variant:"icon",size:"sm",get disabled(){return e(J)},get"aria-label"(){return e(oe)},$$events:{click:w},children:(y,h)=>{var c=Cs();let D;var V=v(c);Va(V,{size:18}),l(c),Y(le=>D=Le(c,1,"",null,D,le),[()=>({active:m()})],de),u(y,c)},$$slots:{default:!0}});var X=x(W,2);const ae=de(()=>a()||m()),ve=de(()=>i()?"Stop video capture":"Start video capture");xe(X,{variant:"icon",size:"sm",get disabled(){return e(ae)},get"aria-label"(){return e(ve)},$$events:{click:P},children:(y,h)=>{var c=Ps();let D;var V=v(c);Ga(V,{size:18}),l(c),Y(le=>D=Le(c,1,"",null,D,le),[()=>({active:i()})],de),u(y,c)},$$slots:{default:!0}});var U=x(X,2);xe(U,{variant:"icon",size:"sm","aria-label":"Toggle web search",$$events:{click:()=>j("search")},children:(y,h)=>{var c=zs();let D;var V=v(c);Ka(V,{size:18}),l(c),Y(le=>D=Le(c,1,"",null,D,le),[()=>({active:z().search})],de),u(y,c)},$$slots:{default:!0}}),l(C);var re=x(C,2),T=v(re);const A=de(()=>a()||!r().trim()&&o().length===0);xe(T,{variant:"icon",size:"sm",get disabled(){return e(A)},"aria-label":"Send message",$$events:{click:b},children:(y,h)=>{Fa(y,{size:18})},$$slots:{default:!0}}),l(re),l(I),l(E);var k=x(E,2);Ie(k,5,()=>Object.entries(z()),Me,(y,h)=>{let c=()=>e(h)[0],D=()=>e(h)[1];var V=fe(),le=ce(V);{var ke=f=>{var d=Ts();let R;var O=v(d,!0);l(d),Y(ee=>{R=Le(d,1,"tool-button svelte-3q6qyw",null,R,ee),ye(d,"aria-label",`Toggle ${c()??""}`),he(O,c())},[()=>({enabled:D()})],de),se("click",d,()=>j(c())),u(f,d)};G(le,f=>{c()!=="search"&&f(ke)})}u(y,V)}),l(k),l(F),Y(()=>{ye(ue,"placeholder",$()),ue.disabled=a()}),Ke(ue,r),se("keydown",ue,g),se("change",K,q),u(s,F),Fe()}var Ls=M('<span class="success-message svelte-8a76oy">API keys saved successfully!</span>'),Os=M('<span class="error-message svelte-8a76oy"> </span>'),Hs=M('<div class="settings-overlay svelte-8a76oy" role="dialog" aria-modal="true" tabindex="-1"><div class="settings-modal svelte-8a76oy"><div class="settings-header svelte-8a76oy"><h2 class="svelte-8a76oy">Settings</h2> <!></div> <div class="settings-content svelte-8a76oy"><section class="svelte-8a76oy"><h3 class="svelte-8a76oy">API Keys</h3> <p class="description svelte-8a76oy">Add your API keys to use different LLM providers. Keys are stored locally in your browser and never sent out anywhere.</p> <div class="api-keys-form svelte-8a76oy"><div class="form-group svelte-8a76oy"><label for="anthropic-key" class="svelte-8a76oy">Anthropic API Key</label> <input id="anthropic-key" type="password" placeholder="Enter Anthropic API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="openai-key" class="svelte-8a76oy">OpenAI API Key</label> <input id="openai-key" type="password" placeholder="Enter OpenAI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="google-key" class="svelte-8a76oy">Google AI API Key</label> <input id="google-key" type="password" placeholder="Enter Google AI API key" autocomplete="off" class="svelte-8a76oy"></div> <div class="form-group svelte-8a76oy"><label for="ollama-host" class="svelte-8a76oy">Ollama Host</label> <input id="ollama-host" type="text" placeholder="http://localhost:11434" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">Example: http://localhost:11434</small></div> <div class="form-group svelte-8a76oy"><label for="local-host" class="svelte-8a76oy">Local LLM Host</label> <input id="local-host" type="text" placeholder="http://localhost:8000" autocomplete="off" class="svelte-8a76oy"> <small class="svelte-8a76oy">URL for your self-hosted LLM server</small></div></div> <div class="form-actions svelte-8a76oy"><!> <!> <!></div></section></div></div></div>');function Ds(s,t){Ve(t,!1);const[r,$]=bt(),a=()=>je(dt,"$settingsStore",r);let m=te(t,"isOpen",8,!1);const i=ht();let o=ne({anthropic:"",openai:"",google:"",ollamaHost:"http://localhost:11434",localHost:"http://localhost:8000"}),z=ne(!1),p=ne(!1),n=ne("");Qe(()=>{console.log("Settings component mounted, current settingsStore value:",a());const q=a().apiKeys||{};console.log("Stored API keys from settings store:",q),_(o,{anthropic:q.anthropic||"",openai:q.openai||"",google:q.google||"",ollamaHost:q.ollamaHost||"http://localhost:11434",localHost:q.localHost||"http://localhost:8000"}),console.log("Initialized API key form with:",e(o))});function S(){i("close")}async function b(){var q;_(z,!0),_(p,!1),_(n,"");try{if(console.log("Saving API keys to settingsStore:",e(o)),e(o).openai){console.log("EXACT OPENAI KEY BEING SAVED: ",e(o).openai),console.log(`OpenAI key before saving: length=${e(o).openai.length}, starts with=${e(o).openai.substring(0,4)}`);const j=[...e(o).openai.substring(0,10)].map(F=>F.charCodeAt(0));console.log(`First 10 character codes: ${j.join(", ")}`)}if(await dt.updateApiKeys({anthropic:e(o).anthropic,openai:e(o).openai,google:e(o).google,ollamaHost:e(o).ollamaHost||"http://localhost:11434",localHost:e(o).localHost||"http://localhost:8000"}),console.log("API keys saved. Current settingsStore value:",a()),(q=a().apiKeys)!=null&&q.openai){console.log("EXACT OPENAI KEY AFTER SAVING: ",a().apiKeys.openai),console.log(`OpenAI key after saving: length=${a().apiKeys.openai.length}, starts with=${a().apiKeys.openai.substring(0,4)}`);const j=[...a().apiKeys.openai.substring(0,10)].map(F=>F.charCodeAt(0));console.log(`First 10 character codes after saving: ${j.join(", ")}`)}_(p,!0),console.log("API keys saved successfully"),setTimeout(()=>{_(p,!1)},3e3)}catch(j){console.error("Failed to save API keys:",j),_(n,j instanceof Error?j.message:"Unknown error")}finally{_(z,!1)}}Re();var g=fe(),w=ce(g);{var P=q=>{var j=Hs(),F=v(j),B=v(F),E=x(v(B),2);xe(E,{variant:"icon","aria-label":"Close settings",$$events:{click:S},children:(c,D)=>{Kt(c,{size:20})},$$slots:{default:!0}}),l(B);var L=x(B,2),ue=v(L),I=x(v(ue),4),C=v(I),K=x(v(C),2);We(K),l(C);var Z=x(C,2),W=x(v(Z),2);We(W),l(Z);var J=x(Z,2),oe=x(v(J),2);We(oe),l(J);var X=x(J,2),ae=x(v(X),2);We(ae),Ne(2),l(X);var ve=x(X,2),U=x(v(ve),2);We(U),Ne(2),l(ve),l(I);var re=x(I,2),T=v(re);xe(T,{variant:"primary",get disabled(){return e(z)},$$events:{click:b},children:(c,D)=>{Ne();var V=Xt();Y(()=>he(V,e(z)?"Saving...":"Save API Keys")),u(c,V)},$$slots:{default:!0}});var A=x(T,2);{var k=c=>{var D=Ls();u(c,D)};G(A,c=>{e(p)&&c(k)})}var y=x(A,2);{var h=c=>{var D=Os(),V=v(D,!0);l(D),Y(()=>he(V,e(n))),u(c,D)};G(y,c=>{e(n)&&c(h)})}l(re),l(ue),l(L),l(F),l(j),Ke(K,()=>e(o).anthropic,c=>we(o,e(o).anthropic=c)),Ke(W,()=>e(o).openai,c=>we(o,e(o).openai=c)),Ke(oe,()=>e(o).google,c=>we(o,e(o).google=c)),Ke(ae,()=>e(o).ollamaHost,c=>we(o,e(o).ollamaHost=c)),Ke(U,()=>e(o).localHost,c=>we(o,e(o).localHost=c)),se("click",j,La(S)),se("keydown",j,c=>c.key==="Escape"&&S()),u(q,j)};G(w,q=>{m()&&q(P)})}u(s,g),Fe(),$()}var Ks=M('<div class="sidebar-backdrop svelte-u7neki" role="button" tabindex="0" aria-label="Close sidebar"></div>'),Rs=M('<div class="empty-state svelte-u7neki"><h2 class="svelte-u7neki">Start a new conversation</h2> <p class="svelte-u7neki">Send a message to start chatting with the AI assistant.</p> <div class="feature-highlights svelte-u7neki"><div class="feature svelte-u7neki"><!> <span>Attach files for analysis</span></div> <div class="feature svelte-u7neki"><!> <span>Vision support for images</span></div></div></div>'),Vs=M('<div class="settings-portal svelte-u7neki"><!></div>'),Fs=M('<div class="chat-container svelte-u7neki"><!> <!> <main class="chat-main svelte-u7neki"><header class="chat-header svelte-u7neki"><!> <h1 class="chat-title svelte-u7neki"> </h1> <!></header> <div class="chat-messages svelte-u7neki"><!></div> <div class="input-container svelte-u7neki"><!></div></main></div> <!>',1);function ao(s,t){Ve(t,!1);const[r,$]=bt(),a=()=>je(jt,"$activeChat",r),m=()=>je(dt,"$settingsStore",r);let i=ne(!1),o=ne(!0),z=ne(""),p=ne(!1),n=ne(!1),S=ne([]),b=ne({search:!1}),g=ne(),w=ne(!1);function P(){_(i,window.innerWidth<768),e(i)?_(o,!1):_(o,!0)}Qe(()=>(P(),window.addEventListener("resize",P),()=>{window.removeEventListener("resize",P)}));function q(){_(o,!e(o))}async function j({detail:f}){var pe,_e,qe;if(!a())return;const d=a().model.provider;if(console.log("Current settings store state:",m()),d==="openai"&&!((pe=m().apiKeys)!=null&&pe.openai)){console.warn("OpenAI API key not set, opening settings dialog"),_(w,!0),alert("Please set your OpenAI API key in Settings to use this model.");return}else if(d==="anthropic"&&!((_e=m().apiKeys)!=null&&_e.anthropic)){console.warn("Anthropic API key not set, opening settings dialog"),_(w,!0),alert("Please set your Anthropic API key in Settings to use this model.");return}else if(d==="google"&&!((qe=m().apiKeys)!=null&&qe.google)){console.warn("Google API key not set, opening settings dialog"),_(w,!0),alert("Please set your Google API key in Settings to use this model.");return}const{content:R,media:O,tools:ee}=f;console.log("Media items in submission:",O),await ie.addMessage(a().id,{role:"user",content:R,media:O}),_(z,""),_(S,[]),setTimeout(()=>{e(g)&&we(g,e(g).scrollTop=e(g).scrollHeight)},100);const H=await ie.addMessage(a().id,{role:"assistant",content:""});_(p,!0),_(n,!0);try{const $e=a().messages.slice(0,-1);console.log("Sending messages to LLM with media:",$e);const Q=a().model.id;if(d==="anthropic")await qa(Q,$e,N=>{ie.updateMessage(a().id,H,{content:N})},()=>{_(p,!1),_(n,!1),setTimeout(()=>{e(g)&&we(g,e(g).scrollTop=e(g).scrollHeight)},100)},N=>{console.error("Error generating response:",N),ie.updateMessage(a().id,H,{content:`Error generating response: â€“ ${N.message}`}),_(p,!1),_(n,!1)},N=>{ie.updateMessage(a().id,H,{thinking:N})});else if(d==="openai")if(e(n))await Ma(Q,$e,N=>{ie.updateMessage(a().id,H,{content:N})},()=>{_(p,!1),_(n,!1),setTimeout(()=>{e(g)&&we(g,e(g).scrollTop=e(g).scrollHeight)},100)},N=>{console.error("Error generating response from OpenAI:",N);const me=N.message||"An unknown error occurred";ie.updateMessage(a().id,H,{content:`Error: ${me}`}),_(p,!1),_(n,!1)});else try{const N=await Ia(Q,$e);ie.updateMessage(a().id,H,{content:N}),_(p,!1)}catch(N){console.error("Error generating non-streaming response from OpenAI:",N);const me=N.message||"An unknown error occurred";throw ie.updateMessage(a().id,H,{content:`Error: ${me}`}),_(p,!1),N}else if(d==="google")await Sa(Q,$e,(N,me)=>{ie.updateMessage(a().id,H,{content:N,media:me})},()=>{_(p,!1),_(n,!1),setTimeout(()=>{e(g)&&we(g,e(g).scrollTop=e(g).scrollHeight)},100)},N=>{console.error("Error generating response from Google:",N);const me=N.message||"An unknown error occurred";ie.updateMessage(a().id,H,{content:`Error: ${me}`}),_(p,!1),_(n,!1)},N=>{ie.updateMessage(a().id,H,{thinking:N})});else if(d==="ollama")try{await Ea(Q,$e,N=>{ie.updateMessage(a().id,H,{content:N})},()=>{_(p,!1),_(n,!1),setTimeout(()=>{e(g)&&we(g,e(g).scrollTop=e(g).scrollHeight)},100)},N=>{console.error("Error generating response from Ollama:",N);const me=N.message||"An unknown error occurred";ie.updateMessage(a().id,H,{content:`Error connecting to Ollama: ${me}. Make sure Ollama is running locally.`}),_(p,!1),_(n,!1)})}catch(N){throw console.error("Error generating response from Ollama:",N),N}else{let N="";const me="This is a placeholder response. Please set up your API keys in Settings to use actual LLM services.".split(" ");for(const Ze of me)await new Promise(et=>setTimeout(et,50)),N+=Ze+" ",ie.updateMessage(a().id,H,{content:N.trim()});_(p,!1),_(n,!1)}}catch($e){if(console.error("Error generating response:",$e),e(p)){const Q=$e.message||"An unknown error occurred";ie.updateMessage(a().id,H,{content:`Error: ${Q}`}),_(p,!1),_(n,!1)}}}function F(f){f.forEach(async d=>{const R=xa(),O=d.name,ee=d.size;let H="other",pe,_e;console.log(`Processing file: ${O}, type: ${d.type}, size: ${ee} bytes`);const qe=Q=>{var N;if(Q.type.includes("pdf")||Q.type.includes("word")||Q.type.includes("excel")||Q.type.includes("spreadsheet")||Q.type.includes("presentation")||Q.type.includes("officedocument")||Q.type.includes("application/rtf")||Q.type.includes("text/rtf"))return!0;if(!Q.type||Q.type==="application/octet-stream"){const me=(N=O.split(".").pop())==null?void 0:N.toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","csv"].includes(me||"")}return!1};if(d.type.startsWith("image/")){H="image";try{pe=await B(d),console.log(`Created data URL for image ${O} (length: ${pe.length} chars)`)}catch(Q){console.error(`Failed to create data URL for ${O}:`,Q)}}else if(d.type.startsWith("audio/"))H="audio";else if(d.type.startsWith("video/"))H="video";else if(d.type.startsWith("text/"))H="text";else if(qe(d)){if(H="document",a()&&a().model.provider==="openai")try{_e=await Aa(d),console.log(`Document ${O} uploaded to OpenAI with ID: ${_e}`)}catch(Q){console.error(`Failed to upload document to OpenAI: ${Q.message}`),alert(`Failed to upload document to OpenAI: ${Q.message}`)}try{pe=await B(d),console.log(`Created data URL for document ${O}, mime type: ${d.type}`),console.log(`Document data URL length: ${pe.length} chars`),ee>5*1024*1024&&console.warn(`Warning: Large document (${(ee/(1024*1024)).toFixed(2)}MB) may cause issues with API limits`)}catch(Q){console.error(`Failed to create data URL for ${O}:`,Q)}}const $e={id:R,type:H,name:O,preview:pe,size:ee,timestamp:Date.now(),fileId:_e};console.log(`Adding media item: ${H} ${O}`),_(S,[...e(S),$e])})}async function B(f){return new Promise((d,R)=>{const O=new FileReader;O.onload=()=>{const ee=O.result;d(ee)},O.onerror=ee=>{console.error("Error reading file:",ee),R(ee)},O.readAsDataURL(f)})}function E({detail:f}){const{tool:d,enabled:R}=f;_(b,{...e(b),[d]:R})}function L(){console.log("Start audio capture")}function ue(){console.log("Stop audio capture")}function I(){console.log("Start video capture")}function C(){console.log("Stop video capture")}Re();var K=Fs(),Z=ce(K),W=v(Z);ss(W,{get isMobile(){return e(i)},get isExpanded(){return e(o)},$$events:{toggleSidebar:({detail:f})=>_(o,f)}});var J=x(W,2);{var oe=f=>{var d=Ks();se("click",d,()=>_(o,!1)),se("keydown",d,R=>R.key==="Escape"&&_(o,!1)),u(f,d)};G(J,f=>{e(i)&&e(o)&&f(oe)})}var X=x(J,2),ae=v(X),ve=v(ae);{var U=f=>{xe(f,{variant:"icon","aria-label":"Open menu",$$events:{click:q},children:(d,R)=>{Ht(d,{size:20})},$$slots:{default:!0}})};G(ve,f=>{e(i)&&f(U)})}var re=x(ve,2),T=v(re,!0);l(re);var A=x(re,2);xe(A,{variant:"icon","aria-label":"Open settings",$$events:{click:()=>_(w,!0)},children:(f,d)=>{Ba(f,{size:20})},$$slots:{default:!0}}),l(ae);var k=x(ae,2),y=v(k);{var h=f=>{var d=fe(),R=ce(d);Ie(R,1,()=>a().messages,Me,(O,ee,H)=>{const pe=de(()=>e(n)&&H===a().messages.length-1&&e(ee).role==="assistant"),_e=de(()=>H===a().messages.length-1);Ms(O,{get message(){return e(ee)},get isStreaming(){return e(pe)},get scrollToBottom(){return e(_e)}})}),u(f,d)},c=f=>{var d=Rs(),R=x(v(d),4),O=v(R),ee=v(O);Dt(ee,{size:16}),Ne(2),l(O);var H=x(O,2),pe=v(H);Ra(pe,{size:16}),Ne(2),l(H),l(R),l(d),u(f,d)};G(y,f=>{a()&&a().messages.length>0?f(h):f(c,!1)})}l(k),yt(k,f=>_(g,f),()=>e(g));var D=x(k,2),V=v(D);js(V,{get tools(){return e(b)},get disabled(){return e(p)},placeholder:"Send a message...",get value(){return e(z)},set value(f){_(z,f)},get mediaItems(){return e(S)},set mediaItems(f){_(S,f)},$$events:{submit:j,uploadFile:f=>F(f.detail),toggleTool:E,startAudioCapture:L,stopAudioCapture:ue,startVideoCapture:I,stopVideoCapture:C},$$legacy:!0}),l(D),l(X),l(Z);var le=x(Z,2);{var ke=f=>{var d=Vs(),R=v(d);Ds(R,{isOpen:!0,$$events:{close:()=>_(w,!1)}}),l(d),u(f,d)};G(le,f=>{e(w)&&f(ke)})}Y(()=>{var f;return he(T,((f=a())==null?void 0:f.model.name)||"AI Assistant")}),u(s,K),Fe(),$()}export{ao as component};
